<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ParenaTrade ‚Äì G√ºrcistan Yatƒ±rƒ±m ve Pazar Analiz Platformu</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary-orange: #ea580c;
            --primary-orange-dark: #c2410c;
            --primary-orange-light: #fdba74;
            --secondary-red: #dc2626;
            --accent-amber: #f59e0b;
            --gray-50: #fafafa;
            --gray-100: #f4f4f5;
            --gray-200: #e4e4e7;
            --gray-300: #d4d4d8;
            --gray-400: #a1a1aa;
            --gray-500: #71717a;
            --gray-600: #52525b;
            --gray-700: #3f3f46;
            --gray-800: #27272a;
            --gray-900: #18181b;
            --text-dark: #18181b;
            --text-light: #71717a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            color: var(--text-dark);
            line-height: 1.6;
            font-size: 16px;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Typography */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
            line-height: 1.2;
            color: var(--text-dark);
        }

        h1 {
            font-size: 3.5rem;
            font-weight: 700;
        }

        h2 {
            font-size: 2.5rem;
        }

        h3 {
            font-size: 1.5rem;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            font-size: 14px;
            text-decoration: none;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-orange), var(--secondary-red));
            color: white;
            box-shadow: 0 1px 3px rgba(234, 88, 12, 0.2);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(234, 88, 12, 0.3);
        }

        .btn-secondary {
            background: white;
            color: var(--text-dark);
            border: 1px solid var(--gray-300);
        }

        .btn-secondary:hover {
            border-color: var(--primary-orange);
            color: var(--primary-orange);
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--gray-200);
            z-index: 1000;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            font-size: 18px;
            color: var(--text-dark);
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--primary-orange), var(--secondary-red));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-icon svg {
            width: 16px;
            height: 16px;
            color: white;
        }

        .nav {
            display: flex;
            gap: 32px;
        }

        .nav a {
            color: var(--gray-600);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: color 0.2s ease;
        }

        .nav a:hover {
            color: var(--primary-orange);
        }

        /* Hero Section - G√úNCELLENDƒ∞ */
        .hero {
            padding: 180px 0 100px;
            background: linear-gradient(135deg, #fef7f0 0%, #fef2f2 100%);
            position: relative;
            overflow: hidden;
        }

        .hero-content {
            text-align: center;
            max-width: 800px;
            margin: 0 auto 60px;
        }

        .hero h1 {
            margin-bottom: 24px;
            background: linear-gradient(135deg, var(--text-dark), var(--primary-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 20px;
            color: var(--gray-600);
            margin-bottom: 40px;
            line-height: 1.6;
        }

        .hero-actions {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-bottom: 60px;
        }

        /* Georgia Map Animation */
        .georgia-map {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            height: 400px;
        }

        .map-container {
            position: relative;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--gray-200);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
        }

        .city-marker {
            position: absolute;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, var(--primary-orange), var(--secondary-red));
            border-radius: 50%;
            cursor: pointer;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
            box-shadow: 0 0 0 rgba(234, 88, 12, 0.4);
        }

        .city-marker:hover {
            transform: translate(-50%, -50%) scale(1.3);
            box-shadow: 0 0 20px rgba(234, 88, 12, 0.6);
        }

        .city-info {
            position: absolute;
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            min-width: 200px;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 10;
            border: 1px solid var(--gray-200);
        }

        .city-marker:hover .city-info {
            opacity: 1;
            transform: translateY(0);
        }

        .tbilisi { top: 40%; left: 60%; }
        .batumi { top: 20%; left: 25%; }
        .kutaisi { top: 45%; left: 50%; }
        .poti { top: 25%; left: 30%; }
        .hualing { top: 35%; left: 55%; }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(234, 88, 12, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(234, 88, 12, 0); }
            100% { box-shadow: 0 0 0 0 rgba(234, 88, 12, 0); }
        }

        /* Features Grid */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 32px;
            margin-bottom: 60px;
        }

        .feature-card {
            padding: 32px;
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            transition: all 0.2s ease;
        }

        .feature-card:hover {
            border-color: var(--primary-orange);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        }

        .feature-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .feature-icon.orange { background: #fef3f2; }
        .feature-icon.red { background: #fef2f2; }
        .feature-icon.amber { background: #fffbeb; }
        .feature-icon.emerald { background: #f0fdf4; }
        .feature-icon.purple { background: #faf5ff; }
        .feature-icon.blue { background: #eff6ff; }

        .feature-icon svg {
            width: 20px;
            height: 20px;
        }

        .feature-icon.orange svg { color: #ea580c; }
        .feature-icon.red svg { color: #dc2626; }
        .feature-icon.amber svg { color: #d97706; }
        .feature-icon.emerald svg { color: #059669; }
        .feature-icon.purple svg { color: #7c3aed; }
        .feature-icon.blue svg { color: #2563eb; }

        /* Free Zones Section */
        .free-zones {
            padding: 100px 0;
            background: var(--gray-50);
        }

        .zones-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 32px;
        }

        .zone-card {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 32px;
            text-align: center;
            transition: all 0.2s ease;
        }

        .zone-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-orange);
        }

        .zone-icon {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--primary-orange), var(--secondary-red));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }

        .zone-icon svg {
            width: 24px;
            height: 24px;
            color: white;
        }

        .zone-advantage {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 8px 0;
            font-size: 14px;
            color: var(--gray-600);
        }

        .zone-advantage .check {
            color: #059669;
            flex-shrink: 0;
        }

        /* Batum Construction Section */
        .batum-construction {
            padding: 100px 0;
            background: white;
            position: relative;
            overflow: hidden;
        }

        .construction-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 60px;
            align-items: center;
        }

        .construction-animation {
            position: relative;
            height: 400px;
            border-radius: 16px;
            overflow: hidden;
        }

        .construction-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .building {
            position: absolute;
            bottom: 0;
            width: 60px;
            background: linear-gradient(to top, #475569, #64748b);
            transition: all 0.5s ease;
        }

        .building-1 { left: 20%; height: 150px; animation: grow-1 3s ease-in-out infinite alternate; }
        .building-2 { left: 35%; height: 200px; animation: grow-2 4s ease-in-out infinite alternate; }
        .building-3 { left: 50%; height: 250px; animation: grow-3 5s ease-in-out infinite alternate; }
        .building-4 { left: 65%; height: 180px; animation: grow-4 3.5s ease-in-out infinite alternate; }
        .building-5 { left: 80%; height: 220px; animation: grow-5 4.5s ease-in-out infinite alternate; }

        @keyframes grow-1 {
            0% { height: 150px; }
            100% { height: 180px; }
        }

        @keyframes grow-2 {
            0% { height: 200px; }
            100% { height: 240px; }
        }

        @keyframes grow-3 {
            0% { height: 250px; }
            100% { height: 300px; }
        }

        @keyframes grow-4 {
            0% { height: 180px; }
            100% { height: 220px; }
        }

        @keyframes grow-5 {
            0% { height: 220px; }
            100% { height: 260px; }
        }

        .advantages-list {
            list-style: none;
        }

        .advantages-list li {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            font-size: 16px;
            color: var(--gray-600);
        }

        .advantages-list .check {
            color: #059669;
            flex-shrink: 0;
        }

        /* Services Section */
        .services {
            padding: 100px 0;
            background: var(--gray-50);
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 32px;
        }

        .service-card {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 32px;
            transition: all 0.2s ease;
        }

        .service-card:hover {
            border-color: var(--primary-orange);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        }

        .service-card h3 {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .service-card .icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-orange), var(--secondary-red));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .service-card .icon svg {
            width: 20px;
            height: 20px;
            color: white;
        }

        /* Reports Section - G√ºncellendi */
        .reports {
            padding: 100px 0;
            background: white;
        }

        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 32px;
        }

        .report-card {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.2s ease;
        }

        .report-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-orange);
        }

        .report-badge {
            background: var(--primary-orange);
            color: white;
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 600;
            border-bottom-right-radius: 8px;
            display: inline-block;
        }

        .report-content {
            padding: 24px;
        }

        .report-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin: 16px 0;
        }

        .stat-item {
            text-align: center;
            padding: 12px;
            background: var(--gray-50);
            border-radius: 8px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* CTA Section */
        .cta {
            padding: 100px 0;
            background: linear-gradient(135deg, var(--primary-orange), var(--secondary-red));
            color: white;
            text-align: center;
        }

        .cta h2 {
            color: white;
            margin-bottom: 16px;
        }

        .cta p {
            font-size: 18px;
            margin-bottom: 32px;
            opacity: 0.9;
        }

        .cta-actions {
            display: flex;
            gap: 16px;
            justify-content: center;
        }

        /* Footer */
        .footer {
            background: var(--gray-900);
            color: var(--gray-400);
            padding: 60px 0 40px;
        }

        .footer-content {
            text-align: center;
        }

        .footer-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
            color: white;
            font-weight: 600;
            font-size: 18px;
        }

        .footer-logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--primary-orange), var(--secondary-red));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .footer-logo-icon svg {
            width: 16px;
            height: 16px;
            color: white;
        }

        .footer p {
            margin-bottom: 8px;
            font-size: 14px;
        }

        .footer-disclaimer {
            border-top: 1px solid var(--gray-800);
            margin-top: 40px;
            padding-top: 32px;
            font-size: 12px;
            color: var(--gray-500);
        }

        /* AI Analysis Section Styles */
        .ai-analysis {
            padding: 100px 0;
            background: white;
        }

        .ai-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 48px;
        }

        .ai-card {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
        }

        .chat-container {
            height: 400px;
            overflow-y: auto;
            padding: 20px;
            background: var(--gray-50);
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid var(--gray-200);
        }

        .chat-bubble {
            background: white;
            border-radius: 18px;
            padding: 12px 18px;
            margin-bottom: 12px;
            max-width: 80%;
            border: 1px solid var(--gray-200);
        }

        .chat-bubble.user {
            background: linear-gradient(135deg, var(--primary-orange), var(--secondary-red));
            color: white;
            margin-left: auto;
            border: none;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-dark);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s ease;
            background: white;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary-orange);
            box-shadow: 0 0 0 3px rgba(234, 88, 12, 0.1);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 0 16px;
            }
            
            h1 {
                font-size: 2.5rem;
            }
            
            h2 {
                font-size: 2rem;
            }
            
            .hero-actions,
            .cta-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .nav {
                display: none;
            }
            
            .ai-grid,
            .construction-content {
                grid-template-columns: 1fr;
            }
            
            .features-grid,
            .zones-grid,
            .services-grid,
            .reports-grid {
                grid-template-columns: 1fr;
            }
            
            .georgia-map {
                height: 300px;
            }
        }

        /* Harita i√ßin ek CSS */
.georgia-map svg {
    display: block;
}

.city-marker {
    cursor: pointer;
    transition: transform 0.3s ease;
}

.city-marker:hover {
    transform: scale(1.2);
}

.city-marker:hover circle:first-child {
    filter: drop-shadow(0 0 8px rgba(234, 88, 12, 0.6));
}

.city-info {
    position: absolute;
    background: white;
    padding: 16px;
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
    min-width: 180px;
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.3s ease;
    pointer-events: none;
    z-index: 100;
    border: 1px solid var(--gray-200);
}

.city-info h4 {
    margin-bottom: 8px;
    color: var(--text-dark);
    font-size: 14px;
}

.city-info p {
    font-size: 12px;
    color: var(--gray-600);
    line-height: 1.5;
}

.tbilisi-info { border-left: 4px solid var(--primary-orange); }
.batumi-info { border-left: 4px solid var(--secondary-red); }
.kutaisi-info { border-left: 4px solid var(--accent-amber); }
.poti-info { border-left: 4px solid #059669; }

/* Hover efektleri */
.georgia-map:hover .city-info {
    opacity: 0;
}

.tbilisi:hover ~ .tbilisi-info,
.batumi:hover ~ .batumi-info, 
.kutaisi:hover ~ .kutaisi-info,
.poti:hover ~ .poti-info {
    opacity: 1;
    transform: translateY(0);
}
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                    </div>
                    ParenaTrade
                </div>
                
                <nav class="nav">
                    <a href="#analysis">AI Analiz</a>
                    <a href="#zones">Serbest B√∂lgeler</a>
                    <a href="#batum">Batum Avantajlarƒ±</a>
                    <a href="#services">Hizmetlerimiz</a>
                    <a href="#reports">Raporlar</a>
                    <a href="#contact">ƒ∞leti≈üim</a>
                </nav>
                
                <a href="#analysis" class="btn btn-primary">√úcretsiz Analiz</a>
            </div>
        </div>
    </header>

   <!-- Hero Section - G√ºncellendi -->
<section class="hero">
    <div class="container">
        <div class="hero-content">
            <h1>G√ºrcistan'da Yatƒ±rƒ±m Fƒ±rsatlarƒ±nƒ± Ke≈üfedin</h1>
            <p>AI destekli analizler, vergi avantajlarƒ± ve serbest b√∂lgelerde yatƒ±rƒ±m rehberiniz</p>
            
            <div class="hero-actions">
                <a href="#analysis" class="btn btn-primary">AI Analiz Ba≈ülat</a>
                <a href="#zones" class="btn btn-secondary">Serbest B√∂lgeleri ƒ∞ncele</a>
            </div>
        </div>
        
        <!-- G√úNCELLENMƒ∞≈û G√ºrcistan Haritasƒ± -->
        <div class="georgia-map">
            <div class="map-container">
                <!-- SVG G√ºrcistan Haritasƒ± -->
                <svg width="100%" height="100%" viewBox="0 0 800 400" preserveAspectRatio="xMidYMid meet">
                    <!-- Harita arka planƒ± -->
                    <rect width="800" height="400" fill="#e2e8f0" rx="16"/>
                    
                    <!-- G√ºrcistan ana hatlarƒ± (basitle≈ütirilmi≈ü) -->
                    <path d="M300,100 L350,120 L400,110 L450,130 L500,120 L550,140 L600,130 L650,150 
                            L620,200 L580,220 L550,250 L500,280 L450,300 L400,290 L350,270 
                            L320,240 L280,220 L250,190 L270,150 Z" 
                          fill="#cbd5e1" stroke="#475569" stroke-width="2"/>
                    
                    <!-- Daƒülar (Kafkaslar) -->
                    <path d="M320,120 L340,100 L360,110 L380,90 L400,100 L420,85 L440,95" 
                          stroke="#64748b" stroke-width="3" fill="none" stroke-linecap="round"/>
                    
                    <!-- Karadeniz -->
                    <rect x="100" y="50" width="150" height="300" fill="#0ea5e9" opacity="0.3"/>
                    <text x="120" y="100" fill="#0369a1" font-size="12" font-weight="bold">Karadeniz</text>
                    
                    <!-- ≈ûehirler ve Marker'lar -->
                    <!-- Tiflis -->
                    <g class="city-marker tbilisi" transform="translate(450, 180)">
                        <circle cx="0" cy="0" r="10" fill="url(#gradient-orange)"/>
                        <circle cx="0" cy="0" r="10" fill="none" stroke="#ea580c" stroke-width="2" opacity="0.7">
                            <animate attributeName="r" from="10" to="20" dur="2s" repeatCount="indefinite"/>
                            <animate attributeName="opacity" from="0.7" to="0" dur="2s" repeatCount="indefinite"/>
                        </circle>
                        <text x="15" y="5" fill="#1e293b" font-size="12" font-weight="bold">Tiflis</text>
                    </g>
                    
                    <!-- Batum -->
                    <g class="city-marker batumi" transform="translate(200, 150)">
                        <circle cx="0" cy="0" r="8" fill="url(#gradient-red)"/>
                        <circle cx="0" cy="0" r="8" fill="none" stroke="#dc2626" stroke-width="2" opacity="0.7">
                            <animate attributeName="r" from="8" to="16" dur="2s" repeatCount="indefinite" begin="0.5s"/>
                            <animate attributeName="opacity" from="0.7" to="0" dur="2s" repeatCount="indefinite" begin="0.5s"/>
                        </circle>
                        <text x="12" y="5" fill="#1e293b" font-size="10" font-weight="bold">Batum</text>
                    </g>
                    
                    <!-- Kutaisi -->
                    <g class="city-marker kutaisi" transform="translate(380, 160)">
                        <circle cx="0" cy="0" r="7" fill="url(#gradient-amber)"/>
                        <circle cx="0" cy="0" r="7" fill="none" stroke="#d97706" stroke-width="2" opacity="0.7">
                            <animate attributeName="r" from="7" to="14" dur="2s" repeatCount="indefinite" begin="1s"/>
                            <animate attributeName="opacity" from="0.7" to="0" dur="2s" repeatCount="indefinite" begin="1s"/>
                        </circle>
                        <text x="10" y="5" fill="#1e293b" font-size="9" font-weight="bold">Kutaisi</text>
                    </g>
                    
                    <!-- Poti -->
                    <g class="city-marker poti" transform="translate(220, 140)">
                        <circle cx="0" cy="0" r="6" fill="url(#gradient-emerald)"/>
                        <circle cx="0" cy="0" r="6" fill="none" stroke="#059669" stroke-width="2" opacity="0.7">
                            <animate attributeName="r" from="6" to="12" dur="2s" repeatCount="indefinite" begin="1.5s"/>
                            <animate attributeName="opacity" from="0.7" to="0" dur="2s" repeatCount="indefinite" begin="1.5s"/>
                        </circle>
                        <text x="9" y="5" fill="#1e293b" font-size="8" font-weight="bold">Poti</text>
                    </g>
                    
                    <!-- Sƒ±nƒ±r √ßizgileri -->
                    <path d="M300,100 L350,120 L400,110 L450,130 L500,120 L550,140 L600,130 L650,150 
                            L620,200 L580,220 L550,250 L500,280 L450,300 L400,290 L350,270 
                            L320,240 L280,220 L250,190 L270,150 Z" 
                          fill="none" stroke="#334155" stroke-width="1" stroke-dasharray="5,5"/>
                    
                    <!-- T√ºrkiye sƒ±nƒ±rƒ± -->
                    <path d="M100,150 L200,130 L250,190" stroke="#dc2626" stroke-width="2" stroke-dasharray="8,4" opacity="0.7"/>
                    <text x="120" y="170" fill="#dc2626" font-size="10" font-weight="bold">T√ºrkiye</text>
                    
                    <!-- Ermenistan sƒ±nƒ±rƒ± -->
                    <path d="M550,140 L600,200" stroke="#7c3aed" stroke-width="2" stroke-dasharray="8,4" opacity="0.7"/>
                    <text x="570" y="180" fill="#7c3aed" font-size="10" font-weight="bold">Ermenistan</text>
                    
                    <!-- Azerbaycan sƒ±nƒ±rƒ± -->
                    <path d="M650,150 L700,180" stroke="#2563eb" stroke-width="2" stroke-dasharray="8,4" opacity="0.7"/>
                    <text x="670" y="170" fill="#2563eb" font-size="10" font-weight="bold">Azerbaycan</text>
                    
                    <!-- Rusya sƒ±nƒ±rƒ± -->
                    <path d="M350,100 L300,50" stroke="#475569" stroke-width="2" stroke-dasharray="8,4" opacity="0.7"/>
                    <text x="320" y="70" fill="#475569" font-size="10" font-weight="bold">Rusya</text>
                    
                    <!-- Gradient tanƒ±mlamalarƒ± -->
                    <defs>
                        <linearGradient id="gradient-orange" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#ea580c"/>
                            <stop offset="100%" stop-color="#dc2626"/>
                        </linearGradient>
                        <linearGradient id="gradient-red" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#dc2626"/>
                            <stop offset="100%" stop-color="#b91c1c"/>
                        </linearGradient>
                        <linearGradient id="gradient-amber" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#f59e0b"/>
                            <stop offset="100%" stop-color="#d97706"/>
                        </linearGradient>
                        <linearGradient id="gradient-emerald" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#10b981"/>
                            <stop offset="100%" stop-color="#059669"/>
                        </linearGradient>
                    </defs>
                </svg>
                
                <!-- Bilgi Kutularƒ± (Hover i√ßin) -->
                <div class="city-info tbilisi-info" style="top: 160px; left: 480px;">
                    <h4>üéØ Tiflis Serbest B√∂lgesi</h4>
                    <p>‚Ä¢ %0 vergi avantajƒ±<br>‚Ä¢ Sanal ofis hizmeti<br>‚Ä¢ Uzaktan kayƒ±t imkanƒ±</p>
                </div>
                
                <div class="city-info batumi-info" style="top: 130px; left: 230px;">
                    <h4>üèñÔ∏è Batum</h4>
                    <p>‚Ä¢ Turizm merkezi<br>‚Ä¢ Yatƒ±rƒ±m fƒ±rsatlarƒ±<br>‚Ä¢ Deniz iklimi</p>
                </div>
                
                <div class="city-info kutaisi-info" style="top: 140px; left: 410px;">
                    <h4>üè≠ Kutaisi Serbest B√∂lgesi</h4>
                    <p>‚Ä¢ Sanayi odaklƒ±<br>‚Ä¢ %100 yabancƒ± m√ºlkiyet<br>‚Ä¢ Fabrika alanlarƒ±</p>
                </div>
                
                <div class="city-info poti-info" style="top: 120px; left: 250px;">
                    <h4>üö¢ Poti Serbest B√∂lgesi</h4>
                    <p>‚Ä¢ Liman eri≈üimi<br>‚Ä¢ Lojistik merkez<br>‚Ä¢ Uluslararasƒ± ticaret</p>
                </div>
            </div>
        </div>
    </div>
</section>
    <!-- AI Analysis Section - √úste Ta≈üƒ±ndƒ± -->
    <section id="analysis" class="ai-analysis">
        <div class="container">
            <div class="section-header" style="text-align: center; margin-bottom: 60px;">
                <h2>AI Destekli Yatƒ±rƒ±m Analizi</h2>
                <p style="color: var(--gray-600); font-size: 18px;">G√ºrcistan'da yatƒ±rƒ±m fƒ±rsatlarƒ±nƒ±zƒ± AI ile analiz edin</p>
            </div>
            
            <div class="ai-grid">
                <!-- Firma Analiz Sohbeti -->
                <div class="ai-card">
                    <h3 style="margin-bottom: 24px; display: flex; align-items: center; gap: 12px;">
                        <div class="feature-icon orange">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                            </svg>
                        </div>
                        Firma Analiz Sohbeti
                    </h3>
                    
                    <div class="chat-container" id="chat-container">
                        <div class="chat-bubble">
                            <p>Merhaba! G√ºrcistan'da hangi sekt√∂rde yatƒ±rƒ±m yapmayƒ± d√º≈ü√ºn√ºyorsunuz?</p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <select class="form-select" id="service-select">
                            <option value="">Yatƒ±rƒ±m t√ºr√º se√ßin</option>
                            <option value="manufacturing">√úretim/ƒ∞malat</option>
                            <option value="tourism">Turizm</option>
                            <option value="agriculture">Tarƒ±m</option>
                            <option value="technology">Teknoloji</option>
                            <option value="logistics">Lojistik</option>
                        </select>
                    </div>
                    
                    <div id="chat-input-area" class="hidden">
                        <div class="form-group">
                            <input type="text" id="chat-input" class="form-input" placeholder="Cevabƒ±nƒ±zƒ± yazƒ±n...">
                        </div>
                        <button id="send-text" class="btn btn-primary" style="width: 100%;">
                            G√∂nder
                        </button>
                    </div>
                </div>
                
                <!-- Hƒ±zlƒ± Pazar Sorgulama -->
                <div class="ai-card">
                    <h3 style="margin-bottom: 24px; display: flex; align-items: center; gap: 12px;">
                        <div class="feature-icon red">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                        </div>
                        Hƒ±zlƒ± Pazar Sorgulama
                    </h3>
                    
                    <div class="form-group">
                        <label class="form-label">Rapor T√ºr√º</label>
                        <select class="form-select" id="report-template-select">
                            <option value="">Rapor t√ºr√º se√ßin</option>
                            <option value="georgia-market">G√ºrcistan Pazar Analizi</option>
                            <option value="free-zone">Serbest B√∂lge Kar≈üƒ±la≈ütƒ±rmasƒ±</option>
                            <option value="sector-report">Sekt√∂rel Yatƒ±rƒ±m Raporu</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Hedef B√∂lge</label>
                        <select class="form-select" id="target-region">
                            <option value="">B√∂lge se√ßin</option>
                            <option value="tbilisi">Tiflis Serbest B√∂lgesi</option>
                            <option value="kutaisi">Kutaisi Serbest B√∂lgesi</option>
                            <option value="poti">Poti Serbest B√∂lgesi</option>
                            <option value="hualing">Hualing Serbest B√∂lgesi</option>
                            <option value="batumi">Batum</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Yatƒ±rƒ±m Alanƒ±</label>
                        <input type="text" class="form-input" id="investment-area" placeholder="√ñrn: Tekstil, Gƒ±da, Teknoloji...">
                    </div>
                    
                    <button id="generate-report-btn" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-search mr-2"></i> Rapor Olu≈ütur
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Serbest B√∂lgeler Section -->
    <section id="zones" class="free-zones">
        <div class="container">
            <div class="section-header" style="text-align: center; margin-bottom: 60px;">
                <h2>G√ºrcistan Serbest B√∂lgeleri</h2>
                <p style="color: var(--gray-600); font-size: 18px;">%0 vergi avantajlarƒ± ile yatƒ±rƒ±m fƒ±rsatlarƒ±</p>
            </div>
            
            <div class="zones-grid">
                <!-- Tiflis Serbest B√∂lgesi -->
                <div class="zone-card">
                    <div class="zone-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                        </svg>
                    </div>
                    <h3 style="margin-bottom: 16px;">Tiflis Serbest B√∂lgesi</h3>
                    <p style="color: var(--gray-600); margin-bottom: 20px; font-size: 14px;">Sanal ofis, uzaktan kayƒ±t, d√º≈ü√ºk elektrik maliyetleri</p>
                    
                    <div style="text-align: left;">
                        <div class="zone-advantage">
                            <svg class="check" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            %0 Kurumlar Vergisi
                        </div>
                        <div class="zone-advantage">
                            <svg class="check" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            %0 KDV
                        </div>
                        <div class="zone-advantage">
                            <svg class="check" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            %0 Gelir Vergisi
                        </div>
                    </div>
                </div>
                
                <!-- Kutaisi Serbest B√∂lgesi -->
                <div class="zone-card">
                    <div class="zone-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                        </svg>
                    </div>
                    <h3 style="margin-bottom: 16px;">Kutaisi Serbest B√∂lgesi</h3>
                    <p style="color: var(--gray-600); margin-bottom: 20px; font-size: 14px;">Sanayi ve ticaret odaklƒ±, %100 yabancƒ± m√ºlkiyet</p>
                    
                    <div style="text-align: left;">
                        <div class="zone-advantage">
                            <svg class="check" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            Sanayi Alanlarƒ±
                        </div>
                        <div class="zone-advantage">
                            <svg class="check" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            %100 Yabancƒ± M√ºlkiyet
                        </div>
                        <div class="zone-advantage">
                            <svg class="check" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            Vergi Avantajlarƒ±
                        </div>
                    </div>
                </div>
                
                <!-- Poti Serbest B√∂lgesi -->
                <div class="zone-card">
                    <div class="zone-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                        </svg>
                    </div>
                    <h3 style="margin-bottom: 16px;">Poti Serbest B√∂lgesi</h3>
                    <p style="color: var(--gray-600); margin-bottom: 20px; font-size: 14px;">Liman eri≈üimi, uluslararasƒ± ticaret merkezi</p>
                    
                    <div style="text-align: left;">
                        <div class="zone-advantage">
                            <svg class="check" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            Liman Eri≈üimi
                        </div>
                        <div class="zone-advantage">
                            <svg class="check" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            Lojistik Merkez
                        </div>
                        <div class="zone-advantage">
                            <svg class="check" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            %0 Vergi Avantajƒ±
                        </div>
                    </div>
                </div>
                
                <!-- Hualing Serbest B√∂lgesi -->
                <div class="zone-card">
                    <div class="zone-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                        </svg>
                    </div>
                    <h3 style="margin-bottom: 16px;">Hualing Serbest B√∂lgesi</h3>
                    <p style="color: var(--gray-600); margin-bottom: 20px; font-size: 14px;">Ah≈üap i≈üleme, mobilya √ºretimi, in≈üaat sekt√∂r√º</p>
                    
                    <div style="text-align: left;">
                        <div class="zone-advantage">
                            <svg class="check" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            Ah≈üap ƒ∞≈üleme
                        </div>
                        <div class="zone-advantage">
                            <svg class="check" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            Mobilya √úretimi
                        </div>
                        <div class="zone-advantage">
                            <svg class="check" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            ƒ∞n≈üaat Sekt√∂r√º
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Batum Construction Section -->
    <section id="batum" class="batum-construction">
        <div class="container">
            <div class="section-header" style="text-align: center; margin-bottom: 60px;">
                <h2>Batum: Y√ºkselen Yatƒ±rƒ±m Merkezi</h2>
                <p style="color: var(--gray-600); font-size: 18px;">Deniz iklimi ve geli≈üen in≈üaat sekt√∂r√º ile fƒ±rsatlar ≈üehri</p>
            </div>
            
            <div class="construction-content">
                <div class="construction-animation">
                    <div class="construction-placeholder">
                        <div class="building building-1"></div>
                        <div class="building building-2"></div>
                        <div class="building building-3"></div>
                        <div class="building building-4"></div>
                        <div class="building building-5"></div>
                    </div>
                </div>
                
                <div>
                    <h3 style="margin-bottom: 24px;">Batum Yatƒ±rƒ±m Avantajlarƒ±</h3>
                    <ul class="advantages-list">
                        <li>
                            <svg class="check" width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span>Akdeniz iklimi ile yƒ±l boyu turizm potansiyeli</span>
                        </li>
                        <li>
                            <svg class="check" width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span>Geli≈üen in≈üaat sekt√∂r√º ve emlak yatƒ±rƒ±mlarƒ±</span>
                        </li>
                        <li>
                            <svg class="check" width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span>Kumarhane ve eƒülence sekt√∂r√ºnde lider b√∂lge</span>
                        </li>
                        <li>
                            <svg class="check" width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span>Deniz turizmi ve marina yatƒ±rƒ±mlarƒ±</span>
                        </li>
                        <li>
                            <svg class="check" width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span>T√ºrkiye sƒ±nƒ±rƒ±na yakƒ±nlƒ±k avantajƒ±</span>
                        </li>
                    </ul>
                    
                    <a href="#analysis" class="btn btn-primary" style="margin-top: 32px;">
                        <i class="fas fa-chart-line mr-2"></i> Batum Yatƒ±rƒ±m Analizi
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- SERVICES SECTION - G√úNCELLENMƒ∞≈û HALƒ∞ -->
<section id="services" class="services">
    <div class="container">
        <div class="section-header" style="text-align: center; margin-bottom: 60px;">
            <h2>Hizmetlerimiz</h2>
            <p style="color: var(--gray-600); font-size: 18px;">G√ºrcistan'da yatƒ±rƒ±m yolculuƒüunuzda yanƒ±nƒ±zdayƒ±z</p>
        </div>
        
        <div class="services-grid">
            <!-- Pazar Analizi Kartƒ± -->
            <div class="service-card">
                <h3>
                    <div class="icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                    </div>
                    Pazar Analizi
                </h3>
                <p style="color: var(--gray-600); margin-bottom: 20px; font-size: 14px;">G√ºrcistan pazarƒ±nda detaylƒ± sekt√∂rel analiz ve raporlama</p>
                <ul style="color: var(--gray-600); font-size: 14px; list-style-type: none; padding-left: 0;">
                    <li style="margin-bottom: 8px;">‚Ä¢ Rakip analizi</li>
                    <li style="margin-bottom: 8px;">‚Ä¢ Fiyat trendleri</li>
                    <li style="margin-bottom: 8px;">‚Ä¢ Pazar b√ºy√ºkl√ºƒü√º</li>
                </ul>
            </div>
            
            <!-- ≈ûirket Kurulu≈üu Kartƒ± -->
            <div class="service-card">
                <h3>
                    <div class="icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                        </svg>
                    </div>
                    ≈ûirket Kurulu≈üu
                </h3>
                <p style="color: var(--gray-600); margin-bottom: 20px; font-size: 14px;">Serbest b√∂lgelerde ≈üirket kurulumu ve kayƒ±t i≈ülemleri</p>
                <ul style="color: var(--gray-600); font-size: 14px; list-style-type: none; padding-left: 0;">
                    <li style="margin-bottom: 8px;">‚Ä¢ Hƒ±zlƒ± kayƒ±t</li>
                    <li style="margin-bottom: 8px;">‚Ä¢ Yasal danƒ±≈ümanlƒ±k</li>
                    <li style="margin-bottom: 8px;">‚Ä¢ Belge hazƒ±rlama</li>
                </ul>
            </div>
            
            <!-- Vergi Danƒ±≈ümanlƒ±ƒüƒ± Kartƒ± -->
            <div class="service-card">
                <h3>
                    <div class="icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    Vergi Danƒ±≈ümanlƒ±ƒüƒ±
                </h3>
                <p style="color: var(--gray-600); margin-bottom: 20px; font-size: 14px;">G√ºrcistan vergi sistemi ve serbest b√∂lge avantajlarƒ±</p>
                <ul style="color: var(--gray-600); font-size: 14px; list-style-type: none; padding-left: 0;">
                    <li style="margin-bottom: 8px;">‚Ä¢ Vergi optimizasyonu</li>
                    <li style="margin-bottom: 8px;">‚Ä¢ Raporlama</li>
                    <li style="margin-bottom: 8px;">‚Ä¢ Uyumluluk</li>
                </ul>
            </div>
            
            <!-- G√úNCELLENMƒ∞≈û 1. Kart: ƒ∞≈ü Geli≈ütirme & Operasyon -->
<div class="service-card">
    <h3>
        <div class="icon">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
            </svg>
        </div>
        ƒ∞≈ü Geli≈ütirme & Operasyon
    </h3>
    <p style="color: var(--gray-600); margin-bottom: 20px; font-size: 14px;">
        Fiziksel altyapƒ± kurulumu ve ticari operasyonlarƒ±n ba≈ülatƒ±lmasƒ±
    </p>
    
    <!-- Fiziksel Altyapƒ± Vurgusu -->
    <div style="margin-bottom: 16px; padding: 12px; background: #f0fdf4; border-radius: 8px; border-left: 3px solid #059669;">
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
            <svg width="16" height="16" fill="#059669" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"/>
            </svg>
            <span style="font-size: 13px; font-weight: 600; color: var(--text-dark);">Fiziksel Yatƒ±rƒ±m Y√∂netimi</span>
        </div>
        <p style="font-size: 11px; color: var(--gray-600); margin: 0; line-height: 1.4;">
            Arsa/fabrika se√ßimi, proje y√∂netimi, in≈üaat s√ºre√ß takibi
        </p>
    </div>
    
    <ul style="color: var(--gray-600); font-size: 14px; list-style-type: none; padding-left: 0;">
        <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
            <span style="color: var(--primary-orange); margin-right: 8px; flex-shrink: 0;">‚Ä¢</span>
            <span>
                <strong>Depo & Fabrika Kurulumu:</strong> 
                <span style="display: block; font-size: 12px; color: var(--gray-500); margin-top: 2px;">
                    Yer se√ßimi, mimari proje, in≈üaat izinleri, donanƒ±m temini
                </span>
            </span>
        </li>
        <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
            <span style="color: var(--primary-orange); margin-right: 8px; flex-shrink: 0;">‚Ä¢</span>
            <span>
                <strong>Pazar Giri≈ü Stratejisi:</strong>
                <span style="display: block; font-size: 12px; color: var(--gray-500); margin-top: 2px;">
                    G√ºrcistan ve Orta Asya pazarlarƒ±na entegrasyon planƒ±
                </span>
            </span>
        </li>
        <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
            <span style="color: var(--primary-orange); margin-right: 8px; flex-shrink: 0;">‚Ä¢</span>
            <span>
                <strong>Tedarik Zinciri Kurulumu:</strong>
                <span style="display: block; font-size: 12px; color: var(--gray-500); margin-top: 2px;">
                    Yerel tedarik√ßi bulma, anla≈üma y√∂netimi, kalite kontrol
                </span>
            </span>
        </li>
        <li style="display: flex; align-items: flex-start;">
            <span style="color: var(--primary-orange); margin-right: 8px; flex-shrink: 0;">‚Ä¢</span>
            <span>
                <strong>Distrib√ºt√∂r Aƒüƒ± Olu≈üturma:</strong>
                <span style="display: block; font-size: 12px; color: var(--gray-500); margin-top: 2px;">
                    Yerel satƒ±≈ü kanallarƒ± ve distrib√ºt√∂r network√º kurulumu
                </span>
            </span>
        </li>
    </ul>
    
    <!-- Serbest B√∂lge Avantajlarƒ± -->
    <div style="margin-top: 16px; padding: 12px; background: var(--gray-50); border-radius: 8px; border: 1px solid var(--gray-200);">
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
            <div style="width: 20px; height: 20px; background: var(--primary-orange); border-radius: 4px; display: flex; align-items: center; justify-content: center;">
                <svg width="10" height="10" fill="white" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                </svg>
            </div>
            <span style="font-size: 12px; font-weight: 600; color: var(--text-dark);">Serbest B√∂lge Avantajlarƒ±</span>
        </div>
        <div style="display: flex; flex-wrap: wrap; gap: 8px; font-size: 10px; color: var(--gray-600);">
            <span style="padding: 4px 8px; background: #fef3c7; border-radius: 4px; border: 1px solid #fbbf24;">
                ‚ö° 3 G√ºn ≈ûirket Kurma
            </span>
            <span style="padding: 4px 8px; background: #dbeafe; border-radius: 4px; border: 1px solid #60a5fa;">
                üì¶ G√ºmr√ºk Muafiyeti
            </span>
            <span style="padding: 4px 8px; background: #dcfce7; border-radius: 4px; border: 1px solid #34d399;">
                üí∞ %0 Vergi
            </span>
        </div>
    </div>
</div>

<!-- G√úNCELLENMƒ∞≈û 2. Kart: ƒ∞≈ületme Y√∂netimi -->
<div class="service-card">
    <h3>
        <div class="icon">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
            </svg>
        </div>
        ƒ∞≈ületme Y√∂netimi
    </h3>
    <p style="color: var(--gray-600); margin-bottom: 20px; font-size: 14px;">
        Operasyonel s√ºre√ßlerin profesyonel y√∂netimi ve optimizasyonu
    </p>
    
    <!-- Operasyonel M√ºkemmellik Vurgusu -->
    <div style="margin-bottom: 16px; padding: 12px; background: #e0f2fe; border-radius: 8px; border-left: 3px solid #0ea5e9;">
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
            <svg width="16" height="16" fill="#0ea5e9" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
            <span style="font-size: 13px; font-weight: 600; color: var(--text-dark);">Operasyonel M√ºkemmellik</span>
        </div>
        <p style="font-size: 11px; color: var(--gray-600); margin: 0; line-height: 1.4;">
            Departman kurulumu, s√ºre√ß optimizasyonu, performans y√∂netimi
        </p>
    </div>
    
    <ul style="color: var(--gray-600); font-size: 14px; list-style-type: none; padding-left: 0;">
        <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
            <span style="color: var(--primary-orange); margin-right: 8px; flex-shrink: 0;">‚Ä¢</span>
            <span>
                <strong>Departman Kurulumu:</strong> 
                <span style="display: block; font-size: 12px; color: var(--gray-500); margin-top: 2px;">
                    ƒ∞.K., √ºretim, satƒ±≈ü, muhasebe, finans departmanlarƒ±nƒ±n yapƒ±landƒ±rƒ±lmasƒ±
                </span>
            </span>
        </li>
        <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
            <span style="color: var(--primary-orange); margin-right: 8px; flex-shrink: 0;">‚Ä¢</span>
            <span>
                <strong>Lojistik & Operasyon:</strong>
                <span style="display: block; font-size: 12px; color: var(--gray-500); margin-top: 2px;">
                    G√ºmr√ºk, nakliye, depolama ve daƒüƒ±tƒ±m zinciri optimizasyonu
                </span>
            </span>
        </li>
        <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
            <span style="color: var(--primary-orange); margin-right: 8px; flex-shrink: 0;">‚Ä¢</span>
            <span>
                <strong>ƒ∞nsan Kaynaklarƒ± Y√∂netimi:</strong>
                <span style="display: block; font-size: 12px; color: var(--gray-500); margin-top: 2px;">
                    Personel bulma, eƒüitim, performans ve √ºcret y√∂netimi
                </span>
            </span>
        </li>
        <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
            <span style="color: var(--primary-orange); margin-right: 8px; flex-shrink: 0;">‚Ä¢</span>
            <span>
                <strong>Pazarlama & ƒ∞hracat:</strong>
                <span style="display: block; font-size: 12px; color: var(--gray-500); margin-top: 2px;">
                    Pazarlama stratejileri, ihracat operasyonlarƒ±, m√º≈üteri ili≈ükileri
                </span>
            </span>
        </li>
        <li style="display: flex; align-items: flex-start;">
            <span style="color: var(--primary-orange); margin-right: 8px; flex-shrink: 0;">‚Ä¢</span>
            <span>
                <strong>Denetim & Raporlama:</strong>
                <span style="display: block; font-size: 12px; color: var(--gray-500); margin-top: 2px;">
                    Performans √∂l√ß√ºmleme, denetim raporlarƒ±, y√∂netim bilgi sistemi
                </span>
            </span>
        </li>
    </ul>
    
    <!-- Performans Metrikleri -->
    <div style="margin-top: 16px; padding: 12px; background: #fef3c7; border-radius: 8px; border: 1px solid #fbbf24;">
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
            <div style="width: 20px; height: 20px; background: #f59e0b; border-radius: 4px; display: flex; align-items: center; justify-content: center;">
                <svg width="10" height="10" fill="white" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd"/>
                </svg>
            </div>
            <span style="font-size: 12px; font-weight: 600; color: var(--text-dark);">Performans Hedefleri</span>
        </div>
        <div style="display: flex; justify-content: space-between; font-size: 10px; color: var(--gray-700);">
            <div style="text-align: center;">
                <div style="font-weight: 700; color: #059669;">+25%</div>
                <div>Verimlilik</div>
            </div>
            <div style="text-align: center;">
                <div style="font-weight: 700; color: #059669;">-30%</div>
                <div>Operasyon Maliyeti</div>
            </div>
            <div style="text-align: center;">
                <div style="font-weight: 700; color: #059669;">+40%</div>
                <div>ƒ∞hracat Hacmi</div>
            </div>
        </div>
    </div>
</div>
            <!-- OPTƒ∞Mƒ∞ZE EDƒ∞LMƒ∞≈û Kredi & Finansman Kartƒ± -->
<div class="service-card">
    <h3>
        <div class="icon">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
        </div>
        Finansman √á√∂z√ºmleri
    </h3>
    <p style="color: var(--gray-600); margin-bottom: 20px; font-size: 14px;">
        Yatƒ±rƒ±m projeleriniz i√ßin optimize edilmi≈ü finansman yapƒ±landƒ±rmasƒ±
    </p>
    
    <!-- √ñZET KAR≈ûILA≈ûTIRMA -->
    <div style="margin-bottom: 20px; border: 1px solid var(--gray-200); border-radius: 12px; overflow: hidden;">
        <!-- Tablo Ba≈ülƒ±klarƒ± -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; background: var(--gray-50);">
            <div style="padding: 8px; text-align: center; border-right: 1px solid var(--gray-200);">
                <div style="font-size: 12px; font-weight: 600; color: #52525b;">Finansman T√ºr√º</div>
            </div>
            <div style="padding: 8px; text-align: center;">
                <div style="font-size: 12px; font-weight: 600; color: #52525b;">Avantajlarƒ±</div>
            </div>
        </div>
        
        <!-- Teminatlƒ± Yatƒ±rƒ±m Kredisi -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; border-top: 1px solid var(--gray-100);">
            <div style="padding: 12px 8px; border-right: 1px solid var(--gray-100); background: white;">
                <div style="font-size: 11px; font-weight: 700; color: #059669; margin-bottom: 4px;">Teminatlƒ± Yatƒ±rƒ±m Kredisi</div>
                <div style="font-size: 9px; color: var(--gray-500);">T√ºrkiye varlƒ±klarƒ± teminat</div>
            </div>
            <div style="padding: 12px 8px; background: white;">
                <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                    <span style="font-size: 9px; padding: 2px 6px; background: #f0fdf4; color: #059669; border-radius: 10px; border: 1px solid #86efac;">
                        %8-12 Faiz
                    </span>
                    <span style="font-size: 9px; padding: 2px 6px; background: #f0f9ff; color: #0ea5e9; border-radius: 10px; border: 1px solid #7dd3fc;">
                        3-10 Yƒ±l
                    </span>
                    <span style="font-size: 9px; padding: 2px 6px; background: #fef3c7; color: #d97706; border-radius: 10px; border: 1px solid #fcd34d;">
                        USD/Euro
                    </span>
                </div>
            </div>
        </div>
        
        <!-- Proje Finansmanƒ± -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; border-top: 1px solid var(--gray-100);">
            <div style="padding: 12px 8px; border-right: 1px solid var(--gray-100); background: white;">
                <div style="font-size: 11px; font-weight: 700; color: #7c3aed; margin-bottom: 4px;">Proje Finansmanƒ±</div>
                <div style="font-size: 9px; color: var(--gray-500);">Nakit akƒ±≈üƒ± temelli</div>
            </div>
            <div style="padding: 12px 8px; background: white;">
                <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                    <span style="font-size: 9px; padding: 2px 6px; background: #faf5ff; color: #7c3aed; border-radius: 10px; border: 1px solid #d8b4fe;">
                        Yapƒ±landƒ±rƒ±lmƒ±≈ü
                    </span>
                    <span style="font-size: 9px; padding: 2px 6px; background: #f0f9ff; color: #0ea5e9; border-radius: 10px; border: 1px solid #7dd3fc;">
                        Risk Payla≈üƒ±mƒ±
                    </span>
                </div>
            </div>
        </div>
        
        <!-- Trade Finance -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; border-top: 1px solid var(--gray-100);">
            <div style="padding: 12px 8px; border-right: 1px solid var(--gray-100); background: white;">
                <div style="font-size: 11px; font-weight: 700; color: #dc2626; margin-bottom: 4px;">Trade Finance</div>
                <div style="font-size: 9px; color: var(--gray-500);">ƒ∞hracat/ithalat destek</div>
            </div>
            <div style="padding: 12px 8px; background: white;">
                <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                    <span style="font-size: 9px; padding: 2px 6px; background: #fef2f2; color: #dc2626; border-radius: 10px; border: 1px solid #fecaca;">
                        LC & Garantiler
                    </span>
                    <span style="font-size: 9px; padding: 2px 6px; background: #fef3c7; color: #d97706; border-radius: 10px; border: 1px solid #fcd34d;">
                        ƒ∞hracat √ñncesi
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- NEDEN G√úRCƒ∞STAN'DAN Fƒ∞NANSMAN? -->
    <div style="margin-bottom: 16px; padding: 14px; background: linear-gradient(135deg, #fef3c7, #fde68a); border-radius: 10px; border: 1px solid #fbbf24;">
        <div style="display: flex; align-items: flex-start; gap: 10px;">
            <div style="width: 20px; height: 20px; background: #d97706; border-radius: 6px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                <svg width="10" height="10" fill="white" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
            </div>
            <div>
                <div style="font-size: 12px; font-weight: 700; color: #92400e; margin-bottom: 6px;">
                    Yatƒ±rƒ±m Finansmanƒ±nda Stratejik Avantaj
                </div>
                <div style="font-size: 10px; color: #92400e; line-height: 1.4;">
                    ‚Ä¢ T√ºrkiye'deki varlƒ±klarƒ±nƒ±z teminat g√∂sterilir<br>
                    ‚Ä¢ G√ºrcistan'daki yatƒ±rƒ±m projeniz finanse edilir<br>
                    ‚Ä¢ D√º≈ü√ºk faiz, uzun vade, d√∂viz cinsi imkanlar<br>
                    ‚Ä¢ ƒ∞hracat odaklƒ± i≈ü modelinize uygun yapƒ±
                </div>
            </div>
        </div>
    </div>
    
    <!-- HIZLI REFERANS BADGELER -->
    <div style="margin-bottom: 16px;">
        <div style="font-size: 11px; font-weight: 600; color: var(--gray-700); margin-bottom: 8px; text-align: center;">
            Finansman S√ºrecimiz
        </div>
        <div style="display: flex; justify-content: space-between; font-size: 9px; color: var(--gray-600);">
            <div style="text-align: center; flex: 1;">
                <div style="width: 24px; height: 24px; background: #fef3c7; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 4px; border: 2px solid #fbbf24;">
                    <span style="font-size: 10px; font-weight: 700; color: #d97706;">1</span>
                </div>
                <div>Analiz</div>
                <div style="font-size: 8px; color: var(--gray-500);">1-3 g√ºn</div>
            </div>
            <div style="text-align: center; flex: 1;">
                <div style="width: 24px; height: 24px; background: #dbeafe; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 4px; border: 2px solid #60a5fa;">
                    <span style="font-size: 10px; font-weight: 700; color: #1d4ed8;">2</span>
                </div>
                <div>Yapƒ±landƒ±rma</div>
                <div style="font-size: 8px; color: var(--gray-500);">3-7 g√ºn</div>
            </div>
            <div style="text-align: center; flex: 1;">
                <div style="width: 24px; height: 24px; background: #dcfce7; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 4px; border: 2px solid #34d399;">
                    <span style="font-size: 10px; font-weight: 700; color: #059669;">3</span>
                </div>
                <div>Onay & Kullanƒ±m</div>
                <div style="font-size: 8px; color: var(--gray-500);">10-20 g√ºn</div>
            </div>
        </div>
    </div>
    
    <!-- DESTEK ALANLARI -->
    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
        <div style="font-size: 11px; font-weight: 600; color: var(--gray-700); margin-bottom: 8px; display: flex; align-items: center; gap: 6px;">
            <svg width="12" height="12" fill="#475569" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"/>
            </svg>
            Kapsamlƒ± Destek
        </div>
        <div style="display: flex; flex-wrap: wrap; gap: 6px;">
            <span style="font-size: 9px; padding: 4px 8px; background: white; color: var(--gray-700); border-radius: 6px; border: 1px solid #e2e8f0;">
                Banka Dosyasƒ± Hazƒ±rlƒ±ƒüƒ±
            </span>
            <span style="font-size: 9px; padding: 4px 8px; background: white; color: var(--gray-700); border-radius: 6px; border: 1px solid #e2e8f0;">
                Teminat Deƒüerleme
            </span>
            <span style="font-size: 9px; padding: 4px 8px; background: white; color: var(--gray-700); border-radius: 6px; border: 1px solid #e2e8f0;">
                Proje Finans Modeli
            </span>
            <span style="font-size: 9px; padding: 4px 8px; background: white; color: var(--gray-700); border-radius: 6px; border: 1px solid #e2e8f0;">
                Risk Analizi
            </span>
        </div>
    </div>
</div>
</section>            
    <!-- Reports Section - G√ºncellendi -->
    <section id="reports" class="reports">
        <div class="container">
            <div class="section-header" style="text-align: center; margin-bottom: 60px;">
                <h2>G√ºrcistan Yatƒ±rƒ±m Raporlarƒ±</h2>
                <p style="color: var(--gray-600); font-size: 18px;">AI destekli detaylƒ± sekt√∂rel analiz raporlarƒ±</p>
            </div>
            
           <!-- Plastik Ambalaj Sekt√∂r√º Raporu - G√ºncellenmi≈ü -->
<div class="report-card">
    <div class="report-badge" style="background: #2563eb;">Plastik Ambalaj</div>
    <div class="report-content">
        <h3 style="margin-bottom: 16px;">G√ºrcistan Plastik Ambalaj ƒ∞thalatƒ±</h3>
        <p style="color: var(--gray-600); margin-bottom: 20px; font-size: 14px;">
            ≈ûi≈üe, kap, po≈üet ve diƒüer plastik √ºr√ºnler ithalat analizi<br>
            <small style="color: #2563eb; font-weight: 500;">Toplam ƒ∞thalat: 461.64 Milyon USD</small>
        </p>
        
        <div class="report-stats">
            <div class="stat-item" style="background: #eff6ff;">
                <div class="stat-value">$461M</div>
                <div class="stat-label">Toplam ƒ∞thalat</div>
                <small style="font-size: 10px; color: var(--gray-500);">yƒ±llƒ±k</small>
            </div>
            <div class="stat-item" style="background: #eff6ff;">
                <div class="stat-value">%45</div>
                <div class="stat-label">T√ºrkiye Payƒ±</div>
                <small style="font-size: 10px; color: var(--gray-500);">Gƒ±da ambalajƒ±nda</small>
            </div>
        </div>
        
        <!-- Fƒ±rsat Tablosu -->
        <div style="margin: 16px 0; padding: 12px; background: #f8fafc; border-radius: 8px; border-left: 3px solid #2563eb;">
            <div style="font-size: 12px; color: var(--gray-700); margin-bottom: 8px;">
                <strong>üìä Fƒ±rsat Sƒ±ralamasƒ±:</strong>
            </div>
            
            <div style="font-size: 11px; color: var(--gray-600);">
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px; padding: 4px; background: #e0f2fe; border-radius: 4px;">
                    <span><strong>1. Gƒ±da Ambalajƒ±</strong></span>
                    <span>$150M</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px; padding: 4px; background: #f0f9ff; border-radius: 4px;">
                    <span>2. Ev Tipi √úr√ºnler</span>
                    <span>$90M</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px; padding: 4px; background: #f8fafc; border-radius: 4px;">
                    <span>3. Tarƒ±msal Plastik</span>
                    <span>$40M</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 4px; background: #f8fafc; border-radius: 4px;">
                    <span>4. ƒ∞n≈üaat Plastik</span>
                    <span>$55M</span>
                </div>
            </div>
            
            <div style="margin-top: 8px; padding-top: 8px; border-top: 1px dashed #cbd5e1; font-size: 10px; color: var(--gray-500);">
                <strong>üéØ En Y√ºksek Fƒ±rsat:</strong> Gƒ±da ambalajƒ±nda %45 T√ºrkiye baƒüƒ±mlƒ±lƒ±ƒüƒ±
            </div>
        </div>
        
        <button class="btn btn-primary" style="width: 100%; margin-top: 16px; background: linear-gradient(135deg, #2563eb, #1d4ed8);">
            <i class="fas fa-chart-pie mr-2"></i> Detaylƒ± Rapor ƒ∞ncele
        </button>
    </div>
</div>                
               <!-- Tekstil Sekt√∂r√º Raporu - G√ºncellenmi≈ü -->
<div class="report-card">
    <div class="report-badge" style="background: #7c3aed;">Tekstil</div>
    <div class="report-content">
        <h3 style="margin-bottom: 16px;">G√ºrcistan Tekstil √úretimi</h3>
        <p style="color: var(--gray-600); margin-bottom: 20px; font-size: 14px;">
            Kutaisi serbest b√∂lgesi tekstil yatƒ±rƒ±m fƒ±rsatlarƒ±<br>
            <small style="color: #7c3aed; font-weight: 500;">ƒ∞hracat: 180 Milyon USD</small>
        </p>
        
        <div class="report-stats">
            <div class="stat-item" style="background: #faf5ff;">
                <div class="stat-value">42</div>
                <div class="stat-label">Aktif Fabrika</div>
                <small style="font-size: 10px; color: var(--gray-500);">Kutaisi'nde 28</small>
            </div>
            <div class="stat-item" style="background: #faf5ff;">
                <div class="stat-value">+15%</div>
                <div class="stat-label">ƒ∞hracat Artƒ±≈üƒ±</div>
                <small style="font-size: 10px; color: var(--gray-500);">yƒ±llƒ±k</small>
            </div>
        </div>
        
        <!-- Tekstil Detaylarƒ± -->
        <div style="margin: 16px 0; padding: 12px; background: #f8fafc; border-radius: 8px; border-left: 3px solid #7c3aed;">
            <div style="font-size: 12px; color: var(--gray-700); margin-bottom: 8px;">
                <strong>üìà Sekt√∂r Detaylarƒ±:</strong>
            </div>
            
            <div style="font-size: 11px; color: var(--gray-600);">
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                    <span>‚Ä¢ ƒ∞stihdam:</span>
                    <span><strong>8,500 ki≈üi</strong></span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                    <span>‚Ä¢ Avrupa ƒ∞hracatƒ±:</span>
                    <span><strong>65%</strong></span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                    <span>‚Ä¢ T√ºrkiye ƒ∞thalatƒ±:</span>
                    <span><strong>45%</strong></span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>‚Ä¢ Ortalama ROI:</span>
                    <span><strong>3-5 yƒ±l</strong></span>
                </div>
            </div>
        </div>
        
        <button class="btn btn-primary" style="width: 100%; margin-top: 16px; background: linear-gradient(135deg, #7c3aed, #6d28d9);">
            <i class="fas fa-tshirt mr-2"></i> Tekstil Raporu ƒ∞ncele
        </button>
    </div>
</div>                
                <!-- Turizm Raporu -->
                <div class="report-card">
                    <div class="report-badge">Turizm</div>
                    <div class="report-content">
                        <h3 style="margin-bottom: 16px;">Batum Turizm Yatƒ±rƒ±mlarƒ±</h3>
                        <p style="color: var(--gray-600); margin-bottom: 20px; font-size: 14px;">Otel, marina ve eƒülence sekt√∂r√º analizi</p>
                        
                        <div class="report-stats">
                            <div class="stat-item">
                                <div class="stat-value">1.2M</div>
                                <div class="stat-label">Yƒ±llƒ±k Turist</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">%30</div>
                                <div class="stat-label">Doluluk Oranƒ±</div>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" style="width: 100%; margin-top: 16px;">
                            Raporu ƒ∞ncele
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="cta">
        <div class="container">
            <h2>G√ºrcistan'da Yatƒ±rƒ±m Fƒ±rsatƒ±nƒ± Ka√ßƒ±rmayƒ±n</h2>
            <p>AI destekli analizlerimizle size en uygun yatƒ±rƒ±m alanƒ±nƒ± belirleyelim</p>
            <div class="cta-actions">
                <a href="#analysis" class="btn" style="background: white; color: var(--primary-orange);">√úcretsiz Analiz Ba≈ülat</a>
                <a href="#contact" class="btn" style="background: transparent; color: white; border: 1px solid white;">ƒ∞leti≈üime Ge√ß</a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <div class="footer-logo-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                    </div>
                    ParenaTrade
                </div>
                <p>G√ºrcistan Yatƒ±rƒ±m ve Pazar Analiz Platformu</p>
                <p>AI destekli analizler, serbest b√∂lge danƒ±≈ümanlƒ±ƒüƒ±, yatƒ±rƒ±m rehberliƒüi</p>
                
                <div class="footer-disclaimer">
                    <p>G√ºrcistan'da yatƒ±rƒ±m danƒ±≈ümanlƒ±ƒüƒ± ve pazar analiz hizmetleri</p>
                    <p style="margin-top: 8px;">¬© 2024 ParenaTrade. T√ºm haklarƒ± saklƒ±dƒ±r.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript kodlarƒ± buraya gelecek -->
    <script>
        // Mevcut JavaScript kodlarƒ±nƒ±z buraya gelecek
        // (Orijinal index.html'deki t√ºm JavaScript kodlarƒ±nƒ± buraya kopyalayƒ±n)
        
        // Basit interaktif √∂zellikler i√ßin ek kodlar
        document.addEventListener('DOMContentLoaded', function() {
            // Harita marker'larƒ±na tƒ±klama
            document.querySelectorAll('.city-marker').forEach(marker => {
                marker.addEventListener('click', function() {
                    const cityName = this.classList[1]; // tbilisi, batumi, etc.
                    alert(cityName + ' b√∂lgesi hakkƒ±nda daha fazla bilgi i√ßin AI analiz ba≈ülatƒ±n!');
                });
            });
            
            // Rapor butonlarƒ±
            document.querySelectorAll('.report-card .btn').forEach(button => {
                button.addEventListener('click', function() {
                    const reportTitle = this.closest('.report-card').querySelector('h3').textContent;
                    alert(reportTitle + ' raporu i√ßin AI analiz ba≈ülatƒ±lƒ±yor...');
                    document.getElementById('analysis').scrollIntoView({ behavior: 'smooth' });
                });
            });
        });
 
        // Supabase baƒülantƒ±sƒ±
        const supabaseUrl = "https://xliutvspwodhoaxvysks.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhsaXV0dnNwd29kaG9heHZ5c2tzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTczNTgyOTksImV4cCI6MjA3MjkzNDI5OX0.Zodisa_ifP8t2Q4X0ecnB56RiR_Bg4QS5gvPn5ZLK_w";
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Global deƒüi≈ükenler
        let aiReportTemplates = [];
        let selectedTemplate = null;
        let formData = {};
        let serviceCart = [];
        let currentService = null;
        let currentQuestionIndex = 0;
        let companyProfile = {};
        let serviceQuestions = [];
        let isInitialized = false;
        let activeAccordion = null;


// Deƒüi≈üken √ßƒ±karma fonksiyonunu g√ºncelle
function extractVariables(prompt) {
    if (!prompt || typeof prompt !== 'string') {
        console.warn('‚ö†Ô∏è Ge√ßersiz prompt:', prompt);
        return [];
    }
    
    console.log('üîç Prompt analiz ediliyor:', prompt.substring(0, 100) + '...');
    
    const regexPatterns = [
        /\{\{(\w+)\}\}/g,        // {{degisken}}
        /%(\w+)%/g,              // %degisken%
    ];
    
    const matches = [];
    
    regexPatterns.forEach(pattern => {
        let match;
        while ((match = pattern.exec(prompt)) !== null) {
            // current_year'i filtrele
            if (match[1] !== 'current_year') {
                matches.push(match[1]);
            }
        }
    });
    
    // Firma bazlƒ± rapor i√ßin √∂zel deƒüi≈ükenler
    const knownVariables = ['dil', 'ulke', 'sektor', 'urun', 'firma_adi', 'bolge', 'gtip', 'zaman', 'amac', 'derinlik', 'rapor_turu'];
    knownVariables.forEach(variable => {
        if (prompt.includes(variable) && !matches.includes(variable)) {
            matches.push(variable);
        }
    });
    
    const uniqueVariables = [...new Set(matches)];
    console.log('üîç √áƒ±karƒ±lan deƒüi≈ükenler:', uniqueVariables);
    
    return uniqueVariables;
}
        
// Sepete ekle fonksiyonunu d√ºzelt - DYNAMIC √á√ñZ√úM
function addToAICart(item) {
    console.log('‚ûï Sepete ekleniyor:', item);
    
    // TEMPLATE BULMA - DYNAMIC YAKLA≈ûIM
    let template = null;
    
    // 1. √ñnce item i√ßinden template bul
    if (item.template_data) {
        template = item.template_data;
    } 
    // 2. Sonra selectedTemplate'den
    else if (window.selectedTemplate) {
        template = window.selectedTemplate;
    }
    // 3. Sonra global reportTemplates'den ara
    else if (window.reportTemplates && item.id) {
        template = window.reportTemplates.find(t => t.id === item.id);
    }
    // 4. En son item'ƒ±n kendisi template olabilir
    else if (item.report_name || item.report_price) {
        template = item;
    }

    console.log('üîç Bulunan template:', template);

    // Fƒ∞YAT HESAPLAMA - TEMPLATE √ñNCELƒ∞KLƒ∞
    let price = 0;
    if (template && template.report_price !== undefined && template.report_price !== null && !isNaN(parseFloat(template.report_price))) {
        price = parseFloat(template.report_price);
    } else if (item.price !== undefined && item.price !== null && !isNaN(parseFloat(item.price))) {
        price = parseFloat(item.price);
    } else {
        // Varsayƒ±lan fiyatlar - sadece fallback olarak
        const defaultPrices = {
            'Kapsamlƒ± Pazar Raporu': 199,
            'Firma Bazlƒ± Pazar Raporu': 129, 
            'GTIP Bazlƒ± Ticaret Raporu': 159
        };
        price = defaultPrices[item.name] || defaultPrices[item.report_name] || defaultPrices[template?.report_name] || 99;
    }

    // PARA Bƒ∞Rƒ∞Mƒ∞ - TEMPLATE √ñNCELƒ∞KLƒ∞
    let currency = 'USD';
    if (template && template.report_currency) {
        currency = template.report_currency;
    } else if (item.currency && item.currency !== 'undefined') {
        currency = item.currency;
    }

    // ƒ∞Sƒ∞M - TEMPLATE √ñNCELƒ∞KLƒ∞
    let name = 'ƒ∞simsiz √úr√ºn';
    if (template && template.report_name) {
        name = template.report_name;
    } else if (item.name && item.name !== 'undefined') {
        name = item.name;
    }

    // ID - TEMPLATE √ñNCELƒ∞KLƒ∞
    let id = '';
    if (template && template.id) {
        id = template.id;
    } else if (item.id && item.id !== 'undefined') {
        id = item.id;
    } else {
        id = 'unknown_' + Date.now();
    }

    const validatedItem = {
        id: id,
        name: name,
        price: price,
        currency: currency,
        type: item.type || 'report',
        quantity: parseInt(item.quantity) || 1,
        profile: item.profile || null,
        service_type: item.service_type || null,
        reportId: item.reportId || null,
        template_data: template, // Template verisini sakla
        created_at: item.created_at || new Date().toISOString()
    };

    console.log('‚úÖ Doƒürulanmƒ±≈ü √∂ƒüe:', validatedItem);
    
    // √áift eklemeyi √∂nle
    const existingIndex = serviceCart.findIndex(cartItem => 
        cartItem.id === validatedItem.id && cartItem.type === validatedItem.type
    );
    
    if (existingIndex === -1) {
        serviceCart.push(validatedItem);
    } else {
        serviceCart[existingIndex] = validatedItem;
    }
    
    updateAICart();
}

function updateAICart() {
    console.log('üõí Sepet g√ºncelleniyor:', serviceCart);
    
    const cartItems = document.getElementById('ai-report-cart-items');
    const cartTotal = document.getElementById('ai-report-cart-total');
    const completeBtn = document.getElementById('complete-ai-report-order');

    if (!cartItems) {
        console.error('‚ùå Sepet elementi bulunamadƒ±');
        return;
    }

    if (serviceCart.length === 0) {
        cartItems.innerHTML = '<p class="text-gray-500 text-center py-4">Sepetinizde √ºr√ºn bulunmamaktadƒ±r</p>';
        if (cartTotal) cartTotal.textContent = '0 USD';
        if (completeBtn) completeBtn.disabled = true;
        return;
    }

    let cartHTML = '';
    let total = 0;

    serviceCart.forEach((item, index) => {
        // G√úVENLƒ∞ DEƒûER ALMA
        const itemName = item.name || 'ƒ∞simsiz √úr√ºn';
        const itemPrice = parseFloat(item.price) || 0;
        const itemCurrency = item.currency || 'USD';
        const itemQuantity = parseInt(item.quantity) || 1;
        
        const itemTotal = itemPrice * itemQuantity;
        total += itemTotal;

        const isService = item.type === 'service';
        
        cartHTML += `
            <div class="cart-item border-b border-gray-200 pb-4 mb-4">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <h4 class="font-semibold text-gray-800">${itemName}</h4>
                        <p class="text-gray-600 text-sm mt-1">
                            ${itemPrice} ${itemCurrency} 
                        </p>
                        ${isService ? `
                            <p class="text-blue-600 text-xs mt-1">
                                <i class="fas fa-cog mr-1"></i>Hizmet
                            </p>
                        ` : `
                            <p class="text-green-600 text-xs mt-1">
                                <i class="fas fa-file-pdf mr-1"></i>Rapor
                            </p>
                        `}
                    </div>
                    <div class="flex items-center space-x-3">
                        <span class="font-bold text-gray-900">${itemTotal.toFixed(2)} ${itemCurrency}</span>
                        <button class="text-red-500 remove-ai-item hover:text-red-700 transition duration-200" data-index="${index}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                ${isService && item.profile ? `
                    <div class="mt-3 p-3 bg-blue-50 rounded-lg border border-blue-100">
                        <strong class="text-blue-800 text-sm">Toplanan Bilgiler:</strong>
                        <div class="mt-2 space-y-1">
                            ${Object.entries(item.profile).map(([question, answer]) => 
                                `<div class="text-xs text-blue-700">‚Ä¢ ${question}: ${answer}</div>`
                            ).join('')}
                        </div>
                    </div>
                ` : ''}
            </div>
        `;
    });

    cartItems.innerHTML = cartHTML;
    
    // TOPLAM G√ñSTERƒ∞Mƒ∞ - G√úVENLƒ∞
    const displayTotal = isNaN(total) ? 0 : total;
    const displayCurrency = serviceCart[0]?.currency || 'USD';
    
    if (cartTotal) cartTotal.textContent = `${displayTotal.toFixed(2)} ${displayCurrency}`;
    if (completeBtn) completeBtn.disabled = false;

    // Kaldƒ±rma butonlarƒ±
    document.querySelectorAll('.remove-ai-item').forEach(button => {
        button.addEventListener('click', function() {
            const itemIndex = parseInt(this.getAttribute('data-index'));
            if (!isNaN(itemIndex) && itemIndex >= 0 && itemIndex < serviceCart.length) {
                serviceCart.splice(itemIndex, 1);
                updateAICart();
            }
        });
    });
}


        
// √ñNCE: T√ºm yardƒ±mcƒ± fonksiyonlarƒ± tanƒ±mla
// ==============================================

// Hata modal'ƒ± g√∂ster
function showErrorModal(title, message) {
    // Modal HTML'i
    const errorHTML = `
        <div id="error-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4">
                <div class="flex items-center mb-4">
                    <div class="bg-red-100 p-3 rounded-full mr-4">
                        <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-red-700">${title}</h3>
                </div>
                <div class="mb-6">
                    <div class="prose prose-sm max-w-none">
                        ${message}
                    </div>
                </div>
                <div class="flex justify-end space-x-3">
                    <button onclick="closeErrorModal()" class="bg-gray-300 text-gray-700 font-semibold px-4 py-2 rounded-lg hover:bg-gray-400 transition duration-300">
                        Kapat
                    </button>
                    <button onclick="contactSupport()" class="bg-red-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-red-700 transition duration-300">
                        Destek Al
                    </button>
                </div>
            </div>
        </div>
    `;
    
    // Eƒüer zaten bir hata modal'ƒ± varsa kaldƒ±r
    const existingModal = document.getElementById('error-modal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Yeni modal'ƒ± ekle
    document.body.insertAdjacentHTML('beforeend', errorHTML);
}

// Hata modal'ƒ±nƒ± kapat
function closeErrorModal() {
    const errorModal = document.getElementById('error-modal');
    if (errorModal) {
        errorModal.remove();
    }
}       

// Destek butonu fonksiyonu
function contactSupport() {
    window.location.href = 'mailto:info@parenatrade.com?subject=ParenaTrade Destek&body=Merhaba, AI rapor servisi ile ilgili yardƒ±ma ihtiyacƒ±m var.';
}
        
async function testAPIEndpoint() {
    try {
        console.log('üß™ API test ediliyor...');
        
        // Sadece HEAD isteƒüi g√∂nder - daha hƒ±zlƒ±
        const response = await fetch('https://parenatrade.vercel.app/api/generate-report', {
            method: 'HEAD',
            signal: AbortSignal.timeout(3000) // 3 saniye
        });
        
        console.log('üì° API eri≈üilebilir');
        return true;
        
    } catch (error) {
        if (error.name === 'AbortError') {
            console.log('‚è∞ API timeout (3s)');
        } else {
            console.log('‚ùå API eri≈üilemiyor:', error.message);
        }
        return false;
    }
}
        
// API durumuna g√∂re uyarƒ± g√∂ster
async function showAPIStatusAlert() {
    const apiStatus = await testAPIEndpoint();
    
    if (!apiStatus) {
        // Sadece bir kere g√∂ster (spam'ƒ± √∂nle)
        if (!localStorage.getItem('api_alert_shown')) {
            setTimeout(() => {
                showErrorModal(
                    'AI Servisi Ge√ßici Olarak Kullanƒ±lamƒ±yor',
                    'AI rapor olu≈üturma servisi ≈üu an teknik bir sorun nedeniyle kullanƒ±lamƒ±yor.<br><br>' +
                    '‚Ä¢ L√ºtfen birka√ß dakika sonra tekrar deneyin<br>' +
                    '‚Ä¢ Rapor olu≈üturma butonuna tƒ±kladƒ±ƒüƒ±nƒ±zda bu uyarƒ±yƒ± tekrar g√∂receksiniz<br>' +
                    '‚Ä¢ Acil ihtiya√ßlarƒ±nƒ±z i√ßin: info@parenatrade.com<br><br>' +
                    '<small>Bu mesaj sadece bir kere g√∂sterilecektir.</small>'
                );
                localStorage.setItem('api_alert_shown', 'true');
            }, 2000);
        }
    } else {
        console.log('‚úÖ API √ßalƒ±≈üƒ±yor, normal i≈üleme devam');
        // √áalƒ±≈üƒ±yorsa alert kaydƒ±nƒ± temizle
        localStorage.removeItem('api_alert_shown');
    }
    
    return apiStatus;
}

        
// API uyarƒ± sistemini iyile≈ütir
function setupReportWarning() {
    const generateBtn = document.getElementById('generate-report-btn');
    if (generateBtn && !document.getElementById('api-warning')) {
        generateBtn.insertAdjacentHTML('beforebegin', `
            <div id="api-warning" class="bg-orange-50 border border-orange-200 rounded-lg p-3 mb-4">
                <div class="flex items-center">
                    <i class="fas fa-sync-alt text-orange-600 mr-2 animate-spin"></i>
                    <span class="text-orange-800 text-sm">
                        <strong>Servis Kontrol√º:</strong> AI servisi test ediliyor...
                    </span>
                </div>
            </div>
        `);
        
        // API durumunu kontrol et ve uyarƒ±yƒ± g√ºncelle
        setTimeout(async () => {
            const apiStatus = await checkAPIStatus();
            const warningElement = document.getElementById('api-warning');
            
            if (warningElement) {
                if (apiStatus) {
                    warningElement.innerHTML = `
                        <div class="flex items-center">
                            <i class="fas fa-check-circle text-green-600 mr-2"></i>
                            <span class="text-green-800 text-sm">
                                <strong>Servis Hazƒ±r:</strong> AI rapor olu≈üturma aktif
                            </span>
                        </div>
                    `;
                    warningElement.className = 'bg-green-50 border border-green-200 rounded-lg p-3 mb-4';
                } else {
                    warningElement.innerHTML = `
                        <div class="flex items-center">
                            <i class="fas fa-exclamation-triangle text-red-600 mr-2"></i>
                            <span class="text-red-800 text-sm">
                                <strong>Servis Bakƒ±mda:</strong> AI servisi ge√ßici olarak kullanƒ±lamƒ±yor
                            </span>
                        </div>
                    `;
                    warningElement.className = 'bg-red-50 border border-red-200 rounded-lg p-3 mb-4';
                }
            }
        }, 1000);
    }
}

// Eksik fonksiyonlarƒ± ekleyelim
async function checkAPIStatus() {
    return await testAPIEndpoint();
}
        
// Rapor butonunu kur - hata d√ºzeltmeli
function setupReportButton() {
    const generateBtn = document.getElementById('generate-report-btn');
    if (generateBtn) {
        // Butonun orijinal halini sakla
        if (!generateBtn.dataset.originalText) {
            generateBtn.dataset.originalText = generateBtn.innerHTML;
        }
        
        // API durumunu kontrol et ve butonu ayarla
        checkAPIStatus().then(apiStatus => {
            if (!apiStatus) {
                generateBtn.disabled = true;
                generateBtn.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i> Servis Bakƒ±mda';
                generateBtn.classList.add('opacity-50', 'cursor-not-allowed');
                generateBtn.title = 'AI servisi ≈üu an kullanƒ±lamƒ±yor. L√ºtfen daha sonra tekrar deneyin.';
            } else {
                generateBtn.disabled = false;
                generateBtn.innerHTML = generateBtn.dataset.originalText;
                generateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                generateBtn.title = 'AI raporu olu≈ütur';
            }
        }).catch(error => {
            console.error('API kontrol hatasƒ±:', error);
            // Hata durumunda butonu devre dƒ±≈üƒ± bƒ±rak
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i> Servis Kontrol Edilemiyor';
            generateBtn.classList.add('opacity-50', 'cursor-not-allowed');
        });
    }
}
        
// Debug fonksiyonlarƒ±nƒ± basitle≈ütirelim
async function debugServiceTypes() {
    try {
        const { data: services, error } = await supabase
            .from('ai_service_type')
            .select('id, service_name')
            .limit(3);
        
        if (!error && services) {
            console.log('üîç ai_service_type tablosu:', services);
        }
    } catch (error) {
        console.error('Debug hatasƒ±:', error);
    }
}

async function debugServiceMatching() {
    try {
        const { data: questions, error } = await supabase
            .from('ai_question')
            .select('id, question, service_type_id, service_type')
            .limit(5);
            
        if (!error && questions) {
            console.log('üîç ai_question tablosu:', questions);
        }
    } catch (error) {
        console.error('Debug hatasƒ±:', error);
    }
}

        
        // Modal ƒ∞≈ülevselliƒüi
function setupModalFunctionality() {
    // Modal kapatma
    const closeServiceModal = document.getElementById('close-service-modal');
    const cancelServiceOrder = document.getElementById('cancel-service-order');
    const submitServiceOrder = document.getElementById('submit-service-order');
    const closeConfirmation = document.getElementById('close-confirmation');

    if (closeServiceModal) {
        closeServiceModal.addEventListener('click', closeModal);
    }
    
    if (cancelServiceOrder) {
        cancelServiceOrder.addEventListener('click', closeModal);
    }

    // Sipari≈ü g√∂nderme
    if (submitServiceOrder) {
        submitServiceOrder.addEventListener('click', function() {
            // Burada √∂deme sayfasƒ±na y√∂nlendirme yapƒ±lacak
            window.location.href = 'https://parenatrade.vercel.app/ai/login.html';
        });
    }

    // Onay kapatma
    if (closeConfirmation) {
        closeConfirmation.addEventListener('click', closeModal);
    }
}

function closeModal() {
    const modal = document.getElementById('service-order-modal');
    if (modal) {
        modal.classList.add('hidden');
    }
}

// Ana uygulama ba≈ülatma - FORM DATA INITIALIZATION EKLENDƒ∞
// Ayrƒ±ca, initializeApp fonksiyonunu da g√ºvenli hale getirelim:
async function initializeApp() {
    if (isInitialized) {
        console.log('‚ÑπÔ∏è Uygulama zaten ba≈ülatƒ±lmƒ±≈ü');
        return;
    }
    isInitialized = true;
    
    try {
        console.log('üîß Temel sistemler ba≈ülatƒ±lƒ±yor...');
        
        // 0. √ñNCE CRITICAL GLOBAL DEƒûƒ∞≈ûKENLERƒ∞ INITIALIZE ET
        initializeGlobalVariables();
        
        // 1. √ñNCE verileri y√ºkle
        console.log('üì• Veriler y√ºkleniyor...');
        await loadDropdownData();
        await loadServiceTypesSimple();
        await loadReportTemplates();
        
        // 2. SONRA UI bile≈üenlerini kur (elementlerin y√ºklendiƒüinden emin ol)
        console.log('üé® UI bile≈üenleri kuruluyor...');
        
        // √ñnce elementlerin y√ºklendiƒüinden emin ol
        await waitForElement('#service-select');
        await waitForElement('#report-template-select');
        
        setupCompanyAnalysisChat();
        setupQuickReportForm();
        setupCartFunctionality();
        setupModalFunctionality();
        
        // 3. FORM ALANLARI OLU≈ûTUKTAN SONRA listener'larƒ± kur
        console.log('üîß Event listenerlar kuruluyor...');
        setTimeout(() => {
            setupAccordionListeners();
            setupFieldEventListeners();
        }, 500);
        
        // 4. Diƒüer sistemler
        initializeAuthSystem();
        setupProfileTabs();
        setupReportWarning();
        setupReportButton();
        checkChatSession();
        
        console.log('‚úÖ ParenaTrade uygulamasƒ± ba≈üarƒ±yla ba≈ülatƒ±ldƒ±');
        
    } catch (error) {
        console.error('‚ùå Uygulama ba≈ülatma hatasƒ±:', error);
        // Hata durumunda kritik olmayan i≈ülemleri yapmaya devam et
        try {
            initializeAuthSystem();
            setupProfileTabs();
        } catch (e) {
            console.error('ƒ∞kincil sistemlerde hata:', e);
        }
    }
}

// Yardƒ±mcƒ± fonksiyon: Element y√ºklenmesini bekle
function waitForElement(selector, timeout = 5000) {
    return new Promise((resolve, reject) => {
        const startTime = Date.now();
        
        function checkElement() {
            const element = document.querySelector(selector);
            if (element) {
                console.log(`‚úÖ Element bulundu: ${selector}`);
                resolve(element);
            } else if (Date.now() - startTime >= timeout) {
                console.warn(`‚ö†Ô∏è Element bulunamadƒ±: ${selector} (timeout)`);
                resolve(null);
            } else {
                setTimeout(checkElement, 100);
            }
        }
        
        checkElement();
    });
}

// DOMContentLoaded event listener'ƒ±nƒ± da g√ºvenli hale getirelim:
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ ParenaTrade - Uygulama ba≈ülatƒ±lƒ±yor...');
    
    // √ñNCE global deƒüi≈ükenleri initialize et
    initializeGlobalVariables();
    
    // Ana uygulamayƒ± ba≈ülat (hata yakalama ile)
    try {
        initializeApp();
    } catch (error) {
        console.error('‚ùå Ana uygulama ba≈ülatma hatasƒ±:', error);
    }
    
    // Debug ve kontrol i≈ülemleri - sƒ±ralƒ± ve gecikmeli
    const debugTasks = [
        { fn: checkTableStatus, delay: 500, name: 'Tablo durumu' },
        { fn: debugServiceTypes, delay: 1000, name: 'Servis tipleri' },
        { fn: debugServiceMatching, delay: 1500, name: 'Servis e≈üle≈ümesi' },
        { fn: checkSystemStatus, delay: 2000, name: 'Sistem durumu' },
        { 
            fn: () => checkAPIStatus().then(status => {
                if (!status) {
                    console.warn('‚ö†Ô∏è API servisi kullanƒ±lamƒ±yor');
                } else {
                    console.log('‚úÖ API servisi √ßalƒ±≈üƒ±yor');
                }
            }), 
            delay: 2500, 
            name: 'API durumu' 
        }
    ];
    
    debugTasks.forEach(task => {
        setTimeout(() => {
            try {
                console.log(`üîç ${task.name} kontrol√º...`);
                task.fn();
            } catch (e) {
                console.error(`${task.name} kontrol hatasƒ±:`, e);
            }
        }, task.delay);
    });
    
    // EXTRA: Sayfa y√ºklendikten sonra formData kontrol√º
    setTimeout(() => {
        console.log('üîç Final FormData Check:', {
            formData: window.formData,
            formDataType: typeof window.formData,
            selectedTemplate: window.selectedTemplate,
            serviceCart: window.serviceCart
        });
    }, 3000);
});

// Double initialization korumasƒ±
if (window.parenaTradeInitialized) {
    console.log('‚ÑπÔ∏è ParenaTrade zaten y√ºklenmi≈ü');
} else {
    window.parenaTradeInitialized = true;
}

// GLOBAL DEƒûƒ∞≈ûKENLERƒ∞ INITIALIZE ET
function initializeGlobalVariables() {
    console.log('üîß Global deƒüi≈ükenler initialize ediliyor...');
    
    // FORM DATA - CRITICAL
    if (!window.formData || typeof window.formData !== 'object') {
        window.formData = {};
        console.log('‚úÖ window.formData initialized:', window.formData);
    }
    
    // SELECTED TEMPLATE
    if (!window.selectedTemplate) {
        window.selectedTemplate = null;
        console.log('‚úÖ window.selectedTemplate initialized');
    }
    
    // SERVICE CART
    if (!window.serviceCart || !Array.isArray(window.serviceCart)) {
        window.serviceCart = [];
        console.log('‚úÖ window.serviceCart initialized:', window.serviceCart);
    }
    
    // CURRENT USER
    if (!window.currentUser) {
        window.currentUser = null;
        console.log('‚úÖ window.currentUser initialized');
    }
    
    // REPORT TEMPLATES
    if (!window.reportTemplates) {
        window.reportTemplates = [];
        console.log('‚úÖ window.reportTemplates initialized');
    }
    
    console.log('üéØ Global deƒüi≈ükenler ba≈üarƒ±yla initialize edildi');
}

// FORM DATA INITIALIZATION ƒ∞√áƒ∞N EXTRA G√úVENLƒ∞K
function initializeFormData() {
    // Mevcut formData'yƒ± koru, yoksa olu≈ütur
    if (!window.formData || typeof window.formData !== 'object') {
        window.formData = {};
    }
    
    // Required fields i√ßin default deƒüerler
    const defaultFields = ['ulke', 'sektor', 'urun', 'dil', 'bolge', 'gtip', 'zaman', 'amac', 'derinlik'];
    
    defaultFields.forEach(field => {
        if (window.formData[field] === undefined) {
            window.formData[field] = '';
        }
    });
    
    console.log('‚úÖ FormData g√ºvenli initialize edildi:', window.formData);
    return window.formData;
}

function setupQuickReportForm() {
    const templateSelect = document.getElementById('report-template-select');
    const generateBtn = document.getElementById('generate-report-btn');
    
    if (!templateSelect) {
        console.error('‚ùå Template select bulunamadƒ±');
        return;
    }
    
    // Template select'i bo≈üsa, doldurmayƒ± dene
    if (templateSelect.options.length <= 1 && window.reportTemplates && window.reportTemplates.length > 0) {
        console.log('üîÑ Template select dolduruluyor...');
        templateSelect.innerHTML = '<option value="">Rapor t√ºr√º se√ßin</option>';
        
        window.reportTemplates.forEach(template => {
            const option = document.createElement('option');
            option.value = template.id;
            option.textContent = `${template.report_name} - $${template.report_price || 0} ${template.report_currency || 'USD'}`;
            option.setAttribute('data-description', template.report_description);
            templateSelect.appendChild(option);
        });
    }
    
    // Template deƒüi≈üim event'i
    templateSelect.addEventListener('change', function() {
        const templateId = this.value;
        console.log('üéØ Se√ßilen template:', templateId);
        
        if (!templateId) {
            // Temizleme
            window.selectedTemplate = null;
            const dynamicForm = document.getElementById('dynamic-form-fields');
            const criteriaList = document.getElementById('criteria-list');
            if (dynamicForm) dynamicForm.classList.add('hidden');
            if (criteriaList) criteriaList.classList.add('hidden');
            if (generateBtn) generateBtn.classList.add('hidden');
            return;
        }
        
        // Global selectedTemplate'i g√ºncelle
        window.selectedTemplate = window.reportTemplates?.find(t => t.id === templateId);
        console.log('üéØ Global selectedTemplate g√ºncellendi:', window.selectedTemplate);
        
        if (window.selectedTemplate) {
            console.log('üìä Se√ßilen rapor:', window.selectedTemplate.report_name);
            
            // Template a√ßƒ±klamasƒ±nƒ± g√∂ster
            const descriptionElement = document.getElementById('template-description');
            if (descriptionElement && window.selectedTemplate.report_description) {
                descriptionElement.textContent = window.selectedTemplate.report_description;
                descriptionElement.classList.remove('hidden');
            }
            
            // FormData'yƒ± temizle ve yeniden ba≈ülat
            initializeFormData();
            
            // Deƒüi≈ükenleri √ßƒ±kar ve form olu≈ütur
            const variables = extractVariables(window.selectedTemplate.report_prompt);
            createDynamicFormFields(variables);
            
            // Butonu g√∂ster
            if (generateBtn) {
                generateBtn.classList.remove('hidden');
                // Event listener'ƒ± temizle ve yeniden ekle
                generateBtn.onclick = null;
                generateBtn.addEventListener('click', generateAIReport);
            }
            
        } else {
            console.error('‚ùå Template bulunamadƒ±:', templateId);
        }
    });
    
    // Generate butonuna event listener ekle
    if (generateBtn) {
        generateBtn.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Son formData kontrol√º
            if (!window.formData) {
                initializeFormData();
            }
            
            generateAIReport();
        });
    }
    
    console.log('‚úÖ Quick report form kuruldu');
}
// T√ºm ba≈ülatma i≈ülemleri tek bir DOMContentLoaded i√ßinde
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ ParenaTrade - Uygulama ba≈ülatƒ±lƒ±yor...');
    
    // √ñNCE global deƒüi≈ükenleri initialize et
    initializeGlobalVariables();
    
    // Ana uygulamayƒ± ba≈ülat
    initializeApp();
    
    // Debug ve kontrol i≈ülemleri - sƒ±ralƒ± ve gecikmeli
    setTimeout(() => {
        checkTableStatus();
    }, 500);
    
    setTimeout(() => {
        debugServiceTypes();
    }, 1000);
    
    setTimeout(() => {
        debugServiceMatching();
    }, 1500);
    
    setTimeout(() => {
        checkSystemStatus();
    }, 2000);
    
    // API durum kontrol√º
    setTimeout(() => {
        checkAPIStatus().then(status => {
            if (!status) {
                console.warn('‚ö†Ô∏è API servisi kullanƒ±lamƒ±yor');
                // API uyarƒ±sƒ±nƒ± g√∂ster
                const apiWarning = document.getElementById('api-warning');
                if (apiWarning) {
                    apiWarning.classList.remove('hidden');
                }
            } else {
                console.log('‚úÖ API servisi √ßalƒ±≈üƒ±yor');
            }
        });
    }, 2500);
    
    // EXTRA: Sayfa y√ºklendikten sonra formData kontrol√º
    setTimeout(() => {
        console.log('üîç Final FormData Check:', {
            formData: window.formData,
            formDataType: typeof window.formData,
            selectedTemplate: window.selectedTemplate,
            serviceCart: window.serviceCart
        });
    }, 3000);
});

// ACƒ∞L D√úZELTME - Konsolda √ßalƒ±≈ütƒ±rƒ±labilir
function emergencyFormDataFix() {
    console.log('üîÑ Acil FormData d√ºzeltmesi uygulanƒ±yor...');
    
    window.formData = {};
    window.selectedTemplate = window.selectedTemplate || null;
    window.serviceCart = window.serviceCart || [];
    
    console.log('‚úÖ Acil d√ºzeltme tamamlandƒ±:', {
        formData: window.formData,
        selectedTemplate: window.selectedTemplate,
        serviceCart: window.serviceCart
    });
    
    return 'FormData ba≈üarƒ±yla initialize edildi!';
}

// Konsolda test i√ßin
function testFormData() {
    console.log('üß™ FormData Test:');
    console.log('- formData:', window.formData);
    console.log('- selectedTemplate:', window.selectedTemplate);
    console.log('- serviceCart:', window.serviceCart);
    console.log('- reportTemplates:', window.reportTemplates);
    
    if (!window.formData || typeof window.formData !== 'object') {
        console.log('‚ùå FormData hatalƒ±! emergencyFormDataFix() √ßalƒ±≈ütƒ±rƒ±n.');
        return false;
    }
    
    console.log('‚úÖ FormData testi ba≈üarƒ±lƒ±!');
    return true;
}
    

        
// Sistem durumunu kontrol et - G√úNCELLENMƒ∞≈û
async function checkSystemStatus() {
    console.log('=== üîç Sƒ∞STEM DURUM KONTROL√ú ===');
    
    try {
        // 1. Service types kontrol√º
        const { data: services, error: servicesError } = await supabase
            .from('ai_service_type')
            .select('id, service_name')
            .limit(5);
        
        console.log('üìã Service Types:', servicesError ? '‚ùå HATA' : `‚úÖ ${services?.length} hizmet`);
        
        // 2. Questions kontrol√º  
        const { data: questions, error: questionsError } = await supabase
            .from('ai_question')
            .select('id, question, service_type_id, service_type')
            .limit(5);
            
        console.log('üìù Questions:', questionsError ? '‚ùå HATA' : `‚úÖ ${questions?.length} soru`);
        
        // 3. Tablo yapƒ±sƒ±
        await detectTableStructure();
        
        console.log('‚úÖ Sistem durumu: STABIL');
        
    } catch (error) {
        console.error('‚ùå Sistem kontrol hatasƒ±:', error);
    }
}

// Basit tablo yapƒ±sƒ± kontrol√º
async function detectTableStructure() {
    try {
        console.log('üîç Tablo yapƒ±sƒ± kontrol ediliyor...');
        
        // Basit bir test sorgusu
        const { data, error } = await supabase
            .from('ai_question')
            .select('service_type_id, service_type')
            .limit(1);
        
        if (error) {
            console.warn('Tablo yapƒ±sƒ± kontrol edilemedi:', error);
            return 'service_type';
        }
        
        return 'service_type_id'; // Varsayƒ±lan olarak service_type_id kullan
        
    } catch (error) {
        console.error('Tablo yapƒ±sƒ± kontrol hatasƒ±:', error);
        return 'service_type';
    }
}        

// Tablo durumunu kontrol et - G√úNCELLENMƒ∞≈û
async function checkTableStatus() {
    try {
        console.log('=== üìä TABLO DURUM KONTROL√ú ===');
        
        // 1. ai_service_type kontrol√º
        const { data: services, count: serviceCount, error: serviceError } = await supabase
            .from('ai_service_type')
            .select('*', { count: 'exact' });
        
        console.log('üìã ai_service_type:');
        console.log('- Count:', serviceCount);
        console.log('- Error:', serviceError);
        console.log('- Status:', serviceError ? '‚ùå' : '‚úÖ');
        
        // 2. ai_question kontrol√º
        const { data: questions, count: questionCount, error: questionError } = await supabase
            .from('ai_question')
            .select('*', { count: 'exact' })
            .limit(5);
            
        console.log('üìù ai_question:');
        console.log('- Count:', questionCount);
        console.log('- Error:', questionError);
        console.log('- Status:', questionError ? '‚ùå' : '‚úÖ');
        
        // 3. E≈üle≈üme kontrol√º
        if (services && questions) {
            const serviceIds = services.map(s => s.id);
            const matchingQuestions = questions.filter(q => 
                serviceIds.includes(q.service_type_id)
            );
            console.log('üîó E≈üle≈üen sorular:', matchingQuestions.length);
        }
        
    } catch (error) {
        console.error('‚ùå Tablo kontrol hatasƒ±:', error);
    }
}

// √áift y√ºklenmeyi √∂nlemek i√ßin global kontrol
if (window.parenaTradeInitialized) {
    console.log('‚ÑπÔ∏è ParenaTrade zaten y√ºklenmi≈ü');
} else {
    window.parenaTradeInitialized = true;
    // Yukarƒ±daki tek DOMContentLoaded listener burada olacak
}            
                
        // Global deƒüi≈üken - veri y√ºklendi mi takip et
        let serviceTypesLoaded = false;

        // En basit ve g√ºvenli y√∂ntem
        async function loadServiceTypesSimple() {
            try {
                console.log('üîç Hizmet t√ºrleri y√ºkleniyor...');
                
                const { data, error } = await supabase
                    .from('ai_service_type')
                    .select('id, service_name, sort_code')
                    .order('sort_code');
                
                if (error) throw error;
                
                // EN BASƒ∞T YOL: data varsa i≈üle
                if (!data || data.length === 0) {
                    console.error('‚ùå Tablo bo≈ü');
                    return false;
                }
                
                const serviceSelect = document.getElementById('service-select');
                serviceSelect.innerHTML = '<option value="">Hizmet se√ßin</option>';
                
                data.forEach(service => {
                    const option = document.createElement('option');
                    option.value = service.id;
                    option.textContent = service.service_name;
                    serviceSelect.appendChild(option);
                });
                
                console.log(`‚úÖ ${data.length} hizmet t√ºr√º y√ºklendi`);
                return true;
                
            } catch (error) {
                console.error('‚ùå Hizmet t√ºrleri y√ºklenirken hata:', error);
                return false;
            }
        }
                
        // 2. SELECT DEƒûƒ∞≈ûƒ∞Mƒ∞ i√ßin - farklƒ± fonksiyon
        async function handleServiceQuestions(selectedServiceId) {
            try {
                console.log('üîç Sorular y√ºkleniyor, serviceId:', selectedServiceId);
                
                if (!selectedServiceId) {
                    throw new Error('Ge√ßersiz service ID');
                }
                
                // Konsola g√∂re: hem service_type_id HEM service_type var
                // service_type_id: UUID (f3c8c3b7-5cd9-4579-b26d-3b757334fc3b)
                // service_type: string ('hedef_ulke_rapor')
                
                let query = supabase
                    .from('ai_question')
                    .select('id, question, flow_number, service_type_id, service_type')
                    .eq('is_active', true)
                    .order('flow_number');
                
                // √ñNCE: UUID ile e≈üle≈ütirmeyi dene (ger√ßek ID)
                query = query.eq('service_type_id', selectedServiceId);
                
                const { data, error } = await query;
                
                if (error) throw error;
                
                if (data && data.length > 0) {
                    serviceQuestions = data;
                    console.log(`‚úÖ ${data.length} soru y√ºklendi (UUID e≈üle≈ümesi)`);
                    return data;
                }
                
                // Eƒüer UUID ile e≈üle≈üme yoksa, FALLBACK ID'ler i√ßin string e≈üle≈ütirme yap
                console.log('UUID e≈üle≈ümesi bulunamadƒ±, fallback deneniyor...');
                
                const fallbackQuery = supabase
                    .from('ai_question')
                    .select('id, question, flow_number, service_type_id, service_type')
                    .eq('service_type', selectedServiceId)
                    .eq('is_active', true)
                    .order('flow_number');
                    
                const { data: fallbackData, error: fallbackError } = await fallbackQuery;
                
                if (fallbackError) throw fallbackError;
                
                if (fallbackData && fallbackData.length > 0) {
                    serviceQuestions = fallbackData;
                    console.log(`‚úÖ ${fallbackData.length} soru y√ºklendi (string e≈üle≈ümesi)`);
                    return fallbackData;
                }
                
                throw new Error('Bu hizmet i√ßin soru bulunamadƒ±');
                
            } catch (error) {
                console.error('‚ùå Sorular y√ºklenemedi:', error);
                throw error;
            }
        }
                
        // Varsayƒ±lan hizmet t√ºrleri - SADECE GER√áEK ƒ∞HTƒ∞YA√á DURUMUNDA
        function loadDefaultServices() {
            const serviceSelect = document.getElementById('service-select');
            
            // Sadece bo≈üsa ekle
            if (serviceSelect.children.length > 1) {
                console.log('Fallback: Hizmet t√ºrleri zaten var, eklenmedi');
                return;
            }
            
            const defaultServices = [
                { id: 'hedef_ulke_rapor', service_name: 'Hedef √úlke Kapsamlƒ± Rapor' },
                { id: 'firma_kurulus', service_name: 'Firma Kurulu≈üu' },
                { id: 'banka_hesap', service_name: 'Banka Hesabƒ± A√ßƒ±lƒ±≈üƒ±' },
                { id: 'muhasebe', service_name: 'Muhasebe ƒ∞≈ülemleri' },
                { id: 'ihracat_kredileri', service_name: 'ƒ∞hracat Kredileri' }
            ];
            
            defaultServices.forEach(service => {
                const option = document.createElement('option');
                option.value = service.id;
                option.textContent = service.service_name;
                serviceSelect.appendChild(option);
            });
            
            console.log('‚ö†Ô∏è Fallback hizmet t√ºrleri y√ºklendi');
        }        
  

async function generateAIReport() {
    console.log('üöÄ Rapor olu≈üturma ba≈ülatƒ±lƒ±yor...');
    
    // Validasyon
    if (!window.selectedTemplate) {
        alert('‚ùå L√ºtfen rapor t√ºr√º se√ßin.');
        return;
    }
    
    if (!window.formData || typeof window.formData !== 'object') {
        console.error('‚ùå FormData tanƒ±mlƒ± deƒüil:', window.formData);
        alert('‚ùå Form verileri y√ºklenemedi. L√ºtfen sayfayƒ± yenileyin.');
        return;
    }
    
    // Template'e √∂zel validasyon (gtip_required kontrol√º)
    if (window.selectedTemplate.gtip_required && 
        (!window.formData.gtip || String(window.formData.gtip).trim() === '')) {
        alert('‚ùå Bu rapor i√ßin GTIP kodu zorunludur. L√ºtfen GTIP kodu se√ßin.');
        return;
    }
    
    const requiredFields = ['ulke', 'sektor', 'urun'];
    if (window.selectedTemplate.gtip_required) {
        requiredFields.push('gtip');
    }
    
    const missingFields = [];
    requiredFields.forEach(field => {
        if (!window.formData[field] || String(window.formData[field]).trim() === '') {
            missingFields.push(getFieldTitle(field));
        }
    });
    
    if (missingFields.length > 0) {
        alert(`L√ºtfen a≈üaƒüƒ±daki alanlarƒ± doldurun:\n${missingFields.join('\n')}`);
        return;
    }
    
    const generateBtn = document.getElementById('generate-report-btn');
    const progressSection = document.getElementById('report-progress');
    
    // UI durumunu g√ºncelle
    if (generateBtn) {
        generateBtn.disabled = true;
        generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Olu≈üturuluyor...';
    }
    if (progressSection) progressSection.classList.remove('hidden');
    updateProgress(20);

    try {
        // 1. Template prompt'unu doldur
        const finalPrompt = await getTemplatePrompt(
            window.selectedTemplate.id, 
            prepareVariables(window.selectedTemplate, window.formData)
        );
        
        console.log('üìù Template promptu hazƒ±rlandƒ±, ilk 200 karakter:', finalPrompt.substring(0, 200));
        
        if (!finalPrompt) {
            throw new Error('Prompt olu≈üturulamadƒ±.');
        }
        
        updateProgress(40);

        // 2. API'ye g√∂nder (G√úNCELLENDƒ∞ - YENƒ∞ REQUEST BODY)
        console.log('üåê API √ßaƒürƒ±sƒ± yapƒ±lƒ±yor...');
        
        // API request body'sini hazƒ±rla
        const requestBody = {
            prompt: finalPrompt,
            template: window.selectedTemplate.report_name,
            template_code: window.selectedTemplate.report_code, // ‚úÖ YENƒ∞
            parameters: window.formData, // ‚úÖ T√ºm form verileri
            sector: window.selectedTemplate.sector_code || window.formData.sektor, // ‚úÖ YENƒ∞
            country: window.formData.ulke || window.selectedTemplate.target_country || 'G√ºrcistan', // ‚úÖ YENƒ∞
            gtip: window.formData.gtip || '' // ‚úÖ YENƒ∞
        };
        
        console.log('üì§ API Request Body:', {
            template_code: requestBody.template_code,
            country: requestBody.country,
            gtip: requestBody.gtip,
            parameters_count: Object.keys(requestBody.parameters).length
        });
        
        const response = await fetch('https://parenatrade.vercel.app/api/generate-report', {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'X-Request-Source': 'parenatrade-web'
            },
            body: JSON.stringify(requestBody) // ‚úÖ YENƒ∞ JSON BODY
        });

        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`API hatasƒ±: ${response.status} - ${errorText}`);
        }

        const result = await response.json();
        console.log('üì® API cevabƒ±:', { 
            success: result.success, 
            template_used: result.template_used,
            has_pdf_url: !!result.pdf_url 
        });
        
        if (!result.success) {
            throw new Error(result.error || 'Rapor olu≈üturulamadƒ±');
        }

        updateProgress(60);

        // 3. SUPABASE'E KAYDET (G√úNCELLENDƒ∞)
        console.log('üíæ Supabase\'e kaydediliyor...');
        const reportData = {
            template_id: window.selectedTemplate.id,
            report_title: `${window.selectedTemplate.report_name} - ${window.formData.urun || ''}`,
            report_code: window.selectedTemplate.report_code, // ‚úÖ YENƒ∞
            report_prompt: finalPrompt,
            report_content: result.result,
            country: window.formData.ulke || null,
            sector: window.selectedTemplate.sector_code || window.formData.sektor || null, // ‚úÖ YENƒ∞
            product: window.formData.urun || null,
            region: window.formData.bolge || null,
            gtip: window.formData.gtip || null,
            hs_code: window.formData.gtip || null,
            period: window.formData.zaman || null,
            purpose: window.formData.amac || null,
            language: window.formData.dil || 'tr',
            depth: window.formData.derinlik || null,
            report_type: window.selectedTemplate.report_type,
            status: 'completed',
            user_id: window.currentUser?.id || null,
            report_price: window.selectedTemplate.report_price,
            currency: window.selectedTemplate.report_currency,
            pdf_url: result.pdf_url || null, // ‚úÖ PDF URL'sini ekle
            template_data: window.selectedTemplate, // ‚úÖ T√ºm template verisini sakla
            created_at: new Date().toISOString()
        };

        console.log('üìä Kaydedilecek rapor verisi:', {
            report_title: reportData.report_title,
            report_code: reportData.report_code,
            sector: reportData.sector,
            gtip: reportData.gtip
        });

        const { data: report, error } = await supabase
            .from('ai_reports')
            .insert(reportData)
            .select()
            .single();

        if (error) {
            console.error('‚ùå Supabase kayƒ±t hatasƒ±:', error);
            // Hata durumunda bile devam et (kullanƒ±cƒ±ya raporu g√∂ster)
        } else {
            console.log('‚úÖ Rapor Supabase\'e kaydedildi, ID:', report?.id);
        }

        updateProgress(80);

        // 4. SEPETE EKLE (G√úNCELLENDƒ∞)
        const itemPrice = window.selectedTemplate.report_price !== undefined && 
                         window.selectedTemplate.report_price !== null && 
                         !isNaN(parseFloat(window.selectedTemplate.report_price)) 
            ? parseFloat(window.selectedTemplate.report_price) 
            : 199;

        const cartItem = {
            id: window.selectedTemplate.id,
            name: `${window.selectedTemplate.report_name} - ${window.formData.urun || ''}`,
            price: itemPrice,
            currency: window.selectedTemplate.report_currency || 'USD',
            reportId: report?.id,
            type: 'report',
            template_data: window.selectedTemplate,
            sector: window.selectedTemplate.sector_code,
            gtip: window.formData.gtip,
            pdf_url: result.pdf_url // ‚úÖ PDF linkini sepete de ekle
        };

        console.log('üõí Sepete eklenecek √∂ƒüe:', {
            name: cartItem.name,
            price: cartItem.price,
            gtip: cartItem.gtip
        });
        
        addToAICart(cartItem);
        updateProgress(100);

        // 5. Sonu√ßlarƒ± g√∂ster (G√úNCELLENDƒ∞)
        const quickResult = document.getElementById('quick-analysis-result');
        if (quickResult) {
            quickResult.classList.remove('hidden');
            
            // PDF linkini g√∂ster
            if (result.pdf_url) {
                quickResult.innerHTML = `
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-check-circle text-green-500 mr-2"></i>
                            <h4 class="font-bold text-green-800">Rapor Hazƒ±r!</h4>
                        </div>
                        <p class="text-green-700 mb-2">"${window.selectedTemplate.report_name}" raporunuz ba≈üarƒ±yla olu≈üturuldu.</p>
                        <div class="flex space-x-2">
                            ${result.pdf_url ? `
                                <a href="${result.pdf_url}" target="_blank" 
                                   class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 transition inline-flex items-center">
                                    <i class="fas fa-download mr-1"></i> PDF ƒ∞ndir
                                </a>
                            ` : ''}
                            <button onclick="viewCart()" class="bg-indigo-600 text-white px-3 py-1 rounded text-sm hover:bg-indigo-700 transition inline-flex items-center">
                                <i class="fas fa-shopping-cart mr-1"></i> Sepeti G√∂r√ºnt√ºle
                            </button>
                        </div>
                    </div>
                `;
            }
        }
        
        // Ba≈üarƒ± mesajƒ±
        setTimeout(() => {
            if (progressSection) progressSection.classList.add('hidden');
            if (generateBtn) {
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<i class="fas fa-search mr-2"></i> Rapor Olu≈ütur';
            }
            
            console.log('‚úÖ Rapor olu≈üturma i≈ülemi tamamlandƒ±');
            
        }, 2000);

    } catch (error) {
        console.error('‚ùå Rapor olu≈üturma hatasƒ±:', error);
        
        // UI'ƒ± eski haline getir
        if (generateBtn) {
            generateBtn.disabled = false;
            generateBtn.innerHTML = '<i class="fas fa-search mr-2"></i> Rapor Olu≈ütur';
        }
        if (progressSection) progressSection.classList.add('hidden');
        
        // Hata mesajƒ±nƒ± g√∂ster
        let errorMessage = 'Rapor olu≈üturulurken hata: ' + error.message;
        
        if (error.message.includes('API hatasƒ±: 405')) {
            errorMessage = 'API endpoint\'i ge√ßici olarak kullanƒ±lamƒ±yor. L√ºtfen daha sonra tekrar deneyin.';
        } else if (error.message.includes('Failed to fetch')) {
            errorMessage = 'ƒ∞nternet baƒülantƒ±nƒ±zƒ± kontrol edin ve tekrar deneyin.';
        } else if (error.message.includes('GTIP kodu zorunludur')) {
            errorMessage = 'Bu rapor i√ßin GTIP kodu zorunludur. L√ºtfen GTIP kodu se√ßin.';
        }
        
        showError(errorMessage);
    }
}       


// Deƒüi≈ükenleri hazƒ±rla
function prepareVariables(template, formData) {
    return {
        dil: formData.dil || 'T√ºrk√ße',
        ulke: formData.ulke || template.target_country || 'G√ºrcistan',
        sektor: formData.sektor || template.report_category || 'Belirtilmemi≈ü',
        urun: formData.urun || 'Belirtilmemi≈ü',
        bolge: formData.bolge || 'T√ºm B√∂lgeler',
        gtip: formData.gtip || '',
        zaman: formData.zaman || '2020-2025 ve g√ºncel veriler',
        amac: formData.amac || 'pazar analizi ve yatƒ±rƒ±m deƒüerlendirmesi',
        derinlik: formData.derinlik || 'yatƒ±rƒ±mcƒ± sunumuna uygun detaylƒ± rapor',
        rapor_turu: template.report_name,
        yatirim_tutari: formData.yatirim_tutari || '',
        yatirim_turu: formData.yatirim_turu || '',
        hedef_musteri: formData.hedef_musteri || ''
    };
}        

// Template prompt'u getir
async function getTemplatePrompt(templateId, variables) {
    try {
        console.log(`üîç Template promptu aranƒ±yor: ${templateId}`);
        
        // Template'i veritabanƒ±ndan getir
        const { data: template, error } = await supabase
            .from('ai_report_templates')
            .select('report_prompt, report_name, sample_data')
            .eq('id', templateId)
            .single();
        
        if (error) {
            console.error('Template getirme hatasƒ±:', error);
            throw new Error('Template bulunamadƒ±');
        }
        
        if (!template || !template.report_prompt) {
            console.error('Template promptu bulunamadƒ±');
            throw new Error('Template promptu bulunamadƒ±');
        }
        
        console.log(`‚úÖ Template bulundu: ${template.report_name}`);
        
        // Prompt'u doldur
        let filledPrompt = template.report_prompt;
        const currentYear = new Date().getFullYear();
        
        // Deƒüi≈ükenleri yerle≈ütir
        Object.entries(variables).forEach(([key, value]) => {
            if (value && value.trim() !== '') {
                const patterns = [
                    `{{${key}}}`,
                    `%${key}%`,
                    `\\[${key}\\]`
                ];
                
                patterns.forEach(pattern => {
                    const regex = new RegExp(pattern, 'g');
                    filledPrompt = filledPrompt.replace(regex, value.trim());
                });
            }
        });
        
        // current_year'i ekle
        filledPrompt = filledPrompt.replace(/\{\{current_year\}\}/g, currentYear);
        filledPrompt = filledPrompt.replace(/\%current_year\%/g, currentYear);
        
        // Sample data ekle
        if (template.sample_data) {
            try {
                const sampleData = JSON.parse(template.sample_data);
                let sampleText = '\n\n**GER√áEK SEKT√ñR VERƒ∞LERƒ∞ (2024):**\n';
                
                Object.entries(sampleData).forEach(([key, value]) => {
                    if (typeof value === 'number') {
                        if (value >= 1000000) {
                            sampleText += `- ${key}: $${(value / 1000000).toFixed(1)}M\n`;
                        } else if (value >= 1000) {
                            sampleText += `- ${key}: $${(value / 1000).toFixed(1)}K\n`;
                        } else {
                            sampleText += `- ${key}: $${value}\n`;
                        }
                    } else {
                        sampleText += `- ${key}: ${value}\n`;
                    }
                });
                
                filledPrompt += sampleText;
            } catch (e) {
                console.error('Sample data parse hatasƒ±:', e);
            }
        }
        
        // Eksik deƒüi≈ükenleri temizle
        filledPrompt = filledPrompt.replace(/\{\{\w+\}\}/g, 'Belirtilmemi≈ü');
        filledPrompt = filledPrompt.replace(/\%\w+\%/g, 'Belirtilmemi≈ü');
        
        console.log('‚úÖ Template promptu hazƒ±rlandƒ±');
        return filledPrompt;
        
    } catch (error) {
        console.error('‚ùå Template promptu alƒ±namadƒ±:', error);
        throw error;
    }
}


        
// Rapor ≈üablonlarƒ±nƒ± y√ºkle - G√úNCELLENDƒ∞
async function loadReportTemplates() {
    try {
        console.log('üìä Rapor ≈üablonlarƒ± y√ºkleniyor...');
        
        const { data: templates, error } = await supabase
            .from('ai_report_templates')
            .select('*')
            .eq('active', true)
            .order('report_name');
        
        if (error) {
            console.error('‚ùå Rapor ≈üablonlarƒ± y√ºklenemedi:', error);
            return;
        }
        
        if (!templates || templates.length === 0) {
            console.error('‚ùå Rapor ≈üablonu bulunamadƒ±');
            return;
        }
        
        aiReportTemplates = templates;
        window.reportTemplates = templates;
        
        // Template select'i doldur
        const templateSelect = document.getElementById('report-template-select');
        templateSelect.innerHTML = '<option value="">Rapor t√ºr√º se√ßin</option>';
        
        // Sekt√∂rlere g√∂re grupla
        const categories = {};
        
        templates.forEach(template => {
            const category = template.report_category || 'genel';
            if (!categories[category]) {
                categories[category] = [];
            }
            categories[category].push(template);
        });
        
        // Her kategori i√ßin optgroup olu≈ütur
        Object.entries(categories).forEach(([category, categoryTemplates]) => {
            const optgroup = document.createElement('optgroup');
            optgroup.label = category.toUpperCase();
            
            categoryTemplates.forEach(template => {
                const option = document.createElement('option');
                option.value = template.id;
                option.textContent = `${template.report_name} - $${template.report_price} ${template.report_currency}`;
                option.setAttribute('data-category', category);
                option.setAttribute('data-gtip-required', template.gtip_required || false);
                optgroup.appendChild(option);
            });
            
            templateSelect.appendChild(optgroup);
        });
        
        console.log(`‚úÖ ${templates.length} rapor ≈üablonu y√ºklendi`);
        
        // Paketleri de g√ºncelle
        loadServicePackages();
        
    } catch (error) {
        console.error('‚ùå Rapor ≈üablonlarƒ± y√ºklenirken hata:', error);
    }
}        
// Hizmet paketlerini y√ºkle - G√úNCELLENMƒ∞≈û
function loadServicePackages() {
    const packagesContainer = document.getElementById('ai-report-templates');
    
    if (!packagesContainer) {
        console.error('‚ùå Packages container bulunamadƒ±');
        return;
    }

    // Eƒüer zaten y√ºklenmi≈üse temizle
    packagesContainer.innerHTML = '';
    
    aiReportTemplates.forEach(template => {
        const packageHTML = `
            <div class="bg-white rounded-xl shadow-md service-card">
                <div class="p-6 border-b border-gray-200">
                    <div class="sector-icon text-center">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2 text-center">${template.report_name}</h3>
                    <p class="text-gray-600 text-center mb-4">${template.report_description}</p>
                    <div class="text-center mb-4">
                        <span class="text-3xl font-bold text-indigo-600">$${template.report_price}</span>
                        <span class="text-gray-500">${template.report_currency}</span>
                    </div>
                </div>
                <div class="p-6">
                    <ul class="space-y-3 mb-6">
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-500 mr-2"></i>
                            <span>AI destekli analiz</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-500 mr-2"></i>
                            <span>Detaylƒ± pazar verileri</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-500 mr-2"></i>
                            <span>Rakip analizi</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-500 mr-2"></i>
                            <span>Fiyat trendleri</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-500 mr-2"></i>
                            <span>Stratejik √∂neriler</span>
                        </li>
                    </ul>
                    <button class="w-full bg-indigo-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-indigo-700 transition duration-300 add-ai-report" 
                            data-id="${template.id}" 
                            data-name="${template.report_name}" 
                            data-price="${template.report_price}">
                        Sepete Ekle
                    </button>
                </div>
            </div>
        `;
        packagesContainer.innerHTML += packageHTML;
    });

    console.log('‚úÖ Hizmet paketleri y√ºklendi');
}


        
        // Mesajƒ± sohbete ekle
        function addMessageToChat(message, isUser = false) {
            const chatContainer = document.getElementById('chat-container');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-bubble ${isUser ? 'user' : ''}`;
            messageDiv.innerHTML = `<p>${message}</p>`;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

 // setupCompanyAnalysisChat fonksiyonunu d√ºzelt
function setupCompanyAnalysisChat() {
    const serviceSelect = document.getElementById('service-select');
    const chatInput = document.getElementById('chat-input');
    const sendTextButton = document.getElementById('send-text');
    const goBackBtn = document.getElementById('go-back-btn');
    const chatInputArea = document.getElementById('chat-input-area');
    
    // Elementlerin var olduƒüunu kontrol et
    if (!serviceSelect || !chatInput || !sendTextButton || !chatInputArea) {
        console.error('‚ùå Sohbet elementi bulunamadƒ±:', {
            serviceSelect: !!serviceSelect,
            chatInput: !!chatInput,
            sendTextButton: !!sendTextButton,
            chatInputArea: !!chatInputArea
        });
        return; // Elementler yoksa fonksiyondan √ßƒ±k
    }
    
    console.log('‚úÖ Sohbet elementleri bulundu, listenerlar kuruluyor...');
    
    // Event listener'larƒ± temizle ve yeniden ekle
    serviceSelect.addEventListener('change', handleServiceChange);
    sendTextButton.addEventListener('click', handleAnswerSubmit);
    
    if (goBackBtn) {
        goBackBtn.addEventListener('click', handleGoBack);
    }
    
    chatInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            handleAnswerSubmit();
        }
    });

    async function handleServiceChange() {
        const selectedServiceId = this.value;
        
        if (!selectedServiceId) {
            chatInputArea.classList.add('hidden');
            addMessageToChat("L√ºtfen ilgilendiƒüiniz hizmeti se√ßin.");
            return;
        }

        try {
            currentService = selectedServiceId;
            currentQuestionIndex = 0;
            companyProfile[selectedServiceId] = {};
            
            // Sohbeti temizle (ilk mesaj hari√ß)
            const chatContainer = document.getElementById('chat-container');
            if (chatContainer) {
                const initialMessage = chatContainer.querySelector('.chat-bubble:first-child');
                chatContainer.innerHTML = '';
                if (initialMessage) chatContainer.appendChild(initialMessage);
            }
            
            const selectedServiceName = this.options[this.selectedIndex].text;
            addMessageToChat(`"${selectedServiceName}" hizmeti i√ßin analiz ba≈ülatƒ±lƒ±yor...`);
            
            // Sorularƒ± y√ºkle
            await loadServiceQuestionsAdvanced(selectedServiceId);
            
            if (serviceQuestions.length > 0) {
                setTimeout(() => {
                    addMessageToChat(serviceQuestions[0].question);
                    chatInputArea.classList.remove('hidden');
                    if (goBackBtn) goBackBtn.classList.add('hidden');
                }, 1000);
            }
            
        } catch (error) {
            console.error('‚ùå Hizmet deƒüi≈üim hatasƒ±:', error);
            addMessageToChat("‚ùå " + error.message);
        }
    }
    
     function handleGoBack() {
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            const previousQuestion = serviceQuestions[currentQuestionIndex].question;
            
            // Sohbeti d√ºzenle
            const chatContainer = document.getElementById('chat-container');
            if (chatContainer) {
                const messages = chatContainer.querySelectorAll('.chat-bubble');
                if (messages.length >= 2) {
                    chatContainer.removeChild(messages[messages.length - 1]);
                    chatContainer.removeChild(messages[messages.length - 2]);
                }
                
                // √ñnceki soruyu tekrar sor
                addMessageToChat(previousQuestion);
                if (goBackBtn) goBackBtn.classList.toggle('hidden', currentQuestionIndex === 0);
                
                // Form alanƒ±nƒ± temizle
                if (chatInput) chatInput.value = '';
            }
        }
    }
}
        // 4. Tablo verisini debug i√ßin g√∂ster
             
          // Hizmet sorularƒ±nƒ± y√ºkle - TABLO YAPISINA UYGUN
        async function loadServiceQuestions(serviceId) {
            try {
                console.log('üîç Sorular y√ºkleniyor, serviceId:', serviceId);
                
                if (!serviceId) {
                    throw new Error('Ge√ßersiz service ID');
                }
                
                // √ñNEMLƒ∞: Tablo yapƒ±nƒ±za g√∂re sorguyu ayarlayƒ±n
                let query = supabase
                    .from('ai_question')
                    .select('id, question, flow_number, service_type_id, service_type')
                    .eq('is_active', true)
                    .order('flow_number');
                
                // HANGƒ∞ ALAN ƒ∞LE E≈ûLE≈ûTƒ∞RME YAPACAƒûIZ?
                // Se√ßenek 1: service_type_id kullan
                query = query.eq('service_type_id', serviceId);
                
                // VEYA Se√ßenek 2: service_type kullan (string e≈üle≈üme)
                // query = query.eq('service_type', serviceId);
                
                const { data, error } = await query;
                
                if (error) {
                    console.error('‚ùå Sorular y√ºklenemedi:', error);
                    throw error;
                }
                
                if (!data || data.length === 0) {
                    console.warn(`‚ö†Ô∏è ${serviceId} i√ßin soru bulunamadƒ±`);
                    throw new Error('Bu hizmet i√ßin hen√ºz soru bulunmamaktadƒ±r');
                }
                
                serviceQuestions = data;
                console.log(`‚úÖ ${data.length} soru y√ºklendi:`, data);
                
            } catch (error) {
                console.error('‚ùå Sorular y√ºklenirken hata:', error);
                throw error; // Hata yukarƒ± fƒ±rlatƒ±lsƒ±n
            }
        }
   
        // G√ºncellenmi≈ü soru y√ºkleme fonksiyonu
        let tableStructure = null;

        // Hizmet sorularƒ±nƒ± y√ºkle - G√úNCELLENMƒ∞≈û (debug ekle)
async function loadServiceQuestionsAdvanced(serviceId) {
    try {
        console.log('üîç Sorular y√ºkleniyor, serviceId:', serviceId);
        
        if (!serviceId) throw new Error('Ge√ßersiz service ID');
        
        // Hizmet detaylarƒ±nƒ± da al
        const { data: serviceDetails, error: serviceError } = await supabase
            .from('ai_service_type')
            .select('service_name, sort_code, service_price, currency')
            .eq('id', serviceId)
            .single();
            
        if (serviceError) throw serviceError;
        
        console.log('üìã Hizmet detaylarƒ±:', serviceDetails);
        
        // Sorularƒ± y√ºkle
        let { data, error } = await supabase
            .from('ai_question')
            .select('id, question, flow_number, service_type_id, service_type')
            .eq('service_type_id', serviceId)
            .eq('is_active', true)
            .order('flow_number');
        
        if (error) throw error;
        
        // Eƒüer soru bulunamazsa, hizmet t√ºr√ºne g√∂re demo sorular olu≈ütur
        if (!data || data.length === 0) {
            console.warn(`‚ö†Ô∏è ${serviceId} i√ßin soru bulunamadƒ±, demo sorular olu≈üturuluyor`);
            data = generateDemoQuestions(serviceDetails.sort_code || serviceId);
        }
        
        serviceQuestions = data;
        console.log(`‚úÖ ${data.length} soru y√ºklendi`);
        return data;
        
    } catch (error) {
        console.error('‚ùå Sorular y√ºklenemedi:', error);
        throw error;
    }
}


        // Demo sorular olu≈ütur - G√úNCELLENMƒ∞≈û
function generateDemoQuestions(serviceType) {
    const serviceDemoQuestions = {
        'hedef_ulke_rapor': [
            "Hangi √ºlkelerde pazar ara≈ütƒ±rmasƒ± yapmak istiyorsunuz?",
            "Hangi sekt√∂rde faaliyet g√∂steriyorsunuz?",
            "Hedef pazar b√ºy√ºkl√ºƒü√ºn√ºz nedir?",
            "Rakip analizi yapmak istediƒüiniz firmalar var mƒ±?",
            "Raporun hangi dilde hazƒ±rlanmasƒ±nƒ± istersiniz?"
        ],
        'firma_kurulus': [
            "Firmanƒ±zƒ±n adƒ± ne olacak?",
            "Hangi √ºlkede firma kurmak istiyorsunuz?",
            "Firma t√ºr√ºn√ºz ne olacak? (Limited, A.≈û., vb.)",
            "Sermaye miktarƒ±nƒ±z nedir?",
            "Faaliyet konunuz nedir?"
        ],
        'banka_hesap': [
            "Hangi √ºlkede banka hesabƒ± a√ßmak istiyorsunuz?",
            "Hesap t√ºr√º ne olacak? (Bireysel/Kurumsal)",
            "Hangi para birimlerinde hesap gerekiyor?",
            "Aylƒ±k ortalama i≈ülem hacminiz nedir?",
            "√ñncelikli banka tercihleriniz nelerdir?"
        ],
        'muhasebe': [
            "Hangi √ºlkede muhasebe hizmeti almak istiyorsunuz?",
            "Firma t√ºr√ºn√ºz nedir?",
            "Aylƒ±k ortalama i≈ülem sayƒ±nƒ±z nedir?",
            "√ñzel muhasebe gereksinimleriniz var mƒ±?",
            "Tercih ettiƒüiniz muhasebe programƒ± var mƒ±?"
        ],
        'ihracat_kredileri': [
            "ƒ∞hracat yapmayƒ± planladƒ±ƒüƒ±nƒ±z √ºlke nedir?",
            "ƒ∞hracat tutarƒ± ne kadar olacak?",
            "ƒ∞hracat √ºr√ºn√ºn√ºz nedir?",
            "Vade s√ºresi tercihiniz nedir?",
            "Teminat imkanlarƒ±nƒ±z nelerdir?"
        ]
    };
    
    const questions = serviceDemoQuestions[serviceType] || [
        "L√ºtfen ihtiya√ßlarƒ±nƒ±zƒ± detaylandƒ±rƒ±n:",
        "Hedefleriniz nelerdir?",
        "B√ºt√ße aralƒ±ƒüƒ±nƒ±z nedir?",
        "Zaman planlamanƒ±z nasƒ±l?",
        "Ek notlarƒ±nƒ±z var mƒ±?"
    ];
    
    return questions.map((question, index) => ({
        id: `demo-${serviceType}-${index}`,
        question: question,
        flow_number: index + 1,
        service_type_id: serviceType,
        service_type: serviceType,
        is_demo: true
    }));
}
                
    // Firma Analiz Sohbeti - G√úNCELLENMƒ∞≈û
    function setupCompanyAnalysisChat() {
    const serviceSelect = document.getElementById('service-select');
    const chatInput = document.getElementById('chat-input');
    const sendTextButton = document.getElementById('send-text');
    const goBackBtn = document.getElementById('go-back-btn');
    const chatInputArea = document.getElementById('chat-input-area');

    // Event listener'larƒ± temizle ve yeniden ekle
    serviceSelect.addEventListener('change', handleServiceChange);
    sendTextButton.addEventListener('click', handleAnswerSubmit);
    goBackBtn.addEventListener('click', handleGoBack);
    
    chatInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            handleAnswerSubmit();
        }
    });

    async function handleServiceChange() {
        const selectedServiceId = this.value;
        const chatInputArea = document.getElementById('chat-input-area');
        const goBackBtn = document.getElementById('go-back-btn');
        
        if (!selectedServiceId) {
            chatInputArea.classList.add('hidden');
            addMessageToChat("L√ºtfen ilgilendiƒüiniz hizmeti se√ßin.");
            return;
        }

        try {
            currentService = selectedServiceId;
            currentQuestionIndex = 0;
            companyProfile[selectedServiceId] = {};
            
            // Sohbeti temizle (ilk mesaj hari√ß)
            const chatContainer = document.getElementById('chat-container');
            const initialMessage = chatContainer.querySelector('.chat-bubble:first-child');
            chatContainer.innerHTML = '';
            if (initialMessage) chatContainer.appendChild(initialMessage);
            
            const selectedServiceName = this.options[this.selectedIndex].text;
            addMessageToChat(`"${selectedServiceName}" hizmeti i√ßin analiz ba≈ülatƒ±lƒ±yor...`);
            
            // Sorularƒ± y√ºkle
            await loadServiceQuestionsAdvanced(selectedServiceId);
            
            if (serviceQuestions.length > 0) {
                setTimeout(() => {
                    addMessageToChat(serviceQuestions[0].question);
                    chatInputArea.classList.remove('hidden');
                    goBackBtn.classList.add('hidden');
                }, 1000);
            }
            
        } catch (error) {
            console.error('‚ùå Hizmet deƒüi≈üim hatasƒ±:', error);
            addMessageToChat("‚ùå " + error.message);
        }
    }
    
    function handleGoBack() {
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            const previousQuestion = serviceQuestions[currentQuestionIndex].question;
            
            // Sohbeti d√ºzenle
            const chatContainer = document.getElementById('chat-container');
            const messages = chatContainer.querySelectorAll('.chat-bubble');
            if (messages.length >= 2) {
                chatContainer.removeChild(messages[messages.length - 1]);
                chatContainer.removeChild(messages[messages.length - 2]);
            }
            
            // √ñnceki soruyu tekrar sor
            addMessageToChat(previousQuestion);
            goBackBtn.classList.toggle('hidden', currentQuestionIndex === 0);
            
            // Form alanƒ±nƒ± temizle
            chatInput.value = '';
        }
    }
}

// Hizmet t√ºrlerine g√∂re √∂zel son sorular ve fiyat bilgisi
const serviceEndQuestions = {
       'firma_kurulus': {
        question: "≈ûirket kurulu≈ü i≈üleminizi hemen ba≈ülatmak ister misiniz?",
        actionText: "Kurulu≈üu Ba≈ülat"
    },
    'banka_hesap': {
        question: "Banka hesabƒ± a√ßƒ±lƒ±≈ü i≈üleminizi ba≈ülatmak ister misiniz?",
        actionText: "Hesap A√ßƒ±lƒ±≈üƒ±nƒ± Ba≈ülat"
    },
    'muhasebe': {
        question: "Muhasebe i≈ülemlerinizi ba≈ülatmak ister misiniz?",
        actionText: "Muhasebe Ba≈ülat"
    },
    'ihracat_kredileri': {
        question: "ƒ∞hracat kredisi ba≈üvurunuzu ba≈ülatmak ister misiniz?",
        actionText: "Kredi Ba≈üvurusu Ba≈ülat"
    }
};

// Cevap g√∂nderme - D√úZELTƒ∞LMƒ∞≈û
function handleAnswerSubmit() {
    const chatInput = document.getElementById('chat-input');
    const message = chatInput.value.trim();
    const goBackBtn = document.getElementById('go-back-btn');
    
    if (!message) return;

    // Kullanƒ±cƒ± mesajƒ±nƒ± ekle
    addMessageToChat(message, true);

    // ≈ûirket profilini g√ºncelle
    const currentQuestion = serviceQuestions[currentQuestionIndex].question;
    companyProfile[currentService][currentQuestion] = message;

    chatInput.value = '';

    // Son soruya gelindi mi kontrol et
    if (currentQuestionIndex < serviceQuestions.length - 1) {
        // Normal soru devam et
        currentQuestionIndex++;
        const nextQuestion = serviceQuestions[currentQuestionIndex].question;
        setTimeout(() => {
            addMessageToChat(nextQuestion);
            goBackBtn.classList.remove('hidden');
        }, 500);
    } else {
        // SON SORU - Hizmete √∂zel teklifi g√∂ster
        setTimeout(() => {
            showServiceSpecificOffer();
        }, 1000);
    }
}

// Sepeti g√∂r√ºnt√ºle fonksiyonu
function viewCart() {
    // Sepet modal'ƒ±nƒ± a√ß veya sepete y√∂nlendir
    const cartSection = document.getElementById('services');
    if (cartSection) {
        cartSection.scrollIntoView({ behavior: 'smooth' });
    }
}        

// Rapor teklifi g√∂ster
function showReportOffer() {
    const offerHTML = `
        <div class="chat-bubble">
            <p>Kapsamlƒ± Pazar Analizi Raporunuzu hazƒ±rlamamƒ±zƒ± ister misiniz?</p>
            <div class="flex space-x-4 mt-4">
                <button id="accept-offer" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-300">
                    ‚úÖ Evet
                </button>
                <button id="decline-offer" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition duration-300">
                    ‚ùå Hayƒ±r
                </button>
            </div>
        </div>
    `;
    
    const chatContainer = document.getElementById('chat-container');
    chatContainer.insertAdjacentHTML('beforeend', offerHTML);
    
    // Input alanƒ±nƒ± gizle
    document.getElementById('chat-input-area').classList.add('hidden');
    
    // Event listener'larƒ± ekle
    document.getElementById('accept-offer').addEventListener('click', handleOfferAccept);
    document.getElementById('decline-offer').addEventListener('click', handleOfferDecline);
}

// Hizmete √∂zel teklifi g√∂ster - YENƒ∞ FONKSƒ∞YON
async function showServiceSpecificOffer() {
    try {
        // Hizmet detaylarƒ±nƒ± veritabanƒ±ndan al
        const { data: serviceDetails, error } = await supabase
            .from('ai_service_type')
            .select('service_name, service_price, currency, sort_code')
            .eq('id', currentService)
            .single();
        
        if (error) throw error;

        // Hizmet t√ºr√ºne g√∂re son soruyu belirle
        const serviceType = serviceDetails.sort_code || currentService;
        const endConfig = serviceEndQuestions[serviceType] || {
            question: "Hizmetinizi ba≈ülatmak ister misiniz?",
            actionText: "Hizmeti Ba≈ülat"
        };

        const offerHTML = `
            <div class="chat-bubble">
                <p>${endConfig.question}</p>
                <div class="mt-2 p-3 bg-blue-50 rounded-lg border border-blue-200">
                    <div class="flex justify-between items-center">
                        <span class="font-semibold">${serviceDetails.service_name}</span>
                        <span class="text-green-600 font-bold">
                            ${serviceDetails.service_price} ${serviceDetails.currency}
                        </span>
                    </div>
                    <div class="text-sm text-gray-600 mt-1">
                        Hizmet Bedeli
                    </div>
                </div>
                <div class="flex space-x-4 mt-4">
                    <button id="accept-offer" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-300 flex items-center">
                        <i class="fas fa-check mr-2"></i>
                        ${endConfig.actionText}
                    </button>
                    <button id="decline-offer" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition duration-300 flex items-center">
                        <i class="fas fa-times mr-2"></i>
                        Hayƒ±r
                    </button>
                </div>
            </div>
        `;
        
        const chatContainer = document.getElementById('chat-container');
        chatContainer.insertAdjacentHTML('beforeend', offerHTML);
        
        // Input alanƒ±nƒ± gizle
        document.getElementById('chat-input-area').classList.add('hidden');
        
        // Event listener'larƒ± ekle
        document.getElementById('accept-offer').addEventListener('click', () => handleOfferAccept(serviceDetails));
        document.getElementById('decline-offer').addEventListener('click', handleOfferDecline);
        
    } catch (error) {
        console.error('Hizmet detaylarƒ± y√ºklenirken hata:', error);
        // Fallback mesaj
        addMessageToChat("Hizmet bilgileri alƒ±nƒ±rken bir hata olu≈ütu. L√ºtfen daha sonra tekrar deneyin.");
    }
}
// G√úNCELLENMƒ∞≈û - BU KULLANILACAK
function addToAICart(item) {
    // Eƒüer item bir template ise (rapor)
    if (item.template_id) {
        const existingItem = serviceCart.find(cartItem => 
            cartItem.id === item.template_id && cartItem.type !== 'service'
        );
        
        if (!existingItem) {
            serviceCart.push({
                id: item.template_id,
                name: item.report_title || item.report_name,
                price: item.report_price,
                currency: item.report_currency,
                reportId: item.id,
                type: 'report',
                quantity: 1
            });
        }
    } 
    // Eƒüer item bir hizmet ise
    else if (item.type === 'service') {
        const existingItem = serviceCart.find(cartItem => 
            cartItem.id === item.id && cartItem.type === 'service'
        );
        
        if (!existingItem) {
            serviceCart.push({
                id: item.id,
                name: item.name,
                price: item.price,
                currency: item.currency,
                type: 'service',
                profile: item.profile,
                service_type: item.service_type,
                quantity: 1
            });
        }
    }
    // Eƒüer sadece template bilgisi var (eski sistem)
    else {
        const existingItem = serviceCart.find(cartItem => cartItem.id === item.id);
        
        if (!existingItem) {
            serviceCart.push({
                id: item.id,
                name: item.name,
                price: item.price,
                currency: item.currency,
                reportId: item.reportId,
                quantity: 1
            });
        }
    }
    
    updateAICart();
}
        
// handleOfferAccept fonksiyonunu d√ºzelt
async function handleOfferAccept(serviceDetails) {
    try {
        console.log('üõí Servis sepete ekleniyor:', serviceDetails);
        
        // Fiyat kontrol√º - serviceDetails doƒüru mu?
        const servicePrice = serviceDetails.service_price || serviceDetails.price || 0;
        const serviceCurrency = serviceDetails.currency || 'USD';
        const serviceName = serviceDetails.service_name || serviceDetails.name || 'Bilinmeyen Servis';
        
        // Sepete ekle
        const cartItem = {
            id: currentService,
            name: serviceName,
            price: servicePrice,
            currency: serviceCurrency,
            type: 'service',
            profile: companyProfile[currentService],
            service_type: serviceDetails.sort_code || currentService
        };
        
        console.log('‚úÖ Sepet √∂ƒüesi:', cartItem);
        addToAICart(cartItem);
        
        // Kullanƒ±cƒ±ya bilgi ver
        addMessageToChat(`
            ‚úÖ "${serviceName}" hizmeti sepete eklendi! 
            <br>Fiyat: ${servicePrice} ${serviceCurrency}
            <br><br>
            <button onclick="viewCart()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition duration-300 mt-2">
                Sepeti G√∂r√ºnt√ºle
            </button>
        `);
        
        // Butonlarƒ± kaldƒ±r
        document.getElementById('accept-offer').style.display = 'none';
        document.getElementById('decline-offer').style.display = 'none';
        
    } catch (error) {
        console.error('‚ùå Teklif kabul hatasƒ±:', error);
        addMessageToChat('‚ùå Hizmet sepete eklenirken bir hata olu≈ütu. L√ºtfen tekrar deneyin.');
    }
}
        
// Rapor teklifi g√∂ster
function showReportOffer() {
    const offerHTML = `
        <div class="chat-bubble">
            <p>Kapsamlƒ± Pazar Analizi Raporunuzu hazƒ±rlamamƒ±zƒ± ister misiniz?</p>
            <div class="flex space-x-4 mt-4">
                <button id="accept-offer" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-300">
                    ‚úÖ Evet
                </button>
                <button id="decline-offer" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition duration-300">
                    ‚ùå Hayƒ±r
                </button>
            </div>
        </div>
    `;
    
    const chatContainer = document.getElementById('chat-container');
    chatContainer.insertAdjacentHTML('beforeend', offerHTML);
    
    // Input alanƒ±nƒ± gizle
    document.getElementById('chat-input-area').classList.add('hidden');
    
    // Event listener'larƒ± ekle
    document.getElementById('accept-offer').addEventListener('click', handleOfferAccept);
    document.getElementById('decline-offer').addEventListener('click', handleOfferDecline);
}
// Teklifi reddet
function handleOfferDecline() {
    addMessageToChat('Anlƒ±yorum. ƒ∞stediƒüiniz zaman hizmetlerimizden faydalanabilirsiniz. Size nasƒ±l yardƒ±mcƒ± olabilirim?');
    
    // Butonlarƒ± kaldƒ±r
    document.getElementById('accept-offer').style.display = 'none';
    document.getElementById('decline-offer').style.display = 'none';
    
    // Oturum verisini sakla (kullanƒ±cƒ± √ßƒ±kƒ±≈ü yapana kadar)
    saveChatSession();
}

// Oturum verisini sakla
function saveChatSession() {
    const sessionData = {
        serviceId: currentService,
        profile: companyProfile[currentService],
        timestamp: new Date().getTime()
    };
    sessionStorage.setItem('chat_session', JSON.stringify(sessionData));
}

// Oturum verisini temizle
function clearChatSession() {
    sessionStorage.removeItem('chat_session');
    companyProfile = {};
    currentService = null;
    currentQuestionIndex = 0;
    serviceQuestions = [];
}

// Sayfa y√ºklendiƒüinde oturum kontrol√º
function checkChatSession() {
    const savedSession = sessionStorage.getItem('chat_session');
    if (savedSession) {
        const sessionData = JSON.parse(savedSession);
        const now = new Date().getTime();
        const sessionAge = now - sessionData.timestamp;
        
        // 1 saatten eski oturumlarƒ± temizle
        if (sessionAge > 60 * 60 * 1000) {
            clearChatSession();
        } else {
            // Oturumu geri y√ºkle
            console.log('üìù Kayƒ±tlƒ± sohbet oturumu bulundu');
        }
    }
}        
          // ≈ûirket Analizi Olu≈ütur - DOMAIN D√úZELTƒ∞LDƒ∞
        async function generateCompanyAnalysis() {
            try {
                addMessageToChat("üîç Bilgileriniz analiz ediliyor...");
                
                // DOMAIN D√úZELTME: parena-platform.app -> parenatrade.vercel.app
                const response = await fetch('https://parenatrade.vercel.app/api/analyze-company', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        service: currentService,
                        profile: companyProfile[currentService],
                        service_name: document.getElementById('service-select').selectedOptions[0]?.text
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API hatasƒ±: ${response.status} - ${errorText}`);
                }

                const result = await response.json();
                
                if (result.success) {
                    addMessageToChat(result.result);
                    addMessageToChat("üíº Size √∂zel hazƒ±rladƒ±ƒüƒ±m hizmet paketlerini sepete ekleyebilirsiniz.");
                } else {
                    throw new Error(result.error || 'Analiz olu≈üturulamadƒ±');
                }

            } catch (error) {
                console.error('‚ùå Analiz olu≈üturma hatasƒ±:', error);
                addMessageToChat("‚ùå √úzg√ºn√ºm, analiz olu≈üturulamadƒ±: " + error.message);
                
                // Fallback: Mock analiz g√∂ster
                const mockAnalysis = generateMockAnalysis(currentService, companyProfile[currentService]);
                addMessageToChat("üìã Demo analiz:");
                addMessageToChat(mockAnalysis);
                addMessageToChat("üíº Size √∂zel hazƒ±rladƒ±ƒüƒ±m hizmet paketlerini sepete ekleyebilirsiniz.");
            }
        }

        
// Template se√ßiminde global deƒüi≈ükeni g√ºncelle - TAM KOD
function setupQuickReportForm() {
    const templateSelect = document.getElementById('report-template-select');
    const generateBtn = document.getElementById('generate-report-btn');
    
    if (!templateSelect) {
        console.error('‚ùå Template select bulunamadƒ±');
        return;
    }
    
    // Template deƒüi≈üim event'i
    templateSelect.addEventListener('change', function() {
        const templateId = this.value;
        console.log('üéØ Se√ßilen template:', templateId);
        
        if (!templateId) {
            // Temizleme
            window.selectedTemplate = null;
            document.getElementById('dynamic-form-fields').classList.add('hidden');
            document.getElementById('criteria-list').classList.add('hidden');
            if (generateBtn) generateBtn.classList.add('hidden');
            return;
        }
        
        // Global selectedTemplate'i g√ºncelle
        window.selectedTemplate = window.reportTemplates?.find(t => t.id === templateId);
        console.log('üéØ Global selectedTemplate g√ºncellendi:', window.selectedTemplate);
        
        if (window.selectedTemplate) {
            console.log('üìä Se√ßilen rapor:', window.selectedTemplate.report_name);
            
            // Template a√ßƒ±klamasƒ±nƒ± g√∂ster
            const descriptionElement = document.getElementById('template-description');
            if (descriptionElement && window.selectedTemplate.report_description) {
                descriptionElement.textContent = window.selectedTemplate.report_description;
                descriptionElement.classList.remove('hidden');
            }
            
            // Deƒüi≈ükenleri √ßƒ±kar ve form olu≈ütur
            const variables = extractVariables(window.selectedTemplate.report_prompt);
            createDynamicFormFields(variables);
            
            // Butonu g√∂ster
            if (generateBtn) {
                generateBtn.classList.remove('hidden');
                // Event listener'ƒ± temizle ve yeniden ekle
                generateBtn.onclick = null;
                generateBtn.addEventListener('click', generateAIReport);
            }
            
        } else {
            console.error('‚ùå Template bulunamadƒ±:', templateId);
            // Hata durumunda UI'ƒ± temizle
            document.getElementById('dynamic-form-fields').classList.add('hidden');
            document.getElementById('criteria-list').classList.add('hidden');
            if (generateBtn) generateBtn.classList.add('hidden');
        }
    });
    
    // Generate butonuna event listener ekle
    if (generateBtn) {
        generateBtn.addEventListener('click', function(e) {
            e.preventDefault();
            generateAIReport();
        });
    }
    
    // Sayfa y√ºklendiƒüinde mevcut se√ßimi kontrol et
    setTimeout(() => {
        if (templateSelect.value && window.reportTemplates) {
            const currentTemplate = window.reportTemplates.find(t => t.id === templateSelect.value);
            if (currentTemplate) {
                window.selectedTemplate = currentTemplate;
                console.log('üîÑ Mevcut template y√ºklendi:', window.selectedTemplate);
            }
        }
    }, 1000);
    
    console.log('‚úÖ Quick report form kuruldu');
}
        
// Template detaylarƒ±nƒ± Supabase'den √ßek
async function getTemplateDetails(templateId) {
    try {
        const { data, error } = await supabase
            .from('ai_report_templates')
            .select('*')
            .eq('id', templateId)
            .single();
        
        if (error) throw error;
        return data;
        
    } catch (error) {
        console.error('‚ùå Template detaylarƒ± y√ºklenemedi:', error);
        return null;
    }
}

function fillPromptTemplate(template, formData) {
    if (!template || !template.report_prompt) {
        console.error('‚ùå Ge√ßersiz template veya prompt');
        return '';
    }
    
    let filledPrompt = template.report_prompt;
    
    console.log('üîç FormData durumu:', formData);
    
    // current_year'i otomatik ekle
    const currentYear = new Date().getFullYear();
    filledPrompt = filledPrompt.replace(/\{\{current_year\}\}/g, currentYear);
    filledPrompt = filledPrompt.replace(/%current_year%/g, currentYear);
    
    // T√ºm deƒüi≈ükenleri i≈üle
    Object.entries(formData).forEach(([key, value]) => {
        if (value && value.trim() !== '') {
            // T√ºm olasƒ± formatlarda deƒüi≈ütir
            const patterns = [
                `{{${key}}}`,
                `%${key}%`
            ];
            
            patterns.forEach(pattern => {
                const regex = new RegExp(pattern, 'g');
                filledPrompt = filledPrompt.replace(regex, value.trim());
            });
        }
    });
    
    // Eksik deƒüi≈ükenleri temizle
    filledPrompt = filledPrompt.replace(/\{\{\w+\}\}/g, 'Bilgi verilmemi≈ü');
    filledPrompt = filledPrompt.replace(/%\w+%/g, 'Bilgi verilmemi≈ü');
    
    console.log('‚úÖ Prompt dolduruldu, ilk 200 karakter:', filledPrompt.substring(0, 200));
    return filledPrompt;
}
        
// Dropdown verilerini d√ºzeltelim - tablo isimleri yanlƒ±≈ü
async function loadDropdownData() {
    try {
        console.log('üìä Dropdown verileri y√ºkleniyor...');
        
        // 1. Dilleri y√ºkle - EƒûER languages tablosu yoksa, sabit veri kullan
        try {
            const { data: languages, error: langError } = await supabase
                .from('languages')
                .select('id, name, iso_code')
                .order('name');
            
            if (!langError && languages) {
                window.languages = languages;
                console.log(`‚úÖ ${languages.length} dil y√ºklendi`);
            } else {
                // Fallback: Sabit dil listesi
                window.languages = [
                { id: 1, name: 'T√ºrk√ße', iso_code: 'tr' },
                { id: 2, name: 'ƒ∞ngilizce', iso_code: 'en' },
                { id: 3, name: 'Almanca', iso_code: 'de' },
                { id: 4, name: 'Fransƒ±zca', iso_code: 'fr' },
                { id: 5, name: 'Rus√ßa', iso_code: 'ru' }
                ];
                console.log('‚úÖ Varsayƒ±lan diller y√ºklendi');
            }
        } catch (error) {
           window.languages = [
            { id: 1, name: 'T√ºrk√ße', iso_code: 'tr' },
            { id: 2, name: 'ƒ∞ngilizce', iso_code: 'en' },
            { id: 3, name: 'Almanca', iso_code: 'de' },
            { id: 4, name: 'Fransƒ±zca', iso_code: 'fr' },
            { id: 5, name: 'Rus√ßa', iso_code: 'ru' }
        ];
        }
        
        // 2. √úlkeleri y√ºkle - EƒûER country tablosu yoksa, sabit veri kullan
        try {
            const { data: countries, error: countryError } = await supabase
                .from('country')
                .select('id, name, iso_code')
                .order('name');
            
            if (!countryError && countries) {
                window.countries = countries;
                console.log(`‚úÖ ${countries.length} √ºlke y√ºklendi`);
            } else {
                // Fallback: Sabit √ºlke listesi
                window.countries = [
                    { id: 1, name: 'T√ºrkiye', iso_code: 'TR' },
                    { id: 2, name: 'Almanya', iso_code: 'DE' },
                    { id: 3, name: 'Fransa', iso_code: 'FR' },
                    { id: 4, name: 'Romanya', iso_code: 'RO' },
                    { id: 5, name: 'Bulgaristan', iso_code: 'BG' }
                ];
                console.log('‚úÖ Varsayƒ±lan √ºlkeler y√ºklendi');
            }
        } catch (error) {
            window.countries = [
                { id: 1, name: 'T√ºrkiye', iso_code: 'TR' },
                { id: 2, name: 'Almanya', iso_code: 'DE' }
            ];
        }
        
        // 3. Sekt√∂rleri y√ºkle - EƒûER sector tablosu yoksa, sabit veri kullan
        try {
            const { data: sectors, error: sectorError } = await supabase
                .from('sector')
                .select('id, name, code')
                .order('name');
            
            if (!sectorError && sectors) {
                window.sectors = sectors;
                console.log(`‚úÖ ${sectors.length} sekt√∂r y√ºklendi`);
            } else {
                // Fallback: Sabit sekt√∂r listesi
                window.sectors = [
                    { id: 1, name: 'Gƒ±da', code: 'FOOD' },
                    { id: 2, name: 'Tekstil', code: 'TEXTILE' },
                    { id: 3, name: 'Kimya', code: 'CHEMICAL' },
                    { id: 4, name: 'Otomotiv', code: 'AUTO' },
                    { id: 5, name: 'Teknoloji', code: 'TECH' }
                ];
                console.log('‚úÖ Varsayƒ±lan sekt√∂rler y√ºklendi');
            }
        } catch (error) {
            window.sectors = [
                { id: 1, name: 'Gƒ±da', code: 'FOOD' },
                { id: 2, name: 'Tekstil', code: 'TEXTILE' }
            ];
        }
        
        // 4. GTIP kodlarƒ±nƒ± y√ºkle - EƒûER gtip tablosu yoksa, sabit veri kullan
        try {
            const { data: gtipCodes, error: gtipError } = await supabase
                .from('gtip')
                .select('id, name, code')
                .order('code');
            
            if (!gtipError && gtipCodes) {
                window.gtipCodes = gtipCodes;
                console.log(`‚úÖ ${gtipCodes.length} GTIP kodu y√ºklendi`);
            } else {
                // Fallback: Sabit GTIP listesi
                window.gtipCodes = [
                    { id: 1, code: '2002.10', name: 'Domates Sal√ßasƒ±'},
                    { id: 2, code: '2002.90', name: 'Diƒüer Sebze Sal√ßalarƒ±'},
                    { id: 3, code: '5208', name: 'Pamuklu Dokumalar'},
                    { id: 4, code: '6109', name: 'Ti≈ü√∂rt ve Atlet'}
                ];
                console.log('‚úÖ Varsayƒ±lan GTIP kodlarƒ± y√ºklendi');
            }
        } catch (error) {
            window.gtipCodes = [
                { id: 1, code: '2002.10', name: 'Domates Sal√ßasƒ±'},
                { id: 2, code: '5208', name: 'Pamuklu Dokumalar'}
            ];
        }
        
        // 5. Rapor ≈üablonlarƒ±nƒ± y√ºkle - ai_report_templates yerine mevcut sistemi kullan
        try {
            const { data: reportTemplates, error: templateError } = await supabase
                .from('ai_report_templates')
                .select('id, report_name, report_type, report_description, report_price, report_currency')
                .order('report_name');
            
            if (!templateError && reportTemplates) {
                window.reportTemplates = reportTemplates;
                console.log(`‚úÖ ${reportTemplates.length} rapor ≈üablonu y√ºklendi`);
            } else {
                // Fallback: Mevcut rapor ≈üablonlarƒ±nƒ± kullan
                window.reportTemplates = aiReportTemplates;
                console.log('‚úÖ Mevcut rapor ≈üablonlarƒ± kullanƒ±lƒ±yor');
            }
        } catch (error) {
            window.reportTemplates = aiReportTemplates;
        }
        
    } catch (error) {
        console.error('‚ùå Dropdown verileri y√ºklenirken hata:', error);
        // Hata durumunda varsayƒ±lan verileri y√ºkle
        loadDefaultDropdownData();
    }
}

// Varsayƒ±lan dropdown verileri
function loadDefaultDropdownData() {
    window.languages = [
        { id: 1, name: 'T√ºrk√ße', iso_code: 'tr' },
        { id: 2, name: 'ƒ∞ngilizce', iso_code: 'en' },
        { id: 3, name: 'G√ºrc√ºce', iso_code: 'ka' }
    ];
    
    window.countries = [
        { id: 1, name: 'T√ºrkiye', code: 'TR' },
        { id: 2, name: 'G√ºrcistan', code: 'KA' },
        { id: 3, name: 'ƒ∞ngiltere', code: 'EN' },
        { id: 4, name: 'Almanya', code: 'DE' },
        { id: 5, name: 'Fransa', code: 'FR' }
        
    ];
    
    window.sectors = [
        { id: 1, name: 'Gƒ±da', code: 'FOOD' },
        { id: 2, name: 'Tekstil', code: 'TEXTILE' },
        { id: 3, name: 'Kimya', code: 'CHEMICAL' }
    ];
    
    window.gtipCodes = [
        { id: 1, code: '2002.10', name: 'Domates Sal√ßasƒ±'},
        { id: 2, code: '5208', name: 'Pamuklu Dokumalar'}
    ];
    
    window.reportTemplates = aiReportTemplates;
}
// Akordiyon event listener'larƒ±nƒ± ekle - EKSƒ∞K KISIM
// Akordiyon listener'larƒ±nƒ± kur - D√úZELTƒ∞LMƒ∞≈û
function setupAccordionListeners() {
    const accordionHeaders = document.querySelectorAll('.accordion-header');
    
    console.log('üîß Akordiyon listenerlarƒ± kuruluyor, eleman sayƒ±sƒ±:', accordionHeaders.length);
    
    if (accordionHeaders.length === 0) {
        console.warn('‚ö†Ô∏è Akordiyon header bulunamadƒ± - form alanlarƒ± hen√ºz olu≈ümamƒ±≈ü olabilir');
        return;
    }
    
    accordionHeaders.forEach(header => {
        // √ñnceki event listener'larƒ± temizle
        header.replaceWith(header.cloneNode(true));
    });
    
    // Yeni listener'larƒ± ekle
    document.querySelectorAll('.accordion-header').forEach(header => {
        header.addEventListener('click', function() {
            const content = this.nextElementSibling;
            
            if (this.classList.contains('active')) {
                // Kapat
                this.classList.remove('active');
                content.classList.remove('open');
                activeAccordion = null;
            } else {
                // √ñncekini kapat
                if (activeAccordion) {
                    activeAccordion.classList.remove('active');
                    activeAccordion.nextElementSibling.classList.remove('open');
                }
                // Yeni a√ß
                this.classList.add('active');
                content.classList.add('open');
                activeAccordion = this;
            }
        });
    });
    
    console.log('‚úÖ Akordiyon listenerlarƒ± kuruldu');
}

        
// Dinamik form alanlarƒ±nƒ± olu≈ütur - TAM Bƒ∞RLE≈ûTƒ∞Rƒ∞LMƒ∞≈û
function createDynamicFormFields(variables) {
    const container = document.getElementById('dynamic-form-fields');
    if (!container) {
        console.error('‚ùå Form container bulunamadƒ±');
        return;
    }
    
     container.innerHTML = '';
    
    // FORM DATA INITIALIZATION - BURAYA DA EKLE
    if (!window.formData) {
        window.formData = {};
        console.log('‚úÖ window.formData createDynamicFormFields i√ßinde initialize edildi');
    }
    
    // Field konfig√ºrasyonlarƒ± - GER√áEK (√úSTTEKƒ∞ KODDAN)
    const fieldConfigs = {
        dil: {
            title: 'Rapor Dili',
            type: 'dropdown',
            data: window.languages || [
                { id: 1, name: 'T√ºrk√ße', iso_code: 'tr' },
                { id: 2, name: 'ƒ∞ngilizce', iso_code: 'en' }
            ],
            displayField: 'name',
            valueField: 'iso_code'
        },
        ulke: {
            title: 'Hedef √úlke',
            type: 'dropdown',
            data: window.countries || [
                { id: 1, name: 'T√ºrkiye', iso_code: 'TR' },
                { id: 2, name: 'Almanya', iso_code: 'DE' }
            ],
            displayField: 'name',
            valueField: 'name'
        },
        sektor: {
            title: 'Sekt√∂r',
            type: 'dropdown',
            data: window.sectors || [
                { id: 1, name: 'Gƒ±da', code: 'FOOD' },
                { id: 2, name: 'Tekstil', code: 'TEXTILE' }
            ],
            displayField: 'name',
            valueField: 'name'
        },
        firma_adi: {
        title: 'Firma Adƒ±',
        type: 'text',
        placeholder: 'Analiz edilecek firma veya marka adƒ±...'
    },
        urun: {
            title: '√úr√ºn/Hizmet',
            type: 'text',
            placeholder: '√ñrn: Domates Sal√ßasƒ±, Tekstil √úr√ºnleri...'
        },
        bolge: {
            title: 'B√∂lge',
            type: 'dropdown',
            data: [
                { id: 'all', name: 'T√ºm B√∂lgeler' },
                { id: 'east', name: 'Doƒüu' },
                { id: 'west', name: 'Batƒ±' },
                { id: 'north', name: 'Kuzey' },
                { id: 'south', name: 'G√ºney' }
            ],
            displayField: 'name',
            valueField: 'name'
        },
        gtip: {
            title: 'GTIP Kodu',
            type: 'text',
            placeholder: '√ñrn: 2002.10, 5208.11...'
        },
        zaman: {
            title: 'Zaman Aralƒ±ƒüƒ±',
            type: 'text',
            placeholder: '√ñrn: 2020-2024, Son 5 yƒ±l...'
        },
        amac: {
            title: 'Analiz Amacƒ±',
            type: 'textarea',
            placeholder: 'Raporu hangi ama√ßla kullanacaksƒ±nƒ±z?'
        },
        derinlik: {
            title: 'Analiz Derinliƒüi',
            type: 'dropdown',
            data: [
                { id: 1, name: '√ñzet Rapor' },
                { id: 2, name: 'Detaylƒ± Analiz' },
                { id: 3, name: 'Kapsamlƒ± Ara≈ütƒ±rma' }
            ],
            displayField: 'name',
            valueField: 'name'
        },
        rapor_turu: {
            title: 'Rapor T√ºr√º',
            type: 'hidden'
        }
    };
    
    // ALTTAKƒ∞ KODDAN GELEN MANTIK:
    if (!variables || variables.length === 0) {
        container.innerHTML = '<p class="text-gray-500 p-4">Bu rapor i√ßin ek bilgi gerekmemektedir.</p>';
        container.classList.remove('hidden');
        return;
    }
    
     variables.forEach(variable => {
        const config = fieldConfigs[variable];
        if (!config) {
            console.warn(`‚ö†Ô∏è ${variable} i√ßin config bulunamadƒ±`);
            return;
        }
        
        if (config.type === 'hidden') {
            window.formData[variable] = window.selectedTemplate?.report_name || ''; // formData -> window.formData
            return;
        }
        
        const fieldHTML = `
            <div class="accordion-item">
                <div class="accordion-header" data-field="${variable}">
                    <span>${config.title}</span>
                    <i class="fas fa-chevron-down accordion-icon"></i>
                </div>
                <div class="accordion-content">
                    ${createFieldHTML(variable, config)}
                </div>
            </div>
        `;
        
        container.innerHTML += fieldHTML;
        window.formData[variable] = ''; // formData -> window.formData // Ba≈ülangƒ±√ß deƒüeri
    });
    
    // ALTTAKƒ∞ KODDAN GELEN ƒ∞Yƒ∞LE≈ûTƒ∞RME:
    if (selectedTemplate) {
        formData.rapor_turu = selectedTemplate.report_name;
    }
    
    container.classList.remove('hidden');
    
    // ƒ∞Kƒ∞ KODDAN GELEN LISTENER'LAR:
    setTimeout(() => {
        setupAccordionListeners();
        setupFieldEventListeners(); // YENƒ∞ TAM FONKSƒ∞YON
        updateCriteriaList();       // ALTTAKƒ∞ KODDAN GELEN
    }, 100);
    
    console.log('‚úÖ Form alanlarƒ± olu≈üturuldu');
}
// Form alanƒ± olu≈ütur
function createFieldHTML(field, config) {
    const baseClasses = "w-full px-4 py-2 border border-gray-300 rounded-lg form-field";
    
    switch (config.type) {
        case 'dropdown':
            return `
                <select class="${baseClasses}" data-field="${field}">
                    <option value="">Se√ßiniz</option>
                    ${config.data.map(item => 
                        `<option value="${item[config.valueField]}">${item[config.displayField]}</option>`
                    ).join('')}
                </select>
            `;
        
        case 'searchable-dropdown':
            return `
                <div class="searchable-dropdown relative">
                    <input type="text" 
                           class="${baseClasses} search-input"
                           placeholder="${config.placeholder || 'Arama yapƒ±n...'}"
                           data-field="${field}"
                           id="${field}-search-input">
                    <div class="dropdown-results hidden absolute z-50 w-full bg-white border border-gray-300 rounded-lg mt-1 max-h-60 overflow-y-auto shadow-xl"></div>
                </div>
                <div class="selected-value mt-2 hidden">
                    <span class="text-sm text-gray-600">Se√ßilen: </span>
                    <span class="selected-text font-medium"></span>
                    <button class="text-red-500 hover:text-red-700 clear-selection ml-2" data-field="${field}">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
        
        case 'textarea':
            return `
                <textarea class="${baseClasses}" 
                          data-field="${field}" 
                          placeholder="${config.placeholder || ''}"
                          rows="3"></textarea>
            `;
        
        default:
            return `
                <input type="text" 
                       class="${baseClasses}"
                       data-field="${field}"
                       placeholder="${config.placeholder || ''}">
            `;
    }
}
// Field HTML olu≈ütur - YENƒ∞ FONKSƒ∞YON
function createFieldHTML(field, config) {
    switch (config.type) {
        case 'dropdown':
            return `
                <select class="w-full px-4 py-2 border border-gray-300 rounded-lg form-field" data-field="${field}">
                    <option value="">Se√ßiniz</option>
                    ${config.data.map(item => 
                        `<option value="${item[config.valueField]}">${item[config.displayField]}</option>`
                    ).join('')}
                </select>
            `;
        
        case 'textarea':
            return `
                <textarea class="w-full px-4 py-2 border border-gray-300 rounded-lg form-field" 
                          data-field="${field}" 
                          placeholder="${config.placeholder || ''}"
                          rows="3"></textarea>
            `;
        
        default: // text
            return `
                <input type="text" 
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg form-field"
                       data-field="${field}"
                       placeholder="${config.placeholder || ''}">
            `;
    }
}
        

// Dropdown alanƒ± olu≈ütur
function createDropdownField(field, config) {
    return `
        <div class="accordion-item">
            <div class="accordion-header" data-field="${field}">
                <span>${config.title}</span>
                <i class="fas fa-chevron-down accordion-icon"></i>
            </div>
            <div class="accordion-content">
                <select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 form-field dropdown-field"
                        data-field="${field}">
                    <option value="">Se√ßiniz</option>
                    ${config.data ? config.data.map(item => 
                        `<option value="${item[config.valueField]}">${item[config.displayField]}</option>`
                    ).join('') : ''}
                </select>
            </div>
        </div>
    `;
}

// Arama yapƒ±labilir dropdown (GTIP i√ßin) - MEVCUT FONKSƒ∞YONU D√úZELTELƒ∞M
// Arama yapƒ±labilir dropdown (GTIP i√ßin) - MEVCUT FONKSƒ∞YONU D√úZELTELƒ∞M
function createSearchableDropdownField(field, config) {
    return `
        <div class="accordion-item">
            <div class="accordion-header" data-field="${field}">
                <span>${config.title}</span>
                <i class="fas fa-chevron-down accordion-icon"></i>
            </div>
            <div class="accordion-content">
                <div class="searchable-dropdown relative">
                    <input type="text" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 search-input"
                           placeholder="${field === 'gtip' ? 'GTIP kodu yazƒ±n (√∂rn: 2002.90) veya √ºr√ºn adƒ± arayƒ±n...' : 'Arama yapƒ±n...'}"
                           data-field="${field}"
                           id="${field}-search-input">
                    <div class="dropdown-results hidden absolute z-50 w-full bg-white border border-gray-300 rounded-lg mt-1 max-h-60 overflow-y-auto shadow-xl"></div>
                </div>
                ${field === 'gtip' ? `
                <div class="selected-value mt-3 p-3 bg-green-50 rounded-lg border border-green-200 hidden">
                    <div class="flex justify-between items-center">
                        <div>
                            <span class="text-sm text-green-700 font-medium">Se√ßilen GTIP:</span>
                            <div class="selected-text font-semibold text-green-800"></div>
                        </div>
                        <button class="text-red-500 hover:text-red-700 clear-selection" data-field="${field}">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                ` : `
                <div class="selected-value mt-2 hidden">
                    <span class="text-sm text-gray-600">Se√ßilen: </span>
                    <span class="selected-text font-medium"></span>
                </div>
                `}
            </div>
        </div>
    `;
}
        
// Rapor ≈üablonu dropdown
function createTemplateDropdownField(field, config) {
    return `
        <div class="accordion-item">
            <div class="accordion-header" data-field="${field}">
                <span>${config.title}</span>
                <i class="fas fa-chevron-down accordion-icon"></i>
            </div>
            <div class="accordion-content">
                <select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 form-field template-field"
                        data-field="${field}">
                    <option value="">Rapor t√ºr√º se√ßin</option>
                    ${config.data ? config.data.map(item => 
                        `<option value="${item[config.valueField]}" 
                                data-description="${item.report_description}"
                                data-price="${item.report_price}"
                                data-currency="${item.report_currency}">
                            ${item[config.displayField]} - $${item.report_price} ${item.report_currency}
                        </option>`
                    ).join('') : ''}
                </select>
                <div class="template-description mt-2 text-sm text-gray-600 hidden"></div>
            </div>
        </div>
    `;
}

// Text alanƒ± olu≈ütur
function createTextField(field, config) {
    return `
        <div class="accordion-item">
            <div class="accordion-header" data-field="${field}">
                <span>${config.title}</span>
                <i class="fas fa-chevron-down accordion-icon"></i>
            </div>
            <div class="accordion-content">
                <input type="text" 
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 form-field"
                       data-field="${field}"
                       placeholder="${config.placeholder || ''}">
            </div>
        </div>
    `;
}

// Field event listener'larƒ±nƒ± KESƒ∞N √á√ñZ√úM - SADECE GEREKLƒ∞ D√úZELTMELER
function setupFieldEventListeners() {
    console.log('üîß Field event listenerlarƒ± kuruluyor...');
    
    // FORM DATA INITIALIZATION - SADECE BURAYA EKLE
    if (!window.formData) {
        window.formData = {};
        console.log('‚úÖ window.formData setupFieldEventListeners i√ßinde initialize edildi');
    }
    
    // 1. T√úM select elementlerini dinle - KESƒ∞N √á√ñZ√úM
    document.addEventListener('change', function(e) {
        const target = e.target;
        
        if (target.tagName === 'SELECT') {
            const fieldName = target.getAttribute('data-field');
            if (fieldName) {
                window.formData[fieldName] = target.value; // SADECE formData -> window.formData
                console.log(`‚úÖ SELECT ${fieldName} se√ßildi:`, target.value);
                updateCriteriaList();
            }
        }
    });
    
    // 2. T√úM input ve textarea'larƒ± dinle
    document.addEventListener('input', function(e) {
        const target = e.target;
        
        if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA') {
            const fieldName = target.getAttribute('data-field');
            if (fieldName && !target.classList.contains('search-input')) {
                window.formData[fieldName] = target.value; // SADECE formData -> window.formData
                console.log(`‚úÖ INPUT ${fieldName} deƒüi≈üti:`, target.value);
                updateCriteriaList();
            }
        }
    });
    
    // 3. Arama yapƒ±labilir dropdown'lar (mevcut kodunuz - DEƒûƒ∞≈ûƒ∞KLƒ∞K YOK)
    document.querySelectorAll('.search-input').forEach(input => {
        input.addEventListener('input', debounce(function() {
            const field = this.getAttribute('data-field');
            const searchTerm = this.value.trim();
            const resultsContainer = this.parentElement.querySelector('.dropdown-results');
            const selectedContainer = this.closest('.accordion-content').querySelector('.selected-value');
            
            console.log(`üîç ${field} arama:`, searchTerm);
            
            if (searchTerm.length < 2) {
                resultsContainer.classList.add('hidden');
                return;
            }
            
            let filteredResults = [];
            
            if (field === 'gtip') {
                if (!window.gtipCodes || window.gtipCodes.length === 0) {
                    resultsContainer.innerHTML = '<div class="p-3 text-red-500">GTIP verileri y√ºklenemedi</div>';
                    resultsContainer.classList.remove('hidden');
                    return;
                }
                
                filteredResults = window.gtipCodes.filter(item => 
                    item.code.toString().includes(searchTerm) || 
                    item.name.toLowerCase().includes(searchTerm.toLowerCase())
                ).slice(0, 8);
                
            } else if (field === 'amac' || field === 'derinlik') {
                const config = getFieldConfig(field);
                if (config && config.data) {
                    filteredResults = config.data.filter(item => 
                        item.name.toLowerCase().includes(searchTerm.toLowerCase())
                    ).slice(0, 6);
                }
            }
            
            if (filteredResults.length > 0) {
                resultsContainer.innerHTML = filteredResults.map(item => {
                    if (field === 'gtip') {
                        return `
                            <div class="p-3 hover:bg-blue-50 cursor-pointer border-b border-gray-100 search-result-item" 
                                 data-value="${item.code}" 
                                 data-display="${item.code} - ${item.name}">
                                <div class="font-bold text-blue-700">${item.code}</div>
                                <div class="text-sm text-gray-700">${item.name}</div>
                            </div>
                        `;
                    } else {
                        return `
                            <div class="p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 search-result-item" 
                                 data-value="${item.name}" 
                                 data-display="${item.name}">
                                <div class="font-medium">${item.name}</div>
                            </div>
                        `;
                    }
                }).join('');
                resultsContainer.classList.remove('hidden');
            } else {
                resultsContainer.innerHTML = '<div class="p-3 text-gray-500">Sonu√ß bulunamadƒ±</div>';
                resultsContainer.classList.remove('hidden');
            }
        }, 300));
        
        input.addEventListener('focus', function() {
            const resultsContainer = this.parentElement.querySelector('.dropdown-results');
            if (this.value.trim().length > 0) {
                resultsContainer.classList.remove('hidden');
            }
        });
    });
    
    // 4. Dropdown sonu√ß tƒ±klama (mevcut kodunuz - SADECE formData -> window.formData)
    document.addEventListener('click', function(e) {
        if (e.target.closest('.search-result-item')) {
            const resultItem = e.target.closest('.search-result-item');
            const value = resultItem.getAttribute('data-value');
            const display = resultItem.getAttribute('data-display');
            const resultsContainer = resultItem.closest('.dropdown-results');
            const input = resultsContainer.previousElementSibling;
            const field = input.getAttribute('data-field');
            const selectedContainer = input.closest('.accordion-content').querySelector('.selected-value');
            
            console.log(`‚úÖ ${field} se√ßildi:`, value);
            
            window.formData[field] = value; // SADECE formData -> window.formData
            input.value = display;
            
            if (selectedContainer) {
                selectedContainer.querySelector('.selected-text').textContent = display;
                selectedContainer.classList.remove('hidden');
            }
            
            resultsContainer.classList.add('hidden');
            updateCriteriaList();
        }
        
        if (e.target.closest('.clear-selection')) {
            const button = e.target.closest('.clear-selection');
            const field = button.getAttribute('data-field');
            const input = document.getElementById(`${field}-search-input`);
            const selectedContainer = button.closest('.selected-value');
            
            window.formData[field] = ''; // SADECE formData -> window.formData
            if (input) input.value = '';
            if (selectedContainer) selectedContainer.classList.add('hidden');
            updateCriteriaList();
        }
        
        if (!e.target.closest('.search-input') && !e.target.closest('.dropdown-results')) {
            document.querySelectorAll('.dropdown-results').forEach(container => {
                container.classList.add('hidden');
            });
        }
    });
    
    console.log('‚úÖ T√ºm field listenerlarƒ± kuruldu');
}
        
// Debounce fonksiyonu
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}
        // Field config getter
function getFieldConfig(field) {
    const fieldConfigs = {
        amac: {
            data: [
                { id: 1, name: 'Yeni bir giri≈üim pazara giri≈ü stratejisi i√ßin kullanacaƒüƒ±m' },
                { id: 2, name: 'Mevcut √ºr√ºn/hizmeti geli≈ütirmek i√ßin pazar analizi' },
                { id: 3, name: 'Yatƒ±rƒ±m kararƒ± ve risk deƒüerlendirmesi' },
                { id: 4, name: 'Rekabet analizi ve stratejik pozisyon belirleme' },
                { id: 5, name: '√úr√ºn fiyatlandƒ±rma ve pazarlama stratejisi geli≈ütirme' }
            ]
        },
        derinlik: {
            data: [
                { id: 1, name: '√áƒ±ktƒ±yƒ± y√∂netim sunumuna uygun ≈üekilde 5-6 ba≈ülƒ±k altƒ±nda rapor formatƒ±nda hazƒ±rla' },
                { id: 2, name: 'Stratejik y√∂netim i√ßin detaylƒ± analiz ve √∂neriler' },
                { id: 3, name: 'Yatƒ±rƒ±mcƒ± sunumu i√ßin √∂zet rapor ve finansal projeksiyonlar' },
                { id: 4, name: 'Operasyonel ekip i√ßin detaylƒ± pazar ve rekabet analizi' }
            ]
        }
    };
    return fieldConfigs[field];
}

        // Field konfig√ºrasyonlarƒ±
const fieldConfigs = {
    dil: {
        title: 'Rapor Dili',
        type: 'dropdown',
        data: window.languages || [
            { id: 1, name: 'T√ºrk√ße', iso_code: 'tr' },
            { id: 2, name: 'ƒ∞ngilizce', iso_code: 'en' }
        ],
        displayField: 'name',
        valueField: 'iso_code'
    },
    ulke: {
        title: 'Hedef √úlke',
        type: 'dropdown',
        data: window.countries || [
            { id: 1, name: 'T√ºrkiye', iso_code: 'TR' },
            { id: 2, name: 'Almanya', iso_code: 'DE' }
        ],
        displayField: 'name',
        valueField: 'name'
    },
    sektor: {
        title: 'Sekt√∂r',
        type: 'dropdown',
        data: window.sectors || [
            { id: 1, name: 'Gƒ±da', code: 'FOOD' },
            { id: 2, name: 'Tekstil', code: 'TEXTILE' }
        ],
        displayField: 'name',
        valueField: 'name'
    },
    urun: {
        title: '√úr√ºn/Hizmet',
        type: 'text',
        placeholder: '√ñrn: Domates Sal√ßasƒ±, Tekstil √úr√ºnleri...'
    },
    bolge: {
        title: 'B√∂lge',
        type: 'dropdown',
        data: [
            { name: 'T√ºm B√∂lgeler' },
            { name: 'Doƒüu' },
            { name: 'Batƒ±' },
            { name: 'Kuzey' },
            { name: 'G√ºney' }
        ],
        displayField: 'name',
        valueField: 'name'
    },
    gtip: {
        title: 'GTIP Kodu',
        type: 'searchable-dropdown',
        data: window.gtipCodes || [],
        displayField: 'name',
        valueField: 'code'
    },
    zaman: {
        title: 'Zaman Aralƒ±ƒüƒ±',
        type: 'text',
        placeholder: '√ñrn: 2020-2024, Son 5 yƒ±l...'
    },
    amac: {
        title: 'Analiz Amacƒ±',
        type: 'searchable-dropdown',
        data: [
            { id: 1, name: 'Yeni bir giri≈üim pazara giri≈ü stratejisi i√ßin kullanacaƒüƒ±m' },
            { id: 2, name: 'Mevcut √ºr√ºn/hizmeti geli≈ütirmek i√ßin pazar analizi' },
            { id: 3, name: 'Yatƒ±rƒ±m kararƒ± ve risk deƒüerlendirmesi' }
        ],
        displayField: 'name',
        valueField: 'name'
    },
    derinlik: {
        title: 'Analiz Derinliƒüi',
        type: 'searchable-dropdown',
        data: [
            { id: 1, name: '√áƒ±ktƒ±yƒ± y√∂netim sunumuna uygun ≈üekilde 5-6 ba≈ülƒ±k altƒ±nda rapor formatƒ±nda hazƒ±rla' },
            { id: 2, name: 'Stratejik y√∂netim i√ßin detaylƒ± analiz ve √∂neriler' },
            { id: 3, name: 'Yatƒ±rƒ±mcƒ± sunumu i√ßin √∂zet rapor ve finansal projeksiyonlar' }
        ],
        displayField: 'name',
        valueField: 'name'
    },
    rapor_turu: {
        title: 'Rapor T√ºr√º',
        type: 'hidden'
    }
};

 // Kriter listesini g√ºncelle - DEBUG i√ßin
// Kriter listesini g√ºncelle - DEBUG i√ßin
function updateCriteriaList() {
    const criteriaContainer = document.getElementById('criteria-items');
    const criteriaList = document.getElementById('criteria-list');
    
    if (!criteriaContainer || !criteriaList) {
        console.error('‚ùå Kriter containerlarƒ± bulunamadƒ±');
        return;
    }
    
    criteriaContainer.innerHTML = '';
    
    console.log('üîç DEBUG - FormData durumu:', window.formData);
    console.log('üîç DEBUG - dil deƒüeri:', window.formData?.dil);
    
    let hasData = false;
    
    // G√úVENLƒ∞ ERƒ∞≈ûƒ∞M - window.formData kullan
    if (window.formData && typeof window.formData === 'object') {
        Object.entries(window.formData).forEach(([key, value]) => {
            if (value !== undefined && value !== null && value.toString().trim() !== '') {
                hasData = true;
                const title = getFieldTitle(key);
                criteriaContainer.innerHTML += `
                    <div class="criteria-item">
                        <strong>${title}:</strong> ${value}
                    </div>
                `;
                console.log(`‚úÖ Kriter eklendi: ${title} = ${value}`);
            }
        });
    }
    
    if (hasData) {
        criteriaList.classList.remove('hidden');
        console.log('‚úÖ Kriter listesi g√ºncellendi');
    } else {
        criteriaList.classList.add('hidden');
        console.log('‚ÑπÔ∏è Kriter listesi bo≈ü');
    }
}
        // Field title'larƒ± g√ºncelle
function getFieldTitle(field) {
    const titles = {
        dil: 'Rapor Dili',
        ulke: 'Hedef Pazar √úlkesi', // G√ºncellendi
        sektor: 'Sekt√∂r',
        urun: '√úr√ºn/Hizmet',
        firma_adi: 'Firma Adƒ±', // Eklendi
        bolge: 'B√∂lge',
        gtip: 'GTIP Kodu',
        zaman: 'Zaman Aralƒ±ƒüƒ±',
        amac: 'Analiz Amacƒ±',
        derinlik: 'Analiz Derinliƒüi',
        rapor_turu: 'Rapor T√ºr√º'
    };
    return titles[field] || field;
}
// Kullanƒ±cƒ± y√∂netimi deƒüi≈ükenleri
let currentUser = null;
let authToken = null;

// Kullanƒ±cƒ± y√∂netim sistemini ba≈ülat
function initializeAuthSystem() {
    checkExistingSession();
    setupAuthModals();
    setupProfileTabs();
}

c
        
// Kayƒ±t i≈ülemi
async function handleRegister(e) {
    e.preventDefault();
    
    const name = document.getElementById('register-name').value;
    const email = document.getElementById('register-email').value;
    const password = document.getElementById('register-password').value;
    const passwordConfirm = document.getElementById('register-password-confirm').value;
    
    if (password !== passwordConfirm) {
        alert('≈ûifreler e≈üle≈ümiyor!');
        return;
    }
    
    try {
        const { data, error } = await supabase.auth.signUp({
            email: email,
            password: password,
            options: {
                data: {
                    full_name: name
                }
            }
        });
        
        if (error) throw error;
        
        if (data.user) {
            // E-posta doƒürulama g√∂ster
            document.getElementById('register-form').classList.add('hidden');
            document.getElementById('email-verification').classList.remove('hidden');
        }
        
    } catch (error) {
        alert('Kayƒ±t hatasƒ±: ' + error.message);
    }
}
        
// √áƒ±kƒ±≈ü i≈ülemi
function handleLogout() {
    supabase.auth.signOut();
    localStorage.removeItem('parenatrade_token');
    localStorage.removeItem('parenatrade_user');
    currentUser = null;
    authToken = null;
    updateUIForLoggedOutUser();
    document.getElementById('profile-modal').classList.add('hidden');
}

// UI g√ºncelleme - Giri≈ü yapƒ±lmƒ±≈ü
function updateUIForLoggedInUser() {
    // Navbar'ƒ± g√ºncelle
    const navButtons = document.querySelector('.flex.space-x-3');
    if (navButtons) {
        navButtons.innerHTML = `
            <button id="profile-btn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 text-sm">
                <i class="fas fa-user mr-1"></i> Profilim
            </button>
            <button id="logout-nav-btn" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 text-sm">
                √áƒ±kƒ±≈ü
            </button>
        `;
        
        document.getElementById('profile-btn').addEventListener('click', () => {
            document.getElementById('profile-modal').classList.remove('hidden');
        });
        
        document.getElementById('logout-nav-btn').addEventListener('click', handleLogout);
    }
}

// UI g√ºncelleme - √áƒ±kƒ±≈ü yapƒ±lmƒ±≈ü
function updateUIForLoggedOutUser() {
    const navButtons = document.querySelector('.flex.space-x-3');
    if (navButtons) {
        navButtons.innerHTML = `
            <a href="#" id="login-nav-btn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 text-sm">Giri≈ü Yap</a>
            <a href="#" id="register-nav-btn" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 text-sm">Kayƒ±t Ol</a>
        `;
        
        document.getElementById('login-nav-btn').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('login-modal').classList.remove('hidden');
        });
        
        document.getElementById('register-nav-btn').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('login-modal').classList.remove('hidden');
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('register-form').classList.remove('hidden');
        });
    }
}
        

// Profil tab'larƒ±nƒ± kur
function setupProfileTabs() {
    const tabs = document.querySelectorAll('.profile-tab');
    if (tabs.length === 0) {
        console.log('Profil tablarƒ± bulunamadƒ±');
        return;
    }
    
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            // Aktif tab'ƒ± g√ºncelle
            document.querySelectorAll('.profile-tab').forEach(t => {
                t.classList.remove('bg-indigo-100', 'text-indigo-700');
                t.classList.add('hover:bg-gray-100', 'text-gray-700');
            });
            
            this.classList.add('bg-indigo-100', 'text-indigo-700');
            this.classList.remove('hover:bg-gray-100', 'text-gray-700');
            
            // ƒ∞√ßeriƒüi g√∂ster
            const tabName = this.getAttribute('data-tab');
            document.querySelectorAll('.profile-tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            const targetTab = document.getElementById(`tab-${tabName}`);
            if (targetTab) {
                targetTab.classList.remove('hidden');
                
                // Raporlar sekmesine tƒ±klandƒ±ƒüƒ±nda raporlarƒ± y√ºkle
                if (tabName === 'reports') {
                    loadUserReports();
                }
            }
        });
    });
}
        
// Kullanƒ±cƒ± raporlarƒ±nƒ± y√ºkle - SADE VE TEMƒ∞Z
async function loadUserReports() {
    if (!currentUser) {
        console.log('Kullanƒ±cƒ± giri≈üi yok');
        return;
    }
    
    const reportsList = document.getElementById('user-reports-list');
    if (!reportsList) {
        console.log('reportsList elementi bulunamadƒ±');
        return;
    }
    
    try {
        console.log('Kullanƒ±cƒ± raporlarƒ± y√ºkleniyor:', currentUser.id);
        
        const { data: reports, error } = await supabase
            .from('ai_reports')
            .select('*')
            .eq('user_id', currentUser.id)
            .order('created_at', { ascending: false });
        
        if (error) {
            console.error('Rapor y√ºkleme hatasƒ±:', error);
            reportsList.innerHTML = '<p class="text-red-500 text-center py-4">Raporlar y√ºklenirken hata olu≈ütu.</p>';
            return;
        }
        
        console.log('Y√ºklenen rapor sayƒ±sƒ±:', reports?.length);
        
        if (!reports || reports.length === 0) {
            reportsList.innerHTML = `
                <div class="text-center py-8">
                    <i class="fas fa-file-pdf text-4xl text-gray-300 mb-4"></i>
                    <p class="text-gray-500">Hen√ºz raporunuz bulunmamaktadƒ±r.</p>
                    <p class="text-gray-400 text-sm mt-2">√ñdeme yaptƒ±ktan sonra raporlarƒ±nƒ±z burada g√∂r√ºnecektir.</p>
                </div>
            `;
            return;
        }
        
        let html = '';
        reports.forEach(report => {
            const createdDate = new Date(report.created_at).toLocaleDateString('tr-TR');
            const isPaid = report.status === 'completed' || report.status === 'paid';
            const canDownload = isPaid && report.pdf_url;
            
            html += `
                <div class="bg-white border border-gray-200 rounded-lg p-4 mb-3 shadow-sm">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h5 class="font-semibold text-gray-800">${report.report_title || 'ƒ∞simsiz Rapor'}</h5>
                            <p class="text-sm text-gray-600 mt-1">
                                <i class="far fa-calendar mr-1"></i>${createdDate}
                            </p>
                            <div class="flex space-x-2 mt-2">
                                <span class="inline-block ${isPaid ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'} text-xs px-2 py-1 rounded">
                                    ${isPaid ? '‚úÖ √ñdeme Tamam' : '‚è≥ Beklemede'}
                                </span>
                                ${report.is_mock ? `
                                    <span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">
                                        Demo Rapor
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                        <div class="flex space-x-2 ml-4">
                            ${canDownload ? `
                                <a href="${report.pdf_url}" target="_blank" 
                                   class="bg-green-500 text-white px-3 py-2 rounded text-sm hover:bg-green-600 transition flex items-center">
                                    <i class="fas fa-download mr-1"></i> PDF ƒ∞ndir
                                </a>
                            ` : `
                                <button class="bg-gray-300 text-gray-500 px-3 py-2 rounded text-sm cursor-not-allowed flex items-center" disabled>
                                    <i class="fas fa-download mr-1"></i> √ñdeme Gerekli
                                </button>
                            `}
                        </div>
                    </div>
                </div>
            `;
        });
        
        reportsList.innerHTML = html;
        
    } catch (error) {
        console.error('Raporlar y√ºklenirken hata:', error);
        reportsList.innerHTML = '<p class="text-red-500 text-center py-4">Raporlar y√ºklenirken hata olu≈ütu.</p>';
    }
}
    

// Giri≈ü sonrasƒ± sipari≈üe devam et
function proceedWithOrder() {
    const pendingOrder = sessionStorage.getItem('pending_order');
    if (pendingOrder) {
        serviceCart = JSON.parse(pendingOrder);
        sessionStorage.removeItem('pending_order');
        updateAICart();
        proceedToPayment();
    }
}

// √ñdeme sayfasƒ±na git
function proceedToPayment() {
    // Sepetteki raporlarƒ± veritabanƒ±na kaydet
    saveReportsToDatabase().then(() => {
        // √ñdeme sayfasƒ±na y√∂nlendir
        window.location.href = '/ai/payment.html?cart=' + encodeURIComponent(JSON.stringify(serviceCart));
    });
}
        




// PDF indirme
function downloadPDF() {
    const pdfUrl = document.getElementById('pdf-iframe').src;
    if (pdfUrl) {
        const a = document.createElement('a');
        a.href = pdfUrl;
        a.download = `rapor_${Date.now()}.pdf`;
        a.click();
    }
}



// √ñrnek rapor kartlarƒ±na g√∂r√ºnt√ºleme butonu ekle
function setupExampleReports() {
    document.querySelectorAll('#reports .bg-gray-50 button').forEach((button, index) => {
        button.addEventListener('click', function() {
            // √ñrnek rapor verisi
            const exampleReports = [
                {
                    id: 'example-1',
                    report_title: 'Romanya Domates Sal√ßasƒ± Pazar Analizi',
                    report_content: `# Romanya Domates Sal√ßasƒ± Pazar Analizi\n\n## √ñzet\nRomanya domates sal√ßasƒ± pazarƒ± b√ºy√ºme potansiyeli y√ºksek bir pazardƒ±r...`,
                    created_at: new Date().toISOString(),
                    pdf_url: null
                },
                {
                    id: 'example-2', 
                    report_title: 'Bulgaristan Tekstil √úr√ºnleri Pazar Analizi',
                    report_content: `# Bulgaristan Tekstil √úr√ºnleri Pazar Analizi\n\n## √ñzet\nBulgaristan tekstil pazarƒ± rekabet√ßi bir yapƒ±ya sahiptir...`,
                    created_at: new Date().toISOString(),
                    pdf_url: null
                }
            ];
            
            showExampleReport(exampleReports[index]);
        });
    });
}

// √ñrnek rapor g√∂ster
function showExampleReport(report) {
    document.getElementById('report-view-title').textContent = report.report_title;
    document.getElementById('report-content-display').innerHTML = formatReportContent(report.report_content);
    document.getElementById('report-created-date').textContent = new Date(report.created_at).toLocaleDateString('tr-TR');
    document.getElementById('report-status').textContent = '√ñrnek Rapor';
    
    document.getElementById('download-pdf-btn').classList.add('hidden');
    document.getElementById('view-pdf-btn').classList.add('hidden');
    
    showContentView();
}

        
// Raporlarƒ± veritabanƒ±na kaydet - G√úNCELLENDƒ∞
async function saveReportsToDatabase() {
    if (!currentUser) return;
    
    for (const item of serviceCart) {
        if (!item.reportId) continue; // reportId yoksa atla
        
        try {
            const { error } = await supabase
                .from('ai_reports')
                .update({
                    user_id: currentUser.id,
                    status: 'pending_payment'
                })
                .eq('id', item.reportId);
            
            if (error) throw error;
            
        } catch (error) {
            console.error('Rapor g√ºncelleme hatasƒ±:', error);
        }
    }
}


// ‚úÖ YENƒ∞ - Geli≈ümi≈ü prompt hazƒ±rlama (Sizin tasarƒ±mƒ±nƒ±za uygun)
function prepareAdvancedPrompt(template, formData) {
    console.log('üéØ Geli≈ümi≈ü prompt hazƒ±rlanƒ±yor:', { template: template.report_name, formData });
    
    // Deƒüi≈üken mapping
    const variables = {
        dil: formData.dil?.trim() || 'T√ºrk√ße',
        ulke: formData.ulke?.trim() || 'Belirtilmemi≈ü',
        sektor: formData.sektor?.trim() || 'Belirtilmemi≈ü',
        urun: formData.urun?.trim() || 'Belirtilmemi≈ü',
        bolge: formData.bolge?.trim() || 'T√ºm B√∂lgeler',
        gtip: formData.gtip?.trim() || 'Belirtilmemi≈ü',
        zaman: formData.zaman?.trim() || '2020-2025 ve g√ºncel yƒ±l',
        amac: formData.amac?.trim() || 'pazar analizi ve yatƒ±rƒ±m deƒüerlendirmesi',
        derinlik: formData.derinlik?.trim() || 'y√∂netim sunumuna uygun ≈üekilde hazƒ±rla',
        rapor_turu: formData.rapor_turu?.trim() || template.report_name
    };

    // ‚úÖ Sƒ∞Zƒ∞N TASARIMINIZA UYGUN PROFESYONEL PROMPT
    const advancedPrompt = `
Sen bir uluslararasƒ± ticaret ve pazar ara≈ütƒ±rma uzmanƒ±sƒ±n. Benimle birlikte ${variables.urun} i√ßin detaylƒ± pazar ara≈ütƒ±rmasƒ± yapmak istiyorum.

A≈üaƒüƒ±daki ba≈ülƒ±klar kapsamƒ±nda derinlemesine analiz yapmanƒ± istiyorum:

## Pazar Tanƒ±mƒ± ve Genel G√∂r√ºn√ºm: 
Pazarƒ±n boyutu, b√ºy√ºme oranlarƒ±, tarihsel geli≈üimi ve geleceƒüe y√∂nelik projeksiyonlar.

## Pazar Segmentasyonu: 
Coƒürafi, demografik, psikografik ve davranƒ±≈üsal segmentler.

## Hedef M√º≈üteri Profilleri (Buyer Persona): 
Temel ihtiya√ßlar, karar alma davranƒ±≈ülarƒ±, satƒ±n alma kriterleri.

## Rakip Analizi: 
Ana rakipler, pazardaki konumlarƒ±, g√º√ßl√º/zayƒ±f y√∂nleri, fiyatlama, daƒüƒ±tƒ±m kanallarƒ±, farklƒ±la≈ütƒ±rƒ±cƒ± stratejiler.

## Trendler ve Fƒ±rsatlar: 
Teknolojik geli≈ümeler, reg√ºlasyon deƒüi≈üiklikleri, k√ºlt√ºr/sosyal eƒüilimler, yeni i≈ü modelleri.

## Tehditler ve Giri≈ü Engelleri: 
Reg√ºlasyonlar, rekabet yoƒüunluƒüu, ikame √ºr√ºnler, m√º≈üteri sadakati.

## Fiyatlandƒ±rma Dinamikleri: 
Ortalama fiyat aralƒ±klarƒ±, fiyatlandƒ±rma modelleri, m√º≈üteri √∂deme istekliliƒüi.

## SWOT Analizi: 
Genel pazar i√ßin g√º√ßl√º y√∂nler, zayƒ±f y√∂nler, fƒ±rsatlar ve tehditler.

## Sonu√ß ve √ñneriler: 
Stratejik pozisyonlama, potansiyel giri≈ü stratejileri, farklƒ±la≈üma noktalarƒ±.

**Ara≈ütƒ±rma Parametreleri:**
- √úlke/B√∂lge: ${variables.ulke} / ${variables.bolge}
- Sekt√∂r: ${variables.sektor}
- √úr√ºn: ${variables.urun}
- GTIP: ${variables.gtip}
- Zaman Aralƒ±ƒüƒ±: ${variables.zaman}
- Analiz Amacƒ±: ${variables.amac}
- Derinlik D√ºzeyi: ${variables.derinlik}

**√ñnemli Talimatlar:**
- Bilgileri m√ºmk√ºn olduƒüunca g√ºncel kaynaklara dayanarak hazƒ±rla
- Gerektiƒüinde tablo ve madde i≈üaretleri kullan
- Profesyonel, veri odaklƒ± ve rapor formatƒ±nda yaz
- Kullanƒ±lan kaynaklarƒ± ve veri yƒ±llarƒ±nƒ± belirt
- ${variables.derinlik}
    `.trim();

    console.log('‚úÖ Geli≈ümi≈ü Prompt Hazƒ±rlandƒ±');
    return advancedPrompt;
}

async function generateAIReport() {
    console.log('üöÄ Rapor olu≈üturma ba≈ülatƒ±lƒ±yor...');
    
    // Validasyon - G√úVENLƒ∞ FORM DATA KONTROL√ú
    if (!window.selectedTemplate) {
        alert('‚ùå L√ºtfen rapor t√ºr√º se√ßin.');
        return;
    }
    
    // Form data kontrol√º - KESƒ∞N √á√ñZ√úM
    if (!window.formData || typeof window.formData !== 'object') {
        console.error('‚ùå FormData tanƒ±mlƒ± deƒüil:', window.formData);
        alert('‚ùå Form verileri y√ºklenemedi. L√ºtfen sayfayƒ± yenileyin.');
        return;
    }
    
    // Form validasyonu - G√úVENLƒ∞
    const requiredFields = ['ulke', 'sektor', 'urun'];
    const missingFields = [];
    
    requiredFields.forEach(field => {
        // G√ºvenli eri≈üim
        if (!window.formData[field] || String(window.formData[field]).trim() === '') {
            missingFields.push(getFieldTitle(field));
        }
    });
    
    if (missingFields.length > 0) {
        alert(`L√ºtfen a≈üaƒüƒ±daki alanlarƒ± doldurun:\n${missingFields.join('\n')}`);
        return;
    }
    
    const generateBtn = document.getElementById('generate-report-btn');
    const progressSection = document.getElementById('report-progress');
    
    // UI durumunu g√ºncelle
    if (generateBtn) {
        generateBtn.disabled = true;
        generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Olu≈üturuluyor...';
    }
    if (progressSection) progressSection.classList.remove('hidden');
    updateProgress(20);

    try {
        // 1. Prompt'u doldur - G√úVENLƒ∞
        const finalPrompt = fillPromptTemplate(window.selectedTemplate, window.formData);
        console.log('üìù Doldurulmu≈ü prompt:', finalPrompt);
        
        if (!finalPrompt) {
            throw new Error('Prompt olu≈üturulamadƒ±.');
        }
        
        updateProgress(40);

        // 2. API'ye g√∂nder
        console.log('üåê API √ßaƒürƒ±sƒ± yapƒ±lƒ±yor...');
        const response = await fetch('https://parenatrade.vercel.app/api/generate-report', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                prompt: finalPrompt,
                template: window.selectedTemplate.report_name,
                parameters: window.formData
            })
        });

        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`API hatasƒ±: ${response.status} - ${errorText}`);
        }

        const result = await response.json();
        console.log('üì® API cevabƒ±:', result);
        
        if (!result.success) {
            throw new Error(result.error || 'Rapor olu≈üturulamadƒ±');
        }

        updateProgress(60);

        // 3. SUPABASE'E KAYDET - G√úVENLƒ∞
        console.log('üíæ Supabase\'e kaydediliyor...');
        const reportData = {
            template_id: window.selectedTemplate.id,
            report_title: window.selectedTemplate.report_name,
            report_prompt: finalPrompt,
            report_content: result.result,
            country: window.formData.ulke || null,
            sector: window.formData.sektor || null,
            product: window.formData.urun || null,
            region: window.formData.bolge || null,
            gtip: window.formData.gtip || null,
            period: window.formData.zaman || null,
            purpose: window.formData.amac || null,
            language: window.formData.dil || 'tr',
            depth: window.formData.derinlik || null,
            report_type: window.selectedTemplate.report_type,
            status: 'completed',
            user_id: window.currentUser?.id || null,
            report_price: window.selectedTemplate.report_price,
            currency: window.selectedTemplate.report_currency,
            created_at: new Date().toISOString()
        };

        console.log('üìä Kaydedilecek rapor verisi:', reportData);

        const { data: report, error } = await supabase
            .from('ai_reports')
            .insert(reportData)
            .select()
            .single();

        if (error) {
            console.error('‚ùå Supabase kayƒ±t hatasƒ±:', error);
            // Hata durumunda bile devam et
        } else {
            console.log('‚úÖ Rapor Supabase\'e kaydedildi:', report);
        }

        updateProgress(80);

        // 4. SEPETE EKLE - G√úVENLƒ∞
        console.log('üéØ Selected Template Detaylarƒ±:', {
            id: window.selectedTemplate.id,
            name: window.selectedTemplate.report_name,
            price: window.selectedTemplate.report_price,
            currency: window.selectedTemplate.report_currency
        });

        // Fiyat kontrol√º - kesin √ß√∂z√ºm
        const itemPrice = window.selectedTemplate.report_price !== undefined && 
                         window.selectedTemplate.report_price !== null && 
                         !isNaN(parseFloat(window.selectedTemplate.report_price)) 
            ? parseFloat(window.selectedTemplate.report_price) 
            : 199;

        const itemCurrency = window.selectedTemplate.report_currency || 'USD';
        const itemName = window.selectedTemplate.report_name || 'Pazar Raporu';

        const cartItem = {
            id: window.selectedTemplate.id,
            name: itemName,
            price: itemPrice,
            currency: itemCurrency,
            reportId: report?.id,
            type: 'report',
            template_data: window.selectedTemplate
        };

        console.log('üõí Sepete eklenecek √∂ƒüe:', cartItem);
        addToAICart(cartItem);

        updateProgress(100);

        // 5. Sonu√ßlarƒ± g√∂ster
        const quickResult = document.getElementById('quick-analysis-result');
        if (quickResult) quickResult.classList.remove('hidden');
        
        // Ba≈üarƒ± mesajƒ±
        setTimeout(() => {
            if (progressSection) progressSection.classList.add('hidden');
            if (generateBtn) {
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<i class="fas fa-search mr-2"></i> Rapor Olu≈ütur';
            }
            
            console.log('‚úÖ Rapor olu≈üturma i≈ülemi tamamlandƒ±');
            
        }, 2000);

    } catch (error) {
        console.error('‚ùå Rapor olu≈üturma hatasƒ±:', error);
        
        // UI'ƒ± eski haline getir
        if (generateBtn) {
            generateBtn.disabled = false;
            generateBtn.innerHTML = '<i class="fas fa-search mr-2"></i> Rapor Olu≈ütur';
        }
        if (progressSection) progressSection.classList.add('hidden');
        
        // Hata mesajƒ±nƒ± g√∂ster
        let errorMessage = 'Rapor olu≈üturulurken hata: ' + error.message;
        
        if (error.message.includes('API hatasƒ±: 405')) {
            errorMessage = 'API endpoint\'i ge√ßici olarak kullanƒ±lamƒ±yor. L√ºtfen daha sonra tekrar deneyin.';
        } else if (error.message.includes('Failed to fetch')) {
            errorMessage = 'ƒ∞nternet baƒülantƒ±nƒ±zƒ± kontrol edin ve tekrar deneyin.';
        }
        
        alert('‚ùå ' + errorMessage);
    }
}
        
// Hata g√∂ster
function showError(message) {
    // √ñzel hata modal'ƒ± veya alert
    alert('‚ùå ' + message);
}

// Ba≈üarƒ± g√∂ster - BASƒ∞T  
function showSuccess(message) {
    alert('‚úÖ ' + message);
}
        
// Hata loglama fonksiyonu
async function logError(error, context = {}) {
    try {
        await supabase
            .from('error_logs')
            .insert({
                error_message: error.message,
                error_stack: error.stack,
                context: context,
                user_id: window.currentUser?.id,
                url: window.location.href,
                created_at: new Date().toISOString()
            });
    } catch (logError) {
        console.error('Hata loglama ba≈üarƒ±sƒ±z:', logError);
    }
}
        
// Giri≈ü i≈ülemi - G√úNCELLENMƒ∞≈û
async function handleLogin(e) {
    e.preventDefault();
    
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    
    try {
        const { data, error } = await supabase.auth.signInWithPassword({
            email: email,
            password: password
        });
        
        if (error) throw error;
        
        if (data.user) {
            currentUser = data.user;
            authToken = data.session.access_token;
            
            // LocalStorage'a kaydet
            localStorage.setItem('parenatrade_token', authToken);
            localStorage.setItem('parenatrade_user', JSON.stringify(currentUser));
            
            // UI g√ºncelle
            updateUIForLoggedInUser();
            
            // Modal'ƒ± kapat
            document.getElementById('login-modal').classList.add('hidden');
            
            // BEKLEYEN RAPOR VARSA TAMAMLA
            const pendingReport = sessionStorage.getItem('pending_report_data');
            if (pendingReport) {
                const reportData = JSON.parse(pendingReport);
                sessionStorage.removeItem('pending_report_data');
                
                // Kullanƒ±cƒ±ya bilgi ver
                alert('Giri≈ü ba≈üarƒ±lƒ±! Rapor olu≈üturma i≈ülemini tamamlƒ±yorum...');
                
                // Rapor olu≈üturma i≈ülemini ba≈ülat
                await completePendingReport(reportData);
            } else {
                alert('Ba≈üarƒ±yla giri≈ü yapƒ±ldƒ±!');
            }
        }
        
    } catch (error) {
        alert('Giri≈ü hatasƒ±: ' + error.message);
    }
}

// Bekleyen raporu tamamla - TESTLƒ∞
async function completePendingReport(reportData) {
    const { template, formData, finalPrompt } = reportData;
    
    // √ñNCE: API durumunu kontrol et
    const apiStatus = await testAPIEndpoint();
    
    if (!apiStatus) {
        showErrorModal(
            'Rapor Tamamlanamadƒ±',
            '√ñnceden ba≈ülattƒ±ƒüƒ±nƒ±z rapor olu≈üturma i≈ülemi tamamlanamƒ±yor.<br><br>' +
            'AI servisi ge√ßici olarak kullanƒ±lamƒ±yor. L√ºtfen daha sonra "Raporlarƒ±m" b√∂l√ºm√ºnden tekrar deneyin.'
        );
        return;
    }

    try {
        // API √ßaƒürƒ±sƒ±
        const response = await fetch('https://parenatrade.vercel.app/api/generate-report', {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                prompt: finalPrompt,
                template: template.report_name,
                parameters: formData
            })
        });

        if (!response.ok) throw new Error(`API hatasƒ±: ${response.status}`);

        const result = await response.json();
        
        if (!result.success) throw new Error(result.error);

        // Supabase'e kaydet
        const reportDbData = {
            template_id: template.id,
            report_title: template.report_name,
            report_prompt: finalPrompt,
            report_content: result.result,
            country: formData.ulke || null,
            sector: formData.sektor || null,
            product: formData.urun || null,
            region: formData.bolge || null,
            gtip: formData.gtip || null,
            period: formData.zaman || null,
            purpose: formData.amac || null,
            language: formData.dil || null,
            depth: formData.derinlik || null,
            report_type: template.report_type,
            status: 'completed',
            user_id: currentUser.id,
            created_at: new Date().toISOString()
        };

        const { data: report, error } = await supabase
            .from('ai_reports')
            .insert(reportDbData)
            .select()
            .single();

        if (error) throw error;

        // Sepete ekle
        addToAICart(template, report.id);
        
        alert('‚úÖ Rapor ba≈üarƒ±yla olu≈üturuldu ve sepete eklendi!');

    } catch (error) {
        console.error('Bekleyen rapor tamamlama hatasƒ±:', error);
        showErrorModal(
            'Rapor Tamamlanamadƒ±',
            'Giri≈ü yaptƒ±nƒ±z ancak rapor olu≈üturma i≈ülemi tamamlanamadƒ±:<br><br>' +
            '‚Ä¢ Hata: ' + error.message + '<br>' +
            '‚Ä¢ L√ºtfen daha sonra "Raporlarƒ±m" b√∂l√ºm√ºnden tekrar deneyin<br>' +
            '‚Ä¢ Sorun devam ederse m√º≈üteri hizmetleri ile ileti≈üime ge√ßin'
        );
    }
}
        

                        
// Yardƒ±mcƒ± fonksiyonlar
// ƒ∞lerleme g√ºncelle
function updateProgress(percent) {
    const progressFill = document.getElementById('progress-fill');
    const progressPercent = document.getElementById('progress-percent');
    
    if (progressFill && progressPercent) {
        progressFill.style.width = `${percent}%`;
        progressPercent.textContent = `${percent}%`;
    }
}
        

        // AI Raporunu Sepete Ekle
        function addToAICart(template, reportId) {
            const existingItem = serviceCart.find(item => item.id === template.id);
            
            if (!existingItem) {
                serviceCart.push({
                    id: template.id,
                    name: template.report_name,
                    price: template.report_price,
                    currency: template.report_currency,
                    reportId: reportId,
                    quantity: 1
                });
            }
            
            updateAICart();
        }

        function setupCartFunctionality() {
    // AI Rapor sepete ekleme
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('add-ai-report')) {
            const button = e.target;
            const template = aiReportTemplates.find(t => t.id === button.getAttribute('data-id'));
            
            if (template) {
                addToAICart(template);
            }
        }
    });

    // Sepeti tamamlama - G√úNCELLENMƒ∞≈û
document.getElementById('complete-ai-report-order').addEventListener('click', function() {
    if (serviceCart.length === 0) return;
    
    if (!currentUser) {
        // Kullanƒ±cƒ± giri≈ü yapmamƒ±≈üsa login modal a√ß
        alert('L√ºtfen √∂nce giri≈ü yapƒ±n!');
        document.getElementById('login-modal').classList.remove('hidden');
        return;
    }
    
    // Kullanƒ±cƒ± giri≈ü yapmƒ±≈üsa direkt √∂deme
    proceedToPayment();
});

            // Hata ayƒ±klama i√ßin Supabase baƒülantƒ±sƒ±nƒ± kontrol et
        async function checkSupabaseConnection() {
            try {
                const { data, error } = await supabase
                    .from('ai_service_type')
                    .select('count')
                    .limit(1);
                
                if (error) {
                    console.error('Supabase baƒülantƒ± hatasƒ±:', error);
                    return false;
                }
                
                console.log('Supabase baƒülantƒ±sƒ± ba≈üarƒ±lƒ±');
                return true;
            } catch (error) {
                console.error('Supabase baƒülantƒ± testi hatasƒ±:', error);
                return false;
            }
        }

        // Sayfa y√ºklendiƒüinde baƒülantƒ±yƒ± test et - G√úNCELLENDƒ∞
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('DOM y√ºklendi, uygulama ba≈ülatƒ±lƒ±yor...');
            const isConnected = await checkSupabaseConnection();
            if (!isConnected) {
                console.warn('Supabase baƒülantƒ±sƒ± sorunlu, fallback modunda √ßalƒ±≈üƒ±lƒ±yor');
            }
            
            // Sadece bir kere initialize et
            await initializeApp();
        });

        // √áift y√ºklenmeyi √∂nlemek i√ßin ayrƒ±ca bir kontrol
        let initializationStarted = false;

        // Alternatif ba≈ülatma y√∂ntemi
        if (!initializationStarted) {
            initializationStarted = true;
            document.addEventListener('DOMContentLoaded', initializeApp);
        }
        
        // ƒ∞leti≈üim formu
        document.getElementById('contact-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Burada Supabase'e ileti≈üim formu kaydedilecek
            // ≈ûimdilik sadece alert g√∂steriyoruz
            
            alert('Mesajƒ±nƒ±z ba≈üarƒ±yla g√∂nderildi. En kƒ±sa s√ºrede size d√∂n√º≈ü yapacaƒüƒ±z.');
            this.reset();
        });
}
            
    </script>
</body>
</html>
