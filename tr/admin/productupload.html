<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Market Sheets Yönetimi</title>
  <script type="module">
    import { supabase } from "./api/supabase.js";

    async function loadSellers() {
      const { data, error } = await supabase
        .from("profiles")
        .select("id, name, email")
        .eq("role", "seller")
        .eq("sales_type", "market");

      if (error) {
        console.error(error);
        return;
      }

      let select = document.getElementById("seller_id");
      data.forEach(s => {
        let option = document.createElement("option");
        option.value = s.id;
        option.text = `${s.name} (${s.email})`;
        select.appendChild(option);
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadSellers();

      document.getElementById("scraperForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const sellerId = document.getElementById("seller_id").value;
        const sheetsUrl = document.getElementById("sheets_url").value;

        const { error } = await supabase
          .from("profiles")
          .update({ sheets_url: sheetsUrl })
          .eq("id", sellerId);

        if (error) {
          document.getElementById("result").innerText = "❌ Hata: " + error.message;
        } else {
          document.getElementById("result").innerHTML =
            "✅ Kaydedildi: <a href='" + sheetsUrl + "' target='_blank'>" + sheetsUrl + "</a>";
        }
      });
    });
  </script>
</head>
<body>
  <h2>Market Google Sheets Bağlantısı</h2>

  <form id="scraperForm">
    <label>Market Seç:</label>
    <select id="seller_id"></select>
    <br><br>

    <label>Google Sheets Linki:</label>
    <input type="text" id="sheets_url" placeholder="Google Sheets linki" size="80">
    <br><br>

    <button type="submit">Kaydet</button>
  </form>

  <div id="result" style="margin-top:20px;"></div>
</body>
</html>
