<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ParenaTrade - Supabase Entegreli Sipariş Sistemi</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8fafc;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            padding: 24px;
            margin-bottom: 24px;
        }
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background-color: #4f46e5;
            color: white;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            border: none;
        }
        .btn:hover {
            background-color: #3730a3;
        }
        .btn-secondary {
            background-color: #e5e7eb;
            color: #374151;
        }
        .btn-secondary:hover {
            background-color: #d1d5db;
        }
        .btn-success {
            background-color: #10b981;
        }
        .btn-success:hover {
            background-color: #059669;
        }
        .btn-danger {
            background-color: #ef4444;
        }
        .btn-danger:hover {
            background-color: #dc2626;
        }
        .form-group {
            margin-bottom: 16px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 16px;
        }
        .tab-container {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        .tab.active {
            border-bottom: 3px solid #4f46e5;
            color: #4f46e5;
            font-weight: 600;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .product-card {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            transition: transform 0.2s;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        .status-pending {
            background-color: #fef3c7;
            color: #92400e;
        }
        .status-approved {
            background-color: #d1fae5;
            color: #065f46;
        }
        .status-shipped {
            background-color: #dbeafe;
            color: #1e40af;
        }
        .status-delivered {
            background-color: #dcfce7;
            color: #166534;
        }
        .status-cancelled {
            background-color: #fee2e2;
            color: #991b1b;
        }
        .login-container {
            max-width: 400px;
            margin: 50px auto;
            padding: 24px;
        }
        .category-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }
        .category-btn {
            padding: 8px 16px;
            background-color: #e5e7eb;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .category-btn.active {
            background-color: #4f46e5;
            color: white;
        }
        .order-details {
            background-color: #f9fafb;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }
        .logistics-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }
        .logistics-table th, .logistics-table td {
            border: 1px solid #e5e7eb;
            padding: 12px;
            text-align: left;
        }
        .logistics-table th {
            background-color: #f3f4f6;
            font-weight: 600;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 0.3s, transform 0.3s;
        }
        .notification.success {
            background-color: #10b981;
        }
        .notification.error {
            background-color: #ef4444;
        }
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Admin Giriş Üst Barı -->
    <div class="bg-indigo-900 text-white py-3">
        <div class="container flex justify-between items-center">
            <div class="text-xl font-bold">ParenaTrade Admin Paneli</div>
            <div class="flex space-x-4">
                <span id="adminInfo" class="text-sm hidden"></span>
                <button id="adminLoginBtn" class="text-sm">Admin Girişi</button>
                <button id="adminLogoutBtn" class="text-sm hidden">Çıkış Yap</button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Admin Giriş Formu -->
        <div id="adminAuthContainer" class="login-container card">
            <h2 class="text-2xl font-bold mb-6 text-center">Admin Girişi</h2>
            <div class="form-group">
                <label for="adminEmail">E-posta</label>
                <input type="email" id="adminEmail" placeholder="Admin e-posta adresiniz">
            </div>
            <div class="form-group">
                <label for="adminPassword">Şifre</label>
                <input type="password" id="adminPassword" placeholder="Admin şifreniz">
            </div>
            <button class="btn w-full" id="submitAdminAuth">
                <span id="authButtonText">Giriş Yap</span>
                <span id="authSpinner" class="loading hidden"></span>
            </button>
        </div>

        <!-- Ana İçerik (Giriş yapınca görünecek) -->
        <div id="mainContent" class="hidden">
            <h1 class="text-3xl font-bold my-8">ParenaTrade Sipariş Yönetim Sistemi</h1>
            
            <div class="tab-container">
                <div class="tab active" data-tab="categories">Kategoriler</div>
                <div class="tab" data-tab="orders">Siparişler</div>
                <div class="tab" data-tab="payments">Ödemeler</div>
                <div class="tab" data-tab="logistics">Kargo & Lojistik</div>
                <div class="tab" data-tab="admin">Admin Paneli</div>
            </div>

            <!-- Kategoriler Sekmesi -->
            <div class="tab-content active" id="categoriesTab">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold">Ürün Kategorileri</h2>
                    <button class="btn" id="addCategoryBtn">Kategori Ekle</button>
                </div>
                
                <div class="category-filter" id="categoriesList">
                    <!-- Kategoriler JavaScript ile doldurulacak -->
                </div>
                
                <h3 class="text-xl font-semibold mt-8 mb-4" id="categoryTitle">Tüm Ürünler</h3>
                
                <div class="flex justify-between items-center mb-4">
                    <div>Tüm ürünleri görüntülüyorsunuz</div>
                    <button class="btn" id="addProductBtn">Ürün Ekle</button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="productsGrid">
                    <!-- Ürün kartları JavaScript ile doldurulacak -->
                </div>
            </div>

            <!-- Siparişler Sekmesi -->
            <div class="tab-content" id="ordersTab">
                <h2 class="text-2xl font-semibold mb-4">Tüm Siparişler</h2>
                
                <div class="card">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead>
                                <tr>
                                    <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sipariş No</th>
                                    <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Müşteri</th>
                                    <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tarih</th>
                                    <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tutar</th>
                                    <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Durum</th>
                                    <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">İşlemler</th>
                                </tr>
                            </thead>
                            <tbody id="ordersList" class="bg-white divide-y divide-gray-200">
                                <!-- Siparişler JavaScript ile doldurulacak -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Ödemeler Sekmesi -->
            <div class="tab-content" id="paymentsTab">
                <h2 class="text-2xl font-semibold mb-4">Ödeme Geçmişi</h2>
                
                <div class="card">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead>
                                <tr>
                                    <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ödeme No</th>
                                    <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sipariş No</th>
                                    <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Müşteri</th>
                                    <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tarih</th>
                                    <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tutar</th>
                                    <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Yöntem</th>
                                    <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Durum</th>
                                    <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">İşlemler</th>
                                </tr>
                            </thead>
                            <tbody id="paymentsList" class="bg-white divide-y divide-gray-200">
                                <!-- Ödemeler JavaScript ile doldurulacak -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Kargo & Lojistik Sekmesi -->
            <div class="tab-content" id="logisticsTab">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold">Kargo & Lojistik Takibi</h2>
                    <button class="btn" id="addLogisticsBtn">Lojistik Ekle</button>
                </div>
                
                <div class="card">
                    <div class="overflow-x-auto">
                        <table class="logistics-table">
                            <thead>
                                <tr>
                                    <th>Sipariş No</th>
                                    <th>Lojistik Firma</th>
                                    <th>Sevk Tarihi</th>
                                    <th>Araç Plaka</th>
                                    <th>Nakliye Ücreti</th>
                                    <th>Taşıma Durumu</th>
                                    <th>Teslim Tarihi</th>
                                    <th>Teslim Alan</th>
                                    <th>İşlemler</th>
                                </tr>
                            </thead>
                            <tbody id="logisticsList">
                                <!-- Lojistik verileri JavaScript ile doldurulacak -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Admin Paneli Sekmesi -->
            <div class="tab-content" id="adminTab">
                <h2 class="text-2xl font-semibold mb-4">Admin Paneli</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="card text-center">
                        <div class="text-4xl font-bold text-indigo-600 mb-2" id="totalOrders">0</div>
                        <div class="text-gray-600">Toplam Sipariş</div>
                    </div>
                    
                    <div class="card text-center">
                        <div class="text-4xl font-bold text-green-600 mb-2" id="totalRevenue">0₺</div>
                        <div class="text-gray-600">Toplam Gelir</div>
                    </div>
                    
                    <div class="card text-center">
                        <div class="text-4xl font-bold text-blue-600 mb-2" id="pendingOrders">0</div>
                        <div class="text-gray-600">Bekleyen Sipariş</div>
                    </div>
                </div>
                
                <div class="card mt-6">
                    <h3 class="text-xl font-semibold mb-4">Son Siparişler</h3>
                    <div id="recentOrders">
                        <!-- Son siparişler buraya gelecek -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bildirim -->
    <div id="notification" class="notification"></div>

    <!-- Ürün Detay Modal -->
    <div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg w-11/12 md:w-3/4 lg:w-2/3 max-h-screen overflow-y-auto p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold" id="modalProductName"></h3>
                <button id="closeModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <img id="modalProductImage" src="" alt="" class="w-full h-64 object-cover rounded-lg">
                    <div id="modalProductDescription" class="mt-4 text-gray-600"></div>
                </div>
                <div>
                    <div class="mb-4">
                        <span class="text-2xl font-bold text-indigo-600" id="modalProductPrice"></span>
                        <span class="text-gray-500">/ <span id="modalProductUnit"></span></span>
                    </div>
                    <div class="mb-4">
                        <label for="orderQuantity" class="block mb-2">Sipariş Miktarı</label>
                        <input type="number" id="orderQuantity" min="1" value="1" class="w-full p-2 border rounded">
                        <p class="text-sm text-gray-500 mt-1">Minimum sipariş: <span id="minOrderQuantity"></span> <span id="minOrderUnit"></span></p>
                    </div>
                    <div class="mb-4">
                        <label for="incoterms" class="block mb-2">Teslim Şekli (Incoterms)</label>
                        <select id="incoterms" class="w-full p-2 border rounded">
                            <option value="EXW">EXW - Ex Works (İşyerinde Teslim)</option>
                            <option value="FCA">FCA - Free Carrier (Taşıyıcıya Masrafsız)</option>
                            <option value="CPT">CPT - Carriage Paid To (Taşıma Ücreti Ödenmiş Olarak)</option>
                            <option value="CIP">CIP - Carriage and Insurance Paid To (Taşıma ve Sigorta Ödenmiş Olarak)</option>
                            <option value="DAP">DAP - Delivered At Place (Belirlenen Yerde Teslim)</option>
                            <option value="DDP">DDP - Delivered Duty Paid (Gümrük Resmi Ödenmiş Olarak Teslim)</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="deliveryDate" class="block mb-2">Teslim Tarihi</label>
                        <input type="date" id="deliveryDate" class="w-full p-2 border rounded">
                    </div>
                    <div class="mb-4">
                        <label for="paymentMethod" class="block mb-2">Ödeme Şekli</label>
                        <select id="paymentMethod" class="w-full p-2 border rounded">
                            <option value="advance">Peşin Ödeme</option>
                            <option value="cashAgainstDocuments">Vesaik Mukabili Ödeme</option>
                            <option value="letterOfCredit">Akreditifli Ödeme</option>
                            <option value="openAccount">Mal Mukabili Ödeme</option>
                        </select>
                    </div>
                    <button class="btn w-full" id="addToOrder">Sipariş Oluştur</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sipariş Detay Modal -->
    <div id="orderDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg w-11/12 md:w-3/4 lg:w-2/3 max-h-screen overflow-y-auto p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold">Sipariş Detayları: <span id="detailOrderId"></span></h3>
                <button id="closeDetailModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="order-details">
                <h4 class="text-lg font-semibold mb-2">Müşteri Bilgileri</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div><strong>Müşteri:</strong> <span id="detailCustomerName"></span></div>
                    <div><strong>Telefon:</strong> <span id="detailCustomerPhone"></span></div>
                    <div><strong>E-posta:</strong> <span id="detailCustomerEmail"></span></div>
                    <div><strong>Adres:</strong> <span id="detailCustomerAddress"></span></div>
                </div>
                
                <h4 class="text-lg font-semibold mb-2">Sipariş Bilgileri</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div><strong>Sipariş Tarihi:</strong> <span id="detailOrderDate"></span></div>
                    <div><strong>Teslim Şekli:</strong> <span id="detailIncoterm"></span></div>
                    <div><strong>Ödeme Yöntemi:</strong> <span id="detailPaymentMethod"></span></div>
                    <div><strong>Planlanan Teslimat:</strong> <span id="detailDeliveryDate"></span></div>
                </div>
                
                <h4 class="text-lg font-semibold mb-2">Sipariş Öğeleri</h4>
                <div id="detailOrderItems" class="mb-4">
                    <!-- Sipariş öğeleri buraya gelecek -->
                </div>
                
                <div class="flex justify-between items-center border-t pt-4">
                    <div class="text-lg font-semibold">Toplam Tutar:</div>
                    <div class="text-xl font-bold text-indigo-600" id="detailOrderTotal"></div>
                </div>
            </div>
            
            <div class="mt-6">
                <h4 class="text-lg font-semibold mb-2">Sipariş Durumu</h4>
                <div class="flex items-center space-x-4">
                    <select id="orderStatus" class="flex-grow p-2 border rounded">
                        <option value="pending">Beklemede</option>
                        <option value="approved">Onaylandı</option>
                        <option value="preparing">Hazırlanıyor</option>
                        <option value="shipped">Kargoya Verildi</option>
                        <option value="delivered">Teslim Edildi</option>
                        <option value="cancelled">İptal Edildi</option>
                    </select>
                    <button class="btn" id="updateStatus">Durumu Güncelle</button>
                </div>
            </div>
            
            <div class="mt-6 flex justify-end space-x-4">
                <button class="btn btn-secondary" id="closeDetailBtn">Kapat</button>
                <button class="btn btn-danger" id="cancelOrderBtn">Siparişi İptal Et</button>
            </div>
        </div>
    </div>

    <!-- Kategori Ekleme/Düzenleme Modal -->
    <div id="categoryModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg w-11/12 md:w-1/2 lg:w-1/3 p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold" id="categoryModalTitle">Kategori Ekle</h3>
                <button class="close-modal text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="form-group">
                <label for="categoryName">Kategori Adı</label>
                <input type="text" id="categoryName" class="w-full p-2 border rounded">
            </div>
            
            <div class="form-group">
                <label for="categoryIcon">Kategori İkonu (Font Awesome)</label>
                <input type="text" id="categoryIcon" placeholder="fa-utensils" class="w-full p-2 border rounded">
            </div>
            
            <div class="flex justify-end space-x-4 mt-6">
                <button class="btn btn-secondary close-modal">İptal</button>
                <button class="btn" id="saveCategory">Kaydet</button>
            </div>
        </div>
    </div>

    <!-- Ürün Ekleme/Düzenleme Modal -->
    <div id="productFormModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg w-11/12 md:w-3/4 lg:w-2/3 max-h-screen overflow-y-auto p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold" id="productModalTitle">Ürün Ekle</h3>
                <button class="close-modal text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="form-group">
                    <label for="productName">Ürün Adı</label>
                    <input type="text" id="productName" class="w-full p-2 border rounded">
                </div>
                
                <div class="form-group">
                    <label for="productCategory">Kategori</label>
                    <select id="productCategory" class="w-full p-2 border rounded">
                        <!-- Kategoriler JavaScript ile doldurulacak -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="productPrice">Fiyat (₺)</label>
                    <input type="number" id="productPrice" min="0" step="0.01" class="w-full p-2 border rounded">
                </div>
                
                <div class="form-group">
                    <label for="productUnit">Birim</label>
                    <input type="text" id="productUnit" placeholder="kg, adet, litre vb." class="w-full p-2 border rounded">
                </div>
                
                <div class="form-group">
                    <label for="productMinOrder">Minimum Sipariş Miktarı</label>
                    <input type="number" id="productMinOrder" min="1" class="w-full p-2 border rounded">
                </div>
                
                <div class="form-group">
                    <label for="productDeliveryTime">Teslim Süresi (Gün)</label>
                    <input type="number" id="productDeliveryTime" min="1" class="w-full p-2 border rounded">
                </div>
                
                <div class="form-group md:col-span-2">
                    <label for="productDescription">Ürün Açıklaması</label>
                    <textarea id="productDescription" rows="3" class="w-full p-2 border rounded"></textarea>
                </div>
                
                <div class="form-group md:col-span-2">
                    <label for="productImage">Ürün Görsel URL</label>
                    <input type="text" id="productImage" class="w-full p-2 border rounded">
                </div>
            </div>
            
            <div class="flex justify-end space-x-4 mt-6">
                <button class="btn btn-secondary close-modal">İptal</button>
                <button class="btn" id="saveProduct">Kaydet</button>
            </div>
        </div>
    </div>

    <!-- Lojistik Ekleme/Düzenleme Modal -->
    <div id="logisticsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg w-11/12 md:w-3/4 lg:w-2/3 p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold" id="logisticsModalTitle">Lojistik Bilgisi Ekle</h3>
                <button class="close-modal text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="form-group">
                    <label for="logisticsOrder">Sipariş No</label>
                    <select id="logisticsOrder" class="w-full p-2 border rounded">
                        <!-- Siparişler JavaScript ile doldurulacak -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="logisticsCompany">Lojistik Firması</label>
                    <input type="text" id="logisticsCompany" class="w-full p-2 border rounded">
                </div>
                
                <div class="form-group">
                    <label for="logisticsShippingDate">Sevk Tarihi</label>
                    <input type="date" id="logisticsShippingDate" class="w-full p-2 border rounded">
                </div>
                
                <div class="form-group">
                    <label for="logisticsVehiclePlate">Araç Plakası</label>
                    <input type="text" id="logisticsVehiclePlate" class="w-full p-2 border rounded">
                </div>
                
                <div class="form-group">
                    <label for="logisticsCost">Nakliye Ücreti (₺)</label>
                    <input type="number" id="logisticsCost" min="0" step="0.01" class="w-full p-2 border rounded">
                </div>
                
                <div class="form-group">
                    <label for="logisticsStatus">Taşıma Durumu</label>
                    <select id="logisticsStatus" class="w-full p-2 border rounded">
                        <option value="Planlanıyor">Planlanıyor</option>
                        <option value="Hazırlanıyor">Hazırlanıyor</option>
                        <option value="Yolda">Yolda</option>
                        <option value="Teslim Edildi">Teslim Edildi</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="logisticsDeliveryDate">Teslim Tarihi</label>
                    <input type="date" id="logisticsDeliveryDate" class="w-full p-2 border rounded">
                </div>
                
                <div class="form-group">
                    <label for="logisticsDeliveredTo">Teslim Alan</label>
                    <input type="text" id="logisticsDeliveredTo" class="w-full p-2 border rounded">
                </div>
            </div>
            
            <div class="flex justify-end space-x-4 mt-6">
                <button class="btn btn-secondary close-modal">İptal</button>
                <button class="btn" id="saveLogistics">Kaydet</button>
            </div>
        </div>
    </div>

    <script>
        // Supabase bağlantı bilgileri
        const SUPABASE_URL = "https://xliutvspwodhoaxvysks.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhsaXV0dnNwd29kaG9heHZ5c2tzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTczNTgyOTksImV4cCI6MjA3MjkzNDI5OX0.Zodisa_ifP8t2Q4X0ecnB56RiR_Bg4QS5gvPn5ZLK_w";
	
        
        // Supabase client'ı oluştur
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Uygulama durumu
        let currentUser = null;
        let currentProduct = null;
        let currentOrder = null;
        let currentCategory = null;
        let currentLogistics = null;
        let categories = [];
        let products = [];
        let orders = [];
        let payments = [];
        let logistics = [];
        let editingId = null;

        // DOM elementleri
        const adminAuthContainer = document.getElementById('adminAuthContainer');
        const mainContent = document.getElementById('mainContent');
        const categoriesList = document.getElementById('categoriesList');
        const productsGrid = document.getElementById('productsGrid');
        const ordersList = document.getElementById('ordersList');
        const paymentsList = document.getElementById('paymentsList');
        const logisticsList = document.getElementById('logisticsList');
        const productModal = document.getElementById('productModal');
        const orderDetailModal = document.getElementById('orderDetailModal');
        const categoryModal = document.getElementById('categoryModal');
        const productFormModal = document.getElementById('productFormModal');
        const logisticsModal = document.getElementById('logisticsModal');
        const notification = document.getElementById('notification');

        // Sayfa yüklendiğinde
        document.addEventListener('DOMContentLoaded', function() {
            checkAdminStatus();
            setupEventListeners();
        });

        // Event listener'ları kur
        function setupEventListeners() {
            // Admin giriş butonları
            document.getElementById('adminLoginBtn').addEventListener('click', showAdminAuth);
            document.getElementById('adminLogoutBtn').addEventListener('click', adminLogout);
            document.getElementById('submitAdminAuth').addEventListener('click', handleAdminAuth);
            
            // Sekmeler
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchTab(this.dataset.tab);
                });
            });
            
            // Modal kapatma
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.fixed').classList.add('hidden');
                });
            });
            document.getElementById('closeModal').addEventListener('click', closeModal);
            document.getElementById('closeDetailModal').addEventListener('click', closeDetailModal);
            document.getElementById('closeDetailBtn').addEventListener('click', closeDetailModal);
            
            // Sipariş butonları
            document.getElementById('addToOrder').addEventListener('click', addToOrder);
            
            // Sipariş detay işlemleri
            document.getElementById('updateStatus').addEventListener('click', updateOrderStatus);
            document.getElementById('cancelOrderBtn').addEventListener('click', cancelOrder);
            
            // Kategori işlemleri
            document.getElementById('addCategoryBtn').addEventListener('click', () => openCategoryModal());
            document.getElementById('saveCategory').addEventListener('click', saveCategory);
            
            // Ürün işlemleri
            document.getElementById('addProductBtn').addEventListener('click', () => openProductModal());
            document.getElementById('saveProduct').addEventListener('click', saveProduct);
            
            // Lojistik işlemleri
            document.getElementById('addLogisticsBtn').addEventListener('click', () => openLogisticsModal());
            document.getElementById('saveLogistics').addEventListener('click', saveLogistics);
        }

        // Bildirim göster
        function showNotification(message, type = 'success') {
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Yükleniyor durumunu göster
        function setLoading(button, isLoading) {
            const buttonText = button.querySelector('#authButtonText');
            const spinner = button.querySelector('#authSpinner');
            
            if (isLoading) {
                button.disabled = true;
                buttonText.classList.add('hidden');
                spinner.classList.remove('hidden');
            } else {
                button.disabled = false;
                buttonText.classList.remove('hidden');
                spinner.classList.add('hidden');
            }
        }

        // Admin durumunu kontrol et
        function checkAdminStatus() {
            const isAdminLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';
            
            if (isAdminLoggedIn) {
                adminAuthContainer.classList.add('hidden');
                mainContent.classList.remove('hidden');
                document.getElementById('adminLoginBtn').classList.add('hidden');
                document.getElementById('adminLogoutBtn').classList.remove('hidden');
                document.getElementById('adminInfo').classList.remove('hidden');
                document.getElementById('adminInfo').textContent = `Hoş geldiniz, ${localStorage.getItem('adminEmail')}`;
                
                // Verileri yükle
                loadCategories();
                loadOrders();
                loadPayments();
                loadLogistics();
                loadAdminDashboard();
            } else {
                adminAuthContainer.classList.remove('hidden');
                mainContent.classList.add('hidden');
                document.getElementById('adminLoginBtn').classList.remove('hidden');
                document.getElementById('adminLogoutBtn').classList.add('hidden');
                document.getElementById('adminInfo').classList.add('hidden');
            }
        }

        // Admin girişi göster
        function showAdminAuth() {
            adminAuthContainer.classList.remove('hidden');
            mainContent.classList.add('hidden');
        }

        // Admin giriş işlemi
        async function handleAdminAuth() {
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            const authButton = document.getElementById('submitAdminAuth');
            
            if (!email || !password) {
                showNotification('Lütfen e-posta ve şifre giriniz.', 'error');
                return;
            }
            
            setLoading(authButton, true);
            
            try {
                // Supabase ile giriş yap
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) {
                    throw error;
                }
                
                // Giriş başarılı
                localStorage.setItem('adminLoggedIn', 'true');
                localStorage.setItem('adminEmail', email);
                currentUser = data.user;
                
                showNotification('Başarıyla giriş yapıldı.');
                checkAdminStatus();
            } catch (error) {
                console.error('Giriş hatası:', error);
                showNotification('Hatalı e-posta veya şifre!', 'error');
            } finally {
                setLoading(authButton, false);
            }
        }

        // Admin çıkış işlemi
        async function adminLogout() {
            try {
                await supabase.auth.signOut();
                localStorage.removeItem('adminLoggedIn');
                localStorage.removeItem('adminEmail');
                currentUser = null;
                showNotification('Çıkış yapıldı.');
                checkAdminStatus();
            } catch (error) {
                console.error('Çıkış hatası:', error);
                showNotification('Çıkış yapılırken bir hata oluştu.', 'error');
            }
        }

        // Kategorileri yükle
        async function loadCategories() {
            try {
                const { data, error } = await supabase
                    .from('categories')
                    .select('*')
                    .order('name');
                
                if (error) {
                    throw error;
                }
                
                categories = data || [];
                renderCategories();
                
                // Ürünleri de yükle
                await loadProducts();
            } catch (error) {
                console.error('Kategoriler yüklenirken hata:', error);
                showNotification('Kategoriler yüklenirken bir hata oluştu.', 'error');
            }
        }

        // Kategorileri render et
        function renderCategories() {
            categoriesList.innerHTML = '';
            
            // Tümü butonu
            const allButton = document.createElement('div');
            allButton.className = `category-btn ${!currentCategory ? 'active' : ''}`;
            allButton.innerHTML = '<i class="fas fa-list mr-2"></i> Tümü';
            allButton.addEventListener('click', function() {
                currentCategory = null;
                filterProducts();
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                document.getElementById('categoryTitle').textContent = 'Tüm Ürünler';
            });
            categoriesList.appendChild(allButton);
            
            // Kategori butonları
            categories.forEach(category => {
                const button = document.createElement('div');
                button.className = `category-btn ${currentCategory === category.id ? 'active' : ''}`;
                button.innerHTML = `<i class="fas ${category.icon} mr-2"></i> ${category.name}`;
                button.addEventListener('click', function() {
                    currentCategory = category.id;
                    filterProducts(category.id);
                    document.querySelectorAll('.category-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                    document.getElementById('categoryTitle').textContent = `${category.name} Ürünleri`;
                });
                categoriesList.appendChild(button);
            });
        }

        // Ürünleri yükle
        async function loadProducts() {
            try {
                const { data, error } = await supabase
                    .from('products')
                    .select('*')
                    .order('name');
                
                if (error) {
                    throw error;
                }
                
                products = data || [];
                filterProducts(currentCategory);
            } catch (error) {
                console.error('Ürünler yüklenirken hata:', error);
                showNotification('Ürünler yüklenirken bir hata oluştu.', 'error');
            }
        }

        // Ürünleri filtrele
        function filterProducts(categoryId = null) {
            productsGrid.innerHTML = '';
            
            let filteredProducts = products;
            if (categoryId) {
                filteredProducts = products.filter(product => product.category_id === categoryId);
            }
            
            if (filteredProducts.length === 0) {
                productsGrid.innerHTML = `
                    <div class="col-span-3 text-center py-8">
                        <i class="fas fa-box-open text-4xl text-gray-400 mb-4"></i>
                        <h3 class="text-xl font-bold text-gray-600">Bu kategoride ürün bulunamadı</h3>
                    </div>
                `;
                return;
            }
            
            filteredProducts.forEach(product => {
                const category = categories.find(c => c.id === product.category_id);
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <img src="${product.image_url || 'https://placehold.co/300x200/e2e8f0/4f46e5?text=Ürün+Görseli'}" 
                         alt="${product.name}" class="w-full h-48 object-cover rounded-lg mb-4">
                    <h3 class="text-xl font-semibold mb-2">${product.name}</h3>
                    <p class="text-gray-600 text-sm mb-2">${category?.name || 'Kategorisiz'}</p>
                    <p class="text-gray-600 text-sm mb-4">${product.description?.substring(0, 100) || 'Açıklama yok'}...</p>
                    <div class="flex justify-between items-center">
                        <span class="text-lg font-bold text-indigo-600">${product.price}₺</span>
                        <button class="btn view-product" data-id="${product.id}">İncele</button>
                    </div>
                    <div class="flex justify-end mt-4">
                        <button class="text-blue-600 mr-3 edit-product" data-id="${product.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-600 delete-product" data-id="${product.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                productsGrid.appendChild(productCard);
            });
            
            // Ürün inceleme butonlarına event listener ekle
            document.querySelectorAll('.view-product').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.dataset.id);
                    openProductModal(productId);
                });
            });
            
            // Ürün düzenleme butonlarına event listener ekle
            document.querySelectorAll('.edit-product').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.dataset.id);
                    openProductModal(productId, true);
                });
            });
            
            // Ürün silme butonlarına event listener ekle
            document.querySelectorAll('.delete-product').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.dataset.id);
                    deleteProduct(productId);
                });
            });
        }

        // Ürün modalını aç
        function openProductModal(productId = null, isEdit = false) {
            if (isEdit) {
                // Ürün düzenleme modu
                currentProduct = products.find(p => p.id === productId);
                
                if (!currentProduct) return;
                
                document.getElementById('productModalTitle').textContent = 'Ürünü Düzenle';
                document.getElementById('productName').value = currentProduct.name;
                document.getElementById('productCategory').value = currentProduct.category_id;
                document.getElementById('productPrice').value = currentProduct.price;
                document.getElementById('productUnit').value = currentProduct.unit;
                document.getElementById('productMinOrder').value = currentProduct.min_order;
                document.getElementById('productDeliveryTime').value = currentProduct.delivery_time;
                document.getElementById('productDescription').value = currentProduct.description || '';
                document.getElementById('productImage').value = currentProduct.image_url || '';
                
                // Kategori seçeneklerini doldur
                const categorySelect = document.getElementById('productCategory');
                categorySelect.innerHTML = '';
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    categorySelect.appendChild(option);
                });
                categorySelect.value = currentProduct.category_id;
                
                editingId = productId;
                productFormModal.classList.remove('hidden');
            } else {
                // Ürün görüntüleme modu (sipariş oluşturma)
                currentProduct = products.find(p => p.id === productId);
                
                if (!currentProduct) return;
                
                document.getElementById('modalProductName').textContent = currentProduct.name;
                document.getElementById('modalProductImage').src = currentProduct.image_url || 'https://placehold.co/300x200/e2e8f0/4f46e5?text=Ürün+Görseli';
                document.getElementById('modalProductDescription').textContent = currentProduct.description || 'Açıklama bulunmamaktadır.';
                document.getElementById('modalProductPrice').textContent = currentProduct.price;
                document.getElementById('modalProductUnit').textContent = currentProduct.unit;
                document.getElementById('minOrderQuantity').textContent = currentProduct.min_order;
                document.getElementById('minOrderUnit').textContent = currentProduct.unit;
                document.getElementById('orderQuantity').min = currentProduct.min_order;
                document.getElementById('orderQuantity').value = currentProduct.min_order;
                
                // Teslim tarihini ayarla (ürünün teslim süresine göre)
                const deliveryDate = new Date();
                deliveryDate.setDate(deliveryDate.getDate() + (currentProduct.delivery_time || 7));
                document.getElementById('deliveryDate').valueAsDate = deliveryDate;
                
                productModal.classList.remove('hidden');
            }
        }

        // Modalı kapat
        function closeModal() {
            productModal.classList.add('hidden');
            currentProduct = null;
        }

        // Sipariş oluştur
        async function addToOrder() {
            const quantity = parseInt(document.getElementById('orderQuantity').value);
            const incoterm = document.getElementById('incoterms').value;
            const deliveryDate = document.getElementById('deliveryDate').value;
            const paymentMethod = document.getElementById('paymentMethod').value;
            
            if (quantity < currentProduct.min_order) {
                showNotification(`Minimum sipariş miktarı ${currentProduct.min_order} ${currentProduct.unit}'dir.`, 'error');
                return;
            }
            
            try {
                // Müşteri bilgilerini al (gerçek uygulamada formdan alınır)
                const customer = {
                    name: "Yeni Müşteri",
                    email: "musteri@example.com",
                    phone: "+90 500 000 00 00",
                    address: "Adres bilgisi girilmemiş"
                };
                
                // Siparişi Supabase'e kaydet
                const { data: orderData, error: orderError } = await supabase
                    .from('orders')
                    .insert([
                        {
                            customer_name: customer.name,
                            customer_email: customer.email,
                            customer_phone: customer.phone,
                            customer_address: customer.address,
                            incoterm: incoterm,
                            payment_method: paymentMethod,
                            delivery_date: deliveryDate,
                            status: 'pending',
                            total_amount: currentProduct.price * quantity
                        }
                    ])
                    .select()
                    .single();
                
                if (orderError) {
                    throw orderError;
                }
                
                // Sipariş öğelerini kaydet
                const { error: itemError } = await supabase
                    .from('order_items')
                    .insert([
                        {
                            order_id: orderData.id,
                            product_id: currentProduct.id,
                            product_name: currentProduct.name,
                            quantity: quantity,
                            unit_price: currentProduct.price,
                            total_price: currentProduct.price * quantity
                        }
                    ]);
                
                if (itemError) {
                    throw itemError;
                }
                
                // Ödeme kaydı oluştur
                const { error: paymentError } = await supabase
                    .from('payments')
                    .insert([
                        {
                            order_id: orderData.id,
                            customer_name: customer.name,
                            amount: currentProduct.price * quantity,
                            method: paymentMethod,
                            status: 'Beklemede'
                        }
                    ]);
                
                if (paymentError) {
                    throw paymentError;
                }
                
                // Lojistik kaydı oluştur
                const { error: logisticsError } = await supabase
                    .from('logistics')
                    .insert([
                        {
                            order_id: orderData.id,
                            shipping_cost: 0,
                            status: 'Planlanıyor',
                            delivery_date: deliveryDate
                        }
                    ]);
                
                if (logisticsError) {
                    throw logisticsError;
                }
                
                closeModal();
                showNotification('Sipariş başarıyla oluşturuldu! Sipariş numaranız: ' + orderData.id);
                
                // Verileri yenile
                await loadOrders();
                await loadPayments();
                await loadLogistics();
                await loadAdminDashboard();
                
                // Siparişler sekmesine geç
                switchTab('orders');
            } catch (error) {
                console.error('Sipariş oluşturma hatası:', error);
                showNotification('Sipariş oluşturulurken bir hata oluştu.', 'error');
            }
        }

        // Siparişleri yükle
        async function loadOrders() {
            try {
                const { data, error } = await supabase
                    .from('orders')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    throw error;
                }
                
                orders = data || [];
                renderOrders();
            } catch (error) {
                console.error('Siparişler yüklenirken hata:', error);
                showNotification('Siparişler yüklenirken bir hata oluştu.', 'error');
            }
        }

        // Siparişleri render et
        function renderOrders() {
            ordersList.innerHTML = '';
            
            if (orders.length === 0) {
                ordersList.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-4 text-center">Henüz sipariş bulunmamaktadır.</td>
                    </tr>
                `;
                return;
            }
            
            orders.forEach(order => {
                const statusClass = getStatusClass(order.status);
                const statusText = getStatusText(order.status);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${order.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${order.customer_name}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${new Date(order.created_at).toLocaleDateString('tr-TR')}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${order.total_amount}₺</td>
                    <td class="px-6 py-4 whitespace-nowrap"><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <button class="text-indigo-600 hover:text-indigo-900 view-order-details" data-id="${order.id}">Detay</button>
                        <button class="text-red-600 hover:text-red-900 ml-3 delete-order" data-id="${order.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                ordersList.appendChild(row);
            });
            
            // Sipariş detay butonlarına event listener ekle
            document.querySelectorAll('.view-order-details').forEach(btn => {
                btn.addEventListener('click', function() {
                    const orderId = this.dataset.id;
                    openOrderDetails(orderId);
                });
            });
            
            // Sipariş silme butonlarına event listener ekle
            document.querySelectorAll('.delete-order').forEach(btn => {
                btn.addEventListener('click', function() {
                    const orderId = this.dataset.id;
                    deleteOrder(orderId);
                });
            });
        }

        // Ödemeleri yükle
        async function loadPayments() {
            try {
                const { data, error } = await supabase
                    .from('payments')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    throw error;
                }
                
                payments = data || [];
                renderPayments();
            } catch (error) {
                console.error('Ödemeler yüklenirken hata:', error);
                showNotification('Ödemeler yüklenirken bir hata oluştu.', 'error');
            }
        }

        // Ödemeleri render et
        function renderPayments() {
            paymentsList.innerHTML = '';
            
            if (payments.length === 0) {
                paymentsList.innerHTML = `
                    <tr>
                        <td colspan="8" class="px-6 py-4 text-center">Henüz ödeme bulunmamaktadır.</td>
                    </tr>
                `;
                return;
            }
            
            payments.forEach(payment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${payment.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${payment.order_id}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${payment.customer_name}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${new Date(payment.created_at).toLocaleDateString('tr-TR')}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${payment.amount}₺</td>
                    <td class="px-6 py-4 whitespace-nowrap">${payment.method}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${payment.status}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <button class="text-red-600 hover:text-red-900 delete-payment" data-id="${payment.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                paymentsList.appendChild(row);
            });
            
            // Ödeme silme butonlarına event listener ekle
            document.querySelectorAll('.delete-payment').forEach(btn => {
                btn.addEventListener('click', function() {
                    const paymentId = this.dataset.id;
                    deletePayment(paymentId);
                });
            });
        }

        // Lojistik bilgilerini yükle
        async function loadLogistics() {
            try {
                const { data, error } = await supabase
                    .from('logistics')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    throw error;
                }
                
                logistics = data || [];
                renderLogistics();
            } catch (error) {
                console.error('Lojistik bilgileri yüklenirken hata:', error);
                showNotification('Lojistik bilgileri yüklenirken bir hata oluştu.', 'error');
            }
        }

        // Lojistik bilgilerini render et
        function renderLogistics() {
            logisticsList.innerHTML = '';
            
            if (logistics.length === 0) {
                logisticsList.innerHTML = `
                    <tr>
                        <td colspan="9" class="px-6 py-4 text-center">Henüz lojistik kaydı bulunmamaktadır.</td>
                    </tr>
                `;
                return;
            }
            
            logistics.forEach(logistic => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${logistic.order_id}</td>
                    <td>${logistic.company || "-"}</td>
                    <td>${logistic.shipping_date ? new Date(logistic.shipping_date).toLocaleDateString('tr-TR') : "-"}</td>
                    <td>${logistic.vehicle_plate || "-"}</td>
                    <td>${logistic.shipping_cost}₺</td>
                    <td>${logistic.status}</td>
                    <td>${logistic.delivery_date ? new Date(logistic.delivery_date).toLocaleDateString('tr-TR') : "-"}</td>
                    <td>${logistic.delivered_to || "-"}</td>
                    <td>
                        <button class="text-indigo-600 hover:text-indigo-900 update-logistics" data-id="${logistic.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-600 hover:text-red-900 ml-3 delete-logistics" data-id="${logistic.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                logisticsList.appendChild(row);
            });
            
            // Lojistik güncelleme butonlarına event listener ekle
            document.querySelectorAll('.update-logistics').forEach(btn => {
                btn.addEventListener('click', function() {
                    const logisticsId = this.dataset.id;
                    openLogisticsModal(logisticsId);
                });
            });
            
            // Lojistik silme butonlarına event listener ekle
            document.querySelectorAll('.delete-logistics').forEach(btn => {
                btn.addEventListener('click', function() {
                    const logisticsId = this.dataset.id;
                    deleteLogistics(logisticsId);
                });
            });
        }

        // Admin dashboard'unu yükle
        async function loadAdminDashboard() {
            try {
                // İstatistikleri hesapla
                const { count: totalOrders, error: ordersError } = await supabase
                    .from('orders')
                    .select('*', { count: 'exact' });
                
                if (ordersError) {
                    throw ordersError;
                }
                
                const { count: pendingOrders, error: pendingError } = await supabase
                    .from('orders')
                    .select('*', { count: 'exact' })
                    .eq('status', 'pending');
                
                if (pendingError) {
                    throw pendingError;
                }
                
                const { data: revenueData, error: revenueError } = await supabase
                    .from('orders')
                    .select('total_amount');
                
                if (revenueError) {
                    throw revenueError;
                }
                
                const totalRevenue = revenueData.reduce((sum, order) => sum + order.total_amount, 0);
                
                // İstatistikleri güncelle
                document.getElementById('totalOrders').textContent = totalOrders || 0;
                document.getElementById('pendingOrders').textContent = pendingOrders || 0;
                document.getElementById('totalRevenue').textContent = `${totalRevenue}₺`;
                
                // Son siparişleri yükle
                const { data: recentOrdersData, error: recentError } = await supabase
                    .from('orders')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(5);
                
                if (recentError) {
                    throw recentError;
                }
                
                // Son siparişleri göster
                const recentOrdersContainer = document.getElementById('recentOrders');
                recentOrdersContainer.innerHTML = '';
                
                if (!recentOrdersData || recentOrdersData.length === 0) {
                    recentOrdersContainer.innerHTML = '<p class="text-gray-500 text-center py-4">Henüz sipariş bulunmamaktadır.</p>';
                    return;
                }
                
                recentOrdersData.forEach(order => {
                    const statusClass = getStatusClass(order.status);
                    const statusText = getStatusText(order.status);
                    
                    const orderElement = document.createElement('div');
                    orderElement.className = 'flex justify-between items-center py-3 border-b';
                    orderElement.innerHTML = `
                        <div>
                            <div class="font-semibold">${order.id}</div>
                            <div class="text-sm text-gray-600">${order.customer_name}</div>
                        </div>
                        <div class="text-right">
                            <div class="font-semibold">${order.total_amount}₺</div>
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                    `;
                    recentOrdersContainer.appendChild(orderElement);
                });
            } catch (error) {
                console.error('Dashboard yüklenirken hata:', error);
                showNotification('Dashboard yüklenirken bir hata oluştu.', 'error');
            }
        }

        // Sipariş detaylarını aç
        async function openOrderDetails(orderId) {
            try {
                // Sipariş bilgilerini getir
                const { data: orderData, error: orderError } = await supabase
                    .from('orders')
                    .select('*')
                    .eq('id', orderId)
                    .single();
                
                if (orderError) {
                    throw orderError;
                }
                
                // Sipariş öğelerini getir
                const { data: itemsData, error: itemsError } = await supabase
                    .from('order_items')
                    .select('*')
                    .eq('order_id', orderId);
                
                if (itemsError) {
                    throw itemsError;
                }
                
                currentOrder = orderData;
                currentOrder.items = itemsData || [];
                
                // Modalı doldur
                document.getElementById('detailOrderId').textContent = currentOrder.id;
                document.getElementById('detailCustomerName').textContent = currentOrder.customer_name;
                document.getElementById('detailCustomerPhone').textContent = currentOrder.customer_phone;
                document.getElementById('detailCustomerEmail').textContent = currentOrder.customer_email;
                document.getElementById('detailCustomerAddress').textContent = currentOrder.customer_address;
                document.getElementById('detailOrderDate').textContent = new Date(currentOrder.created_at).toLocaleDateString('tr-TR');
                document.getElementById('detailIncoterm').textContent = currentOrder.incoterm;
                document.getElementById('detailPaymentMethod').textContent = currentOrder.payment_method;
                document.getElementById('detailDeliveryDate').textContent = new Date(currentOrder.delivery_date).toLocaleDateString('tr-TR');
                document.getElementById('detailOrderTotal').textContent = `${currentOrder.total_amount}₺`;
                
                // Sipariş öğelerini yükle
                const orderItemsContainer = document.getElementById('detailOrderItems');
                orderItemsContainer.innerHTML = '';
                
                currentOrder.items.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'flex justify-between py-2 border-b';
                    itemElement.innerHTML = `
                        <div>
                            <div class="font-semibold">${item.product_name}</div>
                            <div class="text-sm text-gray-600">${item.quantity} adet × ${item.unit_price}₺</div>
                        </div>
                        <div class="font-semibold">${item.total_price}₺</div>
                    `;
                    orderItemsContainer.appendChild(itemElement);
                });
                
                // Mevcut durumu seç
                document.getElementById('orderStatus').value = currentOrder.status;
                
                orderDetailModal.classList.remove('hidden');
            } catch (error) {
                console.error('Sipariş detayları yüklenirken hata:', error);
                showNotification('Sipariş detayları yüklenirken bir hata oluştu.', 'error');
            }
        }

        // Sipariş detay modalını kapat
        function closeDetailModal() {
            orderDetailModal.classList.add('hidden');
            currentOrder = null;
        }

        // Sipariş durumunu güncelle
        async function updateOrderStatus() {
            if (!currentOrder) return;
            
            const newStatus = document.getElementById('orderStatus').value;
            
            try {
                const { error } = await supabase
                    .from('orders')
                    .update({ status: newStatus })
                    .eq('id', currentOrder.id);
                
                if (error) {
                    throw error;
                }
                
                showNotification('Sipariş durumu güncellendi: ' + getStatusText(newStatus));
                closeDetailModal();
                await loadOrders();
                await loadAdminDashboard();
            } catch (error) {
                console.error('Sipariş durumu güncellenirken hata:', error);
                showNotification('Sipariş durumu güncellenirken bir hata oluştu.', 'error');
            }
        }

        // Siparişi iptal et
        async function cancelOrder() {
            if (!currentOrder) return;
            
            if (!confirm('Bu siparişi iptal etmek istediğinize emin misiniz?')) {
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('orders')
                    .update({ status: 'cancelled' })
                    .eq('id', currentOrder.id);
                
                if (error) {
                    throw error;
                }
                
                showNotification('Sipariş iptal edildi.');
                closeDetailModal();
                await loadOrders();
                await loadAdminDashboard();
            } catch (error) {
                console.error('Sipariş iptal edilirken hata:', error);
                showNotification('Sipariş iptal edilirken bir hata oluştu.', 'error');
            }
        }

        // Sipariş sil
        async function deleteOrder(orderId) {
            if (!confirm('Bu siparişi silmek istediğinize emin misiniz? Bu işlem geri alınamaz.')) {
                return;
            }
            
            try {
                // İlk önce ilişkili kayıtları sil
                const { error: itemsError } = await supabase
                    .from('order_items')
                    .delete()
                    .eq('order_id', orderId);
                
                if (itemsError) {
                    throw itemsError;
                }
                
                const { error: paymentsError } = await supabase
                    .from('payments')
                    .delete()
                    .eq('order_id', orderId);
                
                if (paymentsError) {
                    throw paymentsError;
                }
                
                const { error: logisticsError } = await supabase
                    .from('logistics')
                    .delete()
                    .eq('order_id', orderId);
                
                if (logisticsError) {
                    throw logisticsError;
                }
                
                // Sonra siparişi sil
                const { error } = await supabase
                    .from('orders')
                    .delete()
                    .eq('id', orderId);
                
                if (error) {
                    throw error;
                }
                
                showNotification('Sipariş başarıyla silindi.');
                await loadOrders();
                await loadPayments();
                await loadLogistics();
                await loadAdminDashboard();
            } catch (error) {
                console.error('Sipariş silinirken hata:', error);
                showNotification('Sipariş silinirken bir hata oluştu.', 'error');
            }
        }

        // Ödeme sil
        async function deletePayment(paymentId) {
            if (!confirm('Bu ödeme kaydını silmek istediğinize emin misiniz?')) {
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('payments')
                    .delete()
                    .eq('id', paymentId);
                
                if (error) {
                    throw error;
                }
                
                showNotification('Ödeme kaydı başarıyla silindi.');
                await loadPayments();
            } catch (error) {
                console.error('Ödeme kaydı silinirken hata:', error);
                showNotification('Ödeme kaydı silinirken bir hata oluştu.', 'error');
            }
        }

        // Kategori modalını aç
        function openCategoryModal(categoryId = null) {
            editingId = categoryId;
            
            if (categoryId) {
                // Düzenleme modu
                const category = categories.find(c => c.id === categoryId);
                if (!category) return;
                
                document.getElementById('categoryModalTitle').textContent = 'Kategori Düzenle';
                document.getElementById('categoryName').value = category.name;
                document.getElementById('categoryIcon').value = category.icon;
            } else {
                // Ekleme modu
                document.getElementById('categoryModalTitle').textContent = 'Kategori Ekle';
                document.getElementById('categoryName').value = '';
                document.getElementById('categoryIcon').value = '';
            }
            
            categoryModal.classList.remove('hidden');
        }

        // Kategori kaydet
        async function saveCategory() {
            const name = document.getElementById('categoryName').value;
            const icon = document.getElementById('categoryIcon').value;
            
            if (!name || !icon) {
                showNotification('Lütfen kategori adı ve ikonunu giriniz.', 'error');
                return;
            }
            
            try {
                if (editingId) {
                    // Düzenleme
                    const { error } = await supabase
                        .from('categories')
                        .update({ name, icon })
                        .eq('id', editingId);
                    
                    if (error) {
                        throw error;
                    }
                    
                    showNotification('Kategori başarıyla güncellendi.');
                } else {
                    // Ekleme
                    const { error } = await supabase
                        .from('categories')
                        .insert([{ name, icon }]);
                    
                    if (error) {
                        throw error;
                    }
                    
                    showNotification('Kategori başarıyla eklendi.');
                }
                
                categoryModal.classList.add('hidden');
                await loadCategories();
            } catch (error) {
                console.error('Kategori kaydedilirken hata:', error);
                showNotification('Kategori kaydedilirken bir hata oluştu.', 'error');
            }
        }

        // Ürün kaydet
        async function saveProduct() {
            const name = document.getElementById('productName').value;
            const categoryId = document.getElementById('productCategory').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const unit = document.getElementById('productUnit').value;
            const minOrder = parseInt(document.getElementById('productMinOrder').value);
            const deliveryTime = parseInt(document.getElementById('productDeliveryTime').value);
            const description = document.getElementById('productDescription').value;
            const imageUrl = document.getElementById('productImage').value;
            
            if (!name || !categoryId || !price || !unit || !minOrder || !deliveryTime) {
                showNotification('Lütfen zorunlu alanları doldurunuz.', 'error');
                return;
            }
            
            try {
                if (editingId) {
                    // Düzenleme
                    const { error } = await supabase
                        .from('products')
                        .update({ 
                            name, 
                            category_id: categoryId, 
                            price, 
                            unit, 
                            min_order: minOrder, 
                            delivery_time: deliveryTime, 
                            description, 
                            image_url: imageUrl 
                        })
                        .eq('id', editingId);
                    
                    if (error) {
                        throw error;
                    }
                    
                    showNotification('Ürün başarıyla güncellendi.');
                } else {
                    // Ekleme
                    const { error } = await supabase
                        .from('products')
                        .insert([{ 
                            name, 
                            category_id: categoryId, 
                            price, 
                            unit, 
                            min_order: minOrder, 
                            delivery_time: deliveryTime, 
                            description, 
                            image_url: imageUrl 
                        }]);
                    
                    if (error) {
                        throw error;
                    }
                    
                    showNotification('Ürün başarıyla eklendi.');
                }
                
                productFormModal.classList.add('hidden');
                await loadProducts();
            } catch (error) {
                console.error('Ürün kaydedilirken hata:', error);
                showNotification('Ürün kaydedilirken bir hata oluştu.', 'error');
            }
        }

        // Ürün sil
        async function deleteProduct(productId) {
            if (!confirm('Bu ürünü silmek istediğinize emin misiniz? Bu işlem geri alınamaz.')) {
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('products')
                    .delete()
                    .eq('id', productId);
                
                if (error) {
                    throw error;
                }
                
                showNotification('Ürün başarıyla silindi.');
                await loadProducts();
            } catch (error) {
                console.error('Ürün silinirken hata:', error);
                showNotification('Ürün silinirken bir hata oluştu.', 'error');
            }
        }

        // Lojistik modalını aç
        async function openLogisticsModal(logisticsId = null) {
            editingId = logisticsId;
            
            // Sipariş seçeneklerini doldur
            const orderSelect = document.getElementById('logisticsOrder');
            orderSelect.innerHTML = '';
            
            orders.forEach(order => {
                const option = document.createElement('option');
                option.value = order.id;
                option.textContent = order.id;
                orderSelect.appendChild(option);
            });
            
            if (logisticsId) {
                // Düzenleme modu
                const logistic = logistics.find(l => l.id === logisticsId);
                if (!logistic) return;
                
                document.getElementById('logisticsModalTitle').textContent = 'Lojistik Bilgisini Düzenle';
                document.getElementById('logisticsOrder').value = logistic.order_id;
                document.getElementById('logisticsCompany').value = logistic.company || '';
                document.getElementById('logisticsShippingDate').value = logistic.shipping_date || '';
                document.getElementById('logisticsVehiclePlate').value = logistic.vehicle_plate || '';
                document.getElementById('logisticsCost').value = logistic.shipping_cost || 0;
                document.getElementById('logisticsStatus').value = logistic.status || 'Planlanıyor';
                document.getElementById('logisticsDeliveryDate').value = logistic.delivery_date || '';
                document.getElementById('logisticsDeliveredTo').value = logistic.delivered_to || '';
            } else {
                // Ekleme modu
                document.getElementById('logisticsModalTitle').textContent = 'Lojistik Bilgisi Ekle';
                document.getElementById('logisticsOrder').value = '';
                document.getElementById('logisticsCompany').value = '';
                document.getElementById('logisticsShippingDate').value = '';
                document.getElementById('logisticsVehiclePlate').value = '';
                document.getElementById('logisticsCost').value = '';
                document.getElementById('logisticsStatus').value = 'Planlanıyor';
                document.getElementById('logisticsDeliveryDate').value = '';
                document.getElementById('logisticsDeliveredTo').value = '';
            }
            
            logisticsModal.classList.remove('hidden');
        }

        // Lojistik kaydet
        async function saveLogistics() {
            const orderId = document.getElementById('logisticsOrder').value;
            const company = document.getElementById('logisticsCompany').value;
            const shippingDate = document.getElementById('logisticsShippingDate').value;
            const vehiclePlate = document.getElementById('logisticsVehiclePlate').value;
            const cost = parseFloat(document.getElementById('logisticsCost').value) || 0;
            const status = document.getElementById('logisticsStatus').value;
            const deliveryDate = document.getElementById('logisticsDeliveryDate').value;
            const deliveredTo = document.getElementById('logisticsDeliveredTo').value;
            
            if (!orderId) {
                showNotification('Lütfen bir sipariş seçiniz.', 'error');
                return;
            }
            
            try {
                if (editingId) {
                    // Düzenleme
                    const { error } = await supabase
                        .from('logistics')
                        .update({ 
                            order_id: orderId,
                            company,
                            shipping_date: shippingDate,
                            vehicle_plate: vehiclePlate,
                            shipping_cost: cost,
                            status,
                            delivery_date: deliveryDate,
                            delivered_to: deliveredTo
                        })
                        .eq('id', editingId);
                    
                    if (error) {
                        throw error;
                    }
                    
                    showNotification('Lojistik bilgisi başarıyla güncellendi.');
                } else {
                    // Ekleme
                    const { error } = await supabase
                        .from('logistics')
                        .insert([{ 
                            order_id: orderId,
                            company,
                            shipping_date: shippingDate,
                            vehicle_plate: vehiclePlate,
                            shipping_cost: cost,
                            status,
                            delivery_date: deliveryDate,
                            delivered_to: deliveredTo
                        }]);
                    
                    if (error) {
                        throw error;
                    }
                    
                    showNotification('Lojistik bilgisi başarıyla eklendi.');
                }
                
                logisticsModal.classList.add('hidden');
                await loadLogistics();
            } catch (error) {
                console.error('Lojistik bilgisi kaydedilirken hata:', error);
                showNotification('Lojistik bilgisi kaydedilirken bir hata oluştu.', 'error');
            }
        }

        // Lojistik sil
        async function deleteLogistics(logisticsId) {
            if (!confirm('Bu lojistik kaydını silmek istediğinize emin misiniz?')) {
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('logistics')
                    .delete()
                    .eq('id', logisticsId);
                
                if (error) {
                    throw error;
                }
                
                showNotification('Lojistik kaydı başarıyla silindi.');
                await loadLogistics();
            } catch (error) {
                console.error('Lojistik kaydı silinirken hata:', error);
                showNotification('Lojistik kaydı silinirken bir hata oluştu.', 'error');
            }
        }

        // Sekme değiştir
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}Tab`).classList.add('active');
        }

        // Durum sınıfını al
        function getStatusClass(status) {
            switch(status) {
                case 'pending': return 'status-pending';
                case 'approved': return 'status-approved';
                case 'preparing': return 'status-pending';
                case 'shipped': return 'status-shipped';
                case 'delivered': return 'status-delivered';
                case 'cancelled': return 'status-cancelled';
                default: return 'status-pending';
            }
        }

        // Durum metnini al
        function getStatusText(status) {
            switch(status) {
                case 'pending': return 'Beklemede';
                case 'approved': return 'Onaylandı';
                case 'preparing': return 'Hazırlanıyor';
                case 'shipped': return 'Kargoya Verildi';
                case 'delivered': return 'Teslim Edildi';
                case 'cancelled': return 'İptal Edildi';
                default: return 'Beklemede';
            }
        }
    </script>
</body>
</html>