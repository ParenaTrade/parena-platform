<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Voiza SimÃ¼lasyon â€” Market & Restaurant (Demo)</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial; background: linear-gradient(180deg,#f8fafc,#eef2ff); }
  .container { max-width:1100px; margin:24px auto; }
  .card { background:#fff; border-radius:12px; box-shadow:0 8px 30px rgba(2,6,23,0.06); overflow:hidden; }
  .hero { padding:22px; display:flex; align-items:center; justify-content:space-between; gap:16px; }
  .btn { padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600; }
  .btn-prim { background:#0ea5a4; color:white; }
  .btn-voice { background:#2563eb; color:white; }
  .stage { padding:18px; display:grid; grid-template-columns: 1fr 360px; gap:16px; }
  .scene { background: linear-gradient(180deg,#fff,#f8fafc); border-radius:10px; padding:12px; min-height:420px; position:relative; overflow:hidden; }
  .panel { background:#fff; border-radius:10px; padding:12px; box-shadow:0 6px 18px rgba(2,6,23,0.06); }
  .shelf { background:linear-gradient(180deg,#fff,#f1f5f9); border-radius:10px; padding:8px; margin-bottom:12px; box-shadow:0 6px 18px rgba(2,6,23,0.05); display:flex; gap:8px; align-items:center; }
  .prod-thumb { width:62px; height:62px; border-radius:8px; object-fit:cover; }
  .price { font-weight:700; color:#0f172a; }
  .price-tag { position:absolute; right:12px; top:12px; background:#111827; color:#fff; padding:6px 10px; border-radius:8px; transform-origin:center; transition: transform .25s ease; }
  .price-tag.pulse { transform:scale(1.3); }
  .cart-floating { position:fixed; right:18px; bottom:18px; background:#0ea5a4; color:#fff; padding:12px 16px; border-radius:12px; box-shadow:0 12px 30px rgba(2,6,23,0.12); z-index:3000; }
  .floating { position:fixed; right:120px; bottom:120px; width:120px; transition: transform .6s cubic-bezier(.2,.9,.25,1); z-index:3001; display:none; }
  .overlay { position:fixed; left:50%; transform:translateX(-50%); top:18px; background:#fff; padding:10px 14px; border-radius:8px; box-shadow:0 8px 30px rgba(2,6,23,0.08); display:none; z-index:3002;}
  .speech-ind { font-size:13px; color:#334155; }
  .mode-badge { display:inline-block; padding:6px 10px; border-radius:999px; background:#f1f5f9; font-weight:600; }
  .hidden { display:none; }
</style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="hero">
        <div>
          <h1 class="text-2xl font-bold">Voiza SimÃ¼lasyon â€” Market & Restaurant (Demo)</h1>
          <p class="text-sm text-slate-500">Sesi kullan, reyon aÃ§, fiyat sor, miktar sÃ¶yle sepete ekle â€” teyze dostu deneyim.</p>
        </div>
        <div class="flex gap-3 items-center">
          <div id="greeting" class="text-sm text-slate-600">Merhaba AyÅŸe Teyze (demo)</div>
          <button id="btnMarket" class="btn btn-prim">Market</button>
          <button id="btnRestaurant" class="btn btn-prim">Restaurant</button>
          <button id="btnVoice" class="btn btn-voice">ðŸŽ¤ Sesle</button>
        </div>
      </div>

      <div class="stage">
        <!-- Scene -->
        <div class="scene" id="scene">
          <div id="welcomeScreen">
            <img src="https://images.unsplash.com/photo-1507476299244-0a3e9ff9899f?auto=format&fit=crop&w=1400&q=60" alt="" style="width:100%; height:220px; object-fit:cover; border-radius:8px; margin-bottom:12px;">
            <div style="padding:8px 6px;">
              <div class="text-lg font-semibold">HoÅŸgeldiniz! Market veya Restaurant seÃ§in, sonra sesi kullanÄ±n.</div>
              <div class="text-sm text-slate-500 mt-2">Ã–rnek komutlar: "Manav reyonu", "Domates kaÃ§ para", "1 kilo ver", "DÃ¶ner istiyorum", "Et olsun".</div>
            </div>
          </div>

          <!-- Market view -->
          <div id="marketView" class="hidden">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
              <div><h3 class="text-lg font-semibold">Market â€” Reyonlar</h3><div class="text-xs text-slate-500">Sesle reyon aÃ§, Ã¼rÃ¼n sor, sepet eklensin.</div></div>
              <div class="mode-badge" id="currentMode">Mode: Market</div>
            </div>
            <div id="marketShelves">
              <!-- dynamic shelves -->
            </div>
          </div>

          <!-- Restaurant view -->
          <div id="restaurantView" class="hidden">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
              <div><h3 class="text-lg font-semibold">Restaurant â€” MenÃ¼</h3><div class="text-xs text-slate-500">Sesle sipariÅŸ ver, et/tavuk seÃ§, porsiyon belirt.</div></div>
              <div class="mode-badge">Mode: Restaurant</div>
            </div>

            <div id="menuList">
              <!-- dynamic menu -->
            </div>
          </div>

          <div class="price-tag hidden" id="priceTag">0â‚º</div>
        </div>

        <!-- Right panel -->
        <div class="panel">
          <div class="mb-3">
            <div class="flex justify-between items-center">
              <div><strong>Durum</strong></div>
              <div class="speech-ind" id="speechState">Ses: HazÄ±r</div>
            </div>
            <div class="text-xs text-slate-500 mt-2">TuÅŸla veya sesle komut verin. Komut Ã¶rnekleri Ã¼stte.</div>
          </div>

          <div class="mb-3">
            <div class="flex gap-2">
              <input id="manualInput" class="w-full p-2 border rounded" placeholder="Komut yaz (Ã¶r: domates kaÃ§ para)" />
              <button id="btnManual" class="btn btn-prim">Ara</button>
            </div>
          </div>

          <div class="mb-3">
            <h4 class="font-semibold">Sepet</h4>
            <ul id="cartList" class="mt-2 text-sm"></ul>
            <div class="mt-2 flex justify-between items-center">
              <div>Toplam: <span id="cartTotal">0â‚º</span></div>
              <div><button id="checkout" class="btn btn-prim">SipariÅŸi GÃ¶nder</button></div>
            </div>
          </div>

          <div>
            <h4 class="font-semibold">KÄ±sa Komutlar</h4>
            <div class="text-xs text-slate-500 mt-2">
              Market: "Manav reyonu", "SÃ¼t reyonu", "SalÃ§a fiyatÄ± kaÃ§" <br>
              Restaurant: "DÃ¶ner istiyorum", "Et olsun", "1 porsiyon"
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- floating UI -->
    <div class="cart-floating" id="cartBtn">ðŸ›’ Sepet (<span id="cartCount">0</span>)</div>
    <img class="floating" id="floatingImg" src="" alt="floating">

    <div class="overlay" id="overlay"></div>
  </div>

<script>
/* ----------------- Config & Data ----------------- */
const localUser = { name: 'AyÅŸe Teyze' }; // demo personalization

const PRODUCTS = {
  tomato: { id:'tomato', name:'Domates', price:40, unit:'kg', img:'https://images.unsplash.com/photo-1572441710260-e8aa3ca5f0a6?auto=format&fit=crop&w=200&q=60', aisle:'manav' },
  onion: { id:'onion', name:'SoÄŸan', price:9, unit:'kg', img:'https://images.unsplash.com/photo-1580711200959-7b1a0b6be5d8?auto=format&fit=crop&w=200&q=60', aisle:'manav' },
  cheese: { id:'cheese', name:'Beyaz Peynir', price:120, unit:'kg', img:'https://images.unsplash.com/photo-1563431986-7b3d5b8a27b4?auto=format&fit=crop&w=200&q=60', aisle:'sut' },
  paste: { id:'paste', name:'Domates SalÃ§asÄ±', price:95, unit:'2kg', img:'https://images.unsplash.com/photo-1542444459-db8a60b0b96f?auto=format&fit=crop&w=200&q=60', aisle:'kiler' }
};

const MENU = {
  doner: { id:'doner', name:'DÃ¶ner', basePrice:85, variants: ['Et','Tavuk'], img:'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?auto=format&fit=crop&w=400&q=60' },
  pizza: { id:'pizza', name:'Pizza', basePrice:150, variants: ['Klasik','Peynirli'], img:'https://images.unsplash.com/photo-1604908177522-6f4591a9a7e5?auto=format&fit=crop&w=400&q=60' }
};

/* ----------------- State ----------------- */
let mode = null; // 'market' | 'restaurant'
let cart = [];
const $ = id => document.getElementById(id);

/* ----------------- UI init ----------------- */
function showWelcome() {
  $('welcomeScreen').classList.remove('hidden');
  $('marketView').classList.add('hidden');
  $('restaurantView').classList.add('hidden');
  $('priceTag').classList.add('hidden');
}
function openMarket() {
  mode = 'market';
  $('welcomeScreen').classList.add('hidden');
  $('marketView').classList.remove('hidden');
  $('restaurantView').classList.add('hidden');
  $('currentMode').innerText = 'Mode: Market';
  renderMarketShelves();
  speak(`${localUser.name} market seÃ§tiniz. Hangi reyon?`);
}
function openRestaurant() {
  mode = 'restaurant';
  $('welcomeScreen').classList.add('hidden');
  $('marketView').classList.add('hidden');
  $('restaurantView').classList.remove('hidden');
  renderMenu();
  speak(`${localUser.name} restaurant seÃ§tiniz. Ne istersiniz?`);
}
showWelcome();

/* ----------------- Render functions ----------------- */
function renderMarketShelves() {
  const container = $('marketShelves');
  container.innerHTML = '';
  // group by aisle
  const aisles = {};
  Object.values(PRODUCTS).forEach(p => {
    if (!aisles[p.aisle]) aisles[p.aisle] = [];
    aisles[p.aisle].push(p);
  });
  for (const [aisle, items] of Object.entries(aisles)) {
    const sec = document.createElement('div');
    sec.className = 'shelf';
    sec.dataset.aisle = aisle;
    sec.innerHTML = `<div style="flex:1"><strong style="text-transform:capitalize">${aisle}</strong><div class="text-xs text-slate-500">TÄ±klayÄ±n veya sesle aÃ§Ä±n</div></div>`;
    const list = document.createElement('div');
    list.style.display = 'flex'; list.style.flexDirection='column'; list.style.gap='6px';
    items.forEach(it => {
      const row = document.createElement('div');
      row.className = 'prod-row';
      row.style.display='flex'; row.style.gap='8px'; row.style.alignItems='center';
      row.innerHTML = `<img src="${it.img}" class="prod-thumb" alt=""><div><div style="font-weight:600">${it.name}</div><div class="text-xs text-slate-500">${it.unit}</div></div><div style="margin-left:auto" class="price">${it.price}â‚º</div>`;
      row.dataset.prodId = it.id;
      row.onclick = ()=> { addToCart(it.id,1); animatePrice(it.id); };
      list.appendChild(row);
    });
    sec.appendChild(list);
    container.appendChild(sec);
  }
}

function renderMenu() {
  const list = $('menuList');
  list.innerHTML = '';
  Object.values(MENU).forEach(m => {
    const div = document.createElement('div');
    div.className = 'shelf';
    div.innerHTML = `<img src="${m.img}" class="prod-thumb" style="width:72px;height:72px"><div style="margin-left:10px"><div style="font-weight:700">${m.name}</div><div class="text-xs text-slate-500">SeÃ§enek: ${m.variants.join(', ')}</div></div><div style="margin-left:auto" class="price">${m.basePrice}â‚º</div>`;
    div.onclick = ()=> { speak(`${m.name} seÃ§ildi. Et mi tavuk mu istersiniz?`); lastMenuChoice = m; mode = 'restaurant'; };
    list.appendChild(div);
  });
}

/* ----------------- Cart ----------------- */
function addToCart(productId, qty) {
  if (PRODUCTS[productId]) {
    const p = PRODUCTS[productId];
    cart.push({ id:p.id, name:p.name, qty, unit:p.unit, price:p.price });
    updateCartUI();
    showFloating(p.img);
    speak(`${qty} ${p.unit} ${p.name} sepete eklendi efendim`);
  } else {
    // menu
    const m = MENU[productId];
    if (m) {
      const variant = selectedVariant || m.variants[0];
      cart.push({ id:m.id, name:m.name + ' - ' + variant, qty: selectedQty || 1, unit:'porsiyon', price:m.basePrice });
      updateCartUI();
      showFloating(m.img);
      speak(`${selectedQty||1} porsiyon ${m.name} sepete eklendi efendim`);
      selectedQty = null; selectedVariant = null;
    }
  }
}

function updateCartUI() {
  const ul = $('cartList'); ul.innerHTML='';
  let total = 0;
  cart.forEach((it,idx)=>{
    total += it.qty * it.price;
    const li = document.createElement('li');
    li.style.display='flex'; li.style.justifyContent='space-between'; li.style.padding='6px 0';
    li.innerHTML = `<div>${it.qty} x ${it.name}</div><div>${(it.qty*it.price).toFixed(2)}â‚º</div>`;
    ul.appendChild(li);
  });
  $('cartTotal').innerText = total.toFixed(2) + 'â‚º';
  $('cartCount').innerText = cart.length;
}

/* ----------------- Animations ----------------- */
function animatePrice(prodId) {
  // find shelf and pulse
  const prod = Object.values(PRODUCTS).find(p=>p.id===prodId);
  if (!prod) return;
  // find shelf element matching aisle
  const shelf = Array.from(document.querySelectorAll('.shelf')).find(s=>s.dataset.aisle===prod.aisle);
  const tag = $('priceTag');
  tag.innerText = `${prod.price}â‚º`;
  tag.classList.remove('hidden');
  tag.style.left = ''; tag.style.right = '12px';
  tag.classList.add('pulse');
  setTimeout(()=> tag.classList.remove('pulse'),800);
  setTimeout(()=> tag.classList.add('hidden'),1800);
}

function showFloating(src) {
  const f = $('floatingImg'); f.src = src; f.style.display='block';
  f.style.transform='translateY(0)';
  setTimeout(()=> { f.style.transform='translateY(-180px)'; setTimeout(()=> { f.style.display='none'; f.style.transform='translateY(0)'; },700); }, 300);
}

/* ----------------- Voice Recognition ----------------- */
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
let recognition = null;
let lastMenuChoice = null;
let selectedVariant = null;
let selectedQty = null;

if (SpeechRecognition) {
  recognition = new SpeechRecognition();
  recognition.lang = 'tr-TR';
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;
  recognition.onstart = ()=> { $('speechState').innerText = 'Ses: Dinleniyor...'; };
  recognition.onend = ()=> { $('speechState').innerText = 'Ses: HazÄ±r'; };
  recognition.onerror = (e)=> { $('speechState').innerText = 'Ses hatasÄ±'; speak('AnlamadÄ±m, tekrar eder misiniz?'); };
  recognition.onresult = (ev)=> {
    const text = ev.results[0][0].transcript.toLowerCase();
    $('speechState').innerText = 'Duydu: ' + text;
    handleVoice(text);
  };
}

/* start voice */
$('btnVoice').addEventListener('click', ()=> {
  if (!mode) { speak('Ã–nce Market veya Restaurant seÃ§in lÃ¼tfen'); return; }
  if (!recognition) { alert('TarayÄ±cÄ±nÄ±z konuÅŸma tanÄ±mayÄ± desteklemiyor'); return; }
  try { recognition.start(); } catch(e){ console.log(e); speak('Mikrofon baÅŸlatÄ±lamadÄ±'); }
});

/* manual */
$('btnManual').addEventListener('click', ()=> { handleVoice($('manualInput').value.toLowerCase()); $('manualInput').value=''; });

/* mode buttons */
$('btnMarket').addEventListener('click', openMarket);
$('btnRestaurant').addEventListener('click', openRestaurant);

/* checkout */
$('checkout').addEventListener('click', ()=> {
  if (cart.length===0) { alert('Sepet boÅŸ'); return; }
  alert('SipariÅŸ demo: konsola bakÄ±n. (Sunucu endpoint ile kaydedilebilir.)');
  console.log('ORDER PAYLOAD', { user: localUser, cart });
  speak('SipariÅŸiniz kayÄ±t altÄ±na alÄ±ndÄ±. TeÅŸekkÃ¼rler.');
});

/* ----------------- Voice Command Handler ----------------- */
function handleVoice(text) {
  // quick helpers: quantity detection
  const qtyMatch = text.match(/(\d+)\s*(kilo|kg|adet|porsiyon|porsiyon|tane)?/);
  const quantity = qtyMatch ? parseInt(qtyMatch[1]) : null;

  // Market mode commands
  if (mode === 'market') {
    if (text.includes('manav') || text.includes('sebze')) { highlightAisle('manav'); speak('Manav reyonu aÃ§Ä±ldÄ± efendim'); return; }
    if (text.includes('sÃ¼t') || text.includes('peynir')) { highlightAisle('sut'); speak('SÃ¼t reyonu aÃ§Ä±ldÄ± efendim'); return; }
    if (text.includes('salÃ§a') || text.includes('salca')) { highlightAisle('kiler'); speak('Kiler reyonu aÃ§Ä±ldÄ± efendim'); return; }
    // price question
    if (text.includes('kaÃ§') || text.includes('fiyat')) {
      const found = findProductByName(text);
      if (found) { animatePrice(found.id); speak(`${found.name} ÅŸu anda ${found.price} lira efendim`); return; }
      speak('Hangisinin fiyatÄ±nÄ± Ã¶ÄŸrenmek istiyorsunuz?');
      return;
    }
    // add to cart by name
    const found = findProductByName(text);
    if (found) {
      const q = quantity || 1;
      addToCart(found.id, q); animatePrice(found.id);
      return;
    }
    speak('Markette aradÄ±ÄŸÄ±nÄ±zÄ± bulamadÄ±m, tekrar deneyin lÃ¼tfen');
  }

  // Restaurant mode
  if (mode === 'restaurant') {
    if (text.includes('dÃ¶ner') || text.includes('doner')) {
      lastMenuChoice = MENU.doner;
      speak('DÃ¶ner seÃ§tiniz. Et mi tavuk mu olsun?');
      return;
    }
    if ((text.includes('et') || text.includes('tavuk')) && lastMenuChoice) {
      selectedVariant = text.includes('et') ? 'Et' : 'Tavuk';
      speak(`${selectedVariant} seÃ§tiniz. KaÃ§ porsiyon olsun?`);
      return;
    }
    if (quantity && lastMenuChoice && selectedVariant) {
      selectedQty = quantity;
      // add to cart
      addToCart(lastMenuChoice.id, selectedQty);
      // reset menu flow
      lastMenuChoice = null; selectedVariant = null; selectedQty = null;
      return;
    }
    // price ask for menu
    if (text.includes('fiyat') || text.includes('kaÃ§')) {
      const f = Object.values(MENU).find(m=> text.includes(m.name.toLowerCase()) || text.includes('dÃ¶ner'));
      if (f) { speak(`${f.name} fiyatÄ± ${f.basePrice} lira efendim`); return; }
    }
    speak('Restoranda nasÄ±l yardÄ±mcÄ± olayÄ±m?');
  }
}

/* ----------------- Helpers ----------------- */
function findProductByName(text) {
  for (const k in PRODUCTS) {
    const p = PRODUCTS[k];
    if (text.includes(p.name.toLowerCase()) || text.includes(k)) return p;
  }
  return null;
}
function highlightAisle(aisle) {
  const shelf = Array.from(document.querySelectorAll('.shelf')).find(s=>s.dataset.aisle===aisle);
  if (!shelf) { speak('O reyon bulunamadÄ±'); return; }
  shelf.style.boxShadow = '0 18px 40px rgba(14,165,164,0.12)';
  setTimeout(()=> shelf.style.boxShadow='', 2500);
}

/* TTS */
function speak(text) {
  try {
    const u = new SpeechSynthesisUtterance(text);
    u.lang = 'tr-TR';
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(u);
  } catch(e){ console.log(e); }
}

/* initial greeting */
speak('Demoye hoÅŸgeldiniz. Market veya Restaurant seÃ§in, sonra sesle komut verin.');
</script>
</body>
</html>
