<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lead Havuzu - İhracat CRM</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
        }
        
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .lead-module {
            padding: 20px;
        }
        
        .module-header {
            background-color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .module-card {
            border: none;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .module-card-header {
            background-color: white;
            border-bottom: 1px solid #eee;
            font-weight: 600;
            padding: 15px 20px;
        }
        
        .module-card-body {
            padding: 20px;
        }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-new { background-color: #e3f2fd; color: #1565c0; }
        .status-contacted { background-color: #fff3e0; color: #ef6c00; }
        .status-qualified { background-color: #e8f5e9; color: #2e7d32; }
        .status-proposal { background-color: #f3e5f5; color: #7b1fa2; }
        .status-customer { background-color: #e8f5e9; color: #2e7d32; }
        .status-lost { background-color: #ffebee; color: #c62828; }
        
        .priority-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .priority-high { background-color: #ffebee; color: #c62828; }
        .priority-medium { background-color: #fff8e1; color: #ff8f00; }
        .priority-low { background-color: #e8f5e9; color: #2e7d32; }
        
        .btn-primary { 
            background-color: var(--primary-color); 
            border-color: var(--primary-color); 
        }
        
        .btn-primary:hover { 
            background-color: #2980b9; 
            border-color: #2980b9; 
        }
        
        .search-box {
            position: relative;
        }
        
        .search-box input {
            padding-left: 40px;
            border-radius: 20px;
        }
        
        .search-box i {
            position: absolute;
            left: 15px;
            top: 12px;
            color: #6c757d;
        }
        
        .lead-card {
            border-left: 4px solid var(--primary-color);
            transition: all 0.3s ease;
        }
        
        .lead-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .interaction-timeline {
            border-left: 2px solid var(--primary-color);
            margin-left: 10px;
            padding-left: 20px;
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 20px;
        }
        
        .timeline-item:before {
            content: '';
            position: absolute;
            left: -26px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--primary-color);
        }
        
        .user-info {
            background-color: rgba(0, 0, 0, 0.05);
            padding: 10px 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <!-- Lead Havuzu Modülü -->
    <div class="lead-module">
        <!-- Başlık ve Arama -->
        <div class="module-header d-flex justify-content-between align-items-center">
            <h4 class="mb-0"><i class="fas fa-users me-2"></i>Lead Havuzu</h4>
            <div class="d-flex">
                <div class="search-box me-2">
                    <i class="fas fa-search"></i>
                    <input type="text" class="form-control" placeholder="Lead ara..." id="searchLead">
                </div>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newLeadModal">
                    <i class="fas fa-plus me-1"></i> Yeni Lead
                </button>
            </div>
        </div>

        <!-- Kullanıcı Bilgileri -->
        <div class="user-info">
            <i class="fas fa-user me-1"></i> <span id="userName">Kullanıcı Yükleniyor...</span>
            <span class="badge bg-primary ms-2" id="userRole"></span>
        </div>

        <!-- Filtreler -->
        <div class="module-card">
            <div class="module-card-body">
                <div class="row">
                    <div class="col-md-3">
                        <label class="form-label">Durum</label>
                        <select class="form-select" id="statusFilter">
                            <option value="">Tümü</option>
                            <option value="new">Yeni</option>
                            <option value="contacted">İletişime Geçildi</option>
                            <option value="qualified">Kalifiye</option>
                            <option value="proposal">Teklif Verildi</option>
                            <option value="customer">Müşteri Oldu</option>
                            <option value="lost">Kaybedildi</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Öncelik</label>
                        <select class="form-select" id="priorityFilter">
                            <option value="">Tümü</option>
                            <option value="high">Yüksek</option>
                            <option value="medium">Orta</option>
                            <option value="low">Düşük</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Kaynak</label>
                        <select class="form-select" id="sourceFilter">
                            <option value="">Tümü</option>
                            <option value="website">Web Sitesi</option>
                            <option value="referral">Referans</option>
                            <option value="social_media">Sosyal Medya</option>
                            <option value="event">Etkinlik</option>
                            <option value="other">Diğer</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Ülke</label>
                        <input type="text" class="form-control" id="countryFilter" placeholder="Ülke adı">
                    </div>
                </div>
            </div>
        </div>

        <!-- Lead Listesi -->
        <div class="module-card">
            <div class="module-card-header d-flex justify-content-between align-items-center">
                <span>Lead Listesi</span>
                <small>Toplam <strong id="totalLeads">0</strong> lead</small>
            </div>
            <div class="module-card-body">
                <div class="row" id="leadsContainer">
                    <div class="col-12 text-center py-4">
                        <div class="spinner-border text-primary"></div>
                        <p class="mt-2">Leadler yükleniyor...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Yeni Lead Modal -->
    <div class="modal fade" id="newLeadModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Yeni Lead Ekle</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="newLeadForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Şirket Adı <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="leadCompany" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Yetkili Kişi <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="leadContactPerson" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">E-posta</label>
                                <input type="email" class="form-control" id="leadEmail">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Telefon</label>
                                <input type="tel" class="form-control" id="leadPhone">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Ülke <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="leadCountry" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Web Sitesi</label>
                                <input type="url" class="form-control" id="leadWebsite" placeholder="https://">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Durum</label>
                                <select class="form-select" id="leadStatus">
                                    <option value="new">Yeni</option>
                                    <option value="contacted">İletişime Geçildi</option>
                                    <option value="qualified">Kalifiye</option>
                                    <option value="proposal">Teklif Verildi</option>
                                    <option value="customer">Müşteri Oldu</option>
                                    <option value="lost">Kaybedildi</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Öncelik</label>
                                <select class="form-select" id="leadPriority">
                                    <option value="low">Düşük</option>
                                    <option value="medium" selected>Orta</option>
                                    <option value="high">Yüksek</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Kaynak</label>
                                <select class="form-select" id="leadSource">
                                    <option value="website">Web Sitesi</option>
                                    <option value="referral">Referans</option>
                                    <option value="social_media">Sosyal Medya</option>
                                    <option value="event">Etkinlik</option>
                                    <option value="other">Diğer</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">İlgilendiği Ürün/Hizmet</label>
                                <input type="text" class="form-control" id="leadProductInterest">
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Notlar</label>
                                <textarea class="form-control" id="leadNotes" rows="3"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                    <button type="button" class="btn btn-primary" id="saveLeadBtn">Lead Kaydet</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Lead Detay Modal -->
    <div class="modal fade" id="leadDetailModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Lead Detayları</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="leadDetailContent">
                        <!-- Lead detayları buraya dinamik olarak yüklenecek -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
                    <button type="button" class="btn btn-primary" id="editLeadBtn">Düzenle</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap & jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Supabase yapılandırması - BU BİLGİLERİ KENDİ PROJENİZLE DEĞİŞTİRİN
        const supabaseUrl = "https://xliutvspwodhoaxvysks.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhsaXV0dnNwd29kaG9heHZ5c2tzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTczNTgyOTksImV4cCI6MjA3MjkzNDI5OX0.Zodisa_ifP8t2Q4X0ecnB56RiR_Bg4QS5gvPn5ZLK_w";
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);
        
        // Global değişkenler
        let currentUser = null;
        let currentUserId = null;
        let currentUserRole = null;
        let selectedLeadId = null;
        
        // DOM yüklendikten sonra çalışacak kodlar
        $(document).ready(function() {
            // Oturum durumunu kontrol et
            checkSession();
            
            // Filtre değişikliklerini dinle
            $('#statusFilter, #priorityFilter, #sourceFilter, #countryFilter').change(function() {
                loadLeads();
            });
            
            // Arama kutusu dinleyicisi
            $('#searchLead').on('keyup', function() {
                loadLeads();
            });
            
            // Lead kaydetme butonu
            $('#saveLeadBtn').click(function() {
                saveNewLead();
            });
            
            // Lead düzenleme butonu
            $('#editLeadBtn').click(function() {
                if (selectedLeadId) {
                    editLead(selectedLeadId);
                }
            });
        });
        
        // Oturum kontrolü
        async function checkSession() {
            const { data, error } = await supabase.auth.getSession();
            
            if (error) {
                console.error('Oturum kontrolü hatası:', error);
                window.location.href = "..login.html";
                return;
            }
            
            if (data.session) {
                currentUser = data.session.user;
                currentUserId = data.session.user.id;
                await loadUserData(currentUserId);
                loadLeads();
            } else {
                window.location.href = "..login.html";
            }
        }
        
        // Kullanıcı verilerini yükle
        async function loadUserData(userId) {
            const { data, error } = await supabase
                .from('users')
                .select('*')
                .eq('id', userId)
                .single();
                
            if (error) {
                console.error('Kullanıcı verisi alınırken hata oluştu:', error);
                return;
            }
            
            currentUserRole = data.role;
            $("#userName").text(data.name || data.email);
            $("#userRole").text(currentUserRole === 'admin' ? 'Yönetici' : 'Satıcı');
        }
        
        // Leadleri yükle
        async function loadLeads() {
            try {
                let query = supabase
                    .from('leads')
                    .select('*');
                
                // Eğer kullanıcı admin değilse, sadece kendi leadlerini çek
                if (currentUserRole === 'seller') {
                    query = query.eq('assigned_to', currentUserId);
                }
                
                // Durum filtresi
                const statusFilter = $('#statusFilter').val();
                if (statusFilter) {
                    query = query.eq('status', statusFilter);
                }
                
                // Öncelik filtresi
                const priorityFilter = $('#priorityFilter').val();
                if (priorityFilter) {
                    query = query.eq('priority', priorityFilter);
                }
                
                // Kaynak filtresi
                const sourceFilter = $('#sourceFilter').val();
                if (sourceFilter) {
                    query = query.eq('source', sourceFilter);
                }
                
                // Ülke filtresi
                const countryFilter = $('#countryFilter').val();
                if (countryFilter) {
                    query = query.ilike('country', `%${countryFilter}%`);
                }
                
                // Arama filtresi
                const searchTerm = $('#searchLead').val();
                if (searchTerm) {
                    query = query.or(`company.ilike.%${searchTerm}%,contact_person.ilike.%${searchTerm}%,email.ilike.%${searchTerm}%`);
                }
                
                // Sıralama ve verileri çek
                const { data: leads, error } = await query
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                const leadsContainer = $('#leadsContainer');
                leadsContainer.empty();
                
                if (!leads || leads.length === 0) {
                    leadsContainer.html(`
                        <div class="col-12 text-center py-4">
                            <i class="fas fa-users fa-3x text-muted mb-3"></i>
                            <p class="text-muted">Henüz lead bulunmamaktadır.</p>
                            <button class="btn btn-primary mt-2" data-bs-toggle="modal" data-bs-target="#newLeadModal">
                                <i class="fas fa-plus me-1"></i> Yeni Lead Ekle
                            </button>
                        </div>
                    `);
                    $('#totalLeads').text('0');
                    return;
                }
                
                $('#totalLeads').text(leads.length);
                
                leads.forEach(lead => {
                    // Tarih formatlama
                    const createdDate = lead.created_at ? new Date(lead.created_at).toLocaleDateString('tr-TR') : '-';
                    
                    // Durum badge'i
                    let statusClass = '';
                    let statusText = '';
                    
                    switch(lead.status) {
                        case 'new':
                            statusClass = 'status-new';
                            statusText = 'Yeni';
                            break;
                        case 'contacted':
                            statusClass = 'status-contacted';
                            statusText = 'İletişime Geçildi';
                            break;
                        case 'qualified':
                            statusClass = 'status-qualified';
                            statusText = 'Kalifiye';
                            break;
                        case 'proposal':
                            statusClass = 'status-proposal';
                            statusText = 'Teklif Verildi';
                            break;
                        case 'customer':
                            statusClass = 'status-customer';
                            statusText = 'Müşteri Oldu';
                            break;
                        case 'lost':
                            statusClass = 'status-lost';
                            statusText = 'Kaybedildi';
                            break;
                        default:
                            statusClass = 'status-new';
                            statusText = 'Yeni';
                    }
                    
                    // Öncelik badge'i
                    let priorityClass = '';
                    let priorityText = '';
                    
                    switch(lead.priority) {
                        case 'high':
                            priorityClass = 'priority-high';
                            priorityText = 'Yüksek';
                            break;
                        case 'medium':
                            priorityClass = 'priority-medium';
                            priorityText = 'Orta';
                            break;
                        case 'low':
                            priorityClass = 'priority-low';
                            priorityText = 'Düşük';
                            break;
                        default:
                            priorityClass = 'priority-medium';
                            priorityText = 'Orta';
                    }
                    
                    const leadCard = `
                        <div class="col-md-6 col-lg-4 mb-4">
                            <div class="card lead-card h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <h5 class="card-title mb-0">${lead.company || 'İsimsiz Şirket'}</h5>
                                        <span class="priority-badge ${priorityClass}">${priorityText}</span>
                                    </div>
                                    <h6 class="card-subtitle mb-2 text-muted">${lead.contact_person || 'İsimsiz Yetkili'}</h6>
                                    <p class="card-text">
                                        <i class="fas fa-map-marker-alt me-1"></i> ${lead.country || 'Belirtilmemiş'}<br>
                                        ${lead.email ? `<i class="fas fa-envelope me-1"></i> ${lead.email}<br>` : ''}
                                        ${lead.phone ? `<i class="fas fa-phone me-1"></i> ${lead.phone}` : ''}
                                    </p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="status-badge ${statusClass}">${statusText}</span>
                                        <small class="text-muted">${createdDate}</small>
                                    </div>
                                </div>
                                <div class="card-footer bg-transparent">
                                    <button class="btn btn-sm btn-outline-primary view-lead-detail" data-id="${lead.id}">
                                        <i class="fas fa-eye me-1"></i> Detay
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary edit-lead" data-id="${lead.id}">
                                        <i class="fas fa-edit me-1"></i> Düzenle
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    leadsContainer.append(leadCard);
                });
                
                // Lead detay butonlarına event listener ekle
                $('.view-lead-detail').click(function() {
                    const leadId = $(this).data('id');
                    viewLeadDetail(leadId);
                });
                
                $('.edit-lead').click(function() {
                    const leadId = $(this).data('id');
                    editLead(leadId);
                });
            } catch (error) {
                console.error("Leadler yüklenirken hata oluştu: ", error);
                $('#leadsContainer').html(`
                    <div class="col-12 text-center py-4">
                        <i class="fas fa-exclamation-triangle fa-3x text-danger mb-3"></i>
                        <p class="text-danger">Leadler yüklenirken hata oluştu.</p>
                        <button class="btn btn-primary mt-2" onclick="loadLeads()">
                            <i class="fas fa-redo me-1"></i> Tekrar Dene
                        </button>
                    </div>
                `);
            }
        }
        
        // Yeni lead kaydet
        async function saveNewLead() {
            // Form verilerini topla
            const leadData = {
                company: $("#leadCompany").val(),
                contact_person: $("#leadContactPerson").val(),
                email: $("#leadEmail").val(),
                phone: $("#leadPhone").val(),
                country: $("#leadCountry").val(),
                website: $("#leadWebsite").val(),
                status: $("#leadStatus").val(),
                priority: $("#leadPriority").val(),
                source: $("#leadSource").val(),
                product_interest: $("#leadProductInterest").val(),
                notes: $("#leadNotes").val(),
                assigned_to: currentUserId,
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString()
            };
            
            // Gerekli alanların kontrolü
            if (!leadData.company || !leadData.contact_person || !leadData.country) {
                alert("Lütfen zorunlu alanları doldurunuz!");
                return;
            }
            
            // Submit butonunu devre dışı bırak
            $("#saveLeadBtn").prop("disabled", true).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Kaydediliyor...');
            
            try {
                // Supabase'e kaydet
                const { data, error } = await supabase
                    .from('leads')
                    .insert([leadData])
                    .select();
                
                if (error) throw error;
                
                alert("Lead başarıyla kaydedildi!");
                $('#newLeadModal').modal('hide');
                $("#newLeadForm")[0].reset();
                loadLeads();
            } catch (error) {
                console.error("Lead kaydedilirken hata oluştu: ", error);
                alert("Lead kaydedilirken hata oluştu: " + error.message);
            } finally {
                // Submit butonunu tekrar etkinleştir
                $("#saveLeadBtn").prop("disabled", false).html('Lead Kaydet');
            }
        }
        
        // Lead detaylarını görüntüle
        async function viewLeadDetail(leadId) {
            try {
                const { data: lead, error } = await supabase
                    .from('leads')
                    .select('*')
                    .eq('id', leadId)
                    .single();
                
                if (error) throw error;
                
                selectedLeadId = leadId;
                
                // Durum badge'i
                let statusClass = '';
                let statusText = '';
                
                switch(lead.status) {
                    case 'new':
                        statusClass = 'status-new';
                        statusText = 'Yeni';
                        break;
                    case 'contacted':
                        statusClass = 'status-contacted';
                        statusText = 'İletişime Geçildi';
                        break;
                    case 'qualified':
                        statusClass = 'status-qualified';
                        statusText = 'Kalifiye';
                        break;
                    case 'proposal':
                        statusClass = 'status-proposal';
                        statusText = 'Teklif Verildi';
                        break;
                    case 'customer':
                        statusClass = 'status-customer';
                        statusText = 'Müşteri Oldu';
                        break;
                    case 'lost':
                        statusClass = 'status-lost';
                        statusText = 'Kaybedildi';
                        break;
                    default:
                        statusClass = 'status-new';
                        statusText = 'Yeni';
                }
                
                // Öncelik badge'i
                let priorityClass = '';
                let priorityText = '';
                
                switch(lead.priority) {
                    case 'high':
                        priorityClass = 'priority-high';
                        priorityText = 'Yüksek';
                        break;
                    case 'medium':
                        priorityClass = 'priority-medium';
                        priorityText = 'Orta';
                        break;
                    case 'low':
                        priorityClass = 'priority-low';
                        priorityText = 'Düşük';
                        break;
                    default:
                        priorityClass = 'priority-medium';
                        priorityText = 'Orta';
                }
                
                // Tarih formatlama
                const createdDate = lead.created_at ? new Date(lead.created_at).toLocaleDateString('tr-TR') : '-';
                const updatedDate = lead.updated_at ? new Date(lead.updated_at).toLocaleDateString('tr-TR') : '-';
                
                // Modal içeriğini oluştur
                const leadDetailContent = `
                    <div class="row">
                        <div class="col-md-6">
                            <h5>Şirket Bilgileri</h5>
                            <p><strong>Şirket Adı:</strong> ${lead.company || 'Belirtilmemiş'}</p>
                            <p><strong>Yetkili Kişi:</strong> ${lead.contact_person || 'Belirtilmemiş'}</p>
                            <p><strong>Ülke:</strong> ${lead.country || 'Belirtilmemiş'}</p>
                            <p><strong>Web Sitesi:</strong> ${lead.website ? `<a href="${lead.website}" target="_blank">${lead.website}</a>` : 'Belirtilmemiş'}</p>
                        </div>
                        <div class="col-md-6">
                            <h5>İletişim Bilgileri</h5>
                            <p><strong>E-posta:</strong> ${lead.email || 'Belirtilmemiş'}</p>
                            <p><strong>Telefon:</strong> ${lead.phone || 'Belirtilmemiş'}</p>
                            <p><strong>Kaynak:</strong> ${getSourceText(lead.source)}</p>
                            <p><strong>İlgilendiği Ürün/Hizmet:</strong> ${lead.product_interest || 'Belirtilmemiş'}</p>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <h5>Durum Bilgileri</h5>
                            <p><strong>Durum:</strong> <span class="status-badge ${statusClass}">${statusText}</span></p>
                            <p><strong>Öncelik:</strong> <span class="priority-badge ${priorityClass}">${priorityText}</span></p>
                        </div>
                        <div class="col-md-6">
                            <h5>Sistem Bilgileri</h5>
                            <p><strong>Oluşturulma Tarihi:</strong> ${createdDate}</p>
                            <p><strong>Son Güncelleme:</strong> ${updatedDate}</p>
                        </div>
                    </div>
                    
                    ${lead.notes ? `
                    <div class="row mt-3">
                        <div class="col-12">
                            <h5>Notlar</h5>
                            <div class="border p-3 rounded">${lead.notes}</div>
                        </div>
                    </div>
                    ` : ''}
                `;
                
                $('#leadDetailContent').html(leadDetailContent);
                $('#leadDetailModal').modal('show');
            } catch (error) {
                console.error("Lead detayları alınırken hata oluştu: ", error);
                alert("Lead detayları alınırken hata oluştu: " + error.message);
            }
        }
        
        // Kaynak metnini al
        function getSourceText(source) {
            switch(source) {
                case 'website': return 'Web Sitesi';
                case 'referral': return 'Referans';
                case 'social_media': return 'Sosyal Medya';
                case 'event': return 'Etkinlik';
                case 'other': return 'Diğer';
                default: return source || 'Belirtilmemiş';
            }
        }
        
        // Lead düzenle
        function editLead(leadId) {
            // Bu fonksiyon lead düzenleme modalını açacak
            alert(leadId + " ID'li lead düzenlenecek. Bu kısım geliştirme aşamasındadır.");
            // Lead düzenleme modalını aç ve ilgili lead bilgilerini yükle
        }
    </script>
</body>

</html>
