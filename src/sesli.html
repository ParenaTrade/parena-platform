<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sesli Sipari≈ü Sistemi - Onur Market</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .banner {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            text-align: center;
            padding: 40px 20px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
        }
        
        .banner h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .banner p {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        .banner-button {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .banner-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .hidden {
            display: none !important;
        }		
.test-button {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 10001;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.4);
        }
        :root {
            --primary: #003dff;
            --secondary: #00c2ff;
            --accent: #ff5c00;
            --dark: #1a1a1a;
            --light: #f8f9fa;
            --gray: #6c757d;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --border-radius: 12px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            line-height: 1.6;
        }

        /* Header Styles */
        header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
        }

        .logo i {
            margin-right: 10px;
            color: var(--accent);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .order-summary {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f0f7ff;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
        }

        .order-summary:hover {
            background: #e1f0ff;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .order-count {
            background: var(--accent);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Location Marker */
        .locations-marker {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #e3f2fd;
            padding: 10px 15px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            border: 2px solid #2196f3;
            transition: var(--transition);
            user-select: none;
        }

        .locations-marker:hover {
            background: #bbdefb;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }

        /* Test Button */
        .test-button {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 10001;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.4);
        }
        :root {
            --primary: #003dff;
            --secondary: #00c2ff;
            --accent: #ff5c00;
            --dark: #1a1a1a;
            --light: #f8f9fa;
            --gray: #6c757d;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --border-radius: 12px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            line-height: 1.6;
        }

        /* Header Styles */
        header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
        }

        .logo i {
            margin-right: 10px;
            color: var(--accent);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .order-summary {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f0f7ff;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
        }

        .order-summary:hover {
            background: #e1f0ff;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .order-count {
            background: var(--accent);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Location Marker */
        .locations-marker {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #e3f2fd;
            padding: 10px 15px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            border: 2px solid #2196f3;
            transition: var(--transition);
            user-select: none;
        }

        .locations-marker:hover {
            background: #bbdefb;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }

        /* Profile Dropdown */
        .profile-info {
            position: relative;
        }

        .profile-btn {
            background: none;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 20px;
            transition: background 0.3s;
        }

        .profile-btn:hover {
            background: #f0f0f0;
        }

        .profile-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 15px;
            width: 250px;
            display: none;
            z-index: 10;
        }

        .profile-dropdown.show {
            display: block;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .profile-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .profile-details {
            font-size: 14px;
        }

        .profile-name {
            font-weight: 600;
        }

        .profile-phone {
            color: var(--gray);
        }

        /* Microphone Toggle */
        .microphone-toggle {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
        }

        .microphone-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .microphone-toggle.listening {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 92, 0, 0.6); }
            70% { box-shadow: 0 0 0 15px rgba(255, 92, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 92, 0, 0); }
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow);
            transform: translateY(-20px);
            transition: var(--transition);
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .close-modal {
            cursor: pointer;
            font-size: 24px;
            color: var(--gray);
            transition: var(--transition);
        }

        .close-modal:hover {
            color: var(--dark);
        }

        /* Location Options */
        .location-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 15px;
        }

        .location-option {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: var(--transition);
            background: white;
        }

        .location-option:hover {
            border-color: var(--primary);
            background: #f0f7ff;
            transform: translateY(-2px);
        }

        .location-option.selected {
            border-color: var(--primary);
            background: #f0f7ff;
        }

        /* Main Content */
        .main-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            flex: 1;
        }

        .section-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--dark);
        }

        /* How it works banner */
        .how-it-works {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }

        .how-it-works h2 {
            font-size: 28px;
            margin-bottom: 20px;
        }

        .steps {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
        }

        .step {
            flex: 1;
            min-width: 200px;
            max-width: 250px;
        }

        .step-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }

        .step h3 {
            font-size: 18px;
            margin-bottom: 10px;
        }

        /* Seller Type Grid */
        .seller-type-container {
            position: relative;
            margin-bottom: 30px;
        }

        .seller-type-grid {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding: 10px 0;
            scroll-behavior: smooth;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .seller-type-grid::-webkit-scrollbar {
            display: none;
        }

        .seller-type-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            min-width: 150px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border: 2px solid transparent;
            flex-shrink: 0;
        }

        .seller-type-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .seller-type-card.selected {
            border-color: var(--primary);
            background: #f0f7ff;
        }

        .seller-type-icon {
            font-size: 32px;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .seller-type-name {
            font-weight: 600;
            font-size: 16px;
        }

        /* Categories/Reyons Grid */
        .categories-container {
            position: relative;
            margin-bottom: 30px;
        }

        .categories-grid {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding: 10px 0;
            scroll-behavior: smooth;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .categories-grid::-webkit-scrollbar {
            display: none;
        }

        .category-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            min-width: 150px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border: 2px solid transparent;
            flex-shrink: 0;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .category-card.selected {
            border-color: var(--success);
            background: #f0fff4;
        }

        .category-icon {
            font-size: 32px;
            margin-bottom: 10px;
            color: var(--success);
        }

        .category-name {
            font-weight: 600;
            font-size: 16px;
        }

        /* Seller Grid */
        .sellers-container {
            position: relative;
            margin-bottom: 30px;
        }

        .seller-grid {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding: 10px 0;
            scroll-behavior: smooth;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .seller-grid::-webkit-scrollbar {
            display: none;
        }

        .seller-card {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border: 2px solid transparent;
            min-width: 200px;
            flex-shrink: 0;
        }

        .seller-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .seller-card.selected {
            border-color: var(--success);
            background: #f0fff4;
        }

        .seller-card.disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        .seller-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }

        .seller-info {
            padding: 15px;
        }

        .seller-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .seller-details {
            font-size: 14px;
            color: var(--gray);
            display: flex;
            justify-content: space-between;
        }

        /* Products Grid */
        .products-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .products-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }

        .product-card {
            background: #f9f9f9;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .product-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--accent);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .product-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }

        .product-info {
            padding: 10px;
        }

        .product-name {
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .product-price {
            font-weight: 600;
            color: var(--primary);
        }

        .product-discount {
            color: #ef4444;
            font-size: 12px;
            text-decoration: line-through;
            margin-left: 5px;
        }

        /* Cart Section */
        .cart-container {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100%;
            background: white;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        .cart-container.open {
            right: 0;
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .cart-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .cart-item-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cart-item-image {
            width: 40px;
            height: 40px;
            border-radius: 5px;
            object-fit: cover;
        }

        .cart-item-details {
            font-size: 14px;
        }

        .cart-item-name {
            font-weight: 500;
        }

        .cart-item-price {
            color: var(--gray);
            font-size: 12px;
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            border: 1px solid #ddd;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .cart-totals {
            border-top: 1px solid #eee;
            padding: 20px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .total-final {
            font-weight: 600;
            font-size: 18px;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }

        .payment-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
            padding: 0 20px 20px;
        }

        .payment-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .payment-btn.cash {
            background: var(--success);
            color: white;
        }

        .payment-btn.card {
            background: var(--primary);
            color: white;
        }

        .payment-btn.bonus {
            background: var(--accent);
            color: white;
            grid-column: 1 / -1;
        }

        .payment-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        /* Footer */
        footer {
            background: var(--dark);
            color: white;
            padding: 30px 0;
            margin-top: auto;
        }

        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .footer-section h3 {
            margin-bottom: 15px;
            font-size: 18px;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 8px;
        }

        .footer-links a {
            color: #ccc;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-links a:hover {
            color: white;
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .social-link {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            transition: background 0.3s;
        }

        .social-link:hover {
            background: var(--primary);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            margin-top: 20px;
            border-top: 1px solid #444;
            font-size: 14px;
            color: #aaa;
        }

        /* Voice Assistant */
        .voice-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 300px;
            z-index: 100;
            display: block;
        }

        .status-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e5e7eb;
        }

        .status-title {
            display: flex;
            align-items: center;
            font-weight: 600;
            color: #1f2937;
        }

        .status-title i {
            margin-right: 8px;
            color: var(--accent);
        }

        .status-close {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            color: #6b7280;
        }

        .status-content {
            margin-bottom: 15px;
        }

        .assistant-message {
            padding: 12px;
            background: #f0f9ff;
            border-radius: 8px;
            margin-bottom: 10px;
            color: #374151;
        }

        .user-message {
            padding: 12px;
            background: #dbeafe;
            border-radius: 8px;
            text-align: right;
            color: var(--primary);
        }

        .voice-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 30px;
            margin-top: 10px;
        }

        .voice-bar {
            width: 6px;
            height: 10px;
            background: #ddd;
            margin: 0 3px;
            border-radius: 3px;
        }

        .listening .voice-bar {
            animation: voiceIndicator 0.8s infinite;
        }

        @keyframes voiceIndicator {
            0%, 100% { height: 10px; background: #ddd; }
            50% { height: 30px; background: var(--accent); }
        }

        /* Scroll Buttons */
        .scroll-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
            cursor: pointer;
            z-index: 10;
            transition: var(--transition);
        }

        .scroll-btn:hover {
            background: #f0f0f0;
        }

        .scroll-btn.left {
            left: -20px;
        }

        .scroll-btn.right {
            right: -20px;
        }

        /* Utility Classes */
        .text-center {
            text-align: center;
        }

        .text-gray {
            color: var(--gray);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .order-summary {
                order: 3;
                width: 100%;
                justify-content: center;
            }
            
            .seller-type-grid, .categories-grid, .seller-grid {
                flex-wrap: nowrap;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
            
            .payment-buttons {
                grid-template-columns: 1fr;
            }
            
            .steps {
                flex-direction: column;
                align-items: center;
            }
            
            .step {
                max-width: 100%;
            }
            
            .cart-container {
                width: 100%;
                right: -100%;
            }
            
            .scroll-btn {
                display: none;
            }
            
            .voice-status {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
            }
        }

        @media (max-width: 480px) {
            .header-container {
                padding: 10px 15px;
            }
            
            .logo {
                font-size: 20px;
            }
            
            .microphone-toggle span {
                display: none;
            }
            
            .main-container {
                padding: 0 15px;
            }
            
            .section-title {
                font-size: 20px;
            }
            
            .how-it-works {
                padding: 20px;
            }
            
            .how-it-works h2 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
   </head>
<body>
    <!-- Header -->
    <header>
        <div class="header-container">
            <div class="logo">
                <i class="fas fa-utensils"></i>
                <span>Sesli Sipari≈ü</span>
            </div>
            
            <!-- Konum Se√ßici -->
            <div class="locations-marker" id="locationsMarker">
                <i class="fas fa-map-marker-alt"></i>
                <span id="locationsText">Konumunuzu se√ßin</span>
            </div>
            
            <div class="header-actions">
                <div class="order-summary" id="orderSummary" style="display: none;">
                    <div class="order-count" id="orderCount">0</div>
                    <div>Sipari≈ü: <span id="orderTotal">0 ‚Ç∫</span></div>
                </div>
                
                <div class="profile-info">
                    <button class="profile-btn" id="profileBtn">
                        <i class="fas fa-user"></i>
                        <span id="userName">Profilim</span>
                    </button>
                    <div class="profile-dropdown" id="profileDropdown">
                        <div class="profile-header">
                            <div class="profile-avatar" id="profileAvatar">OM</div>
                            <div class="profile-details">
                                <div class="profile-name" id="profileName">-</div>
                                <div class="profile-phone" id="profilePhone">-</div>
                            </div>
                        </div>
                        <div class="profile-info-item">
                            <strong>≈ûehir:</strong> <span id="profileCity">-</span>
                        </div>
                        <div class="profile-info-item">
                            <strong>Adres:</strong> <span id="profileAddress">-</span>
                        </div>
                        <div class="profile-info-item">
                            <strong>Bonus:</strong> <span id="profileBonus">0 ‚Ç∫</span>
                        </div>
                        <button class="logout-btn" id="logoutBtn" style="margin-top: 15px; width: 100%;">
                            <i class="fas fa-sign-out-alt"></i>
                            √áƒ±kƒ±≈ü Yap
                        </button>
                    </div>
                </div>

                <button id="microphoneToggle" class="microphone-toggle">
                    <i class="fas fa-microphone-slash"></i>
                    <span>Mikrofon (Kapalƒ±)</span>
                </button>
            </div>
        </div>
    </header>
    <!-- Konum Modal'ƒ± -->
    <div id="locationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Konum Se√ßiniz</h3>
                <span class="close-modal" id="closeLocationModal">&times;</span>
            </div>
            <p>L√ºtfen sipari≈ü vermek istediƒüiniz konumu se√ßin:</p>
            <div class="location-options">
                <div class="location-option" data-location="inside">
                    <i class="fas fa-utensils"></i>
                    <span>Restoran i√ßinde</span>
                </div>
                <div class="location-option" data-location="takeaway">
                    <i class="fas fa-utensils"></i>
                    <span>Paket servis</span>
                </div>
                <div class="location-option" data-location="delivery">
                    <i class="fas fa-motorcycle"></i>
                    <span>Adrese teslim</span>
                </div>
            </div>
        </div>
    </div>

  <!-- Konum Modal'ƒ± -->
    <div id="locationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Konum Se√ßiniz</h3>
                <span class="close-modal">&times;</span>
            </div>
            <p>L√ºtfen sipari≈ü vermek istediƒüiniz konumu se√ßin:</p>
            <div class="location-options">
                <div class="location-option" data-location="inside">
                    <i class="fas fa-utensils"></i>
                    <span>Restoran i√ßinde</span>
                </div>
                <div class="location-option" data-location="takeaway">
                    <i class="fas fa-utensils"></i>
                    <span>Paket servis</span>
                </div>
                <div class="location-option" data-location="delivery">
                    <i class="fas fa-motorcycle"></i>
                    <span>Adrese teslim</span>
                </div>
            </div>
        </div>
    </div>
       <!-- Seller Type Selection -->
        <section>
            <h2 class="section-title">Ne yemek istersiniz?</h2>
            <div class="seller-type-container">
                <button class="scroll-btn left" id="scrollSellerTypesLeft">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="seller-type-grid" id="sellerTypeGrid">
                    <!-- Satƒ±cƒ± tipleri buraya y√ºklenecek -->
                </div>
                <button class="scroll-btn right" id="scrollSellerTypesRight">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </section>

        <!-- Sellers Grid -->
        <section id="sellersSection" style="display: none;">
            <h2 class="section-title">Size En Yakƒ±n Yerler</h2>
            <div class="sellers-container">
                <button class="scroll-btn left" id="scrollSellersLeft">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="seller-grid" id="sellerGrid">
                    <!-- Satƒ±cƒ±lar buraya y√ºklenecek -->
                </div>
                <button class="scroll-btn right" id="scrollSellersRight">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </section>

        <!-- Categories/Reyons Grid -->
        <section id="categoriesSection" style="display: none;">
            <h2 class="section-title" id="categoriesTitle">Kategoriler</h2>
            <div class="categories-container">
                <button class="scroll-btn left" id="scrollCategoriesLeft">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="categories-grid" id="categoriesGrid">
                    <!-- Kategoriler/Reyonlar buraya y√ºklenecek -->
                </div>
                <button class="scroll-btn right" id="scrollCategoriesRight">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </section>

        <!-- Products Grid -->
        <section class="products-section" id="productsSection" style="display: none;">
            <div class="products-header">
                <h2 class="section-title" style="margin-bottom: 0;">√úr√ºnler</h2>
                <div id="selectedSellerInfo" class="text-gray">Satƒ±cƒ± se√ßilmedi</div>
            </div>
            <div class="products-grid" id="productsGrid">
                <!-- √úr√ºnler buraya y√ºklenecek -->
            </div>
        </section>
    </div>

    <!-- Cart Section -->
    <div class="cart-container" id="cartContainer">
        <div class="cart-header">
            <h2>Sepetiniz</h2>
            <button class="cart-close" id="cartClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="cart-items" id="cartItems">
            <div class="text-center" style="padding: 30px; color: #6c757d;">
                <i class="fas fa-shopping-cart fa-2x mb-3"></i>
                <p>Sepetiniz bo≈ü</p>
            </div>
        </div>
        <div class="cart-totals">
            <div class="total-row">
                <span>Ara Toplam:</span>
                <span id="subtotal">0 ‚Ç∫</span>
            </div>
            <div class="total-row">
                <span>ƒ∞ndirim:</span>
                <span id="discount">0 ‚Ç∫</span>
            </div>
            <div class="total-row">
                <span>KDV (%18):</span>
                <span id="vatAmount">0 ‚Ç∫</span>
            </div>
            <div class="total-row total-final">
                <span>Toplam:</span>
                <span id="totalAmount">0 ‚Ç∫</span>
            </div>
        </div>
        <div class="payment-buttons">
            <button class="payment-btn cash" id="payCash">Nakit √ñde</button>
            <button class="payment-btn card" id="payCard">Kartla √ñde</button>
            <button class="payment-btn bonus" id="payBonus">Bonus ile √ñde</button>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-container">
            <div class="footer-section">
                <h3>Sesli Sipari≈ü</h3>
                <p>Sesli komutlarla kolayca sipari≈ü verin. Hƒ±zlƒ±, g√ºvenli ve pratik alƒ±≈üveri≈ü deneyimi.</p>
                <div class="social-links">
                    <a href="#" class="social-link"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
                    <a href="https://wa.me/?text=Merhaba!%20Sesli%20Sipari≈ü%20sisteminden%20alƒ±≈üveri≈ü%20yapmak%20istiyorum." class="social-link" target="_blank"><i class="fab fa-whatsapp"></i></a>
                </div>
            </div>
            
            <div class="footer-section">
                <h3>Hƒ±zlƒ± Baƒülantƒ±lar</h3>
                <ul class="footer-links">
                    <li><a href="#" id="referralLink">Referans Linki</a></li>
                    <li><a href="#" id="whatsappOrder">WhatsApp ile Sipari≈ü</a></li>
                    <li><a href="#">Sipari≈ülerim</a></li>
                    <li><a href="#">Yardƒ±m</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>ƒ∞leti≈üim</h3>
                <ul class="footer-links">
                    <li><i class="fas fa-phone"></i> 0850 123 45 67</li>
                    <li><i class="fas fa-envelope"></i> info@seslisiparis.com</li>
                    <li><i class="fas fa-map-marker-alt"></i> ƒ∞stanbul, T√ºrkiye</li>
                </ul>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>&copy; 2023 Sesli Sipari≈ü Sistemi. T√ºm haklarƒ± saklƒ±dƒ±r.</p>
        </div>
    </footer>

    <!-- Voice Assistant -->
    <div class="voice-status" id="voiceStatusPanel">
        <div class="status-header">
            <div class="status-title">
                <i class="fas fa-microphone"></i>
                <span>Sesli Asistan</span>
            </div>
            <button class="status-close" id="closeVoiceStatus">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="status-content">
            <div class="assistant-message" id="assistantMessage">Merhaba! Sipari≈ü vermek i√ßin mikrofonu a√ßƒ±n ve konu≈üun.</div>
            <div class="user-message" id="userMessage"></div>
        </div>
        <div class="voice-indicator" id="voiceIndicator">
            <div class="voice-bar"></div>
            <div class="voice-bar"></div>
            <div class="voice-bar"></div>
            <div class="voice-bar"></div>
            <div class="voice-bar"></div>
        </div>
    </div>

 <button class="test-button" id="testButton">
        <i class="fas fa-vial"></i> Test Et
    </button>
<script>      
        // =============================================
        // D√úZELTƒ∞LMƒ∞≈û KOD BA≈ûLANGICI
        // =============================================

        // Supabase configuration
        const SUPABASE_URL = "https://xliutvspwodhoaxvysks.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhsaXV0dnNwd29kaG9heHZ5c2tzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTczNTgyOTksImV4cCI6MjA3MjkzNDI5OX0.Zodisa_ifP8t2Q4X0ecnB56RiR_Bg4QS5gvPn5ZLK_w";

        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

          // =============================================
        // HATA D√úZELTME - TANIMSIZ DEƒûƒ∞≈ûKENLERƒ∞ TANIMLA
        // =============================================

        // √ñnce t√ºm global deƒüi≈ükenleri tanƒ±mla
        let appState = {
            currentCustomer: null,
            sellers: [],
            products: [],
            categories: [],
            storeTypes: [],
            cart: [],
            recognition: null,
            isListening: false,
            isMicrophoneEnabled: false,
            conversationStep: 0,
            currentPaymentMethod: null,
            selectedSellerId: null,
            selectedSellerType: null,
            selectedCategoryId: null,
            isSellerLocked: false,
            selectedLocation: null,
            referralCode: null,
            referralGroupCode: null,
            commandRoot: "0:0",
            pendingResponse: null,
            commandRules: new Map(),
            appInitialized: false
		
        };

       let appInitialized = false;
        let simpleInitExecuted = false;

        // =============================================
        // TEST FONKSƒ∞YONLARINI TANIMLA
        // =============================================

        // Debug modu
        const DEBUG_MODE = true;

        // Debug fonksiyonu
        function debugLog(message, data = null) {
            if (DEBUG_MODE) {
                console.log(`[DEBUG] ${new Date().toLocaleTimeString()}: ${message}`, data || '');
            }
        }

        // DOM Elements - tek seferde tanƒ±mlayalƒ±m
        let domElements = {};

        function initializeDOMElements() {
            domElements = {
                profileBtn: document.getElementById('profileBtn'),
                profileDropdown: document.getElementById('profileDropdown'),
                profileAvatar: document.getElementById('profileAvatar'),
                profileName: document.getElementById('profileName'),
                profilePhone: document.getElementById('profilePhone'),
                profileCity: document.getElementById('profileCity'),
                profileAddress: document.getElementById('profileAddress'),
                profileBonus: document.getElementById('profileBonus'),
                logoutBtn: document.getElementById('logoutBtn'),
                userName: document.getElementById('userName'),
                microphoneToggle: document.getElementById('microphoneToggle'),
                sellerTypeGrid: document.getElementById('sellerTypeGrid'),
                scrollSellerTypesLeft: document.getElementById('scrollSellerTypesLeft'),
                scrollSellerTypesRight: document.getElementById('scrollSellerTypesRight'),
                categoriesSection: document.getElementById('categoriesSection'),
                categoriesTitle: document.getElementById('categoriesTitle'),
                categoriesGrid: document.getElementById('categoriesGrid'),
                scrollCategoriesLeft: document.getElementById('scrollCategoriesLeft'),
                scrollCategoriesRight: document.getElementById('scrollCategoriesRight'),
                sellersSection: document.getElementById('sellersSection'),
                sellerGrid: document.getElementById('sellerGrid'),
                scrollSellersLeft: document.getElementById('scrollSellersLeft'),
                scrollSellersRight: document.getElementById('scrollSellersRight'),
                productsSection: document.getElementById('productsSection'),
                selectedSellerInfo: document.getElementById('selectedSellerInfo'),
                productsGrid: document.getElementById('productsGrid'),
                cartContainer: document.getElementById('cartContainer'),
                cartClose: document.getElementById('cartClose'),
                cartItems: document.getElementById('cartItems'),
                orderSummary: document.getElementById('orderSummary'),
                orderCount: document.getElementById('orderCount'),
                orderTotal: document.getElementById('orderTotal'),
                subtotalEl: document.getElementById('subtotal'),
                discountEl: document.getElementById('discount'),
                vatAmountEl: document.getElementById('vatAmount'),
                totalAmountEl: document.getElementById('totalAmount'),
                payCashBtn: document.getElementById('payCash'),
                payCardBtn: document.getElementById('payCard'),
                payBonusBtn: document.getElementById('payBonus'),
                assistantMessage: document.getElementById('assistantMessage'),
                userMessage: document.getElementById('userMessage'),
                voiceIndicator: document.getElementById('voiceIndicator'),
                closeVoiceStatus: document.getElementById('closeVoiceStatus'),
                voiceStatusPanel: document.getElementById('voiceStatusPanel'),
                howItWorks: document.getElementById('howItWorks'),
                locationsMarker: document.getElementById('locationsMarker'),
                locationText: document.getElementById('locationText'),
                locationModal: document.getElementById('locationModal'),
                referralLink: document.getElementById('referralLink'),
                whatsappOrder: document.getElementById('whatsappOrder'),
                testButton: document.getElementById('testButton')
            };
            
            debugLog('‚úÖ DOM elementleri ba≈üarƒ±yla tanƒ±mlandƒ±');
        }


     // =============================================
        // KONUM Sƒ∞STEMƒ∞ - T√úM FONKSƒ∞YONLAR TANIMLI
        // =============================================

        function testLocationSystem() {
            console.log('üß™ LOCATIONS Sƒ∞STEMƒ∞ TESTƒ∞ - TANIMLANDI');
            
            const marker = document.getElementById('locationsMarker');
            const modal = document.getElementById('locationsModal');
            const options = document.querySelectorAll('.locations-option');
            
            console.log('üìç Locations Marker:', marker ? 'BULUNDU ‚úÖ' : 'BULUNAMADI ‚ùå');
            console.log('üìç Locations Modal:', modal ? 'BULUNDU ‚úÖ' : 'BULUNAMADI ‚ùå');
            console.log('üìç Locations Se√ßenekleri:', options.length + ' adet');
            
            if (marker) {
                marker.style.border = '3px solid #4CAF50';
                setTimeout(() => {
                    marker.style.border = '2px solid #2196f3';
                }, 3000);
            }
        }

        function initializeLocationsSystem() {
            console.log('üìç KONUM Sƒ∞STEMƒ∞ BA≈ûLATILIYOR');
            
            try {
                setupLocationsMarker();
                setupLocationsModal();
                updateLocationsDisplay();
                
                debugLog('‚úÖ Konum sistemi ba≈ülatƒ±ldƒ±');
                
            } catch (error) {
                console.error('‚ùå Konum sistemi ba≈ülatma hatasƒ±:', error);
            }
        }

        function setupLocationsMarker() {
            const marker = document.getElementById('locationsMarker');
            if (!marker) return;
            
            marker.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                showLocationsModal();
            });
        }

        function setupLocationsModal() {
            debugLog('üîß Locations modal ayarlanƒ±yor...');
            // Modal hen√ºz HTML'de yok
        }

        function showLocationsModal() {
            alert('üìç Konum Se√ßin:\n\n1. Restoran i√ßinde\n2. Paket servis\n3. Adrese teslim');
            debugLog('üìç Konum modal g√∂sterildi (alert)');
            
            // Ge√ßici olarak bir konum se√ß
            setTimeout(() => {
                selectLocationsOption('delivery');
            }, 1000);
        }

        function hideLocationsModal() {
            debugLog('üìç Konum modal gizlendi');
        }

        function selectLocationsOption(locationType) {
            console.log('üìç Konum se√ßildi:', locationType);
            
            selectedLocation = locationType;
            const locationsText = document.getElementById('locationsText');
            if (locationsText) {
                locationsText.textContent = getLocationsName(locationType);
            }
            
            debugLog('‚úÖ Konum ba≈üarƒ±yla se√ßildi: ' + locationType);
            alert('‚úÖ Konumunuz "' + getLocationsName(locationType) + '" olarak ayarlandƒ±');
        }

        function getLocationsName(locationType) {
            const names = {
                'inside': 'üìç Restoran i√ßinde',
                'takeaway': 'üì¶ Paket servis', 
                'delivery': 'üöö Adrese teslim'
            };
            return names[locationType] || locationType;
        }

        function updateLocationsDisplay() {
            const locationsText = document.getElementById('locationsText');
            if (locationsText) {
                locationsText.textContent = getLocationsName(selectedLocation) || 'Konumunuzu se√ßin';
            }
        }

        // =============================================
        // DOM ELEMENT Y√ñNETƒ∞Mƒ∞
        // =============================================

        function initializeDOMElements() {
            debugLog('üîß DOM elementleri tanƒ±mlanƒ±yor...');
            
            // Sadece temel elementleri tanƒ±mla
            const elements = [
                'profileBtn', 'profileDropdown', 'microphoneToggle', 'orderSummary',
                'locationsMarker', 'locationsText', 'testButton'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    debugLog(`‚úÖ ${id} element bulundu`);
                } else {
                    console.warn(`‚ùå ${id} element bulunamadƒ±`);
                }
            });
        }

        function setupBasicEventListeners() {
            debugLog('üîß Temel event listenerlar kuruluyor...');
            
            // Test butonu
            const testButton = document.getElementById('testButton');
            if (testButton) {
                testButton.addEventListener('click', function() {
                    alert('‚úÖ JavaScript √ßalƒ±≈üƒ±yor!\nSayfa bloke deƒüil.\nT√ºm sistemler hazƒ±r.');
                    debugLog('‚úÖ Test butonu √ßalƒ±≈ütƒ±');
                });
            }
            
            // Mikrofon butonu
            const microphoneToggle = document.getElementById('microphoneToggle');
            if (microphoneToggle) {
                microphoneToggle.addEventListener('click', function() {
                    alert('üé§ Mikrofon butonu √ßalƒ±≈üƒ±yor!');
                    debugLog('üé§ Mikrofon butonu tƒ±klandƒ±');
                });
            }
            
            // Konum butonu
            const locationsMarker = document.getElementById('locationsMarker');
            if (locationsMarker) {
                locationsMarker.addEventListener('click', function() {
                    showLocationsModal();
                    debugLog('üìç Konum butonu tƒ±klandƒ±');
                });
            }
            
            // Sepet butonu
            const orderSummary = document.getElementById('orderSummary');
            if (orderSummary) {
                orderSummary.addEventListener('click', function() {
                    alert('üõí Sepet butonu √ßalƒ±≈üƒ±yor!');
                    debugLog('üõí Sepet butonu tƒ±klandƒ±');
                });
            }
        }

        // =============================================
        // DEMO VERƒ∞ Y√úKLEME
        // =============================================

        async function loadDemoData() {
            debugLog('üì¶ Demo veriler y√ºkleniyor...');
            
            try {
                // Demo store types
                const demoStoreTypes = [
                    { id: 1, name: 'Market', code: 'market' },
                    { id: 2, name: 'Restoran', code: 'restaurant' },
                    { id: 3, name: 'Eczane', code: 'pharmacy' },
                    { id: 4, name: 'Fƒ±rƒ±n', code: 'bakery' }
                ];
                
                // Store type grid'i doldur
                const sellerTypeGrid = document.getElementById('sellerTypeGrid');
                if (sellerTypeGrid) {
                    sellerTypeGrid.innerHTML = '';
                    
                    demoStoreTypes.forEach(type => {
                        const card = document.createElement('div');
                        card.className = 'seller-type-card';
                        card.innerHTML = `
                            <div class="seller-type-icon">
                                <i class="fas fa-store"></i>
                            </div>
                            <div class="seller-type-name">${type.name}</div>
                        `;
                        
                        card.addEventListener('click', function() {
                            alert(`‚úÖ ${type.name} se√ßildi!`);
                            debugLog(`üõçÔ∏è Store type se√ßildi: ${type.name}`);
                        });
                        
                        sellerTypeGrid.appendChild(card);
                    });
                    
                    debugLog('‚úÖ Demo store types y√ºklendi');
                }
                
                // Order summary'yi g√∂ster
                const orderSummary = document.getElementById('orderSummary');
                if (orderSummary) {
                    orderSummary.style.display = 'flex';
                }
                
            } catch (error) {
                console.error('‚ùå Demo veri y√ºkleme hatasƒ±:', error);
            }
        }

        // =============================================
        // ANA UYGULAMA BA≈ûLATMA
        // =============================================

   function simpleInit() {
    if (simpleInitExecuted) {
        debugLog('‚ö†Ô∏è simpleInit zaten √ßalƒ±≈ütƒ±, ikinci √ßaƒürƒ± engellendi');
        return;
    }
    simpleInitExecuted = true;
    
    try {
        debugLog('üöÄ Basit init ba≈ülatƒ±lƒ±yor...');
        
        // DOM elementlerini ba≈ülat
        initializeDOMElements();
        
        // Event listener'larƒ± kur
        setupBasicEventListeners();
        
        debugLog('‚úÖ Basit init tamamlandƒ±');
        
        // Ana uygulamayƒ± ba≈ülat
        setTimeout(() => {
            initApp();
        }, 1000);
        
    } catch (error) {
        console.error('‚ùå Basit init hatasƒ±:', error);
        alert('Basit init hatasƒ±: ' + error.message);
    }
}

async function initApp() {
    if (appInitialized) {
        debugLog('‚ö†Ô∏è initApp zaten √ßalƒ±≈ütƒ±');
        return;
    }
    
    appInitialized = true;
    
    try {
        debugLog('üöÄ === ANA UYGULAMA BA≈ûLATILIYOR ===');
        
        // Test fonksiyonlarƒ±nƒ± √ßalƒ±≈ütƒ±r
        testLocationSystem();
        
        // Konum sistemini ba≈ülat
        initializeLocationsSystem();
        
        // Demo verileri y√ºkle
        await loadDemoData();
        
        debugLog('üéâ === ANA UYGULAMA BA≈ûLATMA TAMAMLANDI ===');
        
        alert('‚úÖ Uygulama ba≈üarƒ±yla ba≈ülatƒ±ldƒ±!\nT√ºm sistemler √ßalƒ±≈üƒ±yor.');
        
    } catch (error) {
        console.error('üí• Uygulama ba≈ülatma hatasƒ±:', error);
        alert('Uygulama ba≈ülatma hatasƒ±: ' + error.message);
    }
}
        // =============================================
        // SAYFA Y√úKLEME VE HATA YAKALAMA
        // =============================================

        // Global hata yakalama
        window.addEventListener('error', function(e) {
            console.error('‚ùå Global JavaScript Hatasƒ±:', e.error);
            debugLog('‚ùå HATA: ' + (e.error?.message || 'Bilinmeyen hata'));
        });

        // Promise hatalarƒ±nƒ± yakala
        window.addEventListener('unhandledrejection', function(e) {
            console.error('‚ùå Promise Hatasƒ±:', e.reason);
            debugLog('‚ùå PROMISE HATA: ' + (e.reason?.message || 'Bilinmeyen promise hatasƒ±'));
        });

        // Sayfa y√ºklendiƒüinde
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('üìÑ DOM y√ºklendi, sistem ba≈ülatƒ±lƒ±yor...');
            
            // Basit init'i ba≈ülat - SADECE Bƒ∞R KEZ
            setTimeout(simpleInit, 500);
        });

        // Sayfa tamamen y√ºklendiƒüinde
        window.addEventListener('load', function() {
            debugLog('‚úÖ Sayfa tamamen y√ºklendi');
            console.log('‚úÖ T√ºm kaynaklar y√ºklendi, sayfa hazƒ±r');
        });
        // =============================================
        // BASƒ∞T BA≈ûLATMA Sƒ∞STEMƒ∞
        // =============================================

        function debugLog(message, data = null) {
            console.log(`[DEBUG] ${new Date().toLocaleTimeString()}: ${message}`, data || '');
        }

        function initializeDOMElements() {
            debugLog('üîß DOM elementleri tanƒ±mlanƒ±yor...');
            
            // Sadece temel elementleri tanƒ±mla
            const elements = [
                'profileBtn', 'profileDropdown', 'microphoneToggle', 'orderSummary',
                'locationsMarker', 'locationsText', 'testButton'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    window[id] = element;
                    debugLog(`‚úÖ ${id} element bulundu`);
                } else {
                    console.warn(`‚ùå ${id} element bulunamadƒ±`);
                }
            });
        }

        function setupBasicEventListeners() {
            debugLog('üîß Temel event listenerlar kuruluyor...');
            
            // Test butonu
            if (window.testButton) {
                window.testButton.addEventListener('click', function() {
                    alert('‚úÖ JavaScript √ßalƒ±≈üƒ±yor!\nSayfa bloke deƒüil.\nT√ºm sistemler hazƒ±r.');
                    debugLog('‚úÖ Test butonu √ßalƒ±≈ütƒ±');
                });
            }
            
            // Mikrofon butonu
            if (window.microphoneToggle) {
                window.microphoneToggle.addEventListener('click', function() {
                    alert('üé§ Mikrofon butonu √ßalƒ±≈üƒ±yor!');
                    debugLog('üé§ Mikrofon butonu tƒ±klandƒ±');
                });
            }
            
            // Konum butonu
            if (window.locationsMarker) {
                window.locationsMarker.addEventListener('click', function() {
                    alert('üìç Konum butonu √ßalƒ±≈üƒ±yor!');
                    debugLog('üìç Konum butonu tƒ±klandƒ±');
                });
            }
            
            // Sepet butonu
            if (window.orderSummary) {
                window.orderSummary.addEventListener('click', function() {
                    alert('üõí Sepet butonu √ßalƒ±≈üƒ±yor!');
                    debugLog('üõí Sepet butonu tƒ±klandƒ±');
                });
            }
        }

        function simpleInit() {
            if (simpleInitExecuted) return;
            simpleInitExecuted = true;
            
            debugLog('üöÄ Basit init ba≈ülatƒ±lƒ±yor...');
            
            // Banner sistemini ba≈ülat
            initializeBannerSystem();
            
            // Konum marker event'ini ayarla
            const locationsMarker = document.getElementById('locationsMarker');
            if (locationsMarker) {
                locationsMarker.addEventListener('click', showLocationModal);
            }
            
            // Mikrofon butonunu ayarla (ba≈ülangƒ±√ßta pasif)
            const microphoneToggle = document.getElementById('microphoneToggle');
            if (microphoneToggle) {
                microphoneToggle.addEventListener('click', handleMicrophoneToggle);
                microphoneToggle.disabled = true; // Konum se√ßilene kadar pasif
            }
            
            debugLog('‚úÖ Basit init tamamlandƒ±');
        }

        // Sayfa y√ºklendiƒüinde
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('üìÑ DOM y√ºklendi, banner sistemi ba≈ülatƒ±lƒ±yor...');
            simpleInit();
        });

        // Debug fonksiyonu
        function debugLog(message, data = null) {
            console.log(`[DEBUG] ${new Date().toLocaleTimeString()}: ${message}`, data || '');
        }
        // =============================================
        // ANA UYGULAMA BA≈ûLATMA
        // =============================================

        async function initApp() {
            if (appInitialized) {
                debugLog('‚ö†Ô∏è initApp zaten √ßalƒ±≈ütƒ±');
                return;
            }
            
            appInitialized = true;
            
            try {
                debugLog('üöÄ === ANA UYGULAMA BA≈ûLATILIYOR ===');
                
                // Test fonksiyonlarƒ±nƒ± √ßalƒ±≈ütƒ±r
                testLocationSystem();
                
                // Konum sistemini ba≈ülat
                initializeLocationsSystem();
                
                // Demo verileri y√ºkle
                await loadDemoData();
                
                debugLog('üéâ === ANA UYGULAMA BA≈ûLATMA TAMAMLANDI ===');
                
                alert('‚úÖ Uygulama ba≈üarƒ±yla ba≈ülatƒ±ldƒ±!\nT√ºm sistemler √ßalƒ±≈üƒ±yor.');
                
            } catch (error) {
                console.error('üí• Uygulama ba≈ülatma hatasƒ±:', error);
                alert('Uygulama ba≈ülatma hatasƒ±: ' + error.message);
            }
        }

        // =============================================
        // KONUM Sƒ∞STEMƒ∞ - D√úZELTƒ∞LMƒ∞≈û
        // =============================================

        function initializeLocationsSystem() {
            console.log('üìç KONUM Sƒ∞STEMƒ∞ BA≈ûLATILIYOR');
            
            try {
                setupLocationsMarker();
                setupLocationsModal();
                updateLocationsDisplay();
                
                debugLog('‚úÖ Konum sistemi ba≈ülatƒ±ldƒ±');
                
            } catch (error) {
                console.error('‚ùå Konum sistemi ba≈ülatma hatasƒ±:', error);
            }
        }

        function setupLocationsMarker() {
            if (!window.locationsMarker) return;
            
            window.locationsMarker.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                showLocationsModal();
            });
        }

        function setupLocationsModal() {
            debugLog('üîß Locations modal ayarlanƒ±yor...');
            // Modal hen√ºz HTML'de yok, bu y√ºzden basit bir alert kullan
        }

        function showLocationsModal() {
            alert('üìç Konum Se√ßin:\n\n1. Restoran i√ßinde\n2. Paket servis\n3. Adrese teslim');
            debugLog('üìç Konum modal g√∂sterildi (alert)');
            
            // Ge√ßici olarak bir konum se√ß
            setTimeout(() => {
                selectLocationsOption('delivery');
            }, 1000);
        }

        function hideLocationsModal() {
            debugLog('üìç Konum modal gizlendi');
        }

        function selectLocationsOption(locationType) {
            console.log('üìç Konum se√ßildi:', locationType);
            
            selectedLocation = locationType;
            if (window.locationsText) {
                window.locationsText.textContent = getLocationsName(locationType);
            }
            
            debugLog('‚úÖ Konum ba≈üarƒ±yla se√ßildi: ' + locationType);
            alert('‚úÖ Konumunuz "' + getLocationsName(locationType) + '" olarak ayarlandƒ±');
        }

        function getLocationsName(locationType) {
            const names = {
                'inside': 'üìç Restoran i√ßinde',
                'takeaway': 'üì¶ Paket servis', 
                'delivery': 'üöö Adrese teslim'
            };
            return names[locationType] || locationType;
        }

        function updateLocationsDisplay() {
            if (window.locationsText) {
                window.locationsText.textContent = getLocationsName(selectedLocation) || 'Konumunuzu se√ßin';
            }
        }

        // =============================================
        // DEMO VERƒ∞ Y√úKLEME
        // =============================================

        async function loadDemoData() {
            debugLog('üì¶ Demo veriler y√ºkleniyor...');
            
            try {
                // Demo store types
                const demoStoreTypes = [
                    { id: 1, name: 'Market', code: 'market' },
                    { id: 2, name: 'Restoran', code: 'restaurant' },
                    { id: 3, name: 'Eczane', code: 'pharmacy' },
                    { id: 4, name: 'Fƒ±rƒ±n', code: 'bakery' }
                ];
                
                // Store type grid'i doldur
                const sellerTypeGrid = document.getElementById('sellerTypeGrid');
                if (sellerTypeGrid) {
                    sellerTypeGrid.innerHTML = '';
                    
                    demoStoreTypes.forEach(type => {
                        const card = document.createElement('div');
                        card.className = 'seller-type-card';
                        card.innerHTML = `
                            <div class="seller-type-icon">
                                <i class="fas fa-store"></i>
                            </div>
                            <div class="seller-type-name">${type.name}</div>
                        `;
                        
                        card.addEventListener('click', function() {
                            alert(`‚úÖ ${type.name} se√ßildi!`);
                            debugLog(`üõçÔ∏è Store type se√ßildi: ${type.name}`);
                        });
                        
                        sellerTypeGrid.appendChild(card);
                    });
                    
                    debugLog('‚úÖ Demo store types y√ºklendi');
                }
                
                // Order summary'yi g√∂ster
                if (window.orderSummary) {
                    window.orderSummary.style.display = 'flex';
                }
                
            } catch (error) {
                console.error('‚ùå Demo veri y√ºkleme hatasƒ±:', error);
            }
        }

        // =============================================
        // SAYFA Y√úKLEME VE HATA YAKALAMA
        // =============================================

        document.addEventListener('DOMContentLoaded', function() {
            debugLog('üìÑ DOM y√ºklendi, sistem ba≈ülatƒ±lƒ±yor...');
            
            // Global hata yakalama
            window.addEventListener('error', function(e) {
                console.error('‚ùå Global JavaScript Hatasƒ±:', e.error);
                debugLog('‚ùå HATA: ' + (e.error?.message || 'Bilinmeyen hata'));
            });
            
            // Promise hatalarƒ±nƒ± yakala
            window.addEventListener('unhandledrejection', function(e) {
                console.error('‚ùå Promise Hatasƒ±:', e.reason);
                debugLog('‚ùå PROMISE HATA: ' + (e.reason?.message || 'Bilinmeyen promise hatasƒ±'));
            });
            
            // Basit init'i ba≈ülat
            setTimeout(simpleInit, 500);
        });

        // Sayfa tamamen y√ºklendiƒüinde
        window.addEventListener('load', function() {
            debugLog('‚úÖ Sayfa tamamen y√ºklendi');
            console.log('‚úÖ T√ºm kaynaklar y√ºklendi, sayfa hazƒ±r');
        });












// Diƒüer fonksiyonlar buraya gelecek...
        // Utility functions
        function money(n) { 
            return Number(n||0).toLocaleString('tr-TR',{minimumFractionDigits:2, maximumFractionDigits:2}) + ' ‚Ç∫'; 


		// =============================================
        // YENƒ∞ BANNER Sƒ∞STEMƒ∞
        // =============================================

        function initializeBannerSystem() {
            const startShoppingBtn = document.getElementById('startShoppingBtn');
            if (startShoppingBtn) {
                startShoppingBtn.addEventListener('click', function() {
                    showLocationModal();
                });
            }
        }

        function showLocationModal() {
            // Modal'ƒ± g√∂ster
            const modal = document.getElementById('locationModal');
            if (modal) {
                modal.classList.add('active');
            }
            
            // Modal kapatma butonunu ayarla
            const closeBtn = modal.querySelector('.close-modal');
            if (closeBtn) {
                closeBtn.addEventListener('click', function() {
                    modal.classList.remove('active');
                });
            }
            
            // Konum se√ßeneklerini ayarla
            const locationOptions = modal.querySelectorAll('.location-option');
            locationOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const location = this.getAttribute('data-location');
                    selectLocation(location);
                    modal.classList.remove('active');
                });
            });
        }
function selectLocation(locationType) {
            console.log('üìç Konum se√ßildi:', locationType);
            
            appState.selectedLocation = locationType;
            updateLocationDisplay(locationType);
            
            // Banner'ƒ± kaldƒ±r, ana i√ßeriƒüi g√∂ster
            hideBannerAndShowMain();
            
            // Asistanƒ± ba≈ülat
            initializeAssistant();
            
            debugLog('‚úÖ Konum ba≈üarƒ±yla se√ßildi: ' + locationType);
            speakToUser(`Konumunuz ${getLocationName(locationType)} olarak ayarlandƒ±. Size nasƒ±l yardƒ±mcƒ± olabilirim?`);
        }
		function getLocationName(locationType) {
            const names = {
                'inside': 'restoran i√ßinde',
                'takeaway': 'paket servis', 
                'delivery': 'adrese teslim'
            };
            return names[locationType] || locationType;
        }

        function updateLocationDisplay(locationType) {
            const locationsText = document.getElementById('locationsText');
            if (locationsText) {
                locationsText.textContent = getLocationName(locationType);
            }
        }
	function hideBannerAndShowMain() {
            const banner = document.getElementById('welcomeBanner');
            const mainContent = document.getElementById('mainContent');
            
            if (banner) {
                banner.classList.add('hidden');
            }
            if (mainContent) {
                mainContent.classList.remove('hidden');
            }
        }
		function initializeAssistant() {
            // Asistanƒ± ba≈ülat - sesli asistan mesajƒ± g√∂ster
            const assistantMessage = document.getElementById('assistantMessage');
            if (assistantMessage) {
                assistantMessage.textContent = "Size nasƒ±l yardƒ±mcƒ± olabilirim? Hangi t√ºr maƒüazadan alƒ±≈üveri≈ü yapmak istersiniz?";
            }
            
            // Mikrofon butonunu aktif et
            const microphoneToggle = document.getElementById('microphoneToggle');
            if (microphoneToggle) {
                microphoneToggle.disabled = false;
            }
            
            // Sesli mesaj
            speakToUser("Size nasƒ±l yardƒ±mcƒ± olabilirim? Hangi t√ºr maƒüazadan alƒ±≈üveri≈ü yapmak istersiniz? Market, restoran, eczane veya fƒ±rƒ±n?");
        }
			
// =============================================
// Mƒ∞KROFON VE SESLƒ∞ ASƒ∞STAN Sƒ∞STEMƒ∞ (D√úZELTƒ∞LMƒ∞≈û)
// =============================================

function handleMicrophoneToggle() {
            if (!appState.isMicrophoneEnabled) {
                enableMicrophone();
            } else {
                disableMicrophone();
            }
        }
    
    if (!selectedLocation) {
        console.log('üìç Konum se√ßilmemi≈ü');
        showLocationModal();
        speakToUser("L√ºtfen √∂nce bir konum se√ßiniz.");
        return;
    }
    
    if (isListening) {
        disableMicrophone();
    } else {
        enableMicrophone();
    }
}

function enableMicrophone() {
            // Ses tanƒ±ma API'sini ba≈ülat
            appState.isMicrophoneEnabled = true;
            document.getElementById('microphoneToggle').innerHTML = '<i class="fas fa-microphone"></i> <span>Mikrofon (A√ßƒ±k)</span>';
            document.getElementById('microphoneToggle').classList.add('listening');
            
            // Ses tanƒ±mayƒ± ba≈ülat
            initializeSpeechRecognition();
            
            speakToUser("Mikrofon a√ßƒ±ldƒ±. Konu≈ümaya ba≈ülayabilirsiniz.");
        }

function disableMicrophone() {
            appState.isMicrophoneEnabled = false;
            document.getElementById('microphoneToggle').innerHTML = '<i class="fas fa-microphone-slash"></i> <span>Mikrofon (Kapalƒ±)</span>';
            document.getElementById('microphoneToggle').classList.remove('listening');
            
            if (appState.recognition) {
                appState.recognition.stop();
            }
            
            speakToUser("Mikrofon kapatƒ±ldƒ±.");
        }
	
// SES TANIMA FONKSƒ∞YONU - HATALI KISIM D√úZELTƒ∞LDƒ∞
function initializeSpeechRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            
            if (!SpeechRecognition) {
                alert("Tarayƒ±cƒ±nƒ±z ses tanƒ±ma √∂zelliƒüini desteklemiyor.");
                return;
            }
            
            appState.recognition = new SpeechRecognition();
            appState.recognition.continuous = true;
            appState.recognition.lang = 'tr-TR';
            appState.recognition.interimResults = false;
            
            appState.recognition.onresult = function(event) {
                const transcript = event.results[event.results.length - 1][0].transcript;
                processVoiceCommand(transcript);
            };
            
            appState.recognition.onerror = function(event) {
                console.error('Ses tanƒ±ma hatasƒ±:', event.error);
            };
            
            appState.recognition.start();
        }
// EKSƒ∞K FONKSƒ∞YONU EKLEYELƒ∞M
function startRecognitionSafely() {
    if (!isListening && isMicrophoneEnabled) {
        setTimeout(() => {
            try {
                recognition.start();
                debugLog('üé§ Ses tanƒ±ma ba≈ülatƒ±ldƒ±');
            } catch (error) {
                if (error.name === 'InvalidStateError') {
                    console.log('Ses tanƒ±ma zaten √ßalƒ±≈üƒ±yor');
                } else {
                    console.error('Ses tanƒ±ma ba≈ülatma hatasƒ±:', error);
                }
            }
        }, 500);
    }
}

// SESLƒ∞ ASƒ∞STAN BA≈ûLATMA
function initializeVoiceAssistant() {
    setTimeout(() => {
        if (!currentCustomer) {
            speakToUser("Merhaba! Sesli sipari≈ü sistemine ho≈ü geldiniz. Telefon numaranƒ±zƒ± s√∂yleyerek giri≈ü yapabilir veya misafir olarak devam edebilirsiniz.");
        } else {
            speakToUser(`Ho≈ü geldiniz ${currentCustomer.name}! Ne satƒ±n almak istersiniz?`);
        }
    }, 1000);
}

function speakToUser(message) {
            // Basit bir ses sentezi (tarayƒ±cƒ± desteƒüi varsa)
            if ('speechSynthesis' in window) {
                const speech = new SpeechSynthesisUtterance(message);
                speech.lang = 'tr-TR';
                speech.volume = 1;
                speech.rate = 1;
                speech.pitch = 1;
                window.speechSynthesis.speak(speech);
            }
	 
            // Asistan mesajƒ±nƒ± g√∂ster
            const assistantMessage = document.getElementById('assistantMessage');
            if (assistantMessage) {
                assistantMessage.textContent = message;
            }
        }

// SESLƒ∞ KOMUT ƒ∞≈ûLEME FONKSƒ∞YONU
function processVoiceCommand(transcript) {
            const message = transcript.toLowerCase();
            
            // Kullanƒ±cƒ± mesajƒ±nƒ± g√∂ster
            const userMessage = document.getElementById('userMessage');
            if (userMessage) {
                userMessage.textContent = transcript;
            }
            
            // Basit komut i≈üleme
            if (message.includes('market')) {
                selectStoreTypeByName('Market');
            } else if (message.includes('restoran') || message.includes('lokanta')) {
                selectStoreTypeByName('Restoran');
            } else if (message.includes('eczane')) {
                selectStoreTypeByName('Eczane');
            } else if (message.includes('fƒ±rƒ±n')) {
                selectStoreTypeByName('Fƒ±rƒ±n');
            } else {
                speakToUser(`Anladƒ±m: "${transcript}". L√ºtfen market, restoran, eczane veya fƒ±rƒ±n gibi bir maƒüaza t√ºr√º s√∂yleyin.`);
            }
        }

        function selectStoreTypeByName(typeName) {
            // Store type se√ßimini sim√ºle et
            speakToUser(`${typeName} se√ßildi. Size en yakƒ±n ${typeName.toLowerCase()}larƒ± listeliyorum.`);
            
            // Burada ilgili store type'a tƒ±klama i≈ülemi yapƒ±lacak
            debugLog(`üõçÔ∏è Store type sesli komutla se√ßildi: ${typeName}`);
        }


	// =============================================
        // SAYFA Y√úKLEME S√úRECƒ∞
        // =============================================

        function waitForDOMElements() {
            return new Promise((resolve) => {
                const elements = {
                    'microphoneToggle': document.getElementById('microphoneToggle'),
                    
                    'profileBtn': document.getElementById('profileBtn'),
                    'logoutBtn': document.getElementById('logoutBtn')
                };

                let attempts = 0;
                const maxAttempts = 50;

                const checkElements = () => {
                    attempts++;
                    const loaded = Object.values(elements).filter(el => el !== null).length;
                    const total = Object.keys(elements).length;

                    debugLog(`DOM y√ºkleme: ${loaded}/${total} (deneme ${attempts})`);

                    if (loaded >= 3 || attempts >= maxAttempts) {
                        debugLog('‚úÖ Minimum DOM elementleri y√ºklendi');
                        resolve();
                        return;
                    }

                    setTimeout(checkElements, 100);
                };

                checkElements();
            });
        }

        function setupEventHandlers() {
            try {
                debugLog('üîß Event handlerlar ayarlanƒ±yor...');

                // Konum event'leri
                setupLocationEvents();

                // Mikrofon toggle
                if (microphoneToggle) {
                    microphoneToggle.addEventListener('click', handleMicrophoneToggle);
                }

                 // Profil dropdown - D√úZELTƒ∞LMƒ∞≈û KISIM
        if (profileBtn && profileDropdown) {
            // √ñnceki event listener'larƒ± temizle
            profileBtn.removeEventListener('click', handleProfileToggle);
            document.removeEventListener('click', closeProfileDropdown);
            
            // Yeni event listener'larƒ± ekle
            profileBtn.addEventListener('click', handleProfileToggle);
            document.addEventListener('click', closeProfileDropdown);
        }

                // √áƒ±kƒ±≈ü butonu
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        logout();
                    });
                }

                // Kaydƒ±rma butonlarƒ±
                if (scrollSellerTypesLeft && sellerTypeGrid) {
                    scrollSellerTypesLeft.addEventListener('click', () => scrollElement(sellerTypeGrid, -200));
                    scrollSellerTypesRight.addEventListener('click', () => scrollElement(sellerTypeGrid, 200));
                }
                
                if (scrollCategoriesLeft && categoriesGrid) {
                    scrollCategoriesLeft.addEventListener('click', () => scrollElement(categoriesGrid, -200));
                    scrollCategoriesRight.addEventListener('click', () => scrollElement(categoriesGrid, 200));
                }
                
                if (scrollSellersLeft && sellerGrid) {
                    scrollSellersLeft.addEventListener('click', () => scrollElement(sellerGrid, -200));
                    scrollSellersRight.addEventListener('click', () => scrollElement(sellerGrid, 200));
                }

                // Sepet i≈ülemleri
                if (cartClose) {
                    cartClose.addEventListener('click', closeCart);
                }
                
                if (orderSummary) {
                    orderSummary.addEventListener('click', toggleCart);
                }

                // √ñdeme butonlarƒ±
                if (payCashBtn) {
                    payCashBtn.addEventListener('click', () => finalizeOrder('nakit'));
                }
                if (payCardBtn) {
                    payCardBtn.addEventListener('click', () => finalizeOrder('kart'));
                }
                if (payBonusBtn) {
                    payBonusBtn.addEventListener('click', () => finalizeOrder('bonus'));
                }

                debugLog('‚úÖ T√ºm event handlerlar ba≈üarƒ±yla ayarlandƒ±');

            } catch (error) {
                console.error('‚ùå Event handler ayarlama hatasƒ±:', error);
            }
        }

	// Profil dropdown toggle fonksiyonu
function handleProfileToggle(e) {
    e.stopPropagation();
    profileDropdown.classList.toggle('show');
}

// Profil dropdown kapatma
function closeProfileDropdown(e) {
    if (!profileDropdown.contains(e.target) && !profileBtn.contains(e.target)) {
        profileDropdown.classList.remove('show');
    }
}

        function updateUIAfterLogin() {
            updateLogoutButtonVisibility();
            
            if (currentCustomer) {
                hideHowItWorksBanner();
            } else {
                showHowItWorksBanner();
            }
            
            updateCustomerUI();
            updateLocationText();
        }

        function updateLogoutButtonVisibility() {
            if (logoutBtn) {
                logoutBtn.style.display = currentCustomer ? 'block' : 'none';
            }
        }

        function showHowItWorksBanner() {
            if (howItWorks) howItWorks.style.display = 'block';
            if (categoriesSection) categoriesSection.style.display = 'none';
            if (sellersSection) sellersSection.style.display = 'none';
            if (productsSection) productsSection.style.display = 'none';
            if (orderSummary) orderSummary.style.display = 'none';
        }

        function hideHowItWorksBanner() {
            if (howItWorks) howItWorks.style.display = 'none';
            if (categoriesSection) categoriesSection.style.display = 'block';
            if (sellersSection) sellersSection.style.display = 'block';
            if (orderSummary) orderSummary.style.display = 'flex';
        }

        function updateCustomerUI() {
            if (currentCustomer) {
                if (userName) userName.textContent = currentCustomer.name || 'Profilim';
                if (profileName) profileName.textContent = currentCustomer.name || '-';
                if (profilePhone) profilePhone.textContent = currentCustomer.phone || '-';
                if (profileCity) profileCity.textContent = currentCustomer.city || '-';
                if (profileAddress) profileAddress.textContent = currentCustomer.address || '-';
                if (profileBonus) profileBonus.textContent = money(currentCustomer.bonus_amount || 0);
                if (profileAvatar) profileAvatar.textContent = (currentCustomer.name || 'P').charAt(0).toUpperCase();
            }
        }

        function emergencyFallback() {
            debugLog('üÜò Acil durum modu aktif');
            setupLocationEvents();
            
            if (!selectedLocation) {
                setTimeout(() => {
                    showLocationModal();
                }, 2000);
            }
        }

        // =============================================
        // ANA UYGULAMA BA≈ûLATMA
        // =============================================

// =============================================
// EKSƒ∞K FONKSƒ∞YONLARI TAMAMLAYALIM
// =============================================
// =============================================
// VERƒ∞TABANI ve AI ODAKLI SADELE≈ûTƒ∞Rƒ∞LMƒ∞≈û Sƒ∞STEM
// =============================================

// Global deƒüi≈ükenler



// =============================================
// TEK FONKSƒ∞YON: loadCommandRules
// =============================================
async function loadCommandRules() {
    try {
        debugLog('üîß Komut kurallarƒ± y√ºkleniyor...');
        
        // √ñnce veritabanƒ±ndan dene
        const { data, error } = await supabase
            .from('voice_command_rules')
            .select('*')
            .eq('is_active', true)
            .order('priority');

        if (!error && data && data.length > 0) {
            // Veritabanƒ±ndan kurallarƒ± y√ºkle
            commandRules.clear();
            data.forEach(rule => {
                if (!commandRules.has(rule.root_code)) {
                    commandRules.set(rule.root_code, []);
                }
                commandRules.get(rule.root_code).push(rule);
            });
            debugLog(`‚úÖ Veritabanƒ±ndan ${data.length} kural y√ºklendi`);
            return data;
        }

        // Fallback: Varsayƒ±lan kurallar
        const defaultRules = [
            {
                root_code: '0:0',
                input_patterns: 'merhaba|selam',
                output_text: 'Merhaba! Sesli sipari≈ü sistemine ho≈ü geldiniz.',
                next_root: '1:1',
                action_name: null
            },
            {
                root_code: '1:1',
                input_patterns: 'regex:[0-9]{10,}',
                output_text: 'Telefon numaranƒ±z: {phone}. Doƒüru mu?',
                next_root: '1:2',
                action_name: 'set_phone'
            }
        ];

        debugLog('‚úÖ Varsayƒ±lan komut kurallarƒ± y√ºklendi');
        return defaultRules;
        
    } catch (error) {
        console.error('‚ùå Komut kurallarƒ± y√ºkleme hatasƒ±:', error);
        return [];
    }
}

// =============================================
// TEK FONKSƒ∞YON: findRuleInDatabase
// =============================================
async function findRuleInDatabase(message, root) {
    try {
        const rules = await loadCommandRules();
        const rootRules = Array.isArray(rules) ? rules.filter(rule => rule.root_code === root) : [];
        
        for (const rule of rootRules) {
            const patterns = rule.input_patterns.split('|');
            for (const pattern of patterns) {
                if (pattern.startsWith('regex:')) {
                    const regexPattern = pattern.replace('regex:', '');
                    if (new RegExp(regexPattern).test(message)) {
                        return rule;
                    }
                } else if (message.includes(pattern)) {
                    return rule;
                }
            }
        }
        return null;
    } catch (error) {
        console.error('Kural arama hatasƒ±:', error);
        return null;
    }
}

// =============================================
// TEK FONKSƒ∞YON: executeDatabaseRule
// =============================================
async function executeDatabaseRule(rule, message) {
    try {
        let output = rule.output_text;
        
        // Dinamik veri ekle
        const phoneMatch = message.match(/(\d{10,})/);
        if (phoneMatch) output = output.replace('{phone}', phoneMatch[1]);
        
        speakToUser(output);
        
        if (rule.action_name) {
            await executeAction(rule.action_name, { phone: phoneMatch?.[1] });
        }
        
        if (rule.next_root) {
            commandRoot = rule.next_root;
        }
    } catch (error) {
        console.error('Kural √ßalƒ±≈ütƒ±rma hatasƒ±:', error);
    }
}

// =============================================
// TEK FONKSƒ∞YON: handleAIRequest
// =============================================
async function handleAIRequest(message, root) {
    try {
        // √ñnce veritabanƒ±nda AI √∂nbelleƒüini kontrol et
        const cached = await checkAICache(message, root);
        if (cached) {
            speakToUser(cached.response);
            commandRoot = cached.next_root;
            return;
        }

        // AI analizi yap
        const aiResult = await analyzeWithAI(message, root);
        
        if (aiResult.confidence > 0.6) {
            speakToUser(aiResult.response);
            commandRoot = aiResult.next_root;
            await saveAILearning(message, root, aiResult);
        } else {
            speakToUser("Anlayamadƒ±m, l√ºtfen tekrar s√∂yler misiniz?");
        }
    } catch (error) {
        console.error('AI isteƒüi hatasƒ±:', error);
        speakToUser("Sistem ge√ßici olarak hizmet veremiyor.");
    }
}

// =============================================
// TEK FONKSƒ∞YON: executeAction
// =============================================
async function executeAction(actionName, data) {
    debugLog(`‚ö° Aksiyon: ${actionName}`, data);
    
    try {
        switch(actionName) {
            case 'set_phone':
                if (!currentCustomer) currentCustomer = {};
                currentCustomer.phone = data.phone;
                break;
                
            case 'check_phone':
                await checkCustomerByPhone(data.phone);
                break;
                
            case 'select_market':
                await selectStoreTypeByName('Market');
                break;
                
            default:
                debugLog(`Bilinmeyen aksiyon: ${actionName}`);
        }
    } catch (error) {
        console.error('Aksiyon hatasƒ±:', error);
    }
}

// =============================================
// TEK FONKSƒ∞YON: processVoiceCommand
// =============================================
// Sesli komut i≈üleme - G√úNCELLENMƒ∞≈û
async function processVoiceCommand(transcript) {
    const message = transcript.toLowerCase().trim();
    if (userMessage) userMessage.textContent = transcript;

    debugLog(`üîä Sesli komut: "${message}" | Mevcut k√∂k: ${commandRoot}`);

    // Konum komutlarƒ±
    if (message.includes('konum') || message.includes('lokasyon')) {
        showLocationModal();
        speakToUser("Konum se√ßim ekranƒ± a√ßƒ±ldƒ±. L√ºtfen bir konum se√ßin.");
        return;
    }

    // Store type se√ßimi
    if (message.includes('market')) {
        selectStoreTypeByName('Market');
        speakToUser("Market se√ßildi. Size en yakƒ±n marketler listeleniyor.");
        return;
    } else if (message.includes('restoran') || message.includes('lokanta')) {
        selectStoreTypeByName('Restoran');
        speakToUser("Restoran se√ßildi. Size en yakƒ±n restoranlar listeleniyor.");
        return;
    } else if (message.includes('eczane')) {
        selectStoreTypeByName('Eczane');
        speakToUser("Eczane se√ßildi. Size en yakƒ±n eczaneler listeleniyor.");
        return;
    } else if (message.includes('fƒ±rƒ±n')) {
        selectStoreTypeByName('Fƒ±rƒ±n');
        speakToUser("Fƒ±rƒ±n se√ßildi. Size en yakƒ±n fƒ±rƒ±nlar listeleniyor.");
        return;
    }

    try {
        // Askƒ±da cevap varsa AI'ya y√∂nlendir
        if (pendingResponse) {
            await handleAIRequest(message, commandRoot, pendingResponse);
            pendingResponse = null;
            return;
        }

        // Veritabanƒ±ndan kural ara
        const rule = await findRuleInDatabase(message, commandRoot);
        
        if (rule) {
            await executeDatabaseRule(rule, message);
        } else {
            // Kural yoksa AI'ya y√∂nlendir
            pendingResponse = { message: message, root: commandRoot };
            await handleAIRequest(message, commandRoot);
        }
    } catch (error) {
        console.error('Sesli komut i≈üleme hatasƒ±:', error);
        speakToUser("Komut i≈ülenirken bir hata olu≈ütu.");
    }
}
// =============================================
// AI YARDIMCI FONKSƒ∞YONLAR (SADECE 3 TANE)
// =============================================

async function checkAICache(message, root) {
    // Veritabanƒ±nda √∂nbellek kontrol√º
    const { data } = await supabase
        .from('ai_learning_cache')
        .select('*')
        .eq('original_message', message)
        .eq('original_root', root)
        .single();
    
    return data;
}

async function analyzeWithAI(message, root) {
    // Basit AI analizi - ger√ßek API i√ßin hazƒ±r
    let response = "Anladƒ±m, devam ediyorum...";
    let nextRoot = root;
    let confidence = 0.7;

    if (message.includes('market')) {
        response = "Market se√ßildi.";
        nextRoot = '2:1';
    } else if (message.includes('√∂deme')) {
        response = "√ñdeme i≈ülemi ba≈ülatƒ±lƒ±yor.";
        nextRoot = '5:1';
    }

    return { response, nextRoot, confidence };
}

async function saveAILearning(message, root, aiResult) {
    // AI √∂ƒürenmesini veritabanƒ±na kaydet
    await supabase.from('ai_learning_cache').insert([{
        original_message: message,
        original_root: root,
        ai_response: aiResult.response,
        next_root: aiResult.nextRoot,
        confidence: aiResult.confidence,
        created_at: new Date().toISOString()
    }]);
}

// =============================================
// M√ú≈ûTERƒ∞ ƒ∞≈ûLEMLERƒ∞ (SADECE 1 FONKSƒ∞YON)
// =============================================

async function checkCustomerByPhone(phone) {
    try {
        const { data } = await supabase
            .from('customers')
            .select('*')
            .eq('phone', phone)
            .single();

        if (data) {
            currentCustomer = data;
            updateCustomerUI();
            speakToUser(`Ho≈ü geldiniz ${data.name}!`);
            commandRoot = '2:1';
        } else {
            speakToUser("Kayƒ±tlƒ± deƒüilsiniz. L√ºtfen adƒ±nƒ±zƒ± s√∂yleyin.");
            commandRoot = '1:3';
        }
    } catch (error) {
        console.error('M√º≈üteri kontrol hatasƒ±:', error);
        speakToUser("Giri≈ü i≈üleminde hata olu≈ütu.");
    }
}

// =============================================
// SES TANIMA HATASI D√úZELTMESƒ∞
// =============================================

function initializeSpeechRecognition() {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    
    if (!SpeechRecognition) {
        if (assistantMessage) {
            assistantMessage.textContent = "Tarayƒ±cƒ±nƒ±z ses tanƒ±ma √∂zelliƒüini desteklemiyor";
        }
        disableMicrophone();
        return;
    }
    
    recognition = new SpeechRecognition();
    recognition.continuous = true;
    recognition.lang = 'tr-TR';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;
    
    recognition.onstart = function() {
        isListening = true;
        if (voiceIndicator) voiceIndicator.classList.add('listening');
        if (assistantMessage) assistantMessage.textContent = "Dinliyorum...";
    };
    
    recognition.onresult = function(event) {
        const transcript = event.results[event.results.length - 1][0].transcript;
        if (userMessage) userMessage.textContent = transcript;
        processVoiceCommand(transcript);
    };
    
    recognition.onerror = function(event) {
        console.error('Ses tanƒ±ma hatasƒ±:', event.error);
        
        // InvalidStateError (zaten ba≈ülatƒ±lmƒ±≈ü) hatasƒ±nƒ± √∂nle
        if (event.error === 'invalid-state') {
            console.log('Ses tanƒ±ma zaten ba≈ülatƒ±lmƒ±≈ü, yeniden ba≈ülatma atlanƒ±yor.');
            return;
        }
        
        if (event.error === 'not-allowed') {
            if (assistantMessage) assistantMessage.textContent = "Mikrofon izni gerekli";
        }
        
        isListening = false;
        if (voiceIndicator) voiceIndicator.classList.remove('listening');
    };
    
    recognition.onend = function() {
        isListening = false;
        if (voiceIndicator) voiceIndicator.classList.remove('listening');
        
        // √áift ba≈ülatmayƒ± √∂nle
        if (isMicrophoneEnabled && !isListening) {
            setTimeout(() => {
                if (isMicrophoneEnabled && !isListening) {
                    try {
                        recognition.start();
                        debugLog('üîÑ Ses tanƒ±ma yeniden ba≈ülatƒ±ldƒ±');
                    } catch (error) {
                        if (error.name !== 'InvalidStateError') {
                            console.log('Ses tanƒ±ma yeniden ba≈ülatƒ±lamadƒ±:', error);
                        }
                    }
                }
            }, 1000);
        }
    };
    
    // Ba≈ülatmayƒ± dene
    startRecognitionSafely();
}

// G√ºvenli ses tanƒ±ma ba≈ülatma
function startRecognitionSafely() {
    if (!isListening && isMicrophoneEnabled) {
        setTimeout(() => {
            try {
                recognition.start();
                debugLog('üé§ Ses tanƒ±ma ba≈ülatƒ±ldƒ±');
            } catch (error) {
                if (error.name === 'InvalidStateError') {
                    console.log('Ses tanƒ±ma zaten √ßalƒ±≈üƒ±yor');
                } else {
                    console.error('Ses tanƒ±ma ba≈ülatma hatasƒ±:', error);
                }
            }
        }, 500);
    }
}

// =============================================
// G√úNCELLENMƒ∞≈û processVoiceCommand
// =============================================

async function processVoiceCommand(transcript) {
    const message = transcript.toLowerCase().trim();
    if (userMessage) userMessage.textContent = transcript;

    debugLog(`üîä Sesli komut: "${message}" | Mevcut k√∂k: ${commandRoot}`);

    try {
        // Askƒ±da cevap varsa AI'ya y√∂nlendir
        if (pendingResponse) {
            await handleAIRequest(message, commandRoot, pendingResponse);
            pendingResponse = null;
            return;
        }

        // Veritabanƒ±ndan kural ara
        const rule = await findRuleInDatabase(message, commandRoot);
        
        if (rule) {
            await executeDatabaseRule(rule, message);
        } else {
            // Kural yoksa AI'ya y√∂nlendir
            pendingResponse = { message: message, root: commandRoot };
            await handleAIRequest(message, commandRoot);
        }
    } catch (error) {
        console.error('Sesli komut i≈üleme hatasƒ±:', error);
        speakToUser("Komut i≈ülenirken bir hata olu≈ütu.");
    }
}

// =============================================
// G√úNCELLENMƒ∞≈û initApp
// =============================================



// Storage temizlik kontrol√º
async function checkAndCleanStorage() {
    const session = localStorage.getItem('onurmarket_session');
    if (session) {
        try {
            const sessionData = JSON.parse(session);
            // 24 saatten eski oturumlarƒ± temizle
            const now = new Date().getTime();
            if (now - sessionData.timestamp > 24 * 60 * 60 * 1000) {
                clearUserDataFromStorage();
                debugLog('‚úÖ Eski oturum temizlendi');
            }
        } catch (error) {
            // Ge√ßersiz JSON, temizle
            clearUserDataFromStorage();
            debugLog('‚úÖ Ge√ßersiz oturum temizlendi');
        }
    }
}	
	
// Yardƒ±mcƒ± fonksiyonlar
function waitForDOMElements() {
    return new Promise((resolve) => {
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', resolve);
        } else {
            resolve();
        }
    });
}

	

// =============================================
// ACƒ∞L DURUM FALLBACK'ƒ∞ G√úNCELLE
// =============================================
// Acil durum konum sistemi - TAMƒ∞R EDƒ∞LMƒ∞≈û

function emergencyFallback() {
    debugLog('üÜò Acil durum modu aktif');
    
    // Temel fonksiyonlarƒ± manuel ba≈ülat
    setupLocationEvents();
    
    // Demo verilerle devam et
    if (!storeTypes || storeTypes.length === 0) {
        useFallbackStoreTypes();
    }
    
    // Konum se√ßilmemi≈üse modal g√∂ster
    if (!selectedLocation) {
        setTimeout(() => {
            showLocationModal();
        }, 1000);
    }
}
// Yardƒ±mcƒ± fonksiyonlar
function waitForDOMElements() {
    return new Promise((resolve) => {
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', resolve);
        } else {
            resolve();
        }
    });
}

function debugLog(message) {
    console.log(`[DEBUG] ${new Date().toISOString()}: ${message}`);
}	
	// Yardƒ±mcƒ± fonksiyonlar
        function scrollElement(element, amount) {
            if (element) {
                element.scrollBy({ left: amount, behavior: 'smooth' });
            }
        }

        function toggleCart() {
            if (cartContainer.classList.contains('open')) {
                closeCart();
            } else {
                openCart();
            }
        }

        function openCart() {
            if (cartContainer) {
                cartContainer.classList.add('open');
            }
        }

        function closeCart() {
            if (cartContainer) {
                cartContainer.classList.remove('open');
            }
        }

    

  
        // =============================================
        // GE√áƒ∞Cƒ∞ FONKSƒ∞YONLAR (1. B√ñL√úM'de tamamlanacak)
        // =============================================

        // Bu fonksiyonlar 1. B√∂l√ºm'de detaylandƒ±rƒ±lacak
        async function restoreSession() {
            // Ge√ßici implementasyon
            const savedSession = localStorage.getItem('onurmarket_session');
            if (savedSession) {
                try {
                    const sessionData = JSON.parse(savedSession);
                    currentCustomer = sessionData.customer;
                    debugLog('‚úÖ Oturum geri y√ºklendi');
                } catch (error) {
                    console.error('Oturum geri y√ºkleme hatasƒ±:', error);
                }
            }
        }

      

async function checkCustomerByPhone(phone) {
    try {
        debugLog(`üìû Telefon kontrol ediliyor: ${phone}`);
        
        // Ge√ßici demo m√º≈üteri
        currentCustomer = {
            id: 1,
            name: "Demo Kullanƒ±cƒ±",
            phone: phone,
            city: "ƒ∞stanbul",
            address: "Demo Adres"
        };
        
        updateCustomerUI();
        hideHowItWorksBanner();
        
        speakToUser(`Ho≈ü geldiniz ${currentCustomer.name}!`);
        commandRoot = '2:1'; // Satƒ±cƒ± se√ßimine git
        
        debugLog('‚úÖ M√º≈üteri giri≈üi ba≈üarƒ±lƒ±');
        
    } catch (error) {
        console.error('M√º≈üteri kontrol hatasƒ±:', error);
        speakToUser("Giri≈ü i≈ülemi sƒ±rasƒ±nda bir hata olu≈ütu.");
    }
}



	
        function logout() {
            // Ge√ßici implementasyon - 1. B√∂l√ºm'de tamamlanacak
            console.log('√áƒ±kƒ±≈ü yapƒ±lƒ±yor...');
        }

        function finalizeOrder(method) {
            // Ge√ßici implementasyon - 3. B√∂l√ºm'de tamamlanacak
            console.log('√ñdeme y√∂ntemi:', method);
        }


// =============================================
// 1. B√ñL√úM: LOGIN Gƒ∞Rƒ∞≈û VE KAYIT S√úRECƒ∞
// =============================================

// Kullanƒ±cƒ± oturumunu geri y√ºkle
async function restoreSession() {
    try {
        const savedSession = localStorage.getItem('onurmarket_session');
        if (savedSession) {
            const sessionData = JSON.parse(savedSession);
            const now = new Date().getTime();
            
            // 24 saat i√ßindeki oturumu geri y√ºkle
            if (now - sessionData.timestamp < 24 * 60 * 60 * 1000) {
                currentCustomer = sessionData.customer;
                cart = sessionData.cart || [];
                selectedSellerId = sessionData.selectedSellerId;
                selectedLocation = sessionData.selectedLocation;
                
                updateCustomerUI();
                updateCartUI();
                
                if (currentCustomer) {
                    hideHowItWorksBanner();
                    orderSummary.style.display = 'flex';
                    
                    if (selectedLocation) {
                        updateLocationText();
                    } else {
                        showLocationModal();
                    }
                }
            } else {
                localStorage.removeItem('onurmarket_session');
            }
        }
    } catch (error) {
        console.error('Oturum geri y√ºkleme hatasƒ±:', error);
        localStorage.removeItem('onurmarket_session');
    }
}

// Oturumu kaydet
function saveSession() {
    if (currentCustomer) {
        const sessionData = { 
            customer: currentCustomer, 
            cart: cart, 
            selectedSellerId: selectedSellerId, 
            selectedLocation: selectedLocation, 
            timestamp: new Date().getTime()
        };
        localStorage.setItem('onurmarket_session', JSON.stringify(sessionData));
    }
}

// =============================================
// 1. B√ñL√úM EKSƒ∞KLERƒ∞Nƒ∞ TAMAMLAMA - VERƒ∞TABANI BAƒûLANTILARI
// =============================================

// 1.1. Telefon ile m√º≈üteri kontrol√º - TAMAMLANMI≈û HALƒ∞
// M√º≈üteri kontrol√º - TAM GER√áEK SORGULAR
async function checkCustomerByPhone(phone) {
    try {
        const cleanPhone = phone.replace(/\D/g, '');
        
        const { data, error } = await supabase
            .from('customers')
            .select('*')
            .eq('phone', cleanPhone)
            .maybeSingle();
        
        if (error) {
            console.error('M√º≈üteri sorgulama hatasƒ±:', error);
            throw error;
        }
        
        if (data) {
            // Mevcut kullanƒ±cƒ± bulundu
            currentCustomer = data;
            updateCustomerUI();
            hideHowItWorksBanner();
            orderSummary.style.display = 'flex';
            
            speakToUser(`Ho≈ü geldiniz ${data.name}! Sisteminiz a√ßƒ±lmƒ±≈ütƒ±r.`);
            conversationStep = 10;
            
            saveSession();
            
            if (!selectedLocation) {
                showLocationModal();
            }
        } else {
            // Yeni kullanƒ±cƒ±
            speakToUser("Telefon numaranƒ±z kayƒ±tlƒ± deƒüil. Yeni √ºyelik olu≈üturalƒ±m. L√ºtfen adƒ±nƒ±zƒ± ve soyadƒ±nƒ±zƒ± s√∂yler misiniz?");
            conversationStep = 2;
            
            currentCustomer = { 
                phone: cleanPhone, 
                role: 'customer',
                bonus_amount: 0 
            };
        }
        
    } catch (error) {
        console.error('M√º≈üteri kontrol hatasƒ±:', error);
        speakToUser("Sistemde ge√ßici bir sorun olu≈ütu. L√ºtfen daha sonra tekrar deneyiniz.");
    }
}
// Yeni m√º≈üteri kaydƒ± - TAM GER√áEK SORGULAR
async function createCustomerProfile(customerData) {
    try {
        const { data, error } = await supabase
            .from('customers')
            .insert([{
                name: customerData.name,
                phone: customerData.phone,
                city: customerData.city,
                address: customerData.address,
                role: 'customer',
                bonus_amount: 0,
                created_at: new Date().toISOString()
            }])
            .select()
            .single();
        
        if (error) throw error;
        
        currentCustomer = data;
        updateCustomerUI();
        hideHowItWorksBanner();
        orderSummary.style.display = 'flex';
        
        speakToUser(`Profiliniz olu≈üturuldu! Ho≈ü geldiniz ${customerData.name}.`);
        conversationStep = 10;
        
        saveSession();
        
        if (!selectedLocation) {
            showLocationModal();
        }
        
    } catch (error) {
        console.error('Profil olu≈üturma hatasƒ±:', error);
        speakToUser("Profil olu≈üturulurken bir hata olu≈ütu. L√ºtfen daha sonra tekrar deneyin.");
    }
}
// Kullanƒ±cƒ± aray√ºz√ºn√º g√ºncelle
function updateCustomerUI() {
    if (currentCustomer) {
        if (userName) userName.textContent = currentCustomer.name || 'Profilim';
        if (profileName) profileName.textContent = currentCustomer.name || '-';
        if (profilePhone) profilePhone.textContent = currentCustomer.phone || '-';
        if (profileCity) profileCity.textContent = currentCustomer.city || '-';
        if (profileAddress) profileAddress.textContent = currentCustomer.address || '-';
        if (profileBonus) profileBonus.textContent = money(currentCustomer.bonus_amount || 0);
        if (profileAvatar) profileAvatar.textContent = (currentCustomer.name || 'P').charAt(0).toUpperCase();
    }
}

// √áƒ±kƒ±≈ü i≈ülemi
async function logout() {
    try {
        speakToUser("Oturumunuz kapatƒ±lƒ±yor...");
        
        // 1. √ñnce g√∂rsel geri bildirim g√∂ster
        showNotification("√áƒ±kƒ±≈ü yapƒ±lƒ±yor...", "info");
        
        // 2. T√ºm storage'ƒ± temizle - √ñNCE BUNU YAP
        clearUserDataFromStorage();
        
        // 3. Global deƒüi≈ükenleri sƒ±fƒ±rla
        resetAppState();
        
        // 4. Kƒ±sa bir gecikme
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // 5. UI'ƒ± g√ºncelle
        updateUIAfterLogout();
        
        // 6. Sayfayƒ± yenile (yeniden ba≈ülat)
        setTimeout(() => {
            window.location.reload();
        }, 1500);
        
    } catch (error) {
        console.error('√áƒ±kƒ±≈ü i≈ülemi sƒ±rasƒ±nda hata:', error);
        performEmergencyLogout();
    }
}
	
// Asƒ±l √ßƒ±kƒ±≈ü i≈ülemleri
function performLogout() {
    currentCustomer = null;
    cart = [];
    clearUserDataFromStorage();
    updateUIAfterLogout();
    
    speakToUser("Oturumunuz ba≈üarƒ±yla kapatƒ±ldƒ±. Yeni bir alƒ±≈üveri≈üe ba≈ülayabilirsiniz.");
    
    setTimeout(() => {
        window.location.reload();
    }, 2000);
}

	// App state sƒ±fƒ±rlama
function resetAppState() {
    currentCustomer = null;
    sellers = [];
    products = [];
    categories = [];
    storeTypes = [];
    cart = [];
    isListening = false;
    isMicrophoneEnabled = false;
    conversationStep = 0;
    currentPaymentMethod = null;
    selectedSellerId = null;
    selectedSellerType = null;
    selectedCategoryId = null;
    isSellerLocked = false;
    selectedLocation = null;
    referralCode = null;
    referralGroupCode = null;
    commandRoot = "0:0";
    pendingResponse = null;
    
    debugLog('‚úÖ App state sƒ±fƒ±rlandƒ±');
}
	
// Acil durum √ßƒ±kƒ±≈üƒ±
function performEmergencyLogout() {
    localStorage.clear();
    currentCustomer = null;
    cart = [];
    updateUIAfterLogout();
    speakToUser("Oturumunuz kapatƒ±ldƒ±.");
    
    setTimeout(() => {
        window.location.reload();
    }, 1000);
}

// Storage temizleme fonksiyonu
function clearUserDataFromStorage() {
    localStorage.removeItem('onurmarket_session');
    localStorage.removeItem('selectedLocation');
    localStorage.removeItem('storeTypes');
    localStorage.removeItem('currentCustomer');
    debugLog('‚úÖ T√ºm storage verileri temizlendi');
}

// √áƒ±kƒ±≈ü sonrasƒ± UI g√ºncelleme
function updateUIAfterLogout() {
    if (userName) userName.textContent = 'Profilim';
    if (profileName) profileName.textContent = '-';
    if (profilePhone) profilePhone.textContent = '-';
    if (profileCity) profileCity.textContent = '-';
    if (profileAddress) profileAddress.textContent = '-';
    if (profileBonus) profileBonus.textContent = '0 ‚Ç∫';
    if (profileAvatar) profileAvatar.textContent = 'P';
    
    if (orderSummary) orderSummary.style.display = 'none';
    showHowItWorksBanner();
}

// Banner y√∂netimi
function showHowItWorksBanner() {
    const banner = document.getElementById('howItWorks');
    if (banner) banner.style.display = 'block';
    
    // Diƒüer b√∂l√ºmleri gizle
    const sections = ['categoriesSection', 'sellersSection', 'productsSection'];
    sections.forEach(section => {
        const el = document.getElementById(section);
        if (el) el.style.display = 'none';
    });
}

function hideHowItWorksBanner() {
    const banner = document.getElementById('howItWorks');
    if (banner) banner.style.display = 'none';
    
    // Diƒüer b√∂l√ºmleri g√∂ster
    const sections = ['categoriesSection', 'sellersSection'];
    sections.forEach(section => {
        const el = document.getElementById(section);
        if (el) el.style.display = 'block';
    });
}

// Bildirim g√∂ster
function showNotification(message, type = 'info') {
    // Basit bir bildirim sistemi
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        background: ${type === 'error' ? '#f44336' : type === 'success' ? '#4CAF50' : '#2196F3'};
        color: white;
        border-radius: 5px;
        z-index: 10000;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    `;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// =============================================
// 2. B√ñL√úM: REYONLARIN, SATICILARIN Y√úKLENMESƒ∞
// =============================================

async function loadStoreTypes() {
    try {
        debugLog('üîß StoreTypes y√ºkleniyor...');
        
        // DETAYLI SORGULAMA
        const { data, error, count } = await supabase
            .from('store_type')
            .select('*', { count: 'exact' }) // Kayƒ±t sayƒ±sƒ±nƒ± da al
            .eq('status', 'Active')
			.order('sort_code');

        debugLog('üîç StoreTypes sorgu sonucu:', { 
            dataLength: data?.length, 
            error: error,
            count: count 
        });

        if (error) {
            console.error('‚ùå StoreTypes y√ºkleme hatasƒ±:', error);
            console.error('‚ùå Hata detaylarƒ±:', {
                message: error.message,
                details: error.details,
                hint: error.hint,
                code: error.code
            });
            throw error;
        }

        if (data && data.length > 0) {
            storeTypes = data;
            localStorage.setItem('storeTypes', JSON.stringify(storeTypes));
            debugLog(`‚úÖ StoreTypes sunucudan y√ºklendi: ${data.length} adet`);
            displayStoreTypes(storeTypes);
            return;
        }

        // VERƒ∞ YOKSA FALLBACK
        console.warn('‚ö†Ô∏è StoreTypes verisi bo≈ü, fallback kullanƒ±lƒ±yor. Count:', count);
        throw new Error('StoreTypes verisi bo≈ü');
        
    } catch (error) {
        console.error('‚ùå StoreTypes y√ºkleme hatasƒ±:', error);
        
        // Cache'den dene
        const cached = localStorage.getItem('storeTypes');
        if (cached) {
            try {
                storeTypes = JSON.parse(cached);
                debugLog('‚úÖ StoreTypes cache\'den y√ºklendi');
                displayStoreTypes(storeTypes);
            } catch (parseError) {
                console.error('‚ùå Cache parse hatasƒ±:', parseError);
                await useFallbackStoreTypes();
            }
        } else {
            // Son √ßare: demo veriler
            await useFallbackStoreTypes();
        }
    }
}	
// Store type'larƒ± ekranda g√∂ster
function displayStoreTypes(types) {
    const sellerTypeGrid = document.getElementById('sellerTypeGrid');
    if (!sellerTypeGrid) {
        console.error('‚ùå SellerTypeGrid bulunamadƒ±');
        return;
    }
    
    sellerTypeGrid.innerHTML = '';
    
    if (!types || types.length === 0) {
        sellerTypeGrid.innerHTML = `
            <div class="text-center" style="min-width: 100%; padding: 40px; color: #6c757d;">
                <i class="fas fa-store fa-3x mb-3"></i>
                <p>Maƒüaza tipi bulunamadƒ±</p>
            </div>
        `;
        return;
    }
    
    const iconMap = {
        'Market': 'fas fa-store',
        'Restoran': 'fas fa-utensils',
        'Eczane': 'fas fa-prescription-bottle',
        'Fƒ±rƒ±n': 'fas fa-bread-slice',
        'Kafe': 'fas fa-coffee'
    };
    
    types.forEach(type => {
        const typeCard = document.createElement('div');
        typeCard.className = 'seller-type-card';
        typeCard.dataset.typeId = type.id;
        typeCard.dataset.typeName = type.name;
        
        typeCard.innerHTML = `
            <div class="seller-type-icon">
                <i class="${iconMap[type.name] || 'fas fa-store'}"></i>
            </div>
            <div class="seller-type-name">${type.name}</div>
        `;
        
        typeCard.addEventListener('click', () => {
            // T√ºm kartlardan se√ßimi kaldƒ±r
            document.querySelectorAll('.seller-type-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Bu kartƒ± se√ßili yap
            typeCard.classList.add('selected');
            
            onStoreTypeSelected(type.id, type.name);
        });
        
        sellerTypeGrid.appendChild(typeCard);
    });
    
    debugLog("‚úÖ Store type'lar ba≈üarƒ±yla y√ºklendi");
}

// Store type se√ßildiƒüinde - TAMƒ∞R EDƒ∞LMƒ∞≈û
async function onStoreTypeSelected(storeTypeId, storeTypeName) {
    debugLog("üõçÔ∏è Store type se√ßildi:", storeTypeName, "ID:", storeTypeId);
    
    selectedSellerType = storeTypeName;
    selectedSellerId = null; // Yeni store type se√ßildiƒüinde satƒ±cƒ±yƒ± sƒ±fƒ±rla
    
    // Kategori/reyon ba≈ülƒ±ƒüƒ±nƒ± g√ºncelle
    if (categoriesTitle) {
        categoriesTitle.textContent = storeTypeName === 'Market' ? 'üõí Reyonlar' : 'üìã Men√º Kategorileri';
    }
    
    // ƒ∞lgili b√∂l√ºmleri sƒ±fƒ±rla
    resetSections();
    
    // Reyonlarƒ± y√ºkle
    await loadReyonsByStoreType(storeTypeId);
    
    // Satƒ±cƒ±larƒ± y√ºkle
    await loadSellersByStoreType(storeTypeId);
    
    speakToUser(`${storeTypeName} se√ßildi. Size en yakƒ±n ${storeTypeName.toLowerCase()}lar listeleniyor.`);
}
	// B√∂l√ºmleri sƒ±fƒ±rla
function resetSections() {
    if (categoriesSection) {
        categoriesSection.style.display = 'block';
        categoriesGrid.innerHTML = '<div class="text-center">Y√ºkleniyor...</div>';
    }
    if (sellersSection) {
        sellersSection.style.display = 'block';
        sellerGrid.innerHTML = '<div class="text-center">Y√ºkleniyor...</div>';
    }
    if (productsSection) {
        productsSection.style.display = 'none';
        productsGrid.innerHTML = '';
    }
    if (selectedSellerInfo) {
        selectedSellerInfo.textContent = 'Satƒ±cƒ± se√ßilmedi';
    }
}
// =============================================
// 2. B√ñL√úM VERƒ∞TABANI EKSƒ∞KLERƒ∞Nƒ∞ TAMAMLAMA - REYON/SATICILAR
// =============================================

// Reyon y√ºkleme - TAMƒ∞R EDƒ∞LMƒ∞≈û
async function loadReyonsByStoreType(storeTypeId) {
    try {
        debugLog(`üõí Reyonlar y√ºkleniyor, StoreType: ${storeTypeId}`);
        
        const { data, error } = await supabase
            .from('reyon')
            .select('*')
            .eq('store_type_id', storeTypeId)
            .order('name');

        if (error) {
            console.error('‚ùå Reyon y√ºkleme hatasƒ±:', error);
            throw error;
        }

        categories = data || [];
        displayCategories(categories, 'reyon');
        debugLog(`‚úÖ Reyonlar y√ºklendi: ${categories.length} adet`);

    } catch (error) {
        console.error('‚ùå Reyon y√ºkleme hatasƒ±:', error);
        // Fallback demo reyonlar
        categories = getDemoReyons(storeTypeId);
        displayCategories(categories, 'reyon');
        debugLog('üîÑ Demo reyonlar kullanƒ±lƒ±yor');
    }
}

	// Satƒ±cƒ± y√ºkleme - G√ú√áLENDƒ∞Rƒ∞LMƒ∞≈û
loadSellersByStoreType
// Kategorileri g√∂ster - TAMƒ∞R EDƒ∞LMƒ∞≈û
function displayCategories(categoriesToShow, type) {
    const categoriesGrid = document.getElementById('categoriesGrid');
    if (!categoriesGrid) return;
    
    categoriesGrid.innerHTML = '';
    
    if (categoriesToShow.length === 0) {
        categoriesGrid.innerHTML = `
            <div class="text-center" style="min-width: 100%; padding: 40px; color: #6c757d;">
                <i class="fas fa-box-open fa-3x mb-3"></i>
                <p>Kategori bulunamadƒ±</p>
            </div>
        `;
        return;
    }
    
    const iconMap = {
        'Meyve & Sebze': 'fas fa-apple-alt',
        'S√ºt √úr√ºnleri': 'fas fa-cheese',
        'Et & Tavuk': 'fas fa-drumstick-bite',
        'Temel Gƒ±da': 'fas fa-wheat-alt',
        'ƒ∞√ßecekler': 'fas fa-wine-bottle',
        'Ana Yemekler': 'fas fa-utensils',
        '√áorbalar': 'fas fa-bowl-food',
        'Salatalar': 'fas fa-leaf',
        'Tatlƒ±lar': 'fas fa-ice-cream',
        'Aƒürƒ± Kesiciler': 'fas fa-pills',
        'Vitaminler': 'fas fa-capsules',
        'Ekmekler': 'fas fa-bread-slice',
        'Pastalar': 'fas fa-birthday-cake'
    };
    
    categoriesToShow.forEach(category => {
        const categoryCard = document.createElement('div');
        categoryCard.className = 'category-card';
        categoryCard.dataset.categoryId = category.id;
        categoryCard.dataset.categoryName = category.name;
        
        categoryCard.innerHTML = `
            <div class="category-icon">
                <i class="${iconMap[category.name] || 'fas fa-box'}"></i>
            </div>
            <div class="category-name">${category.name}</div>
        `;
        
        categoryCard.addEventListener('click', function() {
            if (!selectedSellerId) {
                speakToUser("√ñnce bir satƒ±cƒ± se√ßmelisiniz.");
                return;
            }
            
            // T√ºm kartlardan se√ßimi kaldƒ±r
            document.querySelectorAll('.category-card').forEach(c => {
                c.classList.remove('selected');
            });
            
            // Bu kartƒ± se√ßili yap
            this.classList.add('selected');
            
            selectedCategoryId = category.id;
            
            // Reyon se√ßildiƒüinde √ºr√ºnleri filtrele
            filterProductsByReyon(category.id);
            
            debugLog(`üõí Reyon se√ßildi: ${category.name}`);
            speakToUser(`${category.name} reyonundaki √ºr√ºnler listeleniyor.`);
        });
        
        categoriesGrid.appendChild(categoryCard);
    });
}
// Satƒ±cƒ± y√ºkleme - TAMƒ∞R EDƒ∞LMƒ∞≈û
async function loadSellersByStoreType(storeTypeId) {
    try {
        // M√º≈üteri ≈üehir bilgisini al
        const customerCity = currentCustomer?.city || 'Bandƒ±rma';
        
        debugLog(`üîç Satƒ±cƒ±lar y√ºkleniyor: ${storeTypeId}, ≈ûehir: ${customerCity}`);
        
        const { data, error } = await supabase
            .from('seller_profiles')
            .select('*')
            .eq('status', 'True')
            .eq('store_type_id', storeTypeId)
            .ilike('city', `%${customerCity}%`)
            .order('business_name');

        if (error) {
            console.error('‚ùå Satƒ±cƒ± y√ºkleme hatasƒ±:', error);
            throw error;
        }

        if (data && data.length > 0) {
            sellers = data;
            debugLog(`‚úÖ Satƒ±cƒ±lar y√ºklendi: ${data.length} adet`);
            updateSellersGrid();
        } else {
            debugLog('‚ö†Ô∏è Bu kategoride satƒ±cƒ± bulunamadƒ±');
            sellers = [];
            updateSellersGrid();
            speakToUser("Bu kategoride size yakƒ±n satƒ±cƒ± bulunamadƒ±. L√ºtfen ba≈üka bir kategori se√ßin.");
        }

    } catch (error) {
        console.error('‚ùå Satƒ±cƒ± y√ºkleme hatasƒ±:', error);
        // Fallback demo satƒ±cƒ±lar
        sellers = getDemoSellers();
        updateSellersGrid();
        debugLog('üîÑ Demo satƒ±cƒ±lar kullanƒ±lƒ±yor');
    }
}
	// ƒ∞lk satƒ±cƒ±yƒ± otomatik se√ß
function selectFirstSeller(sellerId) {
    const sellerCard = document.querySelector(`[data-seller-id="${sellerId}"]`);
    if (sellerCard) {
        sellerCard.click();
        debugLog(`‚úÖ ƒ∞lk satƒ±cƒ± otomatik se√ßildi: ${sellerId}`);
    }
}
	
// Satƒ±cƒ± grid'ini g√ºncelle - TAMƒ∞R EDƒ∞LMƒ∞≈û
function updateSellersGrid() {
    const sellerGrid = document.getElementById('sellerGrid');
    if (!sellerGrid) return;
    
    sellerGrid.innerHTML = '';
    
    if (sellers.length === 0) {
        sellerGrid.innerHTML = `
            <div class="text-center" style="min-width: 100%; padding: 40px; color: #6c757d;">
                <i class="fas fa-store fa-3x mb-3"></i>
                <p>Bu kategoride satƒ±cƒ± bulunamadƒ±</p>
                <small>L√ºtfen konumunuzu kontrol edin</small>
            </div>
        `;
        return;
    }
    
    sellers.forEach(seller => {
        const sellerCard = document.createElement('div');
        sellerCard.className = 'seller-card';
        sellerCard.dataset.sellerId = seller.id;
        
        if (selectedSellerId === seller.id) {
            sellerCard.classList.add('selected');
        }
        if (isSellerLocked && selectedSellerId !== seller.id) {
            sellerCard.classList.add('disabled');
        }
        
        sellerCard.innerHTML = `
            <img src="${seller.imgurl || 'https://via.placeholder.com/200x120?text=Satƒ±cƒ±'}" 
                 alt="${seller.business_name || seller.full_name}" 
                 class="seller-image"
                 onerror="this.src='https://via.placeholder.com/200x120?text=Satƒ±cƒ±'">
            <div class="seller-info">
                <div class="seller-name">${seller.business_name || seller.full_name}</div>
                <div class="seller-details">
                    <span><i class="fas fa-map-marker-alt"></i> ${seller.city || '≈ûehir belirtilmemi≈ü'}</span>
                    <span><i class="fas fa-star" style="color: gold;"></i> 4.5</span>
                </div>
            </div>
        `;
        
        sellerCard.addEventListener('click', () => {
            if (isSellerLocked && selectedSellerId !== seller.id) {
                speakToUser("√ñnce sepetinizi bo≈üaltmalƒ±sƒ±nƒ±z farklƒ± bir satƒ±cƒ± se√ßmek i√ßin.");
                return;
            }
            
            selectSeller(seller);
        });
        
        sellerGrid.appendChild(sellerCard);
    });
}
// Satƒ±cƒ± se√ß - TAMƒ∞R EDƒ∞LMƒ∞≈û
async function selectSeller(seller) {
    // T√ºm satƒ±cƒ± kartlarƒ±ndan se√ßimi kaldƒ±r
    document.querySelectorAll('.seller-card').forEach(card => {
        card.classList.remove('selected');
    });
    
    // Bu satƒ±cƒ±yƒ± se√ßili yap
    const sellerCard = document.querySelector(`[data-seller-id="${seller.id}"]`);
    if (sellerCard) {
        sellerCard.classList.add('selected');
    }
    
    selectedSellerId = seller.id;
    
    // Satƒ±cƒ± bilgisini g√ºncelle
    if (selectedSellerInfo) {
        selectedSellerInfo.innerHTML = `
            <i class="fas fa-store"></i> ${seller.business_name || seller.full_name} 
            <small style="color: var(--gray);">- ${seller.city || ''}</small>
        `;
    }
    
    // √úr√ºnler b√∂l√ºm√ºn√º g√∂ster
    if (productsSection) {
        productsSection.style.display = 'block';
        productsGrid.innerHTML = '<div class="text-center">√úr√ºnler y√ºkleniyor...</div>';
    }
    
    debugLog(`‚úÖ Satƒ±cƒ± se√ßildi: ${seller.business_name || seller.full_name}`);
    speakToUser(`${seller.business_name || seller.full_name} se√ßildi. √úr√ºnler y√ºkleniyor.`);
    
    // Satƒ±cƒ±nƒ±n √ºr√ºnlerini y√ºkle
    await loadSellerProducts(seller.id);
}

// Reyona g√∂re √ºr√ºnleri grupla
function displayProductsByReyon(productsToShow) {
    if (!productsToShow || productsToShow.length === 0) {
        productsGrid.innerHTML = `
            <div class="text-center" style="grid-column: 1 / -1; padding: 40px; color: #6c757d;">
                <i class="fas fa-box-open fa-3x mb-3"></i>
                <p>Bu satƒ±cƒ±da √ºr√ºn bulunamadƒ±</p>
            </div>
        `;
        return;
    }
    
    // Reyona g√∂re grupla
    const productsByReyon = {};
    productsToShow.forEach(product => {
        const reyonId = product.reyon_id || 'other';
        if (!productsByReyon[reyonId]) {
            productsByReyon[reyonId] = [];
        }
        productsByReyon[reyonId].push(product);
    });
    
    // √úr√ºnleri g√∂ster
    displayProducts(productsToShow);
}
	
// Reyonalarƒ± √ºr√ºnlerle g√ºncelle
function updateReyonsWithProducts(products) {
    if (!categories || categories.length === 0) return;
    
    // √úr√ºnlerin reyon ID'lerini topla
    const productReyonIds = [...new Set(products.map(p => p.reyon_id).filter(id => id))];
    
    // Reyon kartlarƒ±nƒ± g√ºncelle
    const categoryCards = document.querySelectorAll('.category-card');
    categoryCards.forEach(card => {
        const categoryId = card.dataset.categoryId;
        const hasProducts = productReyonIds.includes(categoryId);
        
        if (hasProducts) {
            card.style.opacity = '1';
            card.style.cursor = 'pointer';
        } else {
            card.style.opacity = '0.5';
            card.style.cursor = 'not-allowed';
        }
    });
}	
	// Fallback veriler
async function useFallbackStoreTypes() {
    // Manuel olarak t√ºm store type'larƒ± tanƒ±mlayƒ±n
    storeTypes = [
        { id: '1', name: 'Market', code: 'market', description: 'Market ve bakkallar' },
        { id: '2', name: 'Restoran', code: 'restaurant', description: 'Yemek restoranlarƒ±' },
        { id: '3', name: 'Kafe', code: 'cafe', description: 'Kafe ve pastaneler' },
        { id: '4', name: 'Fƒ±rƒ±n', code: 'bakery', description: 'Fƒ±rƒ±n ve unlu mam√ºller' },
        { id: '5', name: 'Eczane', code: 'pharmacy', description: 'Eczane ve ila√ßlar' },
        { id: '6', name: 'Teknoloji', code: 'technology', description: 'Elektronik √ºr√ºnler' },
        { id: '7', name: 'Giyim', code: 'clothing', description: 'Giyim maƒüazalarƒ±' },
        { id: '8', name: 'Kitap', code: 'bookstore', description: 'Kitap√ßƒ±lar' },
        { id: '9', name: 'Spor', code: 'sports', description: 'Spor malzemeleri' },
        { id: '10', name: 'Kozmetik', code: 'cosmetics', description: 'Kozmetik √ºr√ºnler' },
        { id: '11', name: 'Ev E≈üyasƒ±', code: 'home', description: 'Ev e≈üyalarƒ±' },
        { id: '12', name: 'Oyuncak', code: 'toys', description: 'Oyuncak maƒüazalarƒ±' }
    ];
    
    localStorage.setItem('storeTypes', JSON.stringify(storeTypes));
    displayStoreTypes(storeTypes);
    debugLog('üîÑ Manuel StoreTypes kullanƒ±lƒ±yor');
}
function getDemoReyons(storeTypeId) {
    const demoReyons = {
        '1': [ // Market reyonlarƒ±
            { id: '1', name: 'Meyve & Sebze', image_url: '' },
            { id: '2', name: 'S√ºt √úr√ºnleri', image_url: '' },
            { id: '3', name: 'Et & Tavuk', image_url: '' }
        ],
        '2': [ // Restoran kategorileri
            { id: '4', name: 'Ana Yemekler' },
            { id: '5', name: '√áorbalar' },
            { id: '6', name: 'Tatlƒ±lar' }
        ],
        '3': [ // Eczane kategorileri
            { id: '7', name: 'Aƒürƒ± Kesiciler' },
            { id: '8', name: 'Vitaminler' }
        ]
    };
    
    return demoReyons[storeTypeId] || [];
}

function getDemoSellers() {
    return [
        { 
            id: '1', 
            full_name: "Migros", 
            city: "ƒ∞stanbul", 
            imgurl: "https://via.placeholder.com/200x120?text=Migros", 
            address: "Kadƒ±k√∂y, ƒ∞stanbul"
        },
        { 
            id: '2', 
            full_name: "CarrefourSA", 
            city: "ƒ∞stanbul", 
            imgurl: "https://via.placeholder.com/200x120?text=Carrefour", 
            address: "Be≈üikta≈ü, ƒ∞stanbul"
        }
    ];
}


// =============================================
// 2. SESLƒ∞ Gƒ∞Rƒ∞≈û/KAYIT AKI≈ûI TAMAMLAMA
// =============================================
// =============================================
// YARDIMCI FONKSƒ∞YONLAR
// =============================================

function calculateCartTotal() {
    return cart.reduce((total, item) => total + (item.price * item.quantity), 0) * 1.18;
}

function getAvailableProducts() {
    if (products.length === 0) return "Hen√ºz √ºr√ºn y√ºklenmedi.";
    return products.slice(0, 5).map(p => p.name).join(', ');
}

// √úr√ºn ekleme komutu (aynƒ± kalan)
function handleAddToCartCommand(message) {
    if (!selectedSellerId) {
        speakToUser("√ñnce bir satƒ±cƒ± se√ßmelisiniz.");
        commandRoot = "2:1";
        return;
    }
    
    const productMatch = extractProductInfo(message);
    if (productMatch) {
        const { productName, quantity } = productMatch;
        const foundProduct = findProductByName(productName);
        
        if (foundProduct) {
            addToCart(foundProduct, quantity);
            speakToUser(`${quantity} adet ${productName} sepete eklendi.`);
        } else {
            speakToUser(`√úzg√ºn√ºm, '${productName}' bulunamadƒ±. Mevcut √ºr√ºnler: ${getAvailableProducts()}`);
        }
    }
}
// =============================================
// 3. B√ñL√úM: SEPET VE Sƒ∞PARƒ∞≈û ƒ∞≈ûLEMLERƒ∞
// =============================================

// Satƒ±cƒ± √ºr√ºnlerini y√ºkle - TAMƒ∞R EDƒ∞LMƒ∞≈û
async function loadSellerProducts(sellerId) {
    try {
        debugLog(`üì¶ Satƒ±cƒ± √ºr√ºnleri y√ºkleniyor: ${sellerId}`);
        
        const { data, error } = await supabase
            .from('product_prices')
            .select(`
                *,
                products (
                    id, name, imgurl, reyon_id, category_id, is_active
                )
            `)
            .eq('sube_id', sellerId)
            .eq('products.is_active', true);

        if (error) {
            console.error('‚ùå √úr√ºn y√ºkleme hatasƒ±:', error);
            throw error;
        }

        // Veriyi i≈üle
        products = data
            .filter(item => item.products) // products null olmayanlarƒ± filtrele
            .map(item => ({
                id: item.products.id,
                product_price_id: item.id,
                name: item.products.name,
                price: item.price,
                discount_price: item.discount_price,
                imgurl: item.products.imgurl,
                reyon_id: item.products.reyon_id,
                category_id: item.products.category_id,
                seller_id: sellerId
            }));

        debugLog(`‚úÖ √úr√ºnler y√ºklendi: ${products.length} adet`);
        
        // Reyona g√∂re √ºr√ºnleri grupla ve g√∂ster
        displayProductsByReyon(products);
        
        // Reyonlarƒ± g√ºncelle (mevcut reyonlarla e≈üle≈üen)
        updateReyonsWithProducts(products);

    } catch (error) {
        console.error('‚ùå √úr√ºn y√ºkleme hatasƒ±:', error);
        products = getDemoProducts();
        displayProducts(products);
        debugLog('üîÑ Demo √ºr√ºnler kullanƒ±lƒ±yor');
    }
}

// √úr√ºnleri g√∂ster
function displayProducts(productsToShow) {
    const productsGrid = document.getElementById('productsGrid');
    if (!productsGrid) return;
    
    productsGrid.innerHTML = '';
    
    if (productsToShow.length === 0) {
        productsGrid.innerHTML = `
            <div class="text-center" style="grid-column: 1 / -1; padding: 40px; color: #6c757d;">
                <i class="fas fa-box-open fa-3x mb-3"></i>
                <p>Bu kategoride √ºr√ºn bulunamadƒ±</p>
            </div>
        `;
        return;
    }
    
    productsToShow.forEach(product => {
        const productCard = document.createElement('div');
        productCard.className = 'product-card';
        
        let badgeHTML = '';
        if (product.discount_price && product.discount_price < product.price) {
            badgeHTML = `<div class="product-badge">ƒ∞ndirim</div>`;
        }
        
        let priceHTML = `<div class="product-price">${money(product.price)}</div>`;
        if (product.discount_price && product.discount_price < product.price) {
            priceHTML = `
                <div>
                    <span class="product-price">${money(product.discount_price)}</span>
                    <span class="product-discount">${money(product.price)}</span>
                </div>
            `;
        }
        
        productCard.innerHTML = `
            ${badgeHTML}
            <img src="${product.imgurl || 'https://via.placeholder.com/150x100?text=√úr√ºn'}" alt="${product.name}" class="product-image">
            <div class="product-info">
                <div class="product-name">${product.name}</div>
                ${priceHTML}
                <button class="add-to-cart-btn" data-id="${product.id}" style="margin-top: 10px; width: 100%; padding: 8px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer;">Sepete Ekle</button>
            </div>
        `;
        
        const addToCartBtn = productCard.querySelector('.add-to-cart-btn');
        addToCartBtn.addEventListener('click', function() {
            addToCart(product, 1, productCard);
        });
        
        productsGrid.appendChild(productCard);
    });
}

// Sepete √ºr√ºn ekle
function addToCart(product, quantity, productElement = null) {
    // Sepete √ºr√ºn ekle
    const existingItem = cart.find(item => item.id === product.id);
    
    if (existingItem) {
        existingItem.quantity += quantity;
    } else {
        cart.push({ 
            id: product.id, 
            product_price_id: product.product_price_id, 
            name: product.name, 
            price: product.discount_price || product.price, 
            quantity: quantity, 
            imgurl: product.imgurl,
            seller_id: product.seller_id
        });
    }
    
    // Satƒ±cƒ± kilidini aktif et
    if (!isSellerLocked) {
        isSellerLocked = true;
        updateSellersGrid();
    }
    
    updateCartUI();
    
    // Animasyon efekti
    if (productElement) {
        productElement.style.transform = 'scale(0.95)';
        setTimeout(() => {
            productElement.style.transform = 'scale(1)';
        }, 200);
    }
    
    speakToUser(`${product.name} sepete eklendi.`);
}

// Sepet UI'ƒ±nƒ± g√ºncelle
function updateCartUI() {
    if (!cartItems) return;
    
    cartItems.innerHTML = '';
    
    if (cart.length === 0) {
        cartItems.innerHTML = `
            <div class="text-center" style="padding: 30px; color: #6c757d;">
                <i class="fas fa-shopping-cart fa-2x mb-3"></i>
                <p>Sepetiniz bo≈ü</p>
            </div>
        `;
        if (orderCount) orderCount.textContent = "0";
        if (orderTotal) orderTotal.textContent = "0 ‚Ç∫";
        
        // Sepet bo≈üsa satƒ±cƒ± kilidini kaldƒ±r
        if (isSellerLocked) {
            isSellerLocked = false;
            updateSellersGrid();
        }
    } else {
        cart.forEach(item => {
            const cartItem = document.createElement('div');
            cartItem.className = 'cart-item';
            cartItem.innerHTML = `
                <div class="cart-item-info">
                    <img src="${item.imgurl || 'https://via.placeholder.com/40x40?text=√úr√ºn'}" alt="${item.name}" class="cart-item-image">
                    <div class="cart-item-details">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">${money(item.price)}</div>
                    </div>
                </div>
                <div class="cart-item-controls">
                    <button class="quantity-btn decrease" data-id="${item.id}">-</button>
                    <span>${item.quantity}</span>
                    <button class="quantity-btn increase" data-id="${item.id}">+</button>
                </div>
            `;
            
            cartItems.appendChild(cartItem);
        });
        
        if (orderCount) orderCount.textContent = cart.reduce((total, item) => total + item.quantity, 0);
        
        // Miktar butonlarƒ±na event listener ekle
        document.querySelectorAll('.decrease').forEach(btn => {
            btn.addEventListener('click', function() {
                const productId = this.dataset.id;
                updateCartItemQuantity(productId, -1);
            });
        });
        
        document.querySelectorAll('.increase').forEach(btn => {
            btn.addEventListener('click', function() {
                const productId = this.dataset.id;
                updateCartItemQuantity(productId, 1);
            });
        });
    }
    
    // Toplamlarƒ± g√ºncelle
    updateCartTotals();
}

// Sepet toplamlarƒ±nƒ± g√ºncelle
function updateCartTotals() {
    const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
    const vat = subtotal * 0.18;
    const total = subtotal + vat;
    
    if (subtotalEl) subtotalEl.textContent = money(subtotal);
    if (vatAmountEl) vatAmountEl.textContent = money(vat);
    if (totalAmountEl) totalAmountEl.textContent = money(total);
    if (orderTotal) orderTotal.textContent = money(total);
}

// Sepet √ºr√ºn miktarƒ±nƒ± g√ºncelle
function updateCartItemQuantity(productId, change) {
    const item = cart.find(item => item.id === productId);
    if (item) {
        item.quantity += change;
        
        if (item.quantity <= 0) {
            cart = cart.filter(item => item.id !== productId);
        }
        
        updateCartUI();
    }
}

// =============================================
// 3. Sƒ∞PARƒ∞≈û TAMAMLAMA Sƒ∞STEMƒ∞
// =============================================

async function finalizeOrder(paymentMethod) {
    if (cart.length === 0) {
        speakToUser("Sepetiniz bo≈ü. L√ºtfen √∂nce √ºr√ºn ekleyin.");
        return;
    }
    
    if (!selectedSellerId) {
        speakToUser("L√ºtfen √∂nce bir satƒ±cƒ± se√ßin.");
        return;
    }
    
    if (!currentCustomer || currentCustomer.role === 'guest') {
        speakToUser("L√ºtfen √∂nce giri≈ü yapƒ±n.");
        return;
    }
    
    if (!selectedLocation) {
        speakToUser("L√ºtfen teslimat konumunuzu se√ßin.");
        showLocationModal();
        return;
    }
    
    const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
    const vat = subtotal * 0.18;
    const total = subtotal + vat;
    
    try {
        // 1. Sipari≈üi kaydet
        const { data: order, error: orderError } = await supabase
            .from('orders')
            .insert([{
                customer_id: currentCustomer.id,
                seller_id: selectedSellerId,
                total_amount: total,
                payment_method: paymentMethod,
                status: 'pending',
                location: selectedLocation,
                order_date: new Date().toISOString()
            }])
            .select()
            .single();
        
        if (orderError) throw orderError;
        
        // 2. Sipari≈ü detaylarƒ±nƒ± kaydet
        const orderDetails = cart.map(item => ({
            order_id: order.id,
            product_id: item.id,
            product_price_id: item.product_price_id,
            quantity: item.quantity,
            unit_price: item.price,
            tax_rate: 18
        }));
        
        const { error: detailsError } = await supabase
            .from('order_details')
            .insert(orderDetails);
        
        if (detailsError) throw detailsError;
        
        // 3. Bonus kullanƒ±mƒ±
        if (paymentMethod === 'bonus' && currentCustomer.bonus_amount >= total) {
            const newBonus = currentCustomer.bonus_amount - total;
            await supabase
                .from('customers')
                .update({ bonus_amount: newBonus })
                .eq('id', currentCustomer.id);
                
            currentCustomer.bonus_amount = newBonus;
            updateCustomerUI();
        }
        
        speakToUser(`Sipari≈üiniz alƒ±ndƒ±! Sipari≈ü numaranƒ±z: ${order.id}. Toplam: ${money(total)}`);
        
        // 4. Sepeti temizle
        setTimeout(() => {
            cart = [];
            updateCartUI();
            isSellerLocked = false;
            updateSellersGrid();
        }, 3000);
        
    } catch (error) {
        console.error('Sipari≈ü hatasƒ±:', error);
        speakToUser("Sipari≈üiniz alƒ±nƒ±rken bir hata olu≈ütu. L√ºtfen tekrar deneyin.");
    }
}
// Sepet i≈ülemleri
function toggleCart() {
    if (cartContainer.classList.contains('open')) {
        closeCart();
    } else {
        openCart();
    }
}

function openCart() {
    cartContainer.classList.add('open');
}

function closeCart() {
    cartContainer.classList.remove('open');
}

// Reyon'a g√∂re √ºr√ºnleri filtrele - TAMƒ∞R EDƒ∞LMƒ∞≈û
function filterProductsByReyon(reyonId) {
    if (!products || products.length === 0) {
        debugLog('‚ö†Ô∏è Filtrelenecek √ºr√ºn bulunamadƒ±');
        return;
    }
    
    const filteredProducts = products.filter(product => product.reyon_id === reyonId);
    
    if (filteredProducts.length > 0) {
        displayProducts(filteredProducts);
        debugLog(`‚úÖ Reyon filtreleme: ${filteredProducts.length} √ºr√ºn bulundu`);
    } else {
        // Bu reyonda √ºr√ºn yoksa t√ºm √ºr√ºnleri g√∂ster
        displayProducts(products);
        speakToUser("Bu reyonda √ºr√ºn bulunamadƒ±. T√ºm √ºr√ºnler g√∂steriliyor.");
    }
}
	// Kategoriye g√∂re √ºr√ºnleri filtrele
function filterProductsByCategory(categoryId) {
    const filteredProducts = products.filter(p => p.category_id === categoryId);
    displayProducts(filteredProducts.length > 0 ? filteredProducts : products);
}

// Demo √ºr√ºnler
function getDemoProducts() {
    return [
        { id: '1', name: "S√ºt 1L", price: 15.90, imgurl: "https://via.placeholder.com/150x100?text=S√ºt", discount_price: 12.90 },
        { id: '2', name: "Ekmek", price: 5.50, imgurl: "https://via.placeholder.com/150x100?text=Ekmek" },
        { id: '3', name: "Yumurta 10'lu", price: 32.00, imgurl: "https://via.placeholder.com/150x100?text=Yumurta" }
    ];
}

// Kaydƒ±rma fonksiyonu
function scrollElement(element, amount) {
    element.scrollBy({ left: amount, behavior: 'smooth' });
}

// Demo veri fallback'leri
function getDemoReyons(storeTypeId) {
    const demoReyons = {
        '1': [ { id: '1', name: 'Meyve & Sebze' }, { id: '2', name: 'S√ºt √úr√ºnleri' } ],
        '2': [ { id: '3', name: 'Ana Yemekler' }, { id: '4', name: '√áorbalar' } ]
    };
    return demoReyons[storeTypeId] || [];
}

function getDemoSellers() {
    return [
        { id: '1', full_name: "Demo Market", city: "ƒ∞stanbul", business_name: "Demo Market" }
    ];
}

function getDemoProducts() {
    return [
        { id: '1', name: "Demo √úr√ºn", price: 10.00, seller_id: '1', product_price_id: '1' }
    ];
}


// =============================================
// YENƒ∞ KONUM Sƒ∞STEMƒ∞ - locations kullanarak
// =============================================

// Global deƒüi≈üken
//let selectedLocation = localStorage.getItem('selectedLocation') || null;

// Konum sistemini ba≈ülat
function initializeLocationsSystem() {
    console.log('üìç YENƒ∞ KONUM Sƒ∞STEMƒ∞ BA≈ûLATILIYOR (locations)');
    
    setupLocationsMarker();
    setupLocationsModal();
    updateLocationsDisplay();
    
    // Eƒüer konum se√ßilmemi≈üse, modal'ƒ± g√∂ster
    if (!selectedLocation) {
        setTimeout(() => {
            showLocationsModal();
        }, 1500);
    }
}

// Konum marker'ƒ±nƒ± ayarla
function setupLocationsMarker() {
    const locationsMarker = document.getElementById('locationsMarker');
    if (!locationsMarker) {
        console.error('‚ùå Locations marker bulunamadƒ±');
        return;
    }
    
    // Stilleri uygula
    locationsMarker.style.cssText = `
        display: flex;
        align-items: center;
        gap: 8px;
        background: #e3f2fd;
        padding: 12px 18px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        border: 2px solid #2196f3;
        color: #1976d2;
        transition: all 0.3s ease;
        user-select: none;
    `;
    
    // Hover efektleri
    locationsMarker.addEventListener('mouseover', function() {
        this.style.background = '#bbdefb';
        this.style.transform = 'translateY(-2px)';
        this.style.boxShadow = '0 4px 12px rgba(33, 150, 243, 0.3)';
    });
    
    locationsMarker.addEventListener('mouseout', function() {
        this.style.background = '#e3f2fd';
        this.style.transform = 'translateY(0)';
        this.style.boxShadow = 'none';
    });
    
    // Tƒ±klama event'ini EKLE
    locationsMarker.addEventListener('click', handleLocationsClick);
    
    console.log('‚úÖ Locations marker ayarlandƒ±');
}

// Konum modal'ƒ±nƒ± ayarla
function setupLocationsModal() {
    const modal = document.getElementById('locationsModal');
    if (!modal) {
        console.error('‚ùå Locations modalƒ± bulunamadƒ±');
        return;
    }
    
    // Modal kapatma butonunu ayarla
    const closeBtn = document.getElementById('closeLocationsModal');
    if (closeBtn) {
        closeBtn.addEventListener('click', hideLocationsModal);
    }
    
    // Konum se√ßeneklerini ayarla
    setupLocationsOptions();
    
    // Modal dƒ±≈üƒ±na tƒ±klama
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            hideLocationsModal();
        }
    });
    
    console.log('‚úÖ Locations modalƒ± ayarlandƒ±');
}

// Konum se√ßeneklerini ayarla
function setupLocationsOptions() {
    const options = document.querySelectorAll('.locations-option');
    
    options.forEach(option => {
        // Mevcut event listener'larƒ± temizle
        const newOption = option.cloneNode(true);
        option.parentNode.replaceChild(newOption, option);
    });
    
    // Yeni event listener'larƒ± ekle
    document.querySelectorAll('.locations-option').forEach(option => {
        option.addEventListener('click', function() {
            const location = this.getAttribute('data-location');
            selectLocationsOption(location);
        });
        
        // Hover efektleri
        option.addEventListener('mouseover', function() {
            this.style.background = '#f0f7ff';
            this.style.borderColor = '#2196f3';
            this.style.transform = 'translateY(-2px)';
        });
        
        option.addEventListener('mouseout', function() {
            this.style.background = 'white';
            this.style.borderColor = '#ddd';
            this.style.transform = 'translateY(0)';
        });
    });
    
    console.log('‚úÖ Locations se√ßenekleri ayarlandƒ±');
}

// Konum tƒ±klama handler'ƒ±
function handleLocationsClick(e) {
    console.log('üéØ Locations marker tƒ±klandƒ±!');
    e.preventDefault();
    e.stopPropagation();
    showLocationsModal();
}

// Modal g√∂ster
function showLocationsModal() {
    const modal = document.getElementById('locationsModal');
    if (modal) {
        console.log('üìç Locations modal g√∂steriliyor');
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
}

// Modal gizle
function hideLocationsModal() {
    const modal = document.getElementById('locationsModal');
    if (modal) {
        console.log('üìç Locations modal gizleniyor');
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
}

// Konum se√ß
function selectLocationsOption(locationType) {
    console.log('üìç Locations se√ßildi:', locationType);
    
    selectedLocation = locationType;
    localStorage.setItem('selectedLocation', locationType);
    
    // UI'ƒ± g√ºncelle
    updateLocationsDisplay();
    
    // Modal'ƒ± kapat
    hideLocationsModal();
    
    // M√º≈üteri ≈üehir bilgisini g√ºncelle
    if (!currentCustomer) currentCustomer = {};
    if (!currentCustomer.city) currentCustomer.city = "Bandƒ±rma";
    
    speakToUser(`Konumunuz ${getLocationsName(locationType)} olarak ayarlandƒ±`);
    
    console.log('‚úÖ Locations ba≈üarƒ±yla se√ßildi');
}

// Konum g√∂r√ºnt√ºs√ºn√º g√ºncelle
function updateLocationsDisplay() {
    const locationsText = document.getElementById('locationsText');
    if (locationsText) {
        locationsText.textContent = getLocationsName(selectedLocation) || 'Konumunuzu se√ßin';
        
        if (selectedLocation) {
            locationsText.style.fontWeight = '600';
            locationsText.style.color = '#1976d2';
        }
    }
}

// Konum adƒ±nƒ± getir
function getLocationsName(locationType) {
    const names = {
        'inside': 'üìç Restoran i√ßinde',
        'takeaway': 'üì¶ Paket servis', 
        'delivery': 'üöö Adrese teslim'
    };
    return names[locationType] || locationType;
}
	



        // Sadece deƒüi≈üken isimlerini appState kullanacak ≈üekilde g√ºncelleyin

        // √ñrnek: loadStoreTypes fonksiyonu
        async function loadStoreTypes() {
            try {
                debugLog('üîß StoreTypes y√ºkleniyor...');
                
                // Basit bir demo veri ile devam edelim
                const demoStoreTypes = [
                    { id: 1, name: 'Market', code: 'market' },
                    { id: 2, name: 'Restoran', code: 'restaurant' },
                    { id: 3, name: 'Eczane', code: 'pharmacy' },
                    { id: 4, name: 'Fƒ±rƒ±n', code: 'bakery' }
                ];
                
                appState.storeTypes = demoStoreTypes;
                displayStoreTypes(demoStoreTypes);
                
                debugLog('‚úÖ StoreTypes y√ºklendi (demo)');
                
            } catch (error) {
                console.error('‚ùå StoreTypes y√ºkleme hatasƒ±:', error);
            }
        }

        function displayStoreTypes(types) {
            if (!domElements.sellerTypeGrid) return;
            
            domElements.sellerTypeGrid.innerHTML = '';
            
            types.forEach(type => {
                const typeCard = document.createElement('div');
                typeCard.className = 'seller-type-card';
                typeCard.innerHTML = `
                    <div class="seller-type-icon">
                        <i class="fas fa-store"></i>
                    </div>
                    <div class="seller-type-name">${type.name}</div>
                `;
                
                typeCard.addEventListener('click', function() {
                    alert(`${type.name} se√ßildi!`);
                    debugLog(`üõçÔ∏è Store type se√ßildi: ${type.name}`);
                });
                
                domElements.sellerTypeGrid.appendChild(typeCard);
            });
        }

        // Diƒüer yardƒ±mcƒ± fonksiyonlar
        function checkAndCleanStorage() {
            return new Promise(resolve => {
                debugLog('üßπ Storage temizlik kontrol√º...');
                // Basit bir temizlik
                setTimeout(resolve, 100);
            });
        }

        async function loadCommandRules() {
            debugLog('üîß Komut kurallarƒ± y√ºkleniyor...');
            return new Promise(resolve => setTimeout(resolve, 100));
        }

        async function restoreSession() {
            debugLog('üîê Oturum geri y√ºkleniyor...');
            return new Promise(resolve => setTimeout(resolve, 100));
        }

        function initializeLocation() {
            debugLog('üìç Konum y√∂netimi ba≈ülatƒ±lƒ±yor...');
        }

        function updateUIAfterLogin() {
            debugLog('üé® UI g√ºncelleniyor...');
        }

        function setupEventHandlers() {
            debugLog('üîß Event handlerlar ayarlanƒ±yor...');
        }

        function emergencyFallback() {
            debugLog('üÜò Acil durum modu aktif');
            alert('Acil durum modu: Temel i≈ülevler √ßalƒ±≈üƒ±yor');
        }

        // Sayfa y√ºklendiƒüinde basit init'i ba≈ülat
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('üìÑ DOM y√ºklendi, basit init ba≈ülatƒ±lƒ±yor...');
            setTimeout(simpleInit, 500);
        });

        // Hata yakalama
        window.addEventListener('error', function(e) {
            console.error('Global hata:', e.error);
            debugLog('‚ùå Global hata yakalandƒ±: ' + e.error.message);
        });

</script>	

</body>
</html>











