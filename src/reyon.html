<script>
  let count = 0;
  let cartItems = [];

  const cart = document.getElementById("cart");
  const cartCount = document.getElementById("cart-count");
  const cartList = document.getElementById("cart-list");
  const cartItemsEl = document.getElementById("cart-items");

  // ÃœrÃ¼n listesi (isim â†’ gÃ¶rsel eÅŸleÅŸmesi iÃ§in)
  const productMap = {
    "domates": { img: "https://cdn-icons-png.flaticon.com/512/766/766741.png", price: 40 },
    "soÄŸan": { img: "https://cdn-icons-png.flaticon.com/512/135/135620.png", price: 20 },
    "patlÄ±can": { img: "https://cdn-icons-png.flaticon.com/512/706/706164.png", price: 35 }
  };

  // Sepeti aÃ§/kapat
  cart.addEventListener("click", () => {
    cartList.classList.toggle("hidden");
  });

  function addToCart(name, imgUrl, qty = 1) {
    count += qty;
    cartCount.textContent = count;
    cart.classList.add("shake");
    setTimeout(() => cart.classList.remove("shake"), 500);

    // Sepette var mÄ± kontrol et
    let item = cartItems.find(i => i.name === name);
    if (item) {
      item.qty += qty;
    } else {
      cartItems.push({ name, qty });
    }
    renderCart();

    flyToCart(imgUrl);
  }

  function renderCart() {
    cartItemsEl.innerHTML = "";
    cartItems.forEach(item => {
      const li = document.createElement("li");
      li.textContent = `â€¢ ${item.name} x${item.qty}`;
      cartItemsEl.appendChild(li);
    });
  }

  function flyToCart(imgUrl) {
    const img = document.createElement("img");
    img.src = imgUrl;
    img.className = "fly w-12 h-12 rounded-full";
    document.body.appendChild(img);

    img.style.top = "200px";
    img.style.left = "200px";

    setTimeout(() => {
      const cartRect = cart.getBoundingClientRect();
      img.style.top = cartRect.top + "px";
      img.style.left = cartRect.left + "px";
      img.style.width = "20px";
      img.style.height = "20px";
      img.style.opacity = "0";
    }, 50);

    setTimeout(() => img.remove(), 900);
  }

  // ðŸ”Š Ses tanÄ±ma
  window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  const recognition = new SpeechRecognition();
  recognition.lang = "tr-TR";
  recognition.continuous = true;

  recognition.onresult = (e) => {
    const transcript = e.results[e.results.length - 1][0].transcript.toLowerCase().trim();
    console.log("Ses:", transcript);

    // MiktarÄ± yakala (Ã¶rn: "3 kilo soÄŸan")
    const qtyMatch = transcript.match(/(\d+)\s*(kilo|adet)?/);
    const qty = qtyMatch ? parseInt(qtyMatch[1]) : 1;

    // ÃœrÃ¼n adÄ± yakala
    for (let product in productMap) {
      if (transcript.includes(product)) {
        addToCart(product.charAt(0).toUpperCase() + product.slice(1), productMap[product].img, qty);
      }
    }
  };

  recognition.start();
</script>
