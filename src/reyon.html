<!-- Sepet listesi -->
<div id="cart-list" class="hidden fixed bottom-20 right-6 bg-white shadow-xl rounded-xl p-4 w-72">
  <h3 class="font-bold mb-2">Sepetim</h3>
  <ul id="cart-items" class="space-y-1 text-sm mb-3"></ul>

  <!-- Toplam -->
  <div class="flex justify-between font-bold border-t pt-2">
    <span>Toplam:</span>
    <span id="cart-total">0 ₺</span>
  </div>

  <!-- Sipariş Onay -->
  <button onclick="showPaymentOptions()" 
    class="w-full mt-3 bg-green-500 text-white py-2 rounded">Siparişi Onayla</button>

  <!-- Ödeme seçenekleri -->
  <div id="payment-options" class="hidden mt-3 space-y-2">
    <button onclick="selectPayment('Kapıda Nakit')" 
      class="w-full bg-yellow-500 text-white py-2 rounded">💵 Kapıda Nakit</button>
    <button onclick="selectPayment('Kapıda Kredi Kartı')" 
      class="w-full bg-blue-600 text-white py-2 rounded">💳 Kapıda Kredi Kartı</button>
  </div>
</div>

<script>
  let count = 0;
  let cartItems = [];

  const cartCount = document.getElementById("cart-count");
  const cartItemsEl = document.getElementById("cart-items");
  const cartTotalEl = document.getElementById("cart-total");
  const paymentOptions = document.getElementById("payment-options");

  // Ürün listesi (isim → görsel + fiyat eşleşmesi)
  const productMap = {
    "domates": { img: "https://cdn-icons-png.flaticon.com/512/766/766741.png", price: 40 },
    "soğan": { img: "https://cdn-icons-png.flaticon.com/512/135/135620.png", price: 20 },
    "patlıcan": { img: "https://cdn-icons-png.flaticon.com/512/706/706164.png", price: 35 }
  };

  function addToCart(name, imgUrl, qty = 1, price = 0) {
    count += qty;
    cartCount.textContent = count;

    let item = cartItems.find(i => i.name === name);
    if (item) {
      item.qty += qty;
    } else {
      cartItems.push({ name, qty, price });
    }
    renderCart();
  }

  function renderCart() {
    cartItemsEl.innerHTML = "";
    let total = 0;

    cartItems.forEach(item => {
      const li = document.createElement("li");
      const subtotal = item.qty * item.price;
      total += subtotal;
      li.textContent = `• ${item.name} x${item.qty} = ${subtotal} ₺`;
      cartItemsEl.appendChild(li);
    });

    cartTotalEl.textContent = `${total} ₺`;
  }

  function showPaymentOptions() {
    paymentOptions.classList.remove("hidden");
  }

  function selectPayment(type) {
    alert(`Ödeme tipiniz: ${type}\nSiparişiniz hazırlanıyor efendim 🙏`);
  }

  // 🔊 Ses tanıma
  window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  const recognition = new SpeechRecognition();
  recognition.lang = "tr-TR";
  recognition.continuous = true;

  recognition.onresult = (e) => {
    const transcript = e.results[e.results.length - 1][0].transcript.toLowerCase().trim();
    console.log("Ses:", transcript);

    const qtyMatch = transcript.match(/(\d+)\s*(kilo|adet)?/);
    const qty = qtyMatch ? parseInt(qtyMatch[1]) : 1;

    for (let product in productMap) {
      if (transcript.includes(product)) {
        addToCart(
          product.charAt(0).toUpperCase() + product.slice(1),
          productMap[product].img,
          qty,
          productMap[product].price
        );
      }
    }
  };

  recognition.start();
</script>
